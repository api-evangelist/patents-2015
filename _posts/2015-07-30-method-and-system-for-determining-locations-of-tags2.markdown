---

title: Method and system for determining locations of tags
abstract: Techniques for detecting the presence of a tag are described. According to one aspect of the present invention, a plurality of devices are deployed around an establishment, each of the devices is executing a client module to communicate with a server and receive a broadcast from a tag attached to an object (e.g., a human being or an item). As the object approaches to a device, the broadcast from the tag is received by a device that reports to the server. As a result, the server executing a server module can determine a movement trajectory of the object from those devices that have received the broadcast from the tag. One embodiment of the present invention can be used to track an asset or facilitate a location-based service to a user wearing the tag.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09646298&OS=09646298&RS=09646298
owner: Doorga Inc.
number: 09646298
owner_city: Palo Alto
owner_country: US
publication_date: 20150730
---
This application claims the benefits of U.S. Provisional Application No. 62 038 368 filed Aug. 17 2014 and entitled Method and system for enabling micro proximity detection check in and information access to improve customer engagement and advertisement accuracy which is hereby incorporated by reference for all purposes.

The present invention is generally related to the area of retail commerce. Particularly the present invention is related to method system and device for enabling micro proximity location detection and services.

Modern smartphones typically incorporate a number of communications subsystems for location services. One exemplary incorporated subsystem uses the Global Positioning System GPS for basic outdoor location services. This GPS subsystem uses signals from multiple geo stationary satellites to determine the longitude and latitude position of a smartphone. Such a technology is effective out of doors with an accuracy of plus or minus two meters but loses accuracy inside of buildings as the building roof and structure scatters the satellite signals. The GPS solutions also rapidly deplete the battery life of the mobile phone due to the high power consumption used to satisfy the need for rapid updated measurements from the geo stationary satellites as the user changes their location. While GPS is a solution for outdoor location services there is a need for indoor location services.

Currently the Wi Fi signal strength between a smartphone and one or more Wi Fi Access Points AP has been used in conjunction with a Global Position System GPS to determine the indoor location of the smartphone the user thereof within an establishment. By measuring received Wi Fi signal strength of periodic broadcasts from the smartphone at each AP Indoor Positioning System IPS software running on a Wi Fi controller connected to each of the APs can triangulate on the location of the smartphone achieving an position accuracy within plus or minus one meter. There are however several problems with this solution. In the GPS case the application running on the smartphone is a module determining the location of the phone. In the Wi Fi IPS case the location information is being collected and tracked by an external processor. Getting information from the external processor to the smartphone can be problematic because it typically requires an affirmative action by the user with his her smartphone. Such affirmative action might require the user to connect to a specific Wi Fi network by a name identifier or require the user to connect to a specific website or require the user to open a specific application on the smartphone. In addition the Wi Fi IPS solution is relatively expensive to purchase install and operate since even the lowest cost APs may cost from US 50 to 75 per AP and each AP location is restricted to a location within the reach of electric outlet power since Wi Fi APs cannot operate on limited battery power. Additionally the Wi Fi signals used for location triangulation can be scattered and disrupted by fixtures and other movable structures within a building and a radio phenomenon called multi path in which copies of the original Wi Fi radio signal are created when the original signal is bouncing off interference from indoor structures such as walls and ceilings. All of these problems make triangulation accuracy below a couple of meters impossible. Thus there is another need for solutions to determine a fairly precise location indoor.

More recently a new technology for location and proximity services has been introduced called Bluetooth Low Energy BLE beacons which overcome some of the problems with the Wi Fi IPS. They are easier to install than Wi Fi APs. Like GPS a smartphone performs the location discovery so there is no need for a separate processor which is external to the smartphone no need to get location information to the phone from another processor and the solution scales to any number of smartphones. BLE beacons are also typically battery operated making their placement in an establishment easier. However BLE beacons do suffer some problems. First they are implemented using standard general purpose Bluetooth Low Energy integrated circuits available from vendors such as Texas Instruments and Nordic Semiconductor. As they are designed to meet the full range of Bluetooth specifications they are quite overly sophisticated and costly devices.

Another technology incorporated into some smartphones that can enable and assist in providing location and proximity services is Near Field Communication NFC . Unlike the Wi Fi IPS or BLE beacons NFC devices are typically passive and only operate based on power received from radio waves of a smart phone that physically touch or nearly touch the NFC device. When a smartphone is placed within a millimeter or less to an NFC device the device is activated and generates a near field radio frequency signal that the smartphone can read. NFC devices are often packaged as stickers that can be attached to movable structures or even directly to products. If a user touches the device with his smartphone a resident app can read the information encoded in the device. NFC is also sometimes used to enable short communication directly between two smartphones such as an exchange of photographs when they bump or physically touch each other. Clearly NFC can be used for precise location and proximity services however it always requires that the user take an action to place the smartphone physically against the device. Therefore it cannot be used for passively locating a user within a radius of the device by either a mobile or fixed smartphone. In addition passive NFC devices can only broadcast the same static content and therefore cannot be easily protected so that only specific targeted mobile applications on smartphones are allowed to read the NFC device static content. In other words any third party smartphone application can easily read such NFC devices and generate unwanted content to be displayed to the user on the smartphone.

Still another technology that currently exists for indoor location and proximity services is Radio Frequency Identification RFID . While these devices are inexpensive and can be incorporated into stickers or badges they suffer from two major disadvantages. First most smartphones are not equipped to read RFID tags while a typical mobile RFID reader may cost more than 1500 USD. Secondly while fixed readers for automatically and remotely locating RFID devices do exist they require a costly RF infrastructure consisting of deploying multiple RFID antennas that are connected by coaxial cables to a shared reader. This shared reader is responsible for periodically energizing the RFID devices within the range of a given antenna and then listening for their presence and relative distance. The cost of the antennas shared reader and infrastructure can run to many thousands of US dollars per reader installation. Hence there are many applications for which RFID is not economically viable for indoor location and proximity services.

This section is for the purpose of summarizing some aspects of the present invention and to briefly introduce some preferred embodiments. Simplifications or omissions in this section as well as in the abstract or the title of this description may be made to avoid obscuring the purpose of this section the abstract and the title. Such simplifications or omissions are not intended to limit the scope of the present invention.

In general the present invention pertains to techniques for enabling micro proximity location detection and services. According to one aspect of the present invention an electronic device referred herein as micro proximity tag or simply tag is used in conjunction with mobile devices to provide the micro proximity location services. These tags may be disposed at specific locations to be detected by a mobile device. For example in a retail store such tags are individually disposed near specific products being displayed. When a user carrying a mobile phone standing near a product being displayed the phone is caused to receive signals from a tag disposed specifically for the product. The presence of the user with respect to the product is detected.

According to another aspect of the present invention some content in the broadcast by such micro proximity tags is encrypted and therefore securely protected so that only authorized mobile applications can read the content. When the presence of the user before a specific product is detected the application running on the mobile phone receives a content message targeted based on the specific product and causes the phone to display the message and send out a message e.g. a visual or an audio alert .

According to still another aspect of the present invention a plurality of such tags are respectively disposed near specific objects across a complex e.g. a store . A module is executed in mobile devices respectively associated with a group of contestants where the contestants are contesting to discover the specific objects for example to see promotions or advertisements thereof.

According to still another aspect of the present invention a client module is designed or configured to verify the purchase intent by consumers by confirming their locations in front of a specific product display or that a consumer has approached a cash register after viewing an online advertisement of the product that was previously displayed on his her mobile device.

According to still another aspect of the present invention the client module is designed or configured to track assets and or personnel within an enterprise. In this application a micro proximity tag is attached to an asset and or provided in a card form to a person. Fixed devices are strategically placed around the enterprise. As assets and or personnel enter into a range of the fixed devices their presence and approximate distance are reported periodically to a centralized device e.g. a server .

According to still another aspect of the present invention the client module is designed or configured to confirm the location of a consumer at a specific table in a restaurant in order to enable a wide variety of restaurant applications on mobile phones including menu display service request bill presentation payment and etc.

According to still another aspect of the present invention the tag is specifically designed. Relevant parameters of the tag can be selected and determined via a device e.g. a mobile device running the client module in a predefined mode e.g. write mode v. read mode . Not only is the transmission power controlled to a small amount for detection of a nearby device but the tag also operates periodically e.g. every 2 or 10 seconds to preserve the power driving it. The tag generates a transmission signal in compliance with a wireless technology standard so that the transmission signal can be received by a commonly used device e.g. a smartphone . In addition for simplicity the tag is not designed as a transceiver but operates as a transmitter only.

According to yet another aspect of the present invention the tag is specifically designed to transmit variable powers according to a pattern. At one moment the transmission power is decreased to a minimum so that the tag can only be heard at a certain distance by devices running the client module. At another moment it may be desirable for the tag to be heard by a device many meters away in which case the tag is caused to broadcast a signal e.g. data packets at a high transmission power. In any case the signal is broadcast periodically or at predefined regular intervals or this broadcast only occurs when a device is detected within a predefined radius distance from the tag.

To ensure that the micro proximity tags can be easily deployed without too much on site technical expertise additional aspects of the present invention are developed as a server module or a cloud based software platform referred herein as micro proximity tag services which operates with the tags to enable simplified on site association of a device with a set of predefined actions hereinafter as tag actions . Examples of the tag actions include opening a browser per a particular URL opening a mobile application with a particular message or notifying a server of an interested customer. The micro proximity tag services are provided via a server running a server module specifically designed to implement one embodiment of the present invention. In one embodiment the micro proximity tag Services allow an untrained retail employee to use a mobile application to scan a UPC bar code of a specific product or product display and then read the micro proximity tag thereby forming an association between the product and the tag.

In addition a platform is developed to enable a series of online information updates to confirm that a specific consumer has been located at a micro proximity location s such as a product display or restaurant table. These updates might include the date and time that the consumer was located by a specific device the content or URL displayed to the consumer and location based profile update of the consumer based on the specific device location.

The present invention may be implemented in various ways including an apparatus a method or a system. According to one embodiment the present invention is a method for providing tag services the method comprises receiving in a server a message from a device caused to receive a broadcast from a tag wherein the tag is disposed at a location the broadcast includes at least one data packet the message is generated by a client module being executed in the device in responding to the broadcast and includes an identity of the tag wherein a portion of the identity is encrypted generating in the server a response to the message in accordance with the identity and a profile of a user associated with the device sending the response to the device causing the client module to digest the response wherein the client module is configured to cause the device to display a promotion message on a display screen of the device.

According to another embodiment the present invention is a method for providing tag services the method comprises providing a client module to be loaded in a device the client module being automatically invoked when receiving a first broadcast from a first tag wherein the client module is registered with a server configured to provide the tag services generating by the client module a message when the device gets near a second tag and receives a second broadcast from the second tag the broadcast including at least one data packet determining a distance between the device and the second tag wherein the message includes an identity of the second tag and the determined distance transporting the message to the server identified by a predefined link wherein the server is configured to generate a response to the message in accordance with the identity and a profile of a user associated with the device and causing the device to perform an action when the client module receives the response from the server.

According to still another embodiment the present invention is a system for providing tag services the system comprises a plurality of tags respectively disposed across an establishment each of the tags designed to broadcast to a short range and receive no signals when set to detect a presence of a mobile device coming nearby and a server executing an installed server module configured to communicate with the mobile device when the mobile device is caused to receive a broadcast including the data packets from a tag wherein the mobile device is loaded with a client module registered with the server the server is configured to receive a message from the device and generate a response to the message and wherein the message includes an identity of the tag. Each of the tags packaged in a small form factor operates periodically on one or more batteries and comprises an antenna a state machine controller provided to randomize data packets for transmission in accordance with a wireless technology standard and a direct digital synthesizer provided to synthesize correct signal waveforms based upon data provided by the state machine controller and generate data packets to be broadcast via the antenna and to be received by the mobile device.

According to still another embodiment the present invention is a tag to facilitate tag services the tag comprises a battery an antenna a wake up timer to turn on and off operations of the tag per a predefined timing wherein the tag acts as a transmitter to transmit a broadcast in accordance with a wireless standard a state machine controller provided to randomize data packets a direct digital synthesizer provided to synthesize signal waveforms based upon data provided by the state machine controller and generate data packets to be broadcast via the antenna and a memory space to store at least an identifier of one tag action that is included in the broadcast and causes a device receiving the broadcast to react per the tag action wherein the device is loaded with a client module that is configured to digest the broadcast the tag action is one of tag actions predefined on a server.

According to still another embodiment the present invention is a method for determining a location of a tag the method comprises receiving in a server a message from a device caused to receive a broadcast from a tag wherein the device is disposed at a location the tag is attached to an object moving in an establishment the broadcast includes at least one data packet the message is generated by a client module being executed in the device in responding to the broadcast and includes an identity of the tag and an estimated distance determined by the client module in reference to a transmission power of the broadcast received in the device updating a profile created for the object in reference to the received message wherein the profile includes information pertaining to the identity of the tag and requesting an updated message from the device regarding the tag.

According to yet another embodiment the present invention is a system for determining a location of a tag the system comprises a plurality of devices respectively disposed around an establishment each of the devices executing a client module configured to cause the each of the devices to receive a broadcast from a tag attached to an object wherein the tag is designed to generate the broadcast from time to time in accordance with a wireless standard a device receives the broadcast when the object moves close to the device and a server remotely located with respect to the devices executing a server module to communicate with each of the devices and receives a message from the device when the device receives the broadcast from the tag wherein the message is generated by the client module being executed in the device in responding to the broadcast and includes an identity of the tag and an estimated distance determined by the client module in reference to a transmission power of the broadcast received in the device the identity includes a universally unique identifier UUID and an identifier ID of the tag and wherein the ID is encrypted.

Different objects features and advantages of the present invention will become apparent upon examining the following detailed description of an embodiment thereof taken in conjunction with the attached drawings.

The detailed description of the present invention is presented largely in terms of procedures steps logic blocks processing or other symbolic representations that directly or indirectly resemble the operations of data processing devices. These descriptions and representations are typically used by those skilled in the art to most effectively convey the substance of their work to others skilled in the art. Numerous specific details are set forth in order to provide a thorough understanding of the present invention. However it will become obvious to those skilled in the art that the present invention may be practiced without these specific details. In other instances well known methods procedures components and circuitry have not been described in detail to avoid unnecessarily obscuring aspects of the present invention.

Reference herein to one embodiment or an embodiment means that a particular feature structure or characteristic described in connection with the embodiment can be included in at least one embodiment of the invention. The appearances of the phrase in one embodiment in various places in the specification are not necessarily all referring to the same embodiment nor are separate or alternative embodiments mutually exclusive of other embodiments.

The present invention pertains to a method a platform a device and an application each of which is designed to enable micro proximity location detection and services f. As used herein any pronoun references to gender e.g. he him she her etc. are meant to be gender neutral. Unless otherwise explicitly stated the use of the pronoun he his or him hereinafter is only for administrative clarity and convenience. Additionally any use of the singular or to the plural shall also be construed to refer to the plural or to the singular respectively as warranted by the context. One of the benefits advantages and objectives in the present invention is to detect the presence of a user with respect to an object and provide a set of services in accordance with the presence.

Referring now to the drawings in which like numerals refer to like parts throughout the several views. shows an exemplary retail environment in which one embodiment of the present invention may be practiced. A plurality of micro proximity tags or tags are respectively disposed across the environment . Not specifically shown in there are tags respectively placed near specific products on display. These tags are used to detect the presence of users standing in front the products to show their potential interests in these products. According to one embodiment there are two such tags located at the entrance and exit of the establishment . Depending on implementation the tag at the entrance may activate a module if already installed in the mobile devices carried by the users alert a user to download a module if not yet installed to count users coming to the establishment and etc. the tag at the exit may activate the module in the mobile devices to perform mobile payments or to count users leaving the establishment and etc. The details of the module will further described below.

As a user or customer navigates in the establishment his mobile device running the client module is caused to detect any signals from the deployed tags. When the user stands before a displayed product for a predefined period e.g. 1 minute the presence of his mobile device is detected by the tag and reported to a computing device e.g. a service server remotely located with respect to the tag. As further detailed below triangulation may be used in the software mobile or a server to provide specific location based services . In reference to the detected location designated location and proximity services may be provided to the user . Depending on what the establishment is for promotions or coupons may be pushed to the mobile device being carried by the user . In one embodiment contactless or mobile payment may be executed when the user is detected to be leaving the establishment .

Referring now to it shows an functional block diagram of providing micro proximity tag services according to one embodiment of the present invention. As shown a tag is located at a location a mobile device running a client module or an application app is caused to listen to a signal from the tag over a communication channel when in close proximity to it. It should be noted that the mobile device may be replaced with a fixed electronic device to detect the presence of a tag attached to an item or a card form carried by a person in which case the fixed device is disposed to detect the presence of the tag. Those skilled in the art shall understand that the operations of the tag and a device regardless which one is mobile. remain substantially similar. Unless specifically stated herein the description below is based on the assumption that a mobile device is being carried by a user while a tag is relatively stationary.

The device is coupled to a network e.g. the Internet or a combination of wireless and wired network over a communication channel . In one embodiment both channels and are wireless. Also coupled to Internet is a micro proximity tag services server or simply service server and two or more control portals and . In one embodiment the portal is operated by a service provider a.k.a. micro proximity tag service provider portal while the portal is accessible by clients a.k.a. client portals . Optionally there are one or more additional servers such as client servers and or third party servers coupled to the network.

The service server is loaded and executes a software package not shown that is referred to a server module implementing one embodiment of the present invention. The micro proximity tag services are provided by the server module via the server . According to one embodiment the presence of the device is detected by the tag the device is caused to receive a message from the tag the message in return causes the device to communicate with the server where the server may be configured to send one or more promotion messages to the device with respect to an item attracting the attention of a user carrying the device . Depending on implementation the promotion message may be a discount coupon a further description of the item or a link to another website where different versions of the item may be shown. In one embodiment the install module is designed to provoke the function of mobile payment or enable a regular payment towards a selected item on the device .

Referring now to it illustrates an internal functional block diagram of a mobile device that may be used in or . The mobile device includes a microprocessor or microcontroller a memory device an input interface a screen driver to drive a display screen and a network interface . To make the mobile device operable with deployed tags in an establishment the mobile device is caused to install an application or a module in the memory device . The module also referred to herein a client module is a software version implementing one embodiment of the present invention and downloadable over a network from a library e.g. Apple Store or a designated server.

In one embodiment the module is activated when a user of the mobile device is entering an establishment e.g. an retail environment of . As a result the mobile device is enabled to receive a type of signal when the mobile device is moved within a range of a transmitter or transceiver. According to one embodiment the mobile device is turned on by the module to receive a low powered signal in compliance with the Bluetooth standard where a tag is disposed nearby and powered to broadcast the low powered signal.

The input interface includes one or more input mechanisms. A user may use an input mechanism to interact with the device by entering a command to the microcontroller . Examples of the input mechanisms include a microphone or mic to receive an audio command from the user or a keyboard e.g. a displayed soft keyboard to receive a texture command. Another example of an input mechanism is a camera provided to capture a photo or video where the data for the photo or video is stored in the device for immediate or subsequent use with another application module . The driver coupled to the microcontroller is provided to take instructions therefrom to drive the display screen . In one embodiment the driver is caused to drive the display screen to display a promotion message received via the network interface e.g. Wi Fi or 3G LTE in responding to the received signal from the tag nearby. Besides receiving the Bluetooth compliant signal the network interface is provided to allow the device to communicate with other devices via a designated medium e.g. a data network .

According to one implementation the module is specifically designed to enable the device to receive the Bluetooth compliant signal. A generic computer is incapable of or not equipped with the capability of receiving such a signal. As will be further described below the module is configured to decrypt messages from a tag and cause the device to communicate with a designated server e.g. the tax service server of .

The flows and are used to allow third parties clients and tag service providers to access information about the operation of and configure the behavior for the tag service module . Such access may be provided through the portals and and use communication channels and respectively with the network and communication channel to effect the complete flows. In addition the flow causes the tag service module to exchange information with various modules operating on the client servers via communication channels and together with the network. The flow allows the tag Services to exchange information with the third party server .

A tag service provider is the entity e.g. a corporation or an individual that provides various services to clients who typically own and operate a location with deployed tags. An example of the clients may include but not be limited to a retail chain e.g. Macy s an operator of vending machines or a vendor booth at an industry trade show. A third party is an independent entity that may form a partnership with either a tag service provider or a client or perhaps both. An example of such a third party may be an ad tracking company that analyzes user actions and provides profile information about a user whose device has been interacting with one or more tags in a location.

The tag services offered via the tag service module include location and proximity services. According to one embodiment one version of the client module operates as a Tag Writer while another version of the client module operates as a Tag Reader. As further described below either function may be embedded into the client module that has a different overall purpose with the use of a Software Development Kit SDK that may be provided in accordance with the tag service module . In one embodiment the module is configured as the Tag Writer dedicated to writing tags and the Tag Reader is functionally incorporated into a different version of the module .

According to one embodiment the basic functionality of the micro proximity tag services being provided via the server includes at least three processes a monitoring and tracking process a find me process and a user interaction process.

In the first process the device is caused to monitor its environment listening for any signals from the micro proximity tags that may be present nearby. The presence is detected via periodic reception of data packets transmitted over a wireless channel e.g. a Bluetooth signal . This presence together with the RF power level at which these data packets are received are periodically reported to the server where the micro proximity tag service module is configured to provide location and proximity services in accordance with the detected presence.

The second process is applicable to cases where the device is a mobile type. In this process the module installed in the device is configured to select a tag e.g. the tag that the user would like to find. The module then guides the user to the immediate vicinity of the tag by providing frequent distance estimates based upon the RF power level at which the data packets being transmitted from the tag are received thus guiding the user to where the tag is located.

The third process also applies to the case where the device is of the mobile type. In this case three procedures are performed 

One of the functions provided by the tag services is to allow a client and or a third party to create and manage the tag actions. The tag actions are a set of actions that a client and or a third party would like to have performed when a given tag is read. Examples of possible Tag Actions are 

A tag action may include one or more of these actions arranged in any order and include multiple instances of a particular type of action for example POSTs to several different servers . A tag action is defined by accessing the service module via any of the appropriate portals the tag service provider portal the client portal and the third party portal . Any action that can be pre defined and executed by a computer could qualify as a tag action provided that the service module is configured to provide a mechanism for such actions to be so defined.

Once a tag action is defined it can be assigned to one or more tags being deployed. In one embodiment assigning a defined tag action to one or more Tags is performed through one or more of the portals. In general a tag is uniquely identified with an identity. The identity may be a tuple of values a Universally Unique Identifier UUID and a Tag ID. This tuple is signified by the nomenclature UUID Tag ID . According to one embodiment the module is activated to select a tag action from those defined then read an identity of a tag and direct the tag services from the server to conduct the association. According to another embodiment the module is activated to allow a user to enter an identification string such as a Universal Product Code UPC which is sent together with the identity of the tag to the server to conduct the association between the tag and a tag Action that has been modified by the identification string. According to yet another embodiment a UPC reader may be incorporated into the module to acquire the identification string.

Once a tag has been written which means that an identity has been assigned to a tag action then a user with a device operating a client module configured to implement the tag reader function shall invoke the action or actions associated with the tag when the device is placed in close proximity to the tag. In addition the tag services being offered via the module can also relate this identity to any tag that is detected and read by the device. In both cases The client module is configured to cause the device to receive a predefined signal from the tag and send the identity thereof to the tag services offered on the server . On the server side the tag service server module is configured to decode and look up this unique identity and then execute one or more associated tag action s . Other management and usage information is also gathered during this operation which will be described more thoroughly in the disclosure below.

A micro proximity tag may come in any shape and small in small in size. One of functions of the tag is to broadcast a type of signal commonly receivable by a mobile device e.g. iPhone or a dedicated stationary device. One example of such signal is BLE Advertisement Packets at different RF power levels so that they can be commonly heard by a device. In some cases it may be desirable for a tag to be heard by a device many meters away. In this case a tag is designed to broadcast a signal e.g. data packets at a high transmission power. In other cases it may be desirable for a tag to only be heard by a device only a few meters away in which case the tag is designed to transmit a signal at a low transmission power. In any case the signal is broadcast periodically or at predefined regular intervals or this broadcast only occurs when a device is detected within a predefined radius distance from the tag.

In one embodiment a tag may transmit some data packets for a fixed device and some data packets for a mobile device at the same time. To avoid obstructing important aspects of the present invention the description below is not for the use of these packets nor the variable powers but rather the combination of design choices that allow the electrical circuit needed to accomplish this task to be substantially simpler smaller lower power and less costly than using a conventional Bluetooth integrated circuit.

According to one embodiment the type of signal transmitted by a tag is Bluetooth Low energy BLE packets. shows a Bluetooth Low energy communications spectrum . Communication between a BLE device and a Smartphone occurs on one of forty 40 2 MHz wide radio frequency RF channels centered on frequencies in the unlicensed Wi Fi spectrum band beginning at 2.400 GHz up to 2.482 GHz. Each of the channels can support a 1 MHz data rate using a form of frequency shift key FSK modulation. The channels are subdivided into three advertisement channels centered at 2.402 GHz 2.426 GHz and 2.480 GHz and thirty seven 37 data channels centered at all of the channels not assigned for advertisement. The data channels are numbered 0 to 36 and the advertisement channels are numbered 37 38 and 39 respectively. The BLE standards allow for a given BLE device to periodically broadcast fixed sized advertisement packets on one or more of the advertisement channels in order to notify other BLE devices of the existence of the given BLE device. The number of advertisement packets is determined by an Advertisement Event that may include the given advertisement packet transmitted only on BLE channel on channel then channel or on channel then channel then channel . According to the Bluetooth standards an Advertisement Event however always begins on channel however other non standard embodiments are also possible.

One embodied format of this type of broadcast packet has been specified by Apple Inc. for their iPhone and iPad based location services. This format and timing is called iBeacon. depicts the anatomy of an Apple iBeacon packet. A basic BLE packet includes a packet depicted in consisting of a preamble octet a four octet Access Address a variable length Protocol Data Unit PDU that can be as short as two octets and as long as thirty nine 39 octets and a twenty four 24 bit or three octet CRC calculated over the PDU . For all packets the preamble is set to 0xAA. For advertisement packets the Access Address is set to 0x8E89BED6. shows the corresponding numbers. The PDU includes two fields a two octet header field and a payload field that can have up to thirty seven 37 octets as specified in the length field of the header . The payload for an advertisement packet includes a six octet Advertiser Address field which may be the IEEE address of the BLE device or simply a random data pattern and an Advertiser Data field . These formats are illustrated in and . As depicted in and for the iBeacon format the Advertiser Data field includes two AD structures. AD structure 1 is a three octet field indicating that this advertisement packet is a beacon and AD structure 2 a twenty seven 27 octet field which follows Apple s proprietary iBeacon format. As illustrated in this format is indicated by the AD Type Equal to 0xFF the Apple identifier of 0x004C. The final payload of this second AD structure is depicted in . It includes an identifier set to 0x02 a length field set to 0x15 a sixteen 16 octet universally unique identifier UUID two 2 octet information fields called the Major Identifier and the Minor Identifier and a one octet transmit power which is the 2 s complement representation of the beacon s transmit power at a distance of one meter. The UUID is used by the client module to register for certain types of beacons. The Major and Minor fields are used to say something unique about the specific beacon. The transmit power allows the client module to determine the approximate distance from the beacon by comparing the power at one meter to the power that the packet was actually received by the BLE receiver circuitry within the device running the client module.

In one embodiment a tag uses the iBeacon format as described above and shown in . shows an advertisement packet per the iBeacon format. As shown in this figure all of the standard iBeacon fields are used with one exception. It shall be noted that the Advertisement PDU type is set to 0x00 indicating that the Advertiser Address field contains no valid information. However in another embodiment the Advertisement PDU could be set to 0x40 and a legitimate Advertiser Address field could be present. In addition the iBeacon standard TX Power value is included and represents the RF power of the signal measured one meter away from the tag. The exception to the iBeacon format is that the Major identifier and Minor identifier fields are combined into a single thirty two 32 bit 4 octet field which contains an encrypted version of a specific identifier Tag ID that together with the UUID uniquely identifies the Tag. The ability to make the tag specific to a given service provider using the UUID field and to encrypt the Tag ID and place it in the encrypted Tag ID field are significant improvements over passive NFC devices. A passive NFC device Reader can in principle read any NFC device whereas the client module is typically configured to only receive the advertisement packets from the tag if it already knows and has pre registered for the UUID . This allows a service provider to limit the client module to read a given tag.

Once an identifier of an NFC device has been read the location product or shelf that it is attached thereto is also known and can be used by non client or non service provider Apps to bypass the specific marketing campaign or message desired by the client or the service provider. For example once an NFC device identifier is known for a given Sony Television and it only needs to be read once and stored in a database to do so any Apps with access to such a database can identify the NFC device as referring to a Sony Television and take arbitrary possibly economically harmful action such as presenting offers for competitive products at a lower price.

As a tag ID is encrypted subsequent reads of the same tag would not necessarily result in the value in the encrypted Tag ID field as it can in one embodiment change over time. In one embodiment this encrypted Tag ID changes as often as every hour.

There are many different ways to implement the encryption of the Tag ID to generate the encrypted Tag ID embedded in an advertisement packet. In all cases encryption is accomplished by operating on the Tag ID with an algorithm that is driven by the combination of a private key and a public key. The encrypted value together with the public key are transmitted to the decryption logic that uses the public key together with the private key that only the tag and the decryption logic know to re create the original Tag ID. In some embodiments the public key can be implicit such as the current GMT time. For the purposes of this detailed invention description one particular algorithm is described however many other algorithms are possible.

One objective of encrypting the Tag ID is to ensure that reception of a single advertising packet cannot be used to uniquely identify the tag without knowing the decryption algorithm. In the use case applications envisioned for a tag the encryption requirements need are not very stringent. Basically a client or service provider wants to be insured that anyone attempting to decrypt the encrypted Tag ID would need to study the advertisement packets for a long period of time.

One embodiment an encryption and decryption algorithm that meets these requirements is described in through . The basic idea behind this embodiment is that sixty four 64 encrypted versions of a given Tag ID are calculated and stored in a tag. Further the tag contains a circuit further described below that changes the encrypted Tag ID that it is using in transmitted advertisement packets approximately every hour. This means that in order for a tag unique Tag ID to be recognizable to a client module without knowing the decryption algorithm would require that the tag be monitored for 64 hours and all of the possible encrypted values captured. For the use case applications envisioned for the tag services such an exercise would be onerous.

As depicted in the Tag ID is a twenty six 26 bit value called T . This value is segmented into two thirteen 13 bit values called A and B . In addition there is a six 6 bit key value called K which is incremented from 0x00 to 0x3F. Each value of K points to an Encrypt A Table and an Encrypt B Table . Each of these tables contain a random arrangement of 8192 values between 0 and 0x1 FFF in which none of the values is repeated in the table. There are 8192 factorial ways of creating such tables and 128 of them have been selected at random sixty four for the Encrypt A side and sixty four for the Encrypt B side. The values of A and B are used as the index into the table selected by K presenting the contents at these indices of A and B . These values together with each successive value of K are presented to a bit combiner to generate sixty four 64 encrypted Tag ID values T which are stored into Tag . The operation of the bit combiner is depicted in where the bits from values A B and K are combined to form the encrypted Tag ID T . The reader will recognize that there are more than 31 factorial ways in which this encrypted Tag ID value could be created from the component values and many other embodiments are possible.

This represents simply one embodiment of encryption algorithms. Many other choices are also possible.

Referring now to it shows a functional block diagram of a tag according to one embodiment of the present invention. The diagram may be better understood with reference to . A first unique aspect of the tag is that because it is designed to only be detectable by a device e.g. a smartphone within one meter or so its transmission power can be extremely low. In one embodiment the transmit power measured at 1 meter distance is less than 90 dBm. This specific aspect allows for an entirely different design approach called direct digital synthesis to be used as compared to the generalized Bluetooth modem designs used in more complex integrated circuits. A second unique aspect of the tag is as it is a broadcast only device that no Bluetooth circuitry for reception is required.

As a comparison shows a Bluetooth modem implementation as commonly used as a transceiver. It incorporates a full Bluetooth radio a 32 bit ARM processor a large number of digital input output capabilities and a number of specialized circuits for measuring environmental conditions or connections to analog sensors such as accelerometers . The design shown in shows that there is no need for these items that are typically costly and consume a lot of power which if used in a tag in the present invention would make it impossible to operate the tag on a battery power for an extended period e.g. months .

Referring back to a third unique aspect of one embodiment of the tag is that an Advertising event may include transmission of a single Advertising packet as allowed for by the BLE standards. This unique aspect reduces by one third the current necessary to transmit packets as only one rather than three packets are sent. A fourth unique aspect of one embodiment of the tag is that there are only sixty four versions of the Advertisement packet . This is illustrated in . As seen octets through and are fixed for all packets there are sixty four 64 different fixed patterns for octets through and octets through are calculated by circuitry. Hence one embodiment of the tag that has non volatile storage for 37 0 1 1 64 41 38 1 295 octets is sufficient to hold all versions of the packet that need to be sent. This unique aspect can be contrasted with the complex integrated circuit that require 128 000 to 256 000 octets of non volatile storage .

As illustrated in the design includes a number of blocks and other components. Without obstructing aspects of the design only essential blocks are described herein in detail. A wake up timer is provided to wake up other blocks or components periodically e.g. every M milliseconds wherein M can be set to 100 ms 300 ms or 500 ms depending upon the specific strapping option . In one embodiment it can be strapped externally from the integrated circuit . Block is a clock circuit that provides multiple internal reference clocks Fand Fderived from external crystal operating at frequency F. Block is a 320 8 bit non volatile memory that contains configuration of fixed and variable packet information. This non volatile memory can be programmed using external signals .

Block is a state machine controller that executes a number of functions. First it activates the other blocks in the integrated circuit to enable the transmission of one or more Advertising packets. Second it fetches configuration and packet data from the non volatile Memory processes the data and presents them to the direct digital synthesizer block . Included in this sequence is a variable wait time between 0 and 10 ms which randomizes the transmission of packets in accordance with the Bluetooth Low energy standards. Third it also contains digital circuitry for calculating the CRC value for a given transmitted packet and a whitening circuit as specified by the Bluetooth Low energy standards. These standards oriented capabilities are common and well known to those versed in the art and will not be further explained here. In addition the state machine controller may optionally drive an LED circuit and make use of a proximity sensor .

The direct digital synthesizer block synthesizes the correct signal waveforms based upon the data provided by the state machine controller . This synthesized signal is presented to an external RF circuit which includes a saw filter and an antenna . The direct digital synthesizer block uses a higher frequency clock Fwhich is derived from lower frequency clock Fby the clock multiplier block .

An antenna can be implemented in any number of methods. One embodiment implements the antenna using the well known inverted F printed circuit board structure with an underlying ground plane to insure that all RF energy is directed through the front of the Tag . Ideally the integrated circuit is powered by one or more batteries . All of the blocks are active only for a period of time determined by the state machine controller which is activated by the wake up timer .

The Integrated circuit crystal battery RF circuit and optionally LED circuit and proximity sensor are packaged on a small printed circuit board and installed in a plastic housing . In one embodiment the plastic housing includes an adhesive backing for attaching to a shelf a fixture or a product.

A conceptual representation of the direct digital synthesizer DDS is shown in . The central portion of the DDS is an N bit accumulator that sums the values presented to it by a multiplexer and the previous accumulated sum from an N bit latch . This accumulated value is latched by the N bit latch by transitions of the high speed clock operating at a frequency Fthat is provided by the clock multiplier . The value presented to the N bit accumulator from the multiplexer is selected by the value on the data signal which is presented to the DDS by the state machine controller described above. When a value on the data signal is 0 the N bit value X is selected and presented to the N bit accumulator . When the value on the data signal is 1 the N bit value Y is selected and presented to the N bit accumulator . The actual values of X and Y are determined by the frequency that one wants the DDS to output. The output is the most significant bit of the N bit value stored in the N bit latch . This output is amplified through a buffer which has its output current regulated to a maximum defined by a two bit power value Power provided from the state controller and used to drive the RF circuit .

Since the BLE signal uses frequency shift key modulation a digital 0 is represented by one frequency and a digital 1 is represented by another frequency. So the value of X is chosen to synthesize the frequency corresponding to a digital 0 and the value of Y is chosen to synthesize the frequency corresponding to a digital 1 . The equations for calculating these values is as follows 2and 2

The values of X and Y are stored in a look up table . The specific output pair of values X Y selected from the look up table is driven by the control signal from the state machine controller . As the purpose of the design is to output Bluetooth Low energy Advertisement packets on the Advertisement Channels the pair values X Y stored in the look up table correspond to the frequencies shown in Table 1.

The frequency spectrum of the raw signal output can be quite complex. But in principle the output spectrum includes peaks that are equidistant on either side of the primary carrier frequency F. Since the output at the digital level is either a 1 or a 0 that changes like the edges of a square wave the spectrum around the primary carrier F3 is replicated at a smaller amplitude at the odd harmonics 3 F 5 F . . . etc. . . Using a saw filter one of these spectral images can be filtered out and presented to the Antenna as a single frequency. This is illustrated in where the saw filter acts as a bandpass filter that filters out only the upper side of the spectrum around the fifth harmonic. In other words for the diagram in M 5.

As seen the N bit accumulation function performed by the conceptual DDS shown in is completely predictable if the starting value of the accumulator latch the value of the Data and the value of the Control are known. Furthermore while there are 2 N possible starting values a small subset of these could be preselected and provide the best behavior as the value of Data transitions from 0 to 0 0 to 1 1 to 0 or 1 to 1. Hence another embodiment of the DDS is to fetch a pre calculated sequence of Output values based upon the last Data value and the current Data value and shift this sequence through buffer using High speed Clock F3 . In this case instead of implementing an accumulator these pre calculated sequences would be store in read only memory.

The significance of this approach cannot be understated. First for a typical Bluetooth radio of the frequency synthesis must operate at the Bluetooth frequencies between 2400 MHz and 2482 MHz. These are very high frequencies that require analog integrated circuit technologies. Since this Bluetooth Radio is combined with digital logic such as an ARM processor such an approach requires a customized mixed mode integrated circuit fabrication facility. In comparison the design of the tag in and outlined above is a completely digital circuit that can be fabricated on the most common low cost digital fabrication line. Second as the power consumption of integrated circuits is linearly proportional to the switching frequency the ability to select the Mharmonic means that the digital logic consumes 1 Mof the power. Third the number of components operating at the highest frequency Fis very few. In another embodiment the DDS circuit depicted in can perform the accumulation function in parallel operating at a frequency F 4 and use a SERDES at the output to further reduce the number of components operating at the highest frequency. Fourth a workable lowest power design includes selecting the right values for N Fand M as the advertisement frequencies for 0 and 1 are specified by the Bluetooth standards.

In one embodiment a tag is a direct digital synthesizer where N 10 M 5 F 950 MHz 1000 MHz and 1025 MHz to generate signals for Channels and respectively a saw filter covering 2400 to 2490 MHz is used and the accumulator and the latch circuitry is implemented as four parallel slices. Other design choices are also possible.

In one embodiment the design of the state machine controller is illustrated in through . This embodiment implements a memory assignment of the 320 8 bit Non Volatile Memory NVM block as depicted in . As shown the fixed octets of the Advertisement Packet see are stored in NVM locations 0 through 38. The desired RF power level at which an advertisement packet should be transmitted is stored in location 39. This is a two bit value selecting up to four power levels. In one embodiment these values specify 00 Transmit at 15 dBm 01 Transmit at 20 dBm 10 Transmit at 30 dBm 11 Transmit at 40 dBm. The sixty four 64 different values for the encrypted Tag ID are stored in NVM locations 64 through 319. In addition certain configuration values used by the state machine controller are stored in NVM locations 40 through 43. These configuration values are defined in table 2 and table 3 below.

In this embodiment the state machine controller executes a set of steps necessary to transmit one to three advertisement packets at regular intervals defined by the wake up timer . The state machine controller has several state variables that it must maintain. These are 

If the PacketPerCycle value is non zero it is initialized to the PKT CTR value from the configuration while the INDEX CTR is cleared. Otherwise the PKT CTR is set to 1 and the INDEX CTR is incremented modulo 3 at . This special mode where PacketPerCycle is zero implements one embodiment where there is only one Advertisement Packet per Advertisement Event however each of the three Advertisement channels e.g. indices are used sequentially.

The next set of shaded logic at operates to flash an LED on or off by counting down the off or on duration using counter LED CTR and the configured values LedOffDuration and LedOnDuration respectively. If ProximityEnable is set to 1 then a test at to see if a proximity sensor of detects the presence of a mobile device is performed. If no device is present then no packets are sent and the cycle completion logic described below is executed.

For clarity of description it is assumed that LEDEnable and ProximityEnable are set to 0 so the ADDR CTR is cleared the CRC and WHITNER bits are initialized the Clock Multiplier is set to either 950 MHz 1000 MHz or 1025 MHz as specified by INDEX CTR. . In addition the RF transmit power level is fetched from NVM location 39 see and provided to the direct digital synthesizer at . In accordance with the Bluetooth standard the CRC bits are initialized to alternating 1s and 0s where the first bit is set to 1 and the 24bit is set to 0. Also in accordance with the Bluetooth standard the WHITNER bits are initialized to the binary value of the BLE index that is being used. So for example if the BLE index is for channel represented as 0100101 in binary the first bit of the WHITNER is set to 1 the second to 0 the third to 1 the fourth bit to 0 the fifth bit to 0 the sixth bit to 1 and the seventh bit to 0. The channel being used is captured by the state variable INDEX CTR where 00 means channel index 01 means channel index and 10 means channel index .

As depicted in and the value of ADDR CTR is tested as a large case statement at . Depending upon the value of this counter different steps are performed as described below 

As depicted in once a packet has been transmitted the PKT CTR is decremented. If this counter is non zero then there are still more packets to be sent. The INDEX CTR is incremented to point to the next transmission frequency the Clock Multiplier is updated for the next frequency ADDR CTR is cleared CRC and WHITNER registers are initialized and the logic flow returns to as described above . If the counter is zero then the countdown counter ENCRPYT CTR is decremented and tested to determine if it is time to move to a new encrypted Tag ID value. If the ENCRYPT CTR is non zero then this test if false and control returns to the top of step . If however it is zero then the test is true and the ENCRYPTPAGE which points to next value of encrypted Tag ID is incremented and the ENCRYPT CTR is re initialized to the EncryptPageDuration value stored in the configuration multiplied by 256 before the control returns to the top at in .

The particular tag design described in the preceding paragraphs represent one of a number of ways such a design could be implemented. The particular embodiment does not preclude design approaches where advertisement packets of different formats content and RF transmit power levels are transmitted nor approaches where different choices of BLE transmit frequencies are selected.

As described above with respect to and the installed module of operating on a device is designed and configured to work with the micro proximity tag services being offered via the server . Depending on implementation there are two types of functionality that may be incorporated in the module tag reader functionality and tag writer functionality. The tag reader functionality facilitates a device to detect a tag when it is moved within the proximity of the tag and reports the detection to the tag services. The tag writer functionality facilitates a device to assign a tag to a tag action that has been previously defined by a service provider a client or a third party using the tag services. As described above such assignment could be performed via an appropriate portal. However there are operational simplicities that result from being able to make this assignment after a tag has been placed.

One embodiment of the tag reader functionality is depicted in through . depicts two approaches in which the tag reader functionality can be implemented as part of the module of . In both approaches the module runs on top of an Operating System OS in the device in . The OS provides access to the Bluetooth hardware the device . Access to the hardware is enabled and controlled by use of an Applications Programming Interface API . In one embodiment this API is a Beacon API and provides the ability for the module to register to be notified when any iBeacon formatted advertisement packet is received by the device matching the UUID of a specific tag service provider and thus conveying the contents of the Major and Minor fields which contain the encrypted tag ID.

In a related embodiment the Beacon API provides distance information between a tag and a device in addition to the Major and Minor fields. Using one approach the tag reader functionality is embedded directly into the module which interfaces to the OS using the Beacon API. Using a second approach the tag reader functionality is implemented as a tag Software Development Kit SDK . In this approach the module is not directly connected to the Beacon API but only indirectly as part of importing the SDK. In this case the SDK implements the tag reader functionality. These two approaches are depicted respectively in .

According to one embodiment a sighting message showed as an example is a JSON object containing a unique sequence number created by the tag reader functionality to be used in any response message so that sighting and response can be matched. In the example shown in the sighting or message ID includes the UUID of the tag the Major identifier and the Minor identifier values which contain the encrypted Tag ID and a distance of the device is seeing the tag which is calculated by the client module or the SDK therein by comparing the received signal strength of the broadcast from the tag with a reference e.g. the Tx Power value which represents the calibrated signal strength that should be measured if the device is a certain distance e.g. 1 meter away from the tag. In addition the message ID includes the GPS location of the device an identifier of the client module and the Advertising Identifier of the mobile device. The identifier of the client module is provided to the user who chose to install the module in his device e.g. in his iPhone 6 and to incorporate the tag reader functionality for the micro proximity tags. The GPS and Advertising Identifier values are available from the OS. The GPS location of the tag is typically defined when the tag is registered with the service server. The GPS value in the message identifier is used by the tag services to determine if the tag has been moved. Once the message identifier has been sent the tag reader functionality waits for a response message at .

When a distance parameter is included in the response message. In the cases of actions at and the presence of a distance value directs the client module or the SDK therein to take the action only when the device is moved to a distance less than or equal to the distance value in response message from the tag. In the case of the presence of the distance value indicates that the client module or the SDK therein should notify the tag services when the device is a distance greater than the distance value in response message from the tag.

At this point the writer is registered with the OS to receive the UUID of a specific service provider at in . The user is provided with a number of choices for writing a tag. As shown in the user can at 

If the Clear a Tag function is selected a message is displayed telling the user to place the device close to the tag at . The writer then reads the Tag s Major and Minor fields sent from the OS and forwards these together with a Clear Tag command to the tag services over at . Once a response is received from the tag services indicating the operation is complete a message is displayed to the user at and the sequence is completed.

If Test a Tag function is selected again a message is displayed prompting the user to place his device close to the tag at . Now the Tag information is read at just as the tag reader functionality described above. The user may verify that operation was successful by pressing a designated button e.g. a Done button at .

Referring now to it shows a function block diagram of a server module according to one embodiment of the present invention. The server module is specially designed and configured to provide the tag services some of which has already be described above. As those skilled in the art a general computer does not have the ability nor equipped with the necessary mechanism to perform the tag services described in the present invention. In one perspective the server module may correspond to the server module of or and is preferably loaded in a computing device e.g. a server or may be distributed across a number of servers co located in the same data center or distributed across multiple data centers. For simplicity of description depicts a single server deployment.

As shown in The server module includes a number of processes data stores and databases. Those skilled in the art shall appreciate that the processes stores or databases may be combined to less than those shown in with departing from the intended operations of the server module . According to one embodiment an activity log database is used to record every event executed on or processed by one of the processes running as part of the tag services . This would include such events as tag reads tag writes client logins client logouts tag actions created modified or executed and messages sent to other servers. In one embodiment all of the events are saved in a single database. In a second embodiment the most common events such as tag reads and executed tag Actions are stored in a separate databases for performance reasons.

A database is provided to include information pertaining to a service provider a client or a third party collectively referred to as an agent that makes use of the tag services. A tag database is provided to include information on all tags that are deployed by an operator using this particular tag services. A tag action database is provided to contain all tag actions that have been defined by the operator using this particular tag services. The registered app database is provided to contain information concerning a number of copies of the module downloaded by users and deployed on their devices. When one module containing the tag reader or tag writer functionality is installed the device is registered with the tag services before the read or write functionality can be performed.

An analytics database is provided to contain analytics information that has been created by an analytics processor while a profile database is provided to keep a profile of each of the users who have registered the downloaded module with the tag services to access a service by reading a tag being associated with the tag services. The profile is created by a profile processor and made available to a dynamic Ad coupon generator and a dynamic message generator .

An advertisement database is provided to contain advertisement rules and content used by the dynamic Ad coupon generator and the dynamic message generator to present relevant advertisements to a client module being executed on a mobile device. Although it is possible to send other promotion messages to a user having a device running the client module the promotion messages including an advertisement or a coupon are generally related to a product the user has stopped to pay a close attention to where there is a tag disposed nearby.

A web server interface handles all HTTP or HTTPS communication with a tag service provider portal client portals or third party portals . The web server interface allows an agent to configure or manage the tag services for example using conventional web based mechanisms such as HTML. As such it passes messages and creates pages for interacting with the management processes in a controller portion including a provider manager a client Manager and a third party manager .

A message handler handles all messages to and from a client module residing on devices that may be caused to receive broadcasts from deployed tags. In one embodiment it forwards messages received from a device to and from a tag message decoder and a tag response processor respectively. In one embodiment the messaging structure used for communication with the module is a RESTFUL interface using HTTP or HTTPS and JSON element encoding. In another embodiment the Google Data format is used for the messaging exchanges.

The message server handles all server to server messages between the tag services processes and one or more client servers and one or more third party servers . This communication occurs across communication flows and respectively via Internet Interface Services . The message exchange occurs between these servers and several of the processes within the Controller portion of the MVC architecture but primarily with the Tag Response Processor .

The controller portion implements all of the control logic for the tag services. These control processes can be grouped into four categories 

The manager processes shown in represent one embodiment of an implementation of this functionality within the tag services and are described in the following paragraphs.

The provider manager controls all of the information needed by a micro proximity service provider. This includes user information which is retained in the user database . The primary interface to this process is via the server interface .

The client manager controls all information pertaining to a client who subscribes to the tag services. This includes information pertaining to locations of all tags a client server and a client module and clients agents which are retained in the user database .

The third party manager controls all information pertaining to the third parties who are partnered with clients and or service Provider and subscribe to the tag Services. This includes information pertaining to clients third party servers client modules and third party agents all of which are retained in the user database .

The tag manager manages all actions and activities associated with the deployed tags being used as part of the tag services. This would include information about the location of the tags what tag actions they are assigned to with which a client or third party that they are registered their specific unique tuple UUID TagID and how long they have been in operation. In the depicted embodiment shown in this information is stored in the tag database and the primary process that uses the tag manager services is the tag message decoder .

A tag action manager is provided to manage all tag actions that have been configured by the users of the tag services. In the depicted embodiment shown in this information is stored in the tag action database and the primary process that uses its services is the tag response processor .

The app manager manages information pertaining to all versions of a client module that have implemented to include either a tag reader or tag writer function or both as part of their operation. all of the client modules must be registered with the manager prior to being able to read or write a tag. This process manages the registration process and retains the pertinent registration information. In the depicted embodiment as shown in this information is stored in the registered app database and communicates primarily with the tag response processor and the app message handler .

A background process depicted in represents an implementation within the tag services an analytics processor reads the activity log database and analyzes categorizes accumulates and summarizes many discrete actions recorded there into statistics that can be used to generate usage reports for a provider clients or third parties. These statistics are preserved in the analytics database . The analytics processor generates these reports either on demand or on a pre defined schedule for the provider clients and third parties as has been previously configured via their respective portals e.g. the portals and the manager processes respectively.

A profile updater is responsible for maintaining and updating a profile for each user who has registered to opt to the tag services. It does so by reading the activity log database filtering and correlating which users identified by an advertiser ID and accessing information about which products or services identified in the tag actions that they have requested by reading the tags. Aspects of a user profile that are updated include 

The utility processes depicted in represent an implementation of the tag services and are described in the following paragraphs. Upon request from the tag response processor the dynamic Ad coupon generator uses the profile database and the advertisement database to generate a targeted specific advertisement for a given user in response to that user reading a tag. For example the tag action associated with a given tag that has been read might be to send a mobile advertisement to a mobile device. The selection of the appropriate advertisement would be predicated on knowing something about the user thereof which is available in the profile database and the type of advertisement campaign currently in flight which is available in the advertisement database . 

The dynamic message generator performs a similar function as the dynamic Ad coupon generator . However in this case a customized message is sent to a client e.g. a client server or a third party server . For example a message may be sent to an advertising network server indicating that a user with a given advertisement ID is currently shopping at a particular store making inquiries about a particular type of product. This directive can be defined as part of a tag action and requested by the tag response processor . The profile of the user together with rules regarding what information can be shared are stored in the profile database and advertisement database respectively.

The real time processes depicted in represent one embodiment of the tag services . The tag message decoder receives messages from a client module via the App message handler . One embodiment of such a message is the JSON sighting message . Using the Tag ID decryptor described above and illustrated in and the tag message decoder determines the unique Tag ID from the major and minor values included in the sighting message. This together with the other fields in the sighting message and the IP Address of the device reading the tag are sent to the tag response processor for processing.

The tag response processor is designed to responsible for accepting the incoming sighting messages and other messages from a client module and determining what the response should be based upon the decrypted Tag IDs UUIDs and Application ID presented to it by the tag message decoder . It uses the Tag ID and UUID to query the tag manager for all tag actions identifiers associated with this particular tag. With this information it queries the tag action manager to determine what tag actions must be executed. Because there may be multiple client modules that are sending sighting messages for the same tag the tag response processor must query the app manager to determine which client module has the precedence. Based upon the tag actions that need to be executed dynamic ads or coupons may need to be generated by the dynamic Ad coupon generator and dynamic customized messages might need to be generated by the dynamic message generator . Lastly the tag response processor executes the requested tag action by sending the appropriate response messages such as response message to the appropriate client module via the message handler and or to the client server and or a third party server via a message server .

The present invention has been described in sufficient detail with a certain degree of particularity. It is understood to those skilled in the art that the present disclosure of embodiments has been made by way of examples only and that numerous changes in the arrangement and combination of parts may be resorted without departing from the spirit and scope of the invention as claimed. While the embodiments discussed herein may appear to include some limitations as to the presentation of the information units in terms of the format and arrangement the invention has applicability well beyond such embodiment which can be appreciated by those skilled in the art. Accordingly the scope of the present invention is defined by the appended claims rather than the forgoing description of embodiments.

