---

title: Transaction payment processing by multiple data centers
abstract: A payment service is configured to support purchase transactions generated by merchant point-of-sale (POS) devices, wherein each purchase transaction may comprise multiple transaction requests such as authorization requests and capture requests. Each transaction request may be sent to a different one of multiple data centers of the payment service. Upon successfully receiving an acknowledgement from one of the data centers for a transaction request, the POS device designates that data center as the primary data center. Subsequently, all transaction requests for that transaction identify the primary data center, even when the transaction requests are sent to other data centers. At the payment service, the data centers synchronize requests such that the primary data center is informed of all authorizations and is made responsible for performing the capture of the transaction. This allows the primary data center to detect duplicate authorizations and to prevent duplicate captures.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09436938&OS=09436938&RS=09436938
owner: Square, Inc.
number: 09436938
owner_city: San Francisco
owner_country: US
publication_date: 20150513
---
Point of sale electronic credit card transactions are authorized and captured by several different entities that communicate with each other over a network connection. In an authorization stage a credit card or other payment instrument is read by a point of sale device. Based on details regarding the payment instrument and a payment amount provided by the merchant an authorization request for the payment amount is sent electronically from the point of sale device to a credit card processor. The credit card processor routes the payment request to a card network e.g. Visa or Mastercard which in turn routes the payment request to the card issuer e.g. a bank. Assuming the card issuer approves the transaction an approval is then routed back to the merchant.

In a capture stage a capture request for the approved payment amount is again routed from the merchant to the credit card processor card network and card issuer. The capture stage triggers the transfer of funds between the card issuer and the merchant.

A payment processing system may be implemented as a network based service that receives information from merchant point of sale POS devices to conduct purchase transactions based on payment instruments provided by customers. Payment instruments may comprise credit cards debit cards gift cards electronic tokens and so forth. A POS device may perform a transaction involving a payment instrument such as this by sending one or more authorization requests to the payment processing system followed by a capture request. Each authorization request specifies a payment amount for approval by the issuer of the payment instrument. The capture request triggers the transfer of funds from the customer to the merchant.

In order to provide services for a large number of merchants the payment processing system may be implemented by servers at geographically dispersed data centers. When requesting services a POS device may select from any of the data centers and may send transaction requests to the data centers.

A POS device might typically conduct a particular transaction with a single data center. However there may be situations in which a particular data center becomes unavailable or does not respond to a request. Rather than waiting for the data center to become available the POS device can retry the request with a different data center. After a capture request is sent the data centers synchronize their information to ensure that duplicate authorizations are not captured and to ensure that duplicate captures are not initiated.

In an embodiment described herein the POS device designates a single data center as being a primary data center for a transaction. The primary data center is responsible for initiating the capture request of the transaction. The first data center from which the POS device receives a request response is designated as the primary data center for a particular transaction.

For example the POS device may send an authorization request to a first data center and may fail to receive a response possibly because the data center is down for maintenance. After failing to receive the response the POS device may send the authorization request to a second data center and may receive a response. Thereafter every transaction request including further authorization requests and capture requests specify the second data center as the primary data center for the transaction. The data centers use this specification to coordinate authorizations and captures.

When a data center receives an authorization request that specifies a different primary data center the receiving data center performs the authorization and eventually informs the primary data center of the authorization. When a data center receives a capture request that specifies a different primary data center the receiving data center acknowledges the capture request but does not initiate the capture. Rather the receiving data center forwards the capture request to the primary data center and the primary data center initiates the data capture. This allows the primary data center to check for duplicate authorizations and to avoid double captures for the same transaction.

Additional details and scenarios are described below. This brief introduction is provided for the reader s convenience and is not intended to limit the scope of the claims. Furthermore the techniques described above and below may be implemented in a number of ways and in a number of contexts. Several example implementations and contexts are provided with reference to the following figures as described below in more detail. However the following implementations and contexts are but a few of many.

The payment service may include payment processing software hardware and or services that enable a merchant to receive payments from customers when conducting POS purchase transactions with the customers. For example the payment service may enable a merchant to receive credit card payments debit card payments mobile payments and or different types of electronic payments from customers.

The payment service interacts with multiple POS computing devices which are associated respectively with different merchants . The POS devices are used by the merchants to process payments for purchase transactions from customers. Generally the POS devices may comprise any of various types of devices such as terminals computers portable devices tablet computers smartphones etc. and so forth. In some cases the POS devices may incorporate or work in conjunction with card readers for reading credit cards and or other payment instruments. In some cases the POS devices may enable mobile payments such by allowing a customer to use a smartphone or other mobile device to pay for a purchase transaction. More generally a POS device is configured to receive information from a payment instrument which may comprise a physical card or an electronic token or data object and to interact with bank related services to facilitate the transfer of funds from the customer to the merchant based on the information from the payment instrument.

A customer pays for a purchase transaction by providing a payment instrument such as a debit card a credit card a stored value or gift card a check an electronic token provided by a device carried by the customer etc. The merchant can interact with the POS device to process the transaction such as by inputting e.g. manually via a magnetic card reader or an RFID reader etc. an identifier associated with the payment instrument. For example a payment instrument of one of the customers may include one or more magnetic strips for providing card and customer information when swiped in a card reader. In other examples other types of payment cards may be used such as smart cards having built in memory chips that are read by the device when the cards are dipped into the reader radio frequency identification tags and so forth. The merchant and or the POS device may also provide other information describing the transaction such as a payment amount the item s being purchased a time place and date of the transaction a card network associated with the payment instrument an issuing bank of the payment instrument and so forth.

Although shows only a single POS device associated with each merchant each merchant may use multiple POS devices that are part of an integrated POS system. Furthermore the POS devices of a merchant POS system may be used interchangeably during a purchase transaction. That is a transaction may be initiated on one POS device and completed on another POS device . Thus although the following description assumes that a transaction is completed using a single POS device several different POS devices of the merchant may in fact be used over the course of a single purchase transaction. Furthermore the actions that are described herein as being performed by a POS device may in certain implementations be performed by a POS system of which the POS device is a part.

The payment service communicates with a payment network to conduct purchase transactions electronically on behalf of the merchants . For purposes of discussion the payment network represents one or more card payment networks e.g. MasterCard VISA issuing banks acquiring banks and other entities banks or institutions that may be involved in processing payment transactions and electronically transferring funds between merchants and customers.

The payment service may comprise a large scale service that supports many merchants who may be distributed across large geographic areas. In some cases the payment service may implement POS services through pages of a website that are accessed by the POS devices of the merchants . In these cases the POS devices may comprise devices such as tablet computers or other portable devices that access the pages of the website using an Internet browser. In other cases tablet computers or other devices may run special purpose applications that are specifically configured to implement POS services in conjunction with the payment service using network APIs application program interfaces that are made available by the payment service .

In order to efficiently serve large numbers of geographically dispersed merchants the payment service may be implemented by servers of multiple data centers . Each data center is a facility in a different geographic location that houses redundant computing equipment and software to support the operations and services of the payment service . An individual POS device may communicate with servers at any one of the data centers to process payment transactions. In the described example a POS device selects one of the data centers for any given request. Upon receiving a request the data center routes the request to one of numerous available servers of the data center each of which is configured similarly to respond to the request.

The POS devices may communicate with the data centers of the payment service through a network infrastructure such as the Internet. More generally communications may utilize local area networks wide area networks wired networks Wi Fi and other wireless networks cellular data networks close range wireless communications such as Bluetooth near field communications NFC etc. Protocols for communicating over such networks are well known and will not be discussed herein in detail. The same or similar communication technologies may also facilitate communication between the payment service and the payment network . Various types of encryption and security techniques may be employed to protect communications from eavesdroppers.

A purchase transaction begins when a merchant specifies a preliminary payment amount for the purchase transaction. The preliminary payment amount may be entered manually by the merchant using the POS device or may be generated automatically by a POS system of the merchant based on prices of purchased or ordered items. Upon being presented with the preliminary payment amount the customer presents a payment instrument. The payment instrument may comprise a credit card a debit card or a similar instrument. In some cases the payment instrument may comprise an electronic token provided wirelessly by a mobile device such as when using mobile or cardless payments.

Based on the presented payment amount and payment instrument the POS device sends an authorization request to the payment service . The authorization request specifies various information that may be used by the payment service and in turn by the payment network to obtain authorization for the payment amount. The information may include the payment amount as well as payment instrument details such as credit card information. Credit card information may include things such as the credit card number a security code expiration date and so forth. In addition the authorization request specifies a transaction identifier ID that is unique to the purchase transaction of which the specified payment amount is a part. In addition to uniquely identifying the purchase transaction the transaction ID may also uniquely identify the POS device and or the merchant who is submitting the authorization request .

The authorization request may be sent to and received by any one of the multiple data centers of the payment service . For purposes of discussion shows that the authorization request is sent to and received by a first data center .

In response to receiving the authorization request the receiving first data center interacts with the payment network to obtain an authorization of the payment amount. For example the payment service may provide credit card information and transaction information to a credit card processing network to obtain an approval for the authorization request . The payment service may also perform its own risk analysis to determine whether to approve the authorization request .

Assuming that the authorization request is approved by both the payment network and the payment service the first data center sends an authorization of the payment amount to the POS device . The authorization specifies a data center ID referred to herein as a DCID corresponding to the receiving first data center . The DCID uniquely identifies the first data center and distinguishes it from the other data centers . The authorization may also include other information that is not shown in such as the approved payment amount the transaction ID an authorization number for the payment amount and so forth.

Upon receiving the authorization and the accompanying DCID of the receiving first data center the POS device designates the data first data center as the primary data center for the purchase transaction and associates the DCID of the first data center with the transaction ID of the purchase transaction. Subsequently the POS device will include the DCID of the primary data center referred to herein as the primary DCID in each request sent to any one of the data centers regarding the purchase transaction. This allows the data centers to coordinate their handling of the requests among themselves as will be discussed in detail below.

Some purchase transactions may include multiple authorizations. This may be the case for example when a customer presents more than one credit card for payment of a purchase or when multiple customers split the payment for a purchase transaction. As another example this may occur when a customer orders additional items after an initial authorization. Purchase transactions that include multiple authorizations may be referred to as split tender or multiple tender transactions and each authorization may be referred to as a tender.

The second authorization request may be sent to and received by any one of the data centers . In this example the second authorization request is shown as being sent to and received by a second data center which is different than the first data center .

Assuming that the second authorization request is approved in a manner similar to the first authorization request the second data center sends a second authorization to the POS device . The second authorization may indicate the DCID of the responding data center which in this example will be different than the primary DCID. The second authorization may also indicate additional information that is not shown in such as the approved payment amount the transaction ID the primary DCID an authorization number for the payment amount and so forth.

After all payment amounts for a particular purchase transaction have been approved and the merchant is ready to finalize the transaction the POS device sends a capture request to the payment service . As with any others of the requests the capture request may be sent to and received by any one of the data centers . In this example the capture request is shown as being sent to and received by a third data center which is different than the first data center and different than the second data center .

The capture request specifies the transaction ID of the transaction which is identical to the transaction ID specified by the first authorization request and by the second authorization request . The capture request also specifies previous authorizations and payment amounts that are to be captured. In addition the second authorization request specifies the primary DCID corresponding to the first data center which was the data center that responded to the first authorization request .

In response to receiving the capture request the payment service sends a capture request acknowledgement to the POS device . The capture request acknowledgement may specify the DCID of the receiving and responding third data center which in this case is not the same as the primary DCID. The capture request acknowledgment may also specify other information as may be appropriate including the transaction ID the primary DCID a listing of captured payment amounts or authorizations and other information relating to the capture of the purchase transaction.

In the more general case the requests and shown in may be sent to and responded to by any combination of data centers. In some cases the requests may all be sent to the same data center. In other cases each request may be sent to one of two data centers. The POS device may select the receiving data center based on its location and availability. For example the POS device may attempt to select for any transaction or request the data center that is geographically closest to the merchant. In cases where that data center is unavailable however the POS device may select an alternate data center that is farther from the merchant. In some cases the POS device may submit an authorization request to a first data center receive an authorization from the first data center send a capture request to the first data center and fail to receive a response to the capture request from the first data center. In a situation like this the POS device may retry the capture request by sending it to a second data center. Subsequent figures will show several example sequences such as this and will explain how the payment service prevents duplicate captures resulting from requests sent to different data centers.

As mentioned above a merchant may use multiple POS devices and elements of a transaction may be synchronized between the multiple POS devices so that a single transaction may be conducted using two or more POS devices of a merchant. For example a first POS device may be used for an authorization request and a second POS device may be used for a corresponding capture request. After each request the response from the payment service may be provided by the payment service to both the requesting POS device and to the other POS devices of the merchant so that each POS device has information relating to each pending transaction and so that future requests regarding a transaction may be initiated by any one of the multiple merchant POS devices.

The method implements a sequence of transaction requests for a single purchase transaction. In the described environment a transaction request may comprise an authorization request or a capture request. All transaction requests corresponding to the purchase transaction are identified by a single transaction ID. In multi tender or split tender transactions details of which will be described with reference to transaction requests may also comprise bill creation requests tender requests and bill completion requests.

An action which is performed by the POS device when the merchant is ready to send an initial transaction request comprises selecting one of multiple data centers of a payment service to which the transaction request will be submitted. In some embodiments a merchant POS device may be configured by default to use a particular one of the data centers such as the data center that is closest geographically to the merchant. In other embodiments the merchant POS system may select one of the data centers based on its geographic proximity the speed of communications with the data center the communication latency with the data center whether the data center is currently online and so forth. In some cases the merchant device may randomly select one of the data centers. In some cases an initially selected data center may turn out to be unavailable or may fail to respond to a request. This may be because the data center has been disabled for maintenance or because the data center is experiencing problems of some sort. It may also be because of communication problems between the merchant POS device and the data center.

An action comprises sending a first transaction request to the selected data center. In the examples discussed herein the first transaction request may comprise an authorization request for a payment amount. Alternatively the first transaction request may comprise a bill creation request.

The first transaction request specifies a transaction ID that uniquely identifies the particular transaction of which the first transaction request is a part. In the case of an authorization request the authorization request may also include the information discussed above with reference to the authorization request .

An action comprises determining whether a response is received from the selected data center. The POS device may fail to receive a response in situations where the selected data center is unavailable due to data center maintenance or operational problems for example. Other problems may also prevent the POS system from receiving a response from the selected data center such as communication issues between the POS device and the selected data center.

If a response is not received from the selected data center the actions and are repeated where the action selects a different data center and the action comprises resubmitting the first transaction request to the different data center. The different data center may be selected based on its proximity to the merchant and or other factors similar to the initial data center selection.

The actions and may be repeated until the merchant POS device receives a response from the selected data center to the submitted first transaction request.

After the merchant POS device receives a response to the action of sending the first transaction request the merchant POS device performs an action of associating the DCID of the responding data center with the transaction ID of the purchase transaction. This effectively designates the first successfully responding data center as being the primary data center for the purchase transaction and as being the data center that will have primary responsibility for eventually capturing the authorized payment amounts of the purchase transaction. All subsequent transaction requests sent by the POS device for the purchase transaction will carry the DCID of this first responding data center which as mentioned above is referred to herein as the primary DCID of the transaction.

The remaining actions illustrated by correspond to subsequent transaction requests by the POS device which may comprise authorization requests or a capture request.

The action comprises selecting a data center. The data center selected in this action may be the same data center selected in the action or may comprise a different data center. The selection may be made based on the factors described above with reference to the action .

An action comprises submitting a subsequent transaction request. This transaction request may comprise an authorization request or a capture request. When the subsequent transaction request is an authorization request the authorization request may specify the information mentioned above with regard to the authorization request including the transaction ID and the primary DCID. When the subsequent transaction request is a capture request the capture request may specify the information mentioned above with regard to the capture request including the transaction ID and the primary DCID.

An action comprises determining whether a response is received from the selected data center. The POS device may fail to receive a response in situations where the selected data center is unavailable due to data center maintenance or operational problems for example. Other problems may also prevent the POS system from receiving a response from the selected data center such as communication issues between the POS device and the selected data center.

If a response is not received from the selected data center the actions and are repeated where the action selects a different data center and the action comprises resubmitting the subsequent transaction request to the different data center.

An action comprises determining whether the transaction has been captured which may be the case when the most recent transaction request was a capture request for which a response was successfully received. If the transaction has not been captured the actions and are repeated for one or more additional transaction requests. Otherwise if the transaction has been captured by submitting a capture request and receiving an acknowledgement of the capture request the method is terminated and the purchase transaction is considered to be completed from the standpoint of the POS device. In some cases the POS device may provide a receipt at this point.

An action comprises receiving an authorization request such as the first authorization request or a subsequent authorization request of . As already discussed an authorization request may specify a payment amount a transaction ID and in some cases may specify a primary DCID that indicates a primarily responsible data center wherein the primarily responsible data center may be a data center other than the data center receiving the authorization request.

An action comprises obtaining approval for the payment amount of the authorization request and returning an authorization to the requesting POS device. The data center receiving the authorization request may obtain an approval by communicating with a card payment network or other payment processing network such as the payment network of . The returned authorization may include various information as already discussed above with reference to the authorizations and . As discussed there the authorization may specify the DCID of the data center that has received the authorization request and that is providing the authorization to the requesting POS device.

An action comprises determining whether a primary DCID was specified by the received authorization request. As described with reference to transaction requests other than the first successfully acknowledged transaction request will specify a primary DCID indicating the data center that is primary responsible for eventual capture of the transaction.

If a primary DCID is not specified by the received authorization request an action is performed of recording the authorization to be potentially captured in the future in response to a capture request received from the POS device. If a primary DCID is specified by the authorization request an action is performed of informing the primary data center as identified by the specified primary DCID of the authorization. This allows the primary data center to eventually capture the payment amount of the authorization in response to a future capture request received from the POS system. The receiving data center may report the payment amount of the authorization an approval code associated with the authorization and so forth.

In some cases the action of informing the primary data center of an authorization may not be immediately possible because the primary data center may unavailable due to maintenance or communication issues. In these cases the authorization is queued and provided to the primary data center when the primary data center eventually becomes available.

An action comprises receiving a capture request such as the capture request of . As already discussed a capture request specifies a transaction ID corresponding to a payment transaction. The capture request may also enumerate previous authorizations and associated payment amounts of the payment transaction. In addition the capture request specifies a primary DCID that indicates a primarily responsible data center wherein the primarily responsible data center may be a data center other than the data center receiving the capture request.

An action comprises sending a capture request acknowledgement of the received capture request to the requesting POS device. The acknowledgement indicates to the POS device that the capture request has been received and queued for processing and that further action by the POS device is not necessary for capturing the payment transaction.

An action comprises determining whether the receiving data center is the primary data center as indicated by the primary DCID of the capture request. If the receiving data center is the primary data center an action is performed of initiating a capture of the transaction specified by the capture request. This may involve communicating with a card payment network or other payment processing network such as the payment network of . In initiating the capture the primary data center checks for duplicate authorizations and capture requests and voids or deletes any duplicates. This is possible because any previous requests have either been responded to by the primary data center itself or forwarded to the primary data center by other data centers.

If the receiving data center is not the primary data center an action is performed of forwarding the capture request to the primary data center. This may comprise forwarding the information specified by the received capture request such as the transaction ID the primary DCID enumerated authorizations and payment amounts etc.

In some cases the action of forwarding the capture request to the primary data center may not be immediately possible because the primary data center may be unavailable due to maintenance or communication issues. In these cases the capture request is queued and provided to the primary data center when the primary data center eventually becomes available.

Upon receiving a forwarded capture request the primary data center for the transaction initiates the requested capture by communicating with the payment network of . In initiating the capture the primary data center checks for duplicate authorizations and capture requests and voids or deletes any duplicates. This is possible because any previous requests have either been responded to by the primary data center itself or forwarded to the primary data center by other data centers.

The POS device initially sends a first authorization request to the first data center . As indicated by the dashed block the POS device fails to receive a response from the first data center which could be because the first data center is inoperative that there is a communication issue between the POS device and the first data center or that a communication error occurred during communications between the POS device and the first data center . Meanwhile the status of the first authorization request is unknown to the POS device because the first data center may or may not have obtained an authorization in response to the first authorization request despite the POS device not having received a response to the authorization request .

In response to failing to receive a response to the first authorization request the POS device sends a second authorization request for the payment amount to the second data center . The second authorization request may be essentially identical to the prior authorization request and may specify the same information. In this case the POS device does receive an authorization response from the second data center indicating that the data center did obtain an authorization for the requested payment amount. The authorization response specifies the DCID of the second data center . Henceforth the DCID of the second data center is considered to be the primary DCID and is specified by the POS device in all future transaction requests including authorization and capture requests.

The POS device then sends a capture request to the first data center . The capture request specifies the primary DCID corresponding to the DCID of the second data center from which the authorization response was received. The first data center responds with an acknowledgement response .

After and or at any time before receiving the capture request the first and second data centers and synchronize their information regarding the transaction. In this example the synchronization comprises forwarding the capture request from the first data center to the second data center where the second data center corresponds to the primary DCID specified by the capture request . For example upon receiving the capture request the first data center may immediately or as soon as the second data center is able to receive communications send the information specified by the capture request to the second data center which in this example is considered the primary data center. Upon receiving the forwarded capture request which indicates the DCID of the second data center the second data center initiates a capture of the transaction where the capture includes the payment amount specified by the authorization request .

The synchronization may additionally include exchanging information regarding previous authorizations obtained for the transaction so that duplicated authorizations may be detected and voided. In this example the first data center is shown as performing an action of voiding the authorization assuming it was actually obtained since it is a duplicate of the second authorization .

The POS device then sends a first capture request to the first data center . The first capture request and all subsequent requests specifies the primary DCID corresponding to the DCID of the first data center from which the authorization communication was received.

As indicated by the dashed block the POS device fails to receive a response from the first data center which could be because the first data center is inoperative because there is a communication issue between the POS device and the first data center or because an error occurred during communications between the POS device and the first data center . Meanwhile the status of the first capture request is unknown to the POS device because the first data center may or may not have initiated an actual capture of the transaction in response to the first capture request .

In response to failing to receive a response to the first capture request the POS device sends a second capture request for the payment amount to the second data center . The second capture request may be essentially identical to the prior capture request and may specify the same information. In this case the second data center sends and the POS device receives a capture acknowledgment response . However the second data center does not initiate the actual capture of the transaction. Rather in a synchronization operation the second data center forwards the capture request to the first data center based on the primary DCID specified by the capture request which corresponds to the first data center . In response to receiving the forwarded capture request the first data center may in some cases initiate an actual capture of the transaction. In particular the second capture is performed if the first capture was not already performed. If the first capture was successfully performed the second capture is not performed.

In the example of the bill creation request is sent to the first data center which in response provides an acknowledgement response containing the DCID of the first data center . Henceforth the first data center is considered by the POS device to be the primary data center and the DCID of the first data center is considered to be the primary DCID.

The POS device then sends a first authorization request to the first data center . The first authorization request specifies the primary DCID corresponding to the DCID of the first data center from which the acknowledgement was received. As indicated by the dashed block the POS device fails to receive a response from the first data center in response to the first authorization request which could be because the first data center is inoperative because there is a communication issue between the POS device and the first data center or because an error occurred during communications between the POS device and the first data center . Meanwhile the status of the first authorization request is unknown to the POS device because the first data center may or may not have obtained a first authorization in response to the first authorization request .

In response to failing to receive a response to the first authorization request the POS device sends a second authorization request for the payment amount to the second data center . The second authorization request may be essentially identical to the prior authorization request and may specify the same information. The second authorization request specifies the primary DCID corresponding to the DCID of the first data center in this example.

In this case the POS device does receive an authorization response from the second data center indicating that the second data center did obtain an authorization for the requested payment amount.

In this multiple tender example the POS device may obtain multiple authorizations for multiple payment amounts by sending multiple authorization requests to any one of the data centers where each authorization request specifies the primary DCID which is the DCID of the first responding data center. In the case where an authorization is provided from a data center other than the primary data center the authorization is synchronized in an action which may comprise notifying or informing the primary data center of the authorization. In other words the details of any authorizations performed by a non primary data center are eventually communicated to the primary data center of the transaction so that the primary data center can detect duplicate authorizations.

After obtaining all authorizations the POS device sends a capture request to any one of the data centers . In this example the capture request is sent to the second data center . The capture request specifies the primary DCID corresponding to the DCID of the first data center from which the acknowledgement was received. The second data center responds to the POS device with an acknowledgement response .

After receiving the capture request the first and second data centers and synchronize their information regarding the transaction. In certain embodiments this may comprise forwarding the capture request from the second data center to the first data center where the first data center corresponds to the primary DCID specified by the capture request . For example upon receiving the capture request the second data center may immediately or as soon as the first data center is able to receive communications send the information specified by the capture request to the first data center which in this example is considered the primary data center. Upon receiving the forwarded capture request which indicates the DCID of the first data center the first data center initiates a capture of the transaction which includes the payment amount of previous authorization requests corresponding to the transaction.

Each of the above scenarios is merely an example and many variations are possible. Moreover many variations of the techniques discussed above are possible as well without departing from the scope of this disclosure.

In the illustrated example the POS device includes at least one processor memory a display one or more input output I O components one or more network interfaces at least one card reader at least one location component and at least one power source . Each processor may itself comprise one or more processors or processing cores. For example the processor can be implemented as one or more microprocessors microcomputers microcontrollers digital signal processors central processing units state machines logic circuitries and or any devices that manipulate signals based on operational instructions. In some cases the processor may be one or more hardware processors and or logic circuits of any suitable type specifically programmed or configured to execute the algorithms and processes described herein. The processor can be configured to fetch and execute computer readable processor executable instructions stored in the memory .

Depending on the configuration of the POS device the memory may be an example of tangible non transitory computer storage media and may include volatile and nonvolatile memory and or removable and non removable media implemented in any type of technology for storage of information such as computer readable processor executable instructions data structures program modules or other data. The memory may include but is not limited to RAM ROM EEPROM flash memory solid state storage magnetic disk storage optical storage and or other computer readable media technology. Further in some cases the POS device may access external storage such as RAID storage systems storage arrays network attached storage storage area networks cloud storage or any other medium that can be used to store information and that can be accessed by the processor directly or through another computing device or network. Accordingly the memory may be computer storage media able to store instructions modules or components that may be executed by the processor . Further when mentioned non transitory computer readable media exclude media such as energy carrier signals electromagnetic waves and signals per se.

The memory may be used to store and maintain any number of functional components that are executable by the processor . In some implementations these functional components comprise instructions or programs that are executable by the processor and that when executed implement operational logic for performing the actions and services attributed above to the POS device . Functional components of the POS device stored in the memory may include a merchant application which may present an interface on the POS device to enable the merchant to conduct transactions receive payments and so forth as well as communicating with the payment service for processing payments and sending transaction information. Further the merchant application may present an interface to enable the merchant to manage the merchant s account and the like.

Additional functional components may include an operating system for controlling and managing various functions of the POS device and for enabling basic user interactions with the POS device . The memory may also store transaction information data that is received based on the merchant associated with the POS device engaging in various transactions with customers.

In addition the memory may also store data data structures and the like that are used by the functional components. For example this data may include item information that includes information about the items offered by the merchant which may include images of the items descriptions of the items prices of the items and so forth. Depending on the type of the POS device the memory may also optionally include other functional components and data which may include programs drivers etc. and the data used or generated by the functional components. Further the POS device may include many other logical programmatic and physical components of which those described are merely examples that are related to the discussion herein.

The network interface s may include one or more interfaces and hardware components for enabling communication with various other devices over a network or directly. For example network interface s may enable communication through one or more of the Internet cable networks cellular networks wireless networks e.g. Wi Fi and wired networks as well as close range communications such as Bluetooth Bluetooth low energy and the like as additionally enumerated elsewhere herein.

The I O components may include speakers a microphone a camera various user controls e.g. buttons a joystick a keyboard a keypad etc. and or a haptic output device and so forth.

In addition the POS device may include or may be connectable to a payment instrument reader . In some examples the reader may plug in to a port in the POS device such as a microphone headphone port a data port or other suitable port. In other instances the reader is integral with the POS device . The reader may include a read head for reading a magnetic strip of a payment card and further may include encryption technology for encrypting the information read from the magnetic strip. Alternatively numerous other types of card readers may be employed with the POS devices herein depending on the type and configuration of a particular POS device .

The location component may include a GPS device able to indicate location information or the location component may comprise any other location based sensor. The POS device may also include one or more additional sensors not shown such as an accelerometer gyroscope compass proximity sensor and the like. Additionally the POS device may include various other components that are not shown examples of which include removable storage a power control unit and so forth.

In the illustrated example the server includes at least one processor and associated memory . Each processor may itself comprise one or more processors or processing cores. For example the processor can be implemented as one or more microprocessors microcomputers microcontrollers digital signal processors central processing units state machines logic circuitries and or any devices that manipulate signals based on operational instructions. In some cases the processor may be one or more hardware processors and or logic circuits of any suitable type specifically programmed or configured to execute the algorithms and processes described herein. The processor can be configured to fetch and execute computer readable processor executable instructions stored in the memory .

Depending on the configuration of the server the memory may be an example of tangible non transitory computer storage media and may include volatile and nonvolatile memory and or removable and non removable media implemented in any type of technology for storage of information such as computer readable processor executable instructions data structures program modules or other data. The memory may include but is not limited to RAM ROM EEPROM flash memory solid state storage magnetic disk storage optical storage and or other computer readable media technology. Further in some cases the server may access external storage such as RAID storage systems storage arrays network attached storage storage area networks cloud storage or any other medium that can be used to store information and that can be accessed by the processor directly or through another computing device or network. Accordingly the memory may be computer storage media able to store instructions modules or components that may be executed by the processor . Further when mentioned non transitory computer readable media exclude media such as energy carrier signals electromagnetic waves and signals per se.

The memory may be used to store and maintain any number of functional components that are executable by the processor . In some implementations these functional components comprise instructions or programs that are executable by the processor and that when executed implement operational logic for performing the actions and services attributed above to the payment service . Functional components stored in the memory may include a transaction services component that receives processes and responds to transaction requests in accordance with the preceding discussion. The transaction services may also be responsible for synchronizing transactions between data centers as described above.

Additional functional components may include an operating system and a web services component . The memory may also store APIs application programming interfaces that are used for communications between the server and the POS devices . The memory may also store data data structures and the like that are used by the functional components.

The server may have a network communications interface such as an Ethernet communications interface which provides communication by the server with other servers with the Internet and ultimately with the POS devices .

The server may of course include many other logical programmatic and physical components that are not specifically described herein.

Although the subject matter has been described in language specific to structural features and or methodological acts it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the specific features or acts described. Rather the specific features and acts are disclosed as illustrative forms of implementing the claims.

