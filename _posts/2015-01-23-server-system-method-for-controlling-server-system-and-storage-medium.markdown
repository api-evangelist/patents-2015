---

title: Server system, method for controlling server system, and storage medium
abstract: A server system includes a determination unit, a setting unit, a transmission unit, and a service for performing predetermined processing on data from an external server, wherein the service provides a client with a function of displaying a data preview. The determination unit determines a data type to be subjected to the predetermined processing. The setting unit sets, where it is determined, based on the determined data type, that the client can preview the data, a URL of a specific save location in the server system, and sets, where it is determined, based on the determined data type, that the client cannot preview the data, a URL that allows a data preview and includes an external server URL. The transmission unit transmits, to the client, a data operation screen on which the URL has been set for a preview instruction unit that can receive an instruction to preview the data.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09164707&OS=09164707&RS=09164707
owner: Canon Kabushiki Kaisha
number: 09164707
owner_city: Tokyo
owner_country: JP
publication_date: 20150123
---
The present invention relates to a server system for acquiring a document saved in a cloud a method for controlling a server system and a storage medium.

A form of managing business data and documents and performing various types of processing in a cloud platform is beginning to be prevalent. A representative example of the cloud platform is Salesforce CRM from salesforce.com Inc. A user accesses a web page in a cloud platform via the Internet through a browser on a client computer. If a user gives an instruction to print a document through the web page the browser is redirected to a document generation server and the user selects a document to be printed on a screen returned from the document generation server. Then the document generation server acquires the document in the cloud platform and transmits the document to the document generation server. The user can confirm preview the content of the document before actually giving an instruction to print the document. The de facto standard of a document format handled in the cloud is Portable Document Format PDF . To preview a PDF document the user needs to give an instruction to display a preview of the PDF document on a screen returned from the document generation server. The document generation server downloads the PDF document to the browser on the client computer and a PDF viewer application installed in the client computer displays a preview of the PDF document.

Additionally documents other than a PDF document can also be saved in the cloud platform. There is a demand for printing such documents. Examples of the documents that can be saved in the cloud platform include Office documents such as a Microsoft Word document and a PowerPoint document and image documents such as a Joint Photographic Experts Group JPEG document and a Portable Network Graphics PNG document.

A conventional cloud platform provides a preview display function for displaying a preview of the content of a saved document on a browser. For example if a browser has accessed a web page in the cloud platform in which Microsoft Word documents or PowerPoint documents are saved the document is displayed on the browser so that the document can be previewed. At this time the document automatically converted by the cloud platform into a format that can be previewed on the browser such as the Flash format or the PNG format is displayed.

Meanwhile mobile terminals such as tablets and smartphones represented by iPad iPhone and Android have been rapidly prevalent. A user increasingly accesses a cloud platform using a mobile environment and prints a document. To preview an Office document an Office application needs to have been installed in the client environment. An Office application however has not necessarily been installed particularly in a mobile environment. In response Japanese Patent Application Laid Open No. 2003 015837 discusses a conventional method for displaying a document so that the document can be previewed regardless of the client environment. Japanese Patent Application Laid Open No. 2003 015837 discusses a technique for converting a document into a predetermined format an image file and then displaying the document on a browser.

The conventional method however has the following problem. That is every time a request to preview a document is received the document needs to be converted into the predetermined format. Thus if a plurality of preview requests is simultaneously received the load of a document generation server increases.

The present invention is directed to a technique capable of in a system for printing a document saved in a cloud allowing a preview of the document on a browser without a document generation server converting the document regardless of the environment of a client.

According to an aspect of the present invention a server system having a service for performing predetermined processing on data acquired from an external server wherein the service provides a client with a function of displaying a preview of the data as a function in the service the server system comprising a determination unit configured to determine a type of the data to be subjected to the predetermined processing by the service a setting unit configured to set in a case where it is determined based on the type of the data determined by the determination unit that the client can preview the data a uniform resource locator URL of a specific save location in the server system in which the data acquired from the external server is saved and configured to set in a case where it is determined based on the type of the data determined by the determination unit that the client cannot preview the data a URL that allows a preview of the data and includes a URL of the external server and a transmission unit configured to transmit to the client a data operation screen on which the URL has been set by the setting unit for a preview instruction unit that can receive an instruction to preview the data.

According to the present invention it is possible to in a system for printing a document saved in a cloud allow a preview of the document on a browser without a document generation server converting the document regardless of the environment of a client.

Further features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings.

Various exemplary embodiments features and aspects of the invention will be described in detail below with reference to the drawings.

Further the above components are connected to one another via a network so that the components can communicate with one another. The network is a communication network such as the Internet including for example a local area network LAN a wide area network WAN a telephone circuit a dedicated digital circuit an Asynchronous Transfer Mode ATM or frame relay circuit a cable television circuit and a data broadcasting wireless circuit and combinations thereof. The network may only need to allow the transmission and reception of data. The method of communication from the client apparatus to the cloud platform server or the document generation server the method of communication from the document generation server to the cloud platform server and the method of communication between the servers may be different from one another. illustrates each apparatus as a single apparatus. Alternatively each apparatus may include a plurality of apparatuses. Further it is suitable that each of the cloud platform server and the document generation server should be a cloud system that includes a plurality of servers and disperses requests through a load balancer. Alternatively each of the cloud platform server and the document generation server may be a single server. Thus the term server system includes both a single server and a server group including a plurality of servers.

In these pieces of hardware after starting the CPU executes the BIOS to load the OS from the HDD into the RAM so that the OS can be executed. The CPU loads various software modules from the HDD into the RAM as needed according to the operation of the OS so that the various software modules can be executed. The various software modules are executed by the CPU through the cooperation of the above devices thereby operating. Further the I F is connected to the network and is controlled by the CPU according to the operation of the OS thereby achieving communication by the above communication method.

The document generation server has a service for performing predetermined processing on data acquired from the cloud platform server illustrated in . The document generation server includes a web server and a document transmission module . The web server is configured to have a so called web application function and can be accessed by the client through the web browser . The web server replies to a request from the web browser with user interface information. The web browser renders and displays the user interface information obtained from the web server . The displayed user interface information includes for example a list of documents to be acquired from the cloud platform server by the document generation server and an interface for requesting a document. Further if the web server has received a document acquisition request from the web browser the web server acquires a document from the cloud platform server and transmits a document transmission request with the document to the document transmission module . The document transmission module transmits the transmitted document to a document generation server.

A transmission reception unit processes communication with the web browser of the client apparatus and the web server of the document generation server . A control unit performs processing according to a received request. A page generation unit generates a web page to be returned to the web browser . An authentication unit authenticates a user having made a request to log into the cloud platform service . A session management unit manages session information of a user having been successfully authenticated by the authentication unit . A data management unit holds documents in a database DB and acquires a document from the DB or updates a document in the DB according to a request. A setting management unit holds settings for redirecting to the document generation server . The cloud platform service performs processing described below through the cooperation of these components.

Further the DB stores management user data and documents and is stored in the HDD illustrated in . The management user data and the documents are managed for each company or organization hereinafter referred to as organization . An organization identification ID is automatically assigned to the organization and each piece of data is managed together with the organization ID. When a user is authenticated the organization ID of the organization to which the user belongs is acquired and saved in the session management unit . The subsequent processing such as data acquisition is performed based on the organization ID and only data that matches the organization ID can be referred to. Further the DB also stores settings for redirecting to the document generation server . The documents and the settings for redirecting to the document generation server that are stored in the DB are updated at any timing by a user an administrator through the web browser .

A parameter is a document generation server uniform resource identifier URI which specifies the URI of the document generation server in the form of http . . . . A parameter is a setting for acquiring the session ID of a user having logged in and adding the character string sid to a uniform resource locator URL parameter. A parameter is a setting for acquiring a URL that allows the document generation server to access the cloud platform service and adding the character string srv url to a URL parameter. The URL for accessing the cloud platform service is unique for each organization. When a user is authenticated the control unit acquires a URL according to the organization to which the user belongs. Then the control unit saves the acquired URL in the session management unit . A parameter is a query ID which uniquely identifies query information for acquiring a document list from the cloud platform service . A parameter is a query ID which uniquely identifies query information for acquiring a document from the cloud platform service .

Next with reference to drawings a document preview using the document printing system according to the first exemplary embodiment of the present invention is described in detail. In the following figures the cloud platform service is abbreviated as CPS . illustrates a flow of processing performed in the document printing system according to the first exemplary embodiment of the present invention. A user has already logged into the cloud platform service through a login screen not illustrated . Consequently a screen of the cloud platform service is displayed on the web browser and a document printing button for which the settings in have been made in advance is displayed on the screen.

First in step S the user presses the document printing button on the screen displayed on the web browser of the client apparatus . Then the cloud platform service creates a URL for redirecting to the document generation server based on the settings in and returns a response to the browser .

If the web browser has received the response returned from the cloud platform service then in step S the web browser transmits the session ID sid of the cloud platform service the URL srv url for accessing the cloud platform service the document list acquisition query ID list and the document acquisition query ID content to the web server of the document generation server . If the web server has received this request from the web browser then in step S the web server acquires a document list from the cloud platform service .

In step S the control unit receives the request from the web browser . In step S the control unit acquires the session ID of the cloud platform service the URL for accessing the cloud platform service the document list acquisition query ID list and the document acquisition query ID content from the transmitted parameters and stores the acquired information in the RAM . Further the control unit saves the session ID of the cloud platform service the URL for accessing the cloud platform service and the document acquisition query ID in the session management unit .

Next in step S the control unit searches the query information table and acquires the query information record having the query ID that matches the document list acquisition query ID in the transmitted parameters. Next in step S the control unit connects to the cloud platform service using the session ID of the cloud platform service and the URL for accessing the cloud platform service that have been stored in the RAM in step S. Then the control unit executes the query command of the acquired query information record . Next in step S the control unit acquires a document ID Id and a document name Title from the results of execution of the query command . Then in steps S and S the control unit requests the page generation unit to generate a document list screen and returns the generated document list screen to the web browser . Through the above processing the web server performs the document list screen creation process. If the document list acquisition query ID in the transmitted parameters does not exist in the query information table in step S the control unit can determine that an error has occurred. Further if the number of acquired results of execution of the query command is 0 in step S the control unit may determine that an error has occurred.

Referring to the user selects a document and presses the document printing button on the document list screen returned to the web browser . In response to this operation in step S the web browser transmits a document operation screen acquisition request with the Id of the selected document to the web server . If the web server has received the document operation screen acquisition request in step S the web server performs a document acquisition process.

In step S the control unit receives the request from the web browser . In step S the control unit acquires the Id of the selected document from the transmitted parameters and stores the acquired Id in the RAM . Further the control unit acquires the session ID of the cloud platform service the URL for accessing the cloud platform service and the document acquisition query ID from the session management unit . Next in step S the control unit searches the query information table and acquires the query information record having the query ID that matches the acquired document acquisition query ID . Then the control unit creates a document acquisition query based on the query command of the acquired query information record and the acquired Id of the selected document. Next in step S the control unit connects to the cloud platform service using the session ID of the cloud platform service and the URL for accessing the cloud platform service that have been acquired in step S. Then the control unit executes the created document acquisition query.

Next in step S the control unit saves the document acquired in step S in the session management unit . Then in step S the control unit acquires the User Agent in the request header. In step S the control unit determines whether the client environment is mobile. If it is determined that the client environment is not mobile No in step S i.e. if it is determined that the environment of the client is not mobile and therefore the client can preview a predetermined type of data then in step S the control unit determines the content type of the acquired document. If it is determined in step S that the content type is an Office document or an image document then in step S the control unit generates a URL for downloading the document to the web browser . This URL is a URL for acquiring the document saved in step S from the session management unit and returning the document to the web browser . This URL is a URL for acquiring a document acquired from the cloud platform service which is a service of an external server and saved in the session management unit the URL including the URL of the session management unit . Then in step S the control unit specifies that the generated URL be set to the URL of a preview button. In step S the control unit requests the page generation unit to generate a document operation screen and returns the generated document operation screen to the web browser .

If it is determined that the content type is a Portable Document Format PDF document then in step S the control unit requests the page generation unit to generate a document operation screen and returns the generated document operation screen to the web browser . The process of generating a document operation screen in step S is similar to the processes of steps S to S described above except that in step S the document to be acquired is a PDF document. In either case based on the determination that the environment of the client is not mobile and therefore the client can preview the document regardless of the type of the document the control unit acquires the document from the CPS and provides a document preview function from the document generation server to the web browser .

If it is determined that the client environment is mobile Yes in step S then in step S the control unit determines the content type of the acquired document. If it is determined that the content type is a PDF document then in step S the control unit requests the page generation unit to generate a document operation screen and returns the generated document operation screen to the web browser .

If it is determined in step S that the content type is an Office document or an image document then in step S based on the determination that the environment of the client is mobile and therefore the client cannot preview the document the control unit generates a URL for accessing the page of the document on the cloud platform service . At this time the control unit generates a URL for accessing the page of the document on the cloud platform service from the URL for accessing the cloud platform service acquired in step S and the Id of the selected document stored in RAM . Then in step S the control unit specifies that the generated URL be set to the URL of a preview button. In step S the control unit requests the page generation unit to generate a document operation screen and returns the generated document operation screen to the web browser .

If the fully qualified domain name FQDN which can be changed according to the organization to which the user belongs of the URL for accessing the cloud platform service is na1.salesforse.com and the Id of a Microsoft Word document saved in the cloud platform is 12345 the URL of the detailed page of the document is https na1.salesforse.com 12345 . On the detailed page of the document it is possible to display the document without downloading the document or confirm the owner and the update date and time of the file. If the web browser has accessed the detailed page of the document https na1.salesforse.com 12345 the Microsoft Word document is displayed so that the Microsoft Word document can be previewed on the web browser . At this time the document converted into the Flash format or the Portable Network Graphics PNG format by the cloud platform is displayed on the web browser . An Office application does not need to have been installed in the client apparatus .

The URL for accessing the cloud platform service acquired in step S is for example https na1.salesforse.com services Soap u 19.0 . The FQDN and the portion of this URL can be changed according to the organization to which the user belongs.

In step S the control unit extracts the portion https na1.salesforse.com from the character string of the URL acquired in step S and generates a character string by connecting the Id identification information of the selected document stored in the RAM to the end of the extracted character string. Then the control unit determines the generated character string as the URL for accessing the page of the document on the cloud platform service . This URL is set to the preview button on the generated document operation screen and thereby associated with the preview button. The URL is for example preview . Through the above processing the web server performs the document operation screen creation process.

Referring to the user presses the preview button on the document operation screen returned to the web browser . In response to this operation if the client environment is mobile and the selected document is an Office document or an image document then in step S the web browser accesses the page of the document on the cloud platform service and displays a preview of the document.

As described above in the present exemplary embodiment when the client environment is mobile and the selected document is an Office document or an image document and if the preview button is pressed the web browser accesses the page of the document on the cloud platform service and then displays a preview of the document. In other cases the web browser downloads the document to the web browser and displays a preview of the document. Through above operation it is possible to display a preview of an Office document or an image document without the document generation server converting the document for displaying a preview regardless of the client environment.

In the present exemplary embodiment if the environment is not mobile and an Office document or an image document is previewed the document generation server acquires the document from the CPS . Alternatively the web browser can access a page of the cloud platform service and display a preview of the document without downloading the document. For example if the file size of the document is a certain size or larger the web browser may access a page of the cloud platform service and display a preview of the document. Further in the case of an Office document the web browser may access a page of the cloud platform service and display a preview of the document regardless of whether the environment is mobile.

Next with reference to the drawings a second exemplary embodiment of the present invention is described. The portions similar to those of the first exemplary embodiment are not described and only different portions are described below. After the document operation screen has been displayed on the web browser the user may return the screen to the document list screen and reselect another document. In the first exemplary embodiment if the user has selected a document on the document list screen and pressed the document printing button the document generation server acquires the selected document from the cloud platform service and then displays the document operation screen. The reason for this is to prevent the transmission of a document that cannot be printed by the document generation server to the document generation server. For example the document generation server cannot print a PDF document to which a password is added. Thus the document generation server analyzes a PDF document and if a password is not added to the PDF document the document generation server displays the print button on the document operation screen. To acquire the document an application programming interface API of the cloud platform service is used. A cloud generally has governor limits which limit the number of API calls for example. The present exemplary embodiment is directed to after the document operation screen has been displayed and even if the document operation screen returns to the document list screen to select another document reducing the number of API calls to be consumed to as few as possible.

If it is determined in step S that the content type is a PDF document then in step S the control unit acquires the document. If it is determined in step S that the content type is an Office document or an image document the control unit does not acquire the document. According to the second exemplary embodiment if the client environment is mobile and the selected document is an Office document or an image document the control unit skips the acquisition of the document and displays the document operation screen . If the user has pressed the preview button the web browser accesses the page of the document on the cloud platform service and displays a preview of the document. When the user has pressed the print button the Office document or the image document is acquired.

Based on the above processing according to the client environment and the content type of the document it is possible to switch the timing of acquiring the document. When an Office document or an image document is previewed in a mobile environment the document is not acquired. Then when the document is printed the document is acquired. This prevents the unnecessary consumption of the number of API calls of the cloud platform service.

Next with reference to the drawings a third exemplary embodiment according to the present invention is described. The portions similar to those of the first and second exemplary embodiments are not described and only different portions therefrom are described below.

The function of displaying a preview on a page of the cloud platform service has a limit of the previewable file size. When the document size exceeds a limit and if the page of the document on the cloud platform service has been accessed the document cannot be previewed a screen including a message notifying a user that the document cannot be previewed is displayed . The present exemplary embodiment is directed to if the document size is large preventing access to a page of the cloud platform service.

If it is determined in step S that the acquired size of the document exceeds the threshold No in step S then in step S the control unit specifies that the preview button is disabled. Then the control unit requests the page generation unit to generate a document operation screen. In step S instead of disabling the preview button the control unit can for example display a message on the document operation screen to notify the user that the document cannot be previewed. According to the third exemplary embodiment when the client environment is mobile and the selected document is an Office document or an image document and if the size of the selected document exceeds a threshold the control unit displays the document operation screen on which the preview button is disabled. Through the above processing if the document size is large the web browser does not access a page of the cloud platform service .

In the present exemplary embodiment if the size of a document exceeds a threshold it is not allowed to preview the document. Alternatively even when the size of a document exceeds a threshold if the content type is an image document the document operation screen on which the preview button is abled may be displayed. If the preview button is pressed at this time the image document may be downloaded to the web browser . In this case if it is determined in step S that the size of the document exceeds the threshold the control unit acquires the content type stored in the RAM . Then if the content type is an image document the control unit acquires the document. Next the control unit generates a URL for downloading the acquired document to the web browser . Then the control unit specifies that the generated URL is set to the URL of the preview button. Then the control unit requests the page generation unit to generate a document operation screen.

Embodiments of the present invention can also be realized by a computer of a system or apparatus that reads out and executes computer executable instructions recorded on a storage medium e.g. non transitory computer readable storage medium to perform the functions of one or more of the above described embodiment s of the present invention and by a method performed by the computer of the system or apparatus by for example reading out and executing the computer executable instructions from the storage medium to perform the functions of one or more of the above described embodiment s . The computer may comprise one or more of a central processing unit CPU micro processing unit MPU or other circuitry and may include a network of separate computers or separate computer processors. The computer executable instructions may be provided to the computer for example from a network or the storage medium. The storage medium may include for example one or more of a hard disk a random access memory RAM a read only memory ROM a storage of distributed computing systems an optical disk such as a compact disc CD digital versatile disc DVD or Blu ray Disc BD a flash memory device a memory card and the like.

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.

This application claims the benefit of Japanese Patent Application No. 2014 012801 filed Jan. 27 2014 which is hereby incorporated by reference herein in its entirety.

