---

title: Relay apparatus, relay method, relay system, and non-transitory computer-readable storage medium
abstract: A relay apparatus detects a request, sent from a communication apparatus, to grant an access authority for a desired resource, sends, in the case where the request to grant the access authority has been detected, an authorization request requesting the granting of the access authority to a server, receives an authorization response, which is a response to the authorization request, from the server, saves the authorization response, generates an authorization relay response based on the authorization response, and sends the authorization relay response to the communication apparatus, wherein in the case where a request to grant the access authority sent from another communication apparatus different from the communication apparatus has been detected, the relay apparatus sends the authorization relay response in response to the request to the other communication apparatus based on the saved authorization response.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09554278&OS=09554278&RS=09554278
owner: CANON KABUSHIKI KAISHA
number: 09554278
owner_city: Tokyo
owner_country: JP
publication_date: 20150311
---
The present invention relates to authorization systems configured of a communication apparatus a relay apparatus and an authorization server and particularly relates to relay apparatuses relay methods relay systems and non transitory computer readable storage media for granting access authority to a communication apparatus with an authorization server.

Recently there are cellular phones digital cameras and the like that have functions for accessing resource servers for content sharing services communication services and the like on the Internet. A user can upload image content to a photo sharing service send messages to friends or the like by using such communication apparatuses. Normally a resource server for a photo sharing service or the like manages access authority for resources such as content files and the like on the resource server in tandem with an authorization server Japanese Patent Laid Open No. 2011 39793 .

Authorization servers are increasingly using the OAuth protocol to manage grant access authority. The authorization code type and the implicit type are examples of authorization types for obtaining an access token according to OAuth. In the case of the authorization code type first a communication apparatus obtains from an authorization server an access token indicating access authority for a desired resource and a refresh token for refreshing the access token. In the case of the implicit type first the communication apparatus obtains the access token from the authorization server. When making a request to obtain the desired resource from a resource server the communication apparatus issues the request along with the access token obtained from the authorization server. The resource server sends the requested resource to the communication apparatus only in the case where the access token is valid. With the authorization code type in the case where the access token has expired the communication apparatus can refresh the access token by providing the refresh token to the authorization server.

The authorization server requires the user s authorization when delegating the user s access authority to the communication apparatus using the OAuth protocol. Normally the authorization server presents an HTML screen for the user to carry out an operation for granting the access authority and the user carries out the operation for granting the access authority in a web browser.

However when the authorization server distributes the same access token to multiple communication apparatuses according the conventional technique it is assumed that the user will need to carry out the operation for granting access authority using the web browser each time an access token is distributed. In other words it is necessary for the user to carry out user authentication and operations for granting the access authority the same number of times as there are communication apparatuses. Such operations are complicated for the user.

Having been conceived in light of the aforementioned problems it is an object of the present invention to lighten the burden of user operations with respect to a process for granting access authority.

According to one aspect of the present invention there is provided a relay apparatus capable of relaying communication between a communication apparatus and a server which comprises a detection unit configured to detect a request sent from the communication apparatus to grant an access authority for a desired resource a first sending unit configured to send in the case where the request to grant the access authority has been detected by the detection unit an authorization request requesting the granting of the access authority to the server a receiving unit configured to receive an authorization response which is a response to the authorization request from the server a saving unit configured to save the authorization response received by the receiving unit a generating unit configured to generate an authorization relay response based on the authorization response and a second sending unit configured to send the authorization relay response generated by the generating unit to the communication apparatus wherein in the case where a request to grant the access authority sent from another communication apparatus different from the communication apparatus has been detected the second sending unit sends the authorization relay response in response to the request to the other communication apparatus based on the authorization response saved by the saving unit.

Further features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings .

The present embodiment describes a case in which a user operates a communication apparatus and starts an authorization process from the communication apparatus . is a diagram illustrating an example of the configuration of an authorization relay system according to the present embodiment. The communication apparatus corresponds to a communication apparatus according to the present invention and includes a display function an operation function a wireless LAN Local Area Network communication function based on IEEE 802.11 and an NFC Near Field Communication communication function. However in the present embodiment it is assumed that the communication apparatus does not include a web browser function or includes a web browser function but the web browser function cannot be used. A digital camera a digital video camera a printer a television a video recorder and so on can be given as specific examples of the communication apparatus . The communication apparatus uses the NFC communication function as first wireless communication. Although the communication apparatus uses the NFC communication function as the first wireless communication in the present embodiment the invention is not limited thereto and another close proximity wireless communication standard such as Bluetooth registered trademark ZigBee registered trademark RFID or the like may be used instead. Meanwhile the communication apparatus uses the wireless LAN communication function as second wireless communication. Although the communication apparatus uses the wireless LAN communication function as the second wireless communication in the present embodiment the invention is not limited thereto and another communication standard such as a wired LAN communication function a WAN Wide Area Network communication function or the like may be used instead.

A relay apparatus corresponds to a relay apparatus according to the present invention and includes a display function an operation function a wireless LAN communication function an NFC communication function and a public wireless communication function such as 3G LTE Long Term Evolution or the like. Furthermore in the present embodiment the relay apparatus includes a web browser function. A cellular phone a smartphone a PC or the like can be given as specific examples of the relay apparatus . Although the relay apparatus uses the wireless LAN communication function and the NFC communication function in the present embodiment in the same manner as the communication apparatus the invention is not limited thereto and another communication standard may be used instead. Likewise although the relay apparatus uses the public wireless communication function in the present embodiment the invention is not limited thereto and another communication standards such as the wireless LAN communication function a wired LAN communication function or the like may be used instead. In addition in the present embodiment the relay apparatus includes a tethering function and communicates with an authorization server and a resource server over public wireless communication by relaying the wireless LAN communication from the communication apparatus .

The user corresponds to a user according to the present invention and uses the communication apparatus and the relay apparatus . A network is a network that connects the relay apparatus the authorization server and the resource server . A wired LAN a wireless LAN a WAN the Internet and the like can be given as specific examples of the network . The authorization server corresponds to an authorization server according to the present invention and manages access authority to resources on the resource server according to OAuth 2.0. Although OAuth 2.0 is used as the OAuth protocol in the present embodiment it should be noted that the invention is not limited thereto and another authorization standard such as OAuth 1.0 and OpenID Connect a proprietary authorization method or the like may be used instead. The resource server corresponds to a resource server according to the present invention and manages resources held by the user of the communication apparatus .

Next constituent elements of the authorization system according to the present embodiment will be described in detail. is a block diagram illustrating an example of the hardware configuration of the communication apparatus according to the present embodiment. The communication apparatus includes a CPU Central Processing Unit a ROM Read Only Memory a RAM Random Access Memory auxiliary storage a display unit an operating unit a wireless LAN communication unit a wireless LAN antenna an NFC communication unit and an NFC antenna .

The CPU controls the communication apparatus as a whole. The ROM stores programs parameters and so on that do not need to undergo changes. The RAM temporarily stores programs data and so on supplied from the auxiliary storage or the like. The auxiliary storage stores configuration data such as wireless parameters content data such as images and videos and so on. A memory card a hard disk or the like can be given as example of the auxiliary storage . The display unit displays a GUI Graphical User Interface through which the user operates the communication apparatus . The operating unit is an input interface through which the user operates the communication apparatus . The wireless LAN communication unit controls the wireless LAN antenna and carries out wireless LAN communication with the relay apparatus . The NFC communication unit controls the NFC antenna and carries out NFC communication with the relay apparatus .

The control unit carries out overall control of the respective functional modules provided in the communication apparatus . The display control unit controls the display unit and carries out display control for the GUI in the communication apparatus . The operation control unit controls the operating unit and carries out control for operational inputs made by the user in the communication apparatus . The storage control unit controls the auxiliary storage and stores image content data video content data and the like. The wireless LAN communication control unit controls the wireless LAN communication unit and controls the wireless LAN communication with the relay apparatus . In the present embodiment the wireless LAN communication control unit controls the wireless LAN communication with the relay apparatus according to the WPS Wi Fi Protected Access method. Although the WPS method is used in the present embodiment the invention is not limited thereto and another wireless LAN communication standard such as WPA Wi Fi Protected Access WPA2 Wi Fi Direct or the like may be used instead.

The NFC communication control unit controls the NFC communication unit and controls the NFC communication with the relay apparatus . The NFC communication control unit sends communication apparatus information regarding the communication apparatus to the relay apparatus and receives relay apparatus information regarding the relay apparatus from the relay apparatus . Although the NFC communication method is used in the present embodiment the invention is not limited thereto and another short range wireless communication method such as BT Bluetooth registered trademark BT LE Bluetooth registered trademark Low Energy or the like may be used instead.

The relay apparatus cooperative control unit carries out cooperative control with the relay apparatus by using the wireless LAN communication control unit and the NFC communication control unit . Specifically the relay apparatus cooperative control unit carries out discovery control for discovering and advertising devices on the wireless LAN service control for using and providing services provided by devices on the wireless LAN and so on. In the present embodiment the relay apparatus cooperative control unit carries out the discovery and advertisement using SSDP Simple Service Discovery Protocol . Meanwhile the relay apparatus cooperative control unit provides and controls services through HTTP HyperText Transfer Protocol . Although SSDP and HTTP are used in the present embodiment the invention is not limited thereto and other discovery and service communication standards such as mDNS Multicast Dynamic Name Service UPnP Universal Plug And Play DLNA Digital Living Network Alliance SOAP REST Representational State Transfer AtomPub Atom Publishing Protocol or the like may be used instead.

The authorization determination unit determines whether or not to carry out an authorization process. The authorization control unit carries out the authorization process between the relay apparatus and the authorization server using the wireless LAN communication control unit . In the present embodiment the authorization control unit carries out the authorization process according to the OAuth 2.0 method. Specifically the authorization control unit generates an authorization relay request based on authorization relay request information illustrated in and sends the authorization relay request to an authorization relay service provided by the relay apparatus . The authorization control unit then receives from the relay apparatus an authorization relay response based on authorization relay response information or illustrated in . Thereafter the authorization control unit generates an access token request based on OAuth and sends the access token request to the authorization server . The authorization control unit then receives an access token response based on OAuth from the authorization server . Although OAuth 2.0 is used in the present embodiment the invention is not limited thereto and another authorization method such as OAuth 1.0 OpenID Connect SAML Security Assertion Markup Language Kerberos or the like may be used instead.

The resource obtainment unit obtains a desired resource from the resource server via the relay apparatus using the wireless LAN communication control unit . In the present embodiment resource refers to a resource according to REST. Specifically resource refers to content data such as electronic files electronic data images videos and so on as well as metadata regarding containers and content such as directories and albums and the like. Furthermore functions actions and APIs Application Program Interfaces for various services provided by the resource server storage content sharing printing payments and the like can also be realized as resources. Further still although the resource obtainment unit obtains downloads the resources in the present embodiment the invention is not limited thereto and other resource operations such as generating uploading updating deleting and so on which are basic operations according to REST may be carried out as well. An authorization application unit is an application that enables the user to authorize the communication apparatus .

The NFC communication control unit controls the NFC communication unit and controls the NFC communication with the communication apparatus . The NFC communication control unit receives the communication apparatus information regarding the communication apparatus from the communication apparatus and sends the relay apparatus information regarding the relay apparatus to the communication apparatus . The public wireless communication control unit controls the public wireless communication unit connects to the network and carries out communication between the authorization server and the resource server . Although a public wireless communication method is used in the present embodiment the invention is not limited thereto and another communication standard such as wireless LAN wired LAN WAN or the like may be used instead. The web browser control unit controls the display control unit and displays a web browser. In the present embodiment the web browser control unit is used when displaying a user authentication screen and an access authority granting screen written in HTML HyperText Markup Language provided by the authorization server . The communication apparatus cooperative control unit is the same as the relay apparatus cooperative control unit illustrated in and carries out cooperative control with the communication apparatus .

The authorization relay service control unit provides the authorization relay service to the communication apparatus using the communication apparatus cooperative control unit . In the present embodiment the authorization relay service control unit receives from the communication apparatus the authorization relay request based on the authorization relay request information illustrated in . The authorization relay service control unit then carries out the authorization process with the authorization server using the authorization control unit . Then the authorization relay service control unit generates the authorization relay response information or illustrated in based on an authorization result from the authorization server and sends the authorization relay response to the communication apparatus .

The authorization determination unit determines whether or not to carry out the authorization process. The authorization control unit carries out the authorization process with the authorization server using the wireless LAN communication control unit . In the present embodiment the authorization control unit carries out the authorization process according to the OAuth 2.0 method in the same manner as the authorization control unit illustrated in . Specifically the authorization control unit generates an authorization request based on an authorization request illustrated in and sends the authorization request to the authorization server . Thereafter the authorization control unit carries out user authentication and access authority granting with the authorization server . Then as a response to that result the authorization control unit receives an authorization response based on authorization response information or illustrated in . Although OAuth 2.0 is used in the present embodiment the invention is not limited thereto and another authorization method may be used instead in the same manner as with the authorization control unit illustrated in . Note also that the functional blocks illustrated in and so on are not limited to being provided by software and may be provided by hardware instead. The functional blocks illustrated in and so on are interrelated. Further still the functional blocks illustrated in and so on are examples a single functional block may be made up of multiple functional blocks and any of the functional blocks may be further divided into blocks that perform multiple functions.

Application type indicates the type of an application requested to be executed by the relay apparatus . In the present embodiment the application type is information indicating an authorization application.

In M the user touches the communication apparatus to the relay apparatus . In M the communication apparatus and the relay apparatus detect each other s NFC communication. In M the communication apparatus sends the communication apparatus information to the relay apparatus using the NFC communication control unit . Meanwhile the relay apparatus receives the communication apparatus information from the communication apparatus using the NFC communication control unit . In M the relay apparatus refers to the application type in the communication apparatus information received through the NFC communication and executes an instructed authorization application unit . The authorization application unit generates the relay apparatus information specifying information necessary for wireless LAN communication with the relay apparatus as the wireless parameters . In M the relay apparatus sends the relay apparatus information to the communication apparatus using the NFC communication control unit . Meanwhile the communication apparatus receives the relay apparatus information from the relay apparatus using the NFC communication control unit .

In M the relay apparatus starts a wireless LAN communication tethering mode called wireless LAN tethering hereinafter based on the wireless parameters using the wireless LAN communication control unit and the public wireless communication control unit . In M the relay apparatus starts the authorization relay service using the authorization relay service control unit . In M the communication apparatus starts wireless LAN communication with the relay apparatus based on the wireless parameters in the received relay apparatus information using the wireless LAN communication control unit . In M the communication apparatus broadcasts the presence of the communication apparatus on the wireless LAN using the relay apparatus cooperative control unit . Specifically the relay apparatus cooperative control unit sends an SSDP alive message on the wireless LAN.

In M the relay apparatus receives the message broadcast by the communication apparatus in M and discovers the communication apparatus using the communication apparatus cooperative control unit . In M the relay apparatus broadcasts the presence of the relay apparatus on the wireless LAN and the presence of the authorization relay service using the communication apparatus cooperative control unit and the authorization relay service control unit . Specifically the communication apparatus cooperative control unit sends an SSDP alive message on the wireless LAN in the same manner as in M. In M the communication apparatus receives the message broadcast by the relay apparatus in M and discovers the relay apparatus and the authorization relay service using the relay apparatus cooperative control unit .

In M the relay apparatus generates an authorization request according to the mode selected in M based on the authorization relay request received from the communication apparatus using the authorization relay service control unit . In the case of the private mode the relay apparatus generates the authorization request that specifies the authorization code grant type according to OAuth 2.0. In the case of the group mode the relay apparatus generates an authorization request that specifies the implicit grant type according to OAuth 2.0. Then the relay apparatus sends the generated authorization request to the authorization server using the authorization control unit . The authorization server receives the authorization request from the relay apparatus .

In M in response to the authorization request from the relay apparatus the authorization server issues a request for user authentication to the relay apparatus . Specifically the authorization server sends user authentication screen data written in HTML to the relay apparatus . In the present embodiment the user authentication requested by the authorization server employs HTTP digest authentication using a user ID and a password. Although the user authentication is carried out using HTTP digest authentication in the present embodiment the invention is not limited thereto and another authentication method such as HTTP basic authentication OpenID a client certificate multifactor authentication biometric authentication or the like may be used instead. In M the relay apparatus displays the received user authentication screen in the display unit using the web browser control unit . In M the user inputs a user ID and a password as user authentication information using the operating unit of the relay apparatus . In M the relay apparatus uses the HTTP digest authentication method to send to the authorization server the user authentication information user ID password input by the user using the web browser control unit . The authorization server then carries out the user authentication based on the user authentication information received from the relay apparatus .

When the user authentication succeeds in M the authorization server sends to the relay apparatus the access authority granting screen written in HTML. In M the relay apparatus displays the received access authority granting screen in the display unit using the web browser control unit . In M the user presses an authorize button displayed in the access authority granting screen using the operating unit of the relay apparatus . In M the relay apparatus notifies the authorization server that access authority has been granted using the web browser control unit . In the present embodiment the notification that the access authority has been granted is controlled by a JavaScript registered trademark program embedded in the access authority granting screen received from the authorization server . The authorization server then receives the notification that the access authority has been granted from the relay apparatus and determines to grant authorization to the communication apparatus .

In M the authorization server sends to the relay apparatus an authorization response in response to the authorization request received in M. The authorization response is as indicated by in the case of the private mode and as indicated by in the case of the group mode. The relay apparatus receives the authorization response from the authorization server using the authorization control unit . In M the relay apparatus saves the authorization response received from the authorization server in the RAM which is a storage unit using the storage control unit in the case where the group mode has been selected in M using the authorization control unit .

In M the relay apparatus generates the authorization relay response based on the authorization response received from the authorization server using the authorization relay service control unit . The authorization relay service control unit then sends to the communication apparatus that is the transmission source of the authorization relay request the authorization relay response corresponding to the authorization relay request received in M. The communication apparatus receives the authorization relay response from the relay apparatus using the authorization control unit . In M the communication apparatus notifies the authorization relay service of the relay apparatus that the authorization has succeeded using the authorization control unit . The relay apparatus receives the notification that the authorization has succeeded from the communication apparatus using the authorization relay service control unit . In M the relay apparatus displays an authorized device linking screen in the display unit using the display control unit in the case where the group mode has been selected in M using the authorization control unit .

In step S the wireless LAN communication control unit determines whether or not the wireless LAN communication with the communication apparatus has succeeded. In the case where the wireless LAN communication has succeeded S YES the process moves to step S. On the other hand in the case where the wireless LAN communication has failed S NO the process moves to step S. In step S the authorization relay service control unit determines whether or not the authorization relay request has been received from the communication apparatus . In the case where the authorization relay request has been received S YES the process moves to step S. On the other hand in the case where the authorization relay request has not been received S NO the process moves to step S. In step S the relay apparatus carries out the authorization process with the authorization server . Details are illustrated in .

In step S the authorization determination unit determines whether or not authorization has succeeded. In the case where the authorization has succeeded S YES the process moves to step S. On the other hand in the case where the authorization has failed S NO the process moves to step S. In step S the authorization application unit displays a message indicating that the authorization has succeeded in the display unit using the display control unit . In step S the control unit advances the process to step S assuming that the authorization has succeeded. In step S the relay apparatus carries out the authorization process with the communication apparatus . Details are illustrated in .

In step S the authorization application unit displays a message indicating that the authorization has failed in the display unit using the display control unit . In step S the control unit ends the processing assuming that the authorization has failed. In step S the control unit ends the processing assuming that authorized device linking has succeeded.

In step S the NFC communication control unit receives the communication apparatus information from the communication apparatus . In step S the NFC communication control unit determines whether or not the authorization application is specified in the application type of the received communication apparatus information . In the case where the authorization application is specified S YES the process moves to step S. On the other hand in the case where the authorization application is not specified S NO the process moves to step S. In step S the NFC communication control unit executes the authorization application unit . The authorization application unit generates the relay apparatus information specifying information necessary for wireless LAN communication with the relay apparatus as the wireless parameters . In step S the NFC communication control unit sends the relay apparatus information to the communication apparatus . In step S the NFC communication control unit ends the processing assuming that the NFC communication with the communication apparatus has succeeded. In step S the NFC communication control unit ends the processing assuming that the NFC communication with the communication apparatus has failed.

In step S the wireless LAN communication control unit starts the wireless LAN communication connection with the communication apparatus . In step S the wireless LAN communication control unit determines whether or not the wireless LAN communication connection with the communication apparatus has succeeded. In the case where the connection has succeeded S YES the process moves to step S. On the other hand in the case where the connection has failed S NO the process moves to step S. In step S the communication apparatus cooperative control unit determines whether or not a message providing a notification that the communication apparatus is present on the wireless LAN has been received from the communication apparatus . In the case where it is determined that the message has been received S YES the process moves to step S whereas in the case where it is determined that the message has not been received S NO the process moves to step S. In step S the communication apparatus cooperative control unit discovers the communication apparatus on the wireless LAN.

In step S the communication apparatus cooperative control unit and the authorization relay service control unit broadcast the presence of the relay apparatus on the wireless LAN and the presence of the authorization relay service. In step S the wireless LAN communication control unit determines to end the processing assuming that the wireless LAN communication with the communication apparatus has succeeded. In step S the wireless LAN communication control unit determines to end the processing assuming that the wireless LAN communication with the communication apparatus has failed.

In step S the authorization control unit stores the authorization type selected in step S in the RAM using the storage control unit . In step S the authorization relay service control unit generates the authorization request based on the authorization request information illustrated in using the authorization relay request received from the communication apparatus . In the present embodiment the authorization relay service control unit specifies code in of the authorization request information in the case where the authorization type selected in step S is the private mode. In the case where the authorization type is the group mode the authorization relay service control unit specifies token for in the authorization request information and specifies the same values as those of of the authorization relay request information received in step S in of the authorization request information. Furthermore the authorization relay service control unit specifies a URI Unique Resource Identifier indicating the authorization application unit of the relay apparatus in redirect uri .

In step S the authorization control unit sends the generated authorization request to the authorization server . In step S the authorization control unit determines whether or not the user authentication screen data written in HTML has been received from the authorization server . In the case where it is determined that the data has been received S YES the process moves to step S whereas in the case where it is determined that the data has not been received S NO the process moves to step S. In step S the web browser control unit displays the received user authentication screen in the display unit . In step S the web browser control unit receives the user authentication information user ID password input by the user . In step S the web browser control unit sends the user authentication information user ID password input by the user to the authorization server using the HTTP digest authentication method.

In step S the web browser control unit determines whether or not the user authentication has succeeded. In the case where the user authentication has succeeded S YES the process moves to step S whereas in the case where the user authentication has failed S NO the process moves to step S. In step S the web browser control unit determines whether or not the access authority granting screen data written in HTML has been received from the authorization server . In the case where it is determined that the data has been received S YES the process moves to step S whereas in the case where it is determined that the data has not been received S NO the process moves to step S. In step S the web browser control unit displays the received access authority granting screen in the display unit . In step S the web browser control unit receives access authority granting instruction information input by the user . Specifically the web browser control unit receives information corresponding to an authorize button or a deny button pressed by the user displayed in the access authority granting screen.

In step S the web browser control unit sends the access authority granting instruction information to the authorization server . In step S the authorization control unit determines whether or not the authorization response based on the authorization response information illustrated in has been received from the authorization server via the web browser control unit . In the case where the response has been received S YES the process moves to step S whereas in the case where the response has not been received S NO the process moves to step S. In step S the authorization control unit determines whether the authorization type is the group mode. In the case of the group mode S YES the process moves to step S. On the other hand in the case where the mode is not the group mode S NO the process moves to step S. In step S the storage control unit saves the authorization response in the RAM .

In step S the authorization relay service control unit generates the authorization relay response based on the authorization relay response information or illustrated in using the authorization response received from the authorization server . In the case where the authorization type is the private mode in the present embodiment the authorization relay service control unit specifies the same values as those of of the authorization response information received in step S in of the authorization relay response information. Furthermore the authorization relay service control unit specifies the same value as that of redirect uri of the authorization request in the redirect uri . In the case where the authorization type is the group mode in the present embodiment the authorization relay service control unit specifies the same values as those of and of the authorization response information received in step S in of the authorization relay response information.

In step S the authorization relay service control unit sends the authorization relay response generated in step S to the communication apparatus . In step S the authorization relay service control unit determines whether or not an authorization result has been received from the communication apparatus . In the case where it is determined that the result has been received S YES the process moves to step S whereas in the case where it is determined that the result has not been received S NO the process moves to step S. In step S the authorization relay service control unit determines whether or not the authorization result received from the communication apparatus indicates that the authorization is successful. In the case where it is determined that the authorization result indicates that the authorization is successful S YES the process moves to step S whereas in the case where it is determined that the authorization result indicates that the authorization has failed S NO the process moves to step S. In step S the authorization control unit ends the processing assuming that the authorization has succeeded. In step S the authorization control unit ends the processing assuming that the authorization has failed. In step S the authorization control unit carries out authorized device linking. Details are illustrated in .

In step S the authorization control unit displays the authorized device linking screen in the display unit using the display control unit . In step S the relay apparatus carries out NFC communication with the communication apparatus . Details of step S are as illustrated in . In step S the NFC communication control unit determines whether or not the NFC communication with the communication apparatus has succeeded. In the case where the NFC communication has succeeded S YES the process moves to step S. On the other hand in the case where the NFC communication has failed S NO the process moves to step S. In step S the relay apparatus carries out wireless LAN communication with the communication apparatus . Details of the processing of step S are as illustrated in .

In step S the wireless LAN communication control unit determines whether or not the wireless LAN communication with the communication apparatus has succeeded. In the case where the wireless LAN communication has succeeded S YES the process moves to step S. On the other hand in the case where the wireless LAN communication has failed S NO the process moves to step S. In step S the authorization relay service control unit determines whether or not the authorization relay request has been received from the communication apparatus and detected. In the case where it is determined that the authorization relay request has been received S YES the process moves to step S. On the other hand in the case where it is determined that the authorization relay request has not been received S NO the process moves to step S. In step S the authorization control unit determines whether or not the authorization response is saved in the RAM . In the case where it is determined that the response is saved S YES the process moves to step S. On the other hand in the case where it is determined that the authorization relay request has not been received S NO the process moves to step S.

In step S the authorization relay service control unit generates the authorization relay response based on the authorization relay response illustrated in using the authorization response saved in the RAM . In the present embodiment the authorization relay service control unit sets the authorization response received in step S for the authorization relay responses . In other words the authorization relay service control unit specifies the same value as for specifies the same value as for and specifies the same value as for . In step S the authorization relay service control unit sends the authorization relay response generated in step S to the communication apparatus that is the transmission source of the authorization relay response. In step S the authorization relay service control unit determines whether or not an authorization result has been received from the communication apparatus . In the case where it is determined that the result has been received S YES the process moves to step S whereas in the case where it is determined that the result has not been received S NO the process moves to step S.

In step S the authorization relay service control unit determines whether or not the authorization result received from the communication apparatus indicates that the authorization is successful. In the case where it is determined that the authorization result indicates that the authorization is successful S YES the process moves to step S whereas in the case where it is determined that the authorization result indicates that the authorization has failed S NO the process moves to step S. In step S the authorization control unit ends the processing assuming that the authorization has succeeded. In step S the authorization control unit ends the processing assuming that the authorization has failed.

As described thus far the communication apparatus sends the authorization relay request to the relay apparatus using the NFC communication function and the wireless LAN function of the communication apparatus and the relay apparatus . After receiving the authorization relay request the relay apparatus displays the authorization type selection screen in the display unit . The relay apparatus then generates the authorization request for the authorization type selected by the user through the authorization type selection screen and sends the authorization request to the authorization server . The relay apparatus then displays in the display unit the user authentication screen data and the access authority granting screen data written in HTML from the authorization server using the web browser control unit . The relay apparatus sends an input from the user to the authorization server and receives the authorization response from the authorization server . The relay apparatus saves the authorization response with the user having selected the group mode as the authorization type as a condition. Thereafter the relay apparatus sends the authorization relay response based on the authorization response to the communication apparatus . After receiving the authorization relay response the communication apparatus sends the authorization result to the relay apparatus . In the case where the authorization succeeds and the authorization type is the group mode the authorized device linking screen can be displayed and the user can be prompted to link to an authorized device.

When the user has made a wireless LAN connection with the communication apparatus through the NFC communication function the authorization request is obtained from the NFC linked communication apparatus the authorization relay response is generated based on the saved authorization response and the authorization relay response is sent to the communication apparatus . Through this when granting the same access authority to multiple devices the authorization process can be carried out without carrying out the user authentication and the access authority granting processes with the authorization server each time thus increasing the convenience for the user.

The authorization response saved in the relay apparatus is deleted when the authorization application unit of the relay apparatus is terminated and when the authorization process is started with a new communication apparatus but it is also possible to add a function for deleting the authorization response to the authorization application and delete the response at a predetermined point in time. Although it is possible to terminate the authorization application in order to end the authorized device linking process during operations when the authorized device linking screen is being displayed it is also possible to provide an end button in the authorized device linking screen and enable the user to explicitly end the process.

Meanwhile a situation can be considered where in the relay apparatus it takes time from when the authorization type selection screen is displayed to when the authorization response is obtained from the authorization server after the user authentication and access authority granting processes have been carried out with the authorization server . In light of such a situation it is possible to display in the display unit a screen notifying the user that the authorization response is being received.

In addition it is also possible to use the authorization type set for the authorization relay request by the communication apparatus as is without displaying the authorization type selection screen . Thereafter the relay apparatus generates and sends the authorization relay response based on the authorization response received from the authorization server to the communication apparatus .

Furthermore although the authorization relay request and the authorization relay response are sent and received between the communication apparatus and the relay apparatus through wireless LAN communication in the present embodiment the invention is not limited thereto. It should be noted here that the same effects can be achieved even if another communication method such as NFC BT BT LE ZigBee or the like is used. The foregoing has described an embodiment of the present invention.

The present embodiment describes a case in which the user operates the relay apparatus and starts the authorization process after launching the authorization application unit . In the present embodiment descriptions of items that are the same as those in the first embodiment will be omitted and only the differences will be mentioned.

In M the user operates the relay apparatus and instructs the authorization application to be executed. In M the relay apparatus executes the authorization application unit . In M the wireless LAN communication control unit and the public wireless communication control unit start wireless LAN tethering. In M the authorization control unit displays the authorization type selection screen in the display unit using the display control unit . In M the user selects the authorization type using the operating unit of the relay apparatus . The private mode is an authorization code according to OAuth 2.0 whereas the group mode is implicit according to OAuth 2.0. In the present sequence the user selects the private mode.

In M in the case where the private mode has been selected in M the client id is required when sending the authorization request to the authorization server . As such the user is prompted to make an NFC touch with the communication apparatus and thus the authorized device linking screen is displayed. In M the user touches the relay apparatus to the communication apparatus . In M the communication apparatus and the relay apparatus detect each other s NFC communication. In M the communication apparatus and the relay apparatus connect wirelessly. Details of the processing of M are as illustrated in . In M the communication apparatus the relay apparatus and the authorization server carry out authorization. Details of the processing of M are as illustrated in .

M to M carry out the same operations as those in M to M. In M the communication apparatus the relay apparatus and the authorization server carry out authorization. M to M illustrated in are carried out. In M in the case where the group mode has been selected in M it is necessary to send the authorization response received from the authorization server to the communication apparatus . As such the user is prompted to make an NFC touch with the communication apparatus and thus the authorized device linking screen is displayed. In M the user touches the relay apparatus to the communication apparatus . In M the communication apparatus and the relay apparatus detect each other s NFC communication. In M the communication apparatus and the relay apparatus connect wirelessly. Details of the processing of M are as illustrated in .

In M the relay apparatus generates the authorization relay response based on the authorization response received from the authorization server using the authorization relay service control unit . The authorization relay service control unit then sends to the communication apparatus the authorization relay response corresponding to the authorization relay request received in M. The communication apparatus receives the authorization relay response from the relay apparatus using the authorization control unit . In M the communication apparatus notifies the authorization relay service of the relay apparatus that the authorization has succeeded using the authorization control unit . The relay apparatus receives the notification that the authorization has succeeded from the communication apparatus using the authorization relay service control unit .

As described thus far the relay apparatus can display the authorization type selection screen as a means for launching the authorization application unit. In the case where the private mode has been selected in the authorization type selection screen the authorized device linking screen is displayed and NFC communication is carried out with the communication apparatus . In the case where the group mode has been selected the authorization request is sent to the authorization server the authorized device linking screen is displayed after carrying out the user authentication and access authority granting processes and NFC communication is carried out with the communication apparatus . Through this the user can know a time period in which to carry out NFC communication with the communication apparatus based on the selected authorization type which increases the usability.

Embodiments of the present invention can also be realized by a computer of a system or apparatus that reads out and executes computer executable instructions e.g. one or more programs recorded on a storage medium which may also be referred to more fully as a non transitory computer readable storage medium to perform the functions of one or more of the above described embodiments and or that includes one or more circuits e.g. application specific integrated circuit ASIC for performing the functions of one or more of the above described embodiments and by a method performed by the computer of the system or apparatus by for example reading out and executing the computer executable instructions from the storage medium to perform the functions of one or more of the above described embodiments and or controlling the one or more circuits to perform the functions of one or more of the above described embodiments. The computer may comprise one or more processors e.g. central processing unit CPU micro processing unit MPU and may include a network of separate computers or separate processors to read out and execute the computer executable instructions. The computer executable instructions may be provided to the computer for example from a network or the storage medium. The storage medium may include for example one or more of a hard disk a random access memory RAM a read only memory ROM a storage of distributed computing systems an optical disk such as a compact disc CD digital versatile disc DVD or Blu ray Disc BD a flash memory device a memory card and the like.

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.

This application claims the benefit of Japanese Patent Application No. 2014 059081 filed Mar. 20 2014 which is hereby incorporated by reference herein in its entirety.

