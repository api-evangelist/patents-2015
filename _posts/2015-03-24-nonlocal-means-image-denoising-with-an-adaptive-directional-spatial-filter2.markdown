---

title: Non-local means image denoising with an adaptive directional spatial filter
abstract: System, apparatus, method, and computer readable media for edge-enhanced non-local means (NLM) image denoising. In embodiments, edge detail is preserved in filtered image data by weighting of the noisy input target pixel value with other pixel values based on self-similarity and further informed by a data-driven directional spatial filter. Embodiments herein may denoise regions of an image lacking edge characteristics with a more uniform spatial filter than those having edge characteristics. In embodiments, directionality of a spatial filter function is modulated based on an edge metric to increase the weighting of pixel values along an edge when there is a greater probability the edge passes through the target pixel. In further embodiments, the adaptive spatial filter is elliptical and oriented relative to a spatial gradient direction with non-uniform filter widths that are based on the edge metric.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09576346&OS=09576346&RS=09576346
owner: Intel Corporation
number: 09576346
owner_city: Santa Clara
owner_country: US
publication_date: 20150324
---
Image denoising is an important functional block in an image processing pipeline. The goal of image denoising methods is to recover the original image from a noisy measurement. Images generated by digital camera sensors pick up noise from a variety of sources which should be reduced for aesthetic or practical e.g. machine vision purposes. Ideally a noise reduction algorithm utilized by an image denoising block should improve image clarity by reducing noise while minimizing loss of real detail. The technical difficulty lies in robustly distinguishing noise from image details.

Many image denoising algorithms that perform some averaging or weighting of a pixel relative to a grouping of pixels spatially surrounding the target pixel are referred to as local mean or local smoothing filters. A Gaussian Blur filter is an example of a uniform local mean filter. Non local image denoising algorithms have gained popularity in the last decade because relative to many local means algorithms post filtering clarity is improved while the real detail loss is reduced. In a non local means NLM algorithm an NLM filter utilizes redundancy of self similarity found within an image to reduce edge blurring by taking a mean of a greater number of pixels in the image weighted by how similar the pixels are to the target pixel based on an comparison of multi pixel patches. In some exemplary NLM algorithms for each input pixel a target patch containing the target pixel is determined Other candidate patches typically limited to within a neighborhood of the target patch are then assessed for similarity. An average pixel value may then be computed as a weighted average of the candidate patches according to the self similarity weight assigned to the candidate patch through application of a similarity filter function.

One or more embodiments are described with reference to the enclosed figures. While specific configurations and arrangements are depicted and discussed in detail it should be understood that this is done for illustrative purposes only. Persons skilled in the relevant art will recognize that other configurations and arrangements are possible without departing from the spirit and scope of the description. It will be apparent to those skilled in the relevant art that techniques and or arrangements described herein may be employed in a variety of other systems and applications beyond what is described in detail herein.

Reference is made in the following detailed description to the accompanying drawings which form a part hereof and illustrate exemplary embodiments. Further it is to be understood that other embodiments may be utilized and structural and or logical changes may be made without departing from the scope of claimed subject matter. Therefore the following detailed description is not to be taken in a limiting sense and the scope of claimed subject matter is defined solely by the appended claims and their equivalents.

In the following description numerous details are set forth however it will be apparent to one skilled in the art that embodiments may be practiced without these specific details. Well known methods and devices are shown in block diagram form rather than in detail to avoid obscuring more significant aspects. References throughout this specification to an embodiment or one embodiment mean that a particular feature structure function or characteristic described in connection with the embodiment is included in at least one embodiment. Thus the appearances of the phrase in an embodiment or in one embodiment in various places throughout this specification are not necessarily referring to the same embodiment. Furthermore the particular features structures functions or characteristics described in the context of an embodiment may be combined in any suitable manner in one or more embodiments. For example a first embodiment may be combined with a second embodiment anywhere the particular features structures functions or characteristics associated with the two embodiments are not mutually exclusive.

As used in the description of the exemplary embodiments and the appended claims the singular forms a an and the are intended to include the plural forms as well unless the context clearly indicates otherwise. It will also be understood that the term and or as used herein refers to and encompasses any and all possible combinations of one or more of the associated listed items.

As used throughout the description and in the claims a list of items joined by the phrase at least one of or one or more of means any combination of the listed terms. For example the phrase at least one of A B or C can mean A B C A and B A and C B and C or A B and C.

The terms coupled and connected along with their derivatives may be used herein to describe functional or structural relationships between components. It should be understood that these terms are not intended as synonyms for each other. Rather in particular embodiments connected may be used to indicate that two or more elements are in direct physical optical or electrical contact with each other. Coupled may be used to indicated that two or more elements are in either direct or indirect with other intervening elements between them physical optical or electrical contact with each other and or that the two or more elements co operate or interact with each other e.g. as in a cause an effect relationship .

Some portions of the detailed descriptions provide herein are presented in terms of algorithms and symbolic representations of operations on data bits within a computer memory. Unless specifically stated otherwise as apparent from the following discussion it is appreciated that throughout the description discussions utilizing terms such as calculating computing determining estimating storing collecting displaying receiving consolidating generating updating or the like refer to the action and processes of a computer system or similar electronic computing device that manipulates and transforms data represented as physical electronic quantities within the computer system s circuitry including registers and memories into other data similarly represented as physical quantities within the computer system memories or registers or other such information storage transmission or display devices.

While the following description sets forth embodiments that may be manifested in architectures such system on a chip SoC architectures for example. Implementation of the techniques and or arrangements described herein are not restricted to particular architectures and or computing systems and may be implemented by any architecture and or computing system for similar purposes. Various architectures employing for example multiple integrated circuit IC chips and or packages and or various computing devices and or consumer electronic CE devices such as set top boxes smartphones etc. may implement the techniques and or arrangements described herein. Further while the following description may set forth numerous specific details such as logic implementations types and interrelationships of system components logic partitioning integration choices etc. claimed subject matter may be practiced without such specific details. Furthermore some material such as for example control structures and full software instruction sequences may not be shown in detail in order not to obscure the material disclosed herein.

Certain portions of the material disclosed herein are implemented in hardware for example as logic circuitry in a graphics processor. Certain other portions may be implemented in hardware firmware software or any combination thereof. At least some of the material disclosed herein may also be implemented as instructions stored on a machine readable medium which may be read and executed by one or more processors graphics processors and or central processors . A machine readable medium may include any medium and or mechanism for storing or transmitting information in a form readable by a machine e.g. a computing device . For example a machine readable medium may include read only memory ROM random access memory RAM magnetic disk storage media optical storage media flash memory devices electrical optical acoustical or other similarly non transitory tangible media.

Although NLM denoising techniques often improve image quality over most local mean filters the inventors have found NLM techniques suffer from unsmooth edges at low Signal to Noise Ratios SNR . Image denoising techniques and hardware architectures capable of improving edge smoothness while preserving desirable attributes of the NLM techniques are therefore advantageous. Accordingly one or more systems methods and computer readable media are described below for NLM image denoising enhanced at least in part through incorporation of an adaptive directional spatial filter. This edge enhanced NLM denoising is referred to herein as adaptive directional non local means image denoising. In contrast to conventional NLM filters which suffer poor edge smoothness as noise increases the adaptive directional non local means image denoising embodiments described herein actively account for edges passing through a target pixel by way of a spatial filter function that has directionality parameters adapted based on an edge metric determined for the target pixel. In some embodiments a filtered pixel value is determined by applying a similarity filtering function and a directional spatial filtering function to an input target pixel value. In some embodiments an edge metric assesses the probability that an edge passes through the target pixel and one or more parameters of a spatial filter function controlling directionality of the spatial filter are computed based on the edge metric. In some embodiments the adaptive spatial filter function has widths that vary from a uniform filter value to anisotropic filter values as a function of the edge metric. In some embodiments a spatial gradient direction is determined for a target pixel and orientations of the anisotropic filter widths aligned relative to the gradient direction. Some embodiments herein may thereby denoise a first target pixel off an edge as a function of a more uniform spatial filter and denoise a second target pixel on an edge as a function of a more anisotropic spatial filter. Where SNR is low and both target pixel and similar local patches are more noisy NLM denoising with adaptive directional spatial filtering in accordance with some embodiments described herein have been found to add an edge bias that advantageously achieves a smoother edge without compromising detail preservation the manner often found with purely directional denoising algorithms.

In some embodiments input pixel values pare raw data in RGB space. While this raw data may be raw Bayer data or the like output by a camera sensor in advantageous embodiments the pixel values phave been preprocessed to some extent for example linearized including black level correction and color shading corrected. The raw image data may also have had known bad pixels corrected and lens shading corrections may have been performed upstream of denoising method . In some other embodiments input pixel values preceived at operation are in YUV space with method specifically operating on the luminance Y channel.

At operation an edge metric vis computed for a target pixel p. Many edge detection methods are known in the art and may be employed at operation . Edge detection methods that return more than two states may be advantageously employed at operation . In some embodiments the edge detection method performed at operation returns an edge metric that varies over multiple levels between 0 and 1 e.g. 0 v

At operation one or more parameters of an adaptive spatial filter function are determined based on the edge metric. Driven by the image data the spatial filter function parameter s computed at operation are to adapt to the presence of an edge at target pixel pmodulating directionality of the spatial filter. A spatial filter in NLM denoising is to combine a spatially based weighting with a similarity based weighting so that pixels within a similar patch within a first region of the neighborhood window may be given greater importance than pixels positioned at a second region of the neighborhood window. Mathematically NLM denoising in accordance with some embodiments is a multiplication of two filter functions 2 

where is the local similarity filter function controlling pixel weighting as a function of the similarity distance between a target patch and other patches in its neighborhood. The spatial filter function controls pixel weighting as a function of the spatial distance between a target patch and other patches in its neighborhood. In some embodiments it is the spatial filter function that is to adapt to the image data through a response to the edge metric Vcomputed for the target pixel p. Thus whereas a constant spatial filter e.g. a Gaussian kernel is not data driven and would simply assign spatial weights to pixels based on fixed priority within the neighborhood window e.g. such that the central pixel in the window contribute more to the similarity distance than do pixels located at the edge of the window the adaptive spatial filter in accordance with some embodiments herein is to assign spatial weights to pixels within the neighborhood window such that those pixels on an edge contribute more to the similarity distance than do pixels off an edge. While the adaptive spatial filter may take many forms to implement an edge enhanced spatial pixel weighting some exemplary embodiments are described in greater detail below in the context of and .

With the adaptive spatial filter function computed at operation method continues at operation where the similarity filter function and spatial filter function are applied to the target pixel pby evaluating the patches within the neighborhood window to arrive a the filtered target pixel p. The filtered output target pixel value pis then stored at operation for example to an electronic memory such as but not limited to a register volatile memory cell non volatile memory cell etc. Input target pixel pis incremented over multiple serial iterations of method or over multiple parallel threads until all pixels in an image I have been likewise filtered. In further embodiments filtered pixel value pis further output to a display pipeline and or encoding pipeline and or wireless transmission pipeline.

Referring first to in the exemplary method the adaptive directional spatial filter introduced in the context of method is implemented as an adaptive directional Gaussian filter where the spatial filter as a function of pixel grid coordinates takes the form 

Method begins with receiving the target pixel at operation . Along with the input target pixel p values of other pixels in the image frame I may be received or rendered accessible to the engine executing method . In some embodiments all pixels within a local neighborhood surrounding the target pixel pare received at operation . As shown in an image or frame includes a spatially correlated D pixel array of N N dimension. In the depicted embodiment values of pixel array are in RGB space. Within pixel array is a local neighborhood of K K dimension surrounding target pixel . Pixel values from pixel array may be received as input pixels pat operation for example.

As further illustrated in method proceeds to operation where a spatial gradient direction is computed for the target pixel p. Notably operation is illustrated as potentially independent of the edge metric computation at operation to allow for separate optimization of the computations. Results computed in either operation or may inform the other however as denoted by the dashed line in . In some embodiments the spatial gradient direction may be readily determined from a gradient magnitude computation performed as part of an edge detection algorithm employed at operation . A gradient operator e.g. Sobel kernel may be applied to compute a gradient component in each orientation of the pixel array or grid e.g. G square root over G G at operation in which case angle of orientation of the edge relative to the pixel array giving rise to the spatial gradient may be readily determined at operation . In alternative embodiments for example where G is estimated directly the spatial gradient direction may be determined independently through any known technique as embodiments are not further limited in this respect. further illustrates an exemplary spatial gradient vector G having a direction within neighborhood .

Returning to method continues to operation where spatial filter rotation coordinates x and y are computed. Rotation coordinates x and y are to orient the directional filter relative the pixel grid. In some embodiments rotation coordinates x and y are based on the spatial gradient direction . In one exemplary embodiment rotation coordinates x and y are computed with a rotated coordinates vector 

In some embodiments width parameters of a directional Gaussian filter are computed based on an edge metric. In method for example at operations at least one of spatial filter width parameters and are computed as a function of edge metric v. In advantageous embodiments both filter width parameters and are computed as one or more function of edge metric v. In some embodiments the filter width parameters and are to be a function of edge metric vthat increases the directionality of the Gaussian filter in response to greater certainty that the target pixel is on an edge. In some embodiments the filter width parameters and vary from uniformity to non uniform e.g. as a function of edge metric v. In one exemplary embodiment where vincreases from 0 to 1 with a 0 indicative of a failure to detect an edge and 1 indicative of detecting an edge with a greatest amount of certainty the spatial filter width parameters and are computed as 1 5 1 6 where and are configurable parameters controlling the shape range for the convolution kernel. In some embodiments these parameters have values satisfying the relationship . In the effect of an adaptive directional Gaussian filter shape is depicted as and depend on the edge metric vincreasing from 0 to 1 e.g. 0 no edge and 1 edge with a greatest amount of certainty . In the limit of maximum certainty of an edge maximally directional spatial filter is achieved with filter width parameters and reaching major length and minor length respectively. In the limit of a failure to detect an edge minimally directional spatial filter is realized with filter width parameters and equating to . For edge metric values falling between these limits a moderately directional filter is realized.

Returning to method continues with application of adaptive directional filter function and a similarity filter function in the NLM computation at operation . As further illustrated in a target pixel patch including target pixel is compared to each of one or more candidate pixel patch within the set of all pixels of local neighborhood . Candidate pixel patches may for example be of a predetermined size and overlap with a number of other candidate patches defined within neighborhood . The number of candidate patches within a given neighborhood may for example be a function of the location of target pixel within the image frame e.g. along an edge .

A candidate patch weight Wis computed corresponding to how similar each candidate patch is to the target pixel patch referred to herein as self similarity. A candidate patch weight Wmay for example be larger for a first candidate patch having greater similarity to the target patch than for a second candidate patch less similar to the target patch. Each candidate patch weight Wmay be determined by way of any patch similarity scoring function to assess the similarity between the pixels i and p for example with 0 W i p 1. Any technique known may be employed to arrive at a similarity weight as embodiments herein are not further limited in this respect. In one embodiment the similarity measure is computed as the sum of absolute differences in pixel value e.g. intensity . Such an embodiment may be advantageously implemented in fixed function or semi programmable logic circuitry e.g. an image signal processor . In some embodiments includes Gaussian kernel function where a squared sum of differences in pixel value is computed as the similarity measure.

The candidate patch weight is further a function of adaptive directional filter function to weight candidate patches with a decay that is slower along an edge than the decay normal to the edge. In the example illustrated in where a gradient G is present at target pixel a spatial filter is oriented and directionalized sufficiently to weight patch more heavily than is patch . Application of the similarity and spatial filter functions and described above may be discretized by the pixels and in some embodiments computation of the filtered pixel value proceeds as 

The filtered target pixel value computed at operation is then stored to memory at operation . If all pixels of the image have been so filtered method ends. If not method continues with incrementing to a next target pixel at operation . Operations and are then performed again substantially as described above. Once all filtered pixel values are determined they may be stored as a denoised image according to any known technique. In further embodiments filtered pixel values and or denoised images are further output to a display pipeline and or encoding pipeline and or wireless transmission pipeline not depicted .

In an illustrative embodiment raw data originates from camera hardware module CM that includes a camera sensor both of which may be included as part of system or not as denoted by the dashed line blocks. Sensor may be a QXGA WQXGA or QSXGA format digital image device for example. Camera sensor may provide a color resolution of 10 bits or more per pixel and may be further operable to capture continuous video frames progressively. Sensor may have a pixel frequency of 170 MHz or more. Camera sensor may include an RGB Bayer color filter an analog amplifier an A D converter other components to convert incident light into a digital signal corresponding to raw image data. Sensor may be controlled to operate a rolling shutter or electronic focal plane shutter process where pixels are read out progressively in a line sequential fashion for a frame. Raw data is input to image signal processor ISP . ISP is to receive and analyze frames of raw video data during the horizontal and or vertical blanking periods associated with CM . During raw image data processing ISP performs noise reduction with NLM image denoise module . In the exemplary embodiment ISP further includes a preprocessor to perform one or more of pixel linearization and shading compensation where raw Bayer data or the like output by camera sensor is linearized including also black level correction and color shading corrected. The raw image data chromaticity white balance may be further calculated. Known bad pixel corrections and lens shading corrections may also be performed upstream of denoise module . In an alternative embodiments the amount of preprocessing performed by preprocessor is minimal for example including only dark noise removal upstream of denoise module .

In some embodiments image denoising module is implemented by logic circuitry of ISP . In alternate embodiments image denoising module is implemented as one or more thread instantiated on logic circuitry executing software instructions specifying the denoising pipeline for example on a programmable processor such as a applications processing unit APU or central processing unit CPU . Denoising module may then be coupled to an output port of preprocessor which may be implemented by logic circuitry of ISP . In still other embodiments both pre processor and denoising module are implemented as threads on a APU or CPU coupled to receive output from camera module .

Denoising module includes an edge detection module and an adaptive directional spatial filtering module . Edge detection module includes logic implemented through software programmable circuitry or fixed function logic circuitry to compute an edge metric for example in accordance with any embodiments described elsewhere herein. In some embodiments edge detection module further includes logic to calculate a spatial gradient direction for example in accordance with any embodiments described elsewhere herein. Adaptive directional spatial filter module includes logic implemented through software programmable circuitry or fixed function logic circuitry to compute one or more spatial filter parameters such as width parameters based on edge metric information e.g. output from edge detection module . In some embodiments adaptive directional spatial filter module includes logic to compute one or more spatial filter parameters such as a filter orientation parameter based on gradient direction information e.g. output by edge detection module . Denoising module further includes NLM module having logic implemented through software programmable circuitry or fixed function logic circuitry to compute a non local mean of a target input pixel based on the input pixel values and adaptive directional spatial filtering parameters for example output by adaptive directional spatial filter module . In some embodiments NLM module further includes logic circuitry to compute a patch weight for candidate patches within the neighborhood by performing a pixel value comparison between a number of candidate patches and a target patch of pixels within the neighborhood that contains the target pixel and by performing a positional comparison between a number of candidate patches and the target patch of pixel within the neighborhood to weight pixel values on an edge more heavily than those that do not.

As also illustrated in image processing system further includes an output port coupled to at least of an electronic memory a display or an encoder . Memory includes circuitry to store the filtered image pixel s as a filtered representation of the raw image data . Encoder includes logic to encode the filtered image pixel as a filtered representation of raw image data . Display includes circuitry to present the filtered image pixel s as a filtered representation of image data . In further embodiments one or more of ISP and image denoising module is coupled to an APU CPU having a user space and a kernel space. Applications executed on the user space may control denoising module e.g. defining configurable parameters of adaptive directional spatial filter module such as etc. .

System includes a device platform that may implement all or a subset of the various adaptive directional NLM denoising methods systems described above in the context of . In various exemplary embodiments processor executes adaptive directional NLM denoising algorithms. Processor includes logic circuitry for example to implement any of the denoising algorithms described elsewhere herein. In some embodiments one or more computer readable media may store instructions which when executed by CPU and or processor cause the processor s to execute one or more adaptive directional NLM denoising algorithm such as any of those described in detail above. One or more image data frame filtered by image denoising module may then be stored in electronic memory as filtered image data.

In embodiments device platform is coupled to a human interface device HID . Platform may collect raw image data with CM which is filtered and output to HID . A navigation controller including one or more navigation features may be used to interact with for example device platform and or HID . In embodiments HID may include any television type monitor or display coupled to platform via radio and or network . HID may include for example a computer display screen touch screen display video monitor television like device and or a television.

Under the control of one or more software applications device platform may display user interface on HID . Movements of the navigation features of controller may be replicated on a display e.g. HID by movements of a pointer cursor focus ring or other visual indicators displayed on the display. For example under the control of software applications the navigation features located on navigation controller may be mapped to virtual navigation features displayed on user interface .

In embodiments device platform may include any combination of CM chipset processors memory storage applications and or radio . Chipset may provide intercommunication among processors memory video processor applications or radio .

One or more of processors may be implemented as one or more Complex Instruction Set Computer CISC or Reduced Instruction Set Computer RISC processors x86 instruction set compatible processors multi core or any other microprocessor or central processing unit CPU .

Memory may be implemented as a volatile memory device such as but not limited to a Random Access Memory RAM Dynamic Random Access Memory DRAM or Static RAM SRAM . Memory may also be implemented as a non volatile storage device such as but not limited to flash memory battery backed up SDRAM synchronous DRAM magnetic memory phase change memory and the like.

Radio may include one or more radios capable of transmitting and receiving signals using various suitable wireless communications techniques. Such techniques may involve communications across one or more wireless networks. Example wireless networks include but are not limited to wireless local area networks WLANs wireless personal area networks WPANs wireless metropolitan area network WMANs cellular networks and satellite networks. In communicating across such networks radio may operate in accordance with one or more applicable standards in any version.

In embodiments system may be implemented as a wireless system a wired system or a combination of both. When implemented as a wireless system system may include components and interfaces suitable for communicating over a wireless shared media such as one or more antennas transmitters receivers transceivers amplifiers filters control logic and so forth. An example of wireless shared media may include portions of a wireless spectrum such as the RF spectrum and so forth. When implemented as a wired system system may include components and interfaces suitable for communicating over wired communications media such as input output I O adapters physical connectors to connect the I O adapter with a corresponding wired communications medium a network interface card MC disc controller video controller audio controller and the like. Examples of wired communications media may include a wire cable metal leads printed circuit board PCB backplane switch fabric semiconductor material twisted pair wire co axial cable fiber optics and so forth.

As described above system may be embodied in varying physical styles or form factors. further illustrates embodiments of a mobile handset device in which system may be embodied. In embodiments for example device may be implemented as a mobile computing device having wireless capabilities. A mobile computing device may refer to any device having a processing system and a mobile power source or supply such as one or more batteries for example. Examples of a mobile computing device may include an ultra laptop computer tablet touch pad portable computer handheld computer palmtop computer personal digital assistant PDA cellular telephone combination cellular telephone PDA television smart device e.g. smartphone tablet or smart television mobile internet device MID messaging device data communication device and so forth. Examples of a mobile computing device also may include computers and or media capture transmission devices configured to be worn by a person such as a wrist computer finger computer ring computer eyeglass computer belt clip computer arm band computer shoe computers clothing computers and other wearable computers. In various embodiments for example a mobile computing device may be implemented as a smart phone capable of executing computer applications as well as voice communications and or data communications. Although some embodiments may be described with a mobile computing device implemented as a smart phone by way of example it may be appreciated that other embodiments may be implemented using other wireless mobile computing devices as well. The embodiments are not limited in this context.

As shown in mobile handset device may include a housing with a front and back . Device includes a display an input output I O device and an integrated antenna . Device also may include navigation features . Display may include any suitable display unit for displaying information appropriate for a mobile computing device. I O device may include any suitable I O device for entering information into a mobile computing device. Examples for I O device may include an alphanumeric keyboard a numeric keypad a touch pad input keys buttons switches microphones speakers voice recognition device and software and so forth. Information also may be entered into device by way of microphone not shown or may be digitized by a voice recognition device. Embodiments are not limited in this context. Integrated into at least the back is camera e.g. including a lens an aperture and an imaging sensor and a flash both of which may be components of a CM through which image frames are exposed and output to an adaptive directional NLM denoising module such as any of those implementation described elsewhere herein.

In some embodiments the adaptive directional NLM denoising architecture and associated algorithms as described herein are implemented in various hardware architectures cell designs or IP cores. 

Embodiments described herein may be implemented using hardware elements software elements or a combination of both. Examples of hardware elements or modules include processors microprocessors circuitry circuit elements e.g. transistors resistors capacitors inductors and so forth integrated circuits application specific integrated circuits ASIC programmable logic devices PLD digital signal processors DSP field programmable gate array FPGA logic gates registers semiconductor device chips microchips chip sets and so forth. Examples of software elements or modules include applications computer programs application programs system programs machine programs operating system software middleware firmware routines subroutines functions methods procedures software interfaces application programming interfaces API instruction sets computing code computer code code segments computer code segments data words values symbols or any combination thereof. Determining whether an embodiment is implemented using hardware elements and or software elements may vary in accordance with any number of factors considered for the choice of design such as but not limited to desired computational rate power levels heat tolerances processing cycle budget input data rates output data rates memory resources data bus speeds and other design or performance constraints.

One or more aspects of at least one embodiment may be implemented by representative instructions stored on a machine readable storage medium. Such instructions may reside completely or at least partially within a main memory and or within a processor during execution thereof by the machine the main memory and the processor portions storing the instructions then also constituting a machine readable storage media. Programmable logic circuitry may have registers state machines etc. configured by the processor implementing the computer readable media. Such logic circuitry as programmed may then be understood to be physically transformed into a system falling within the scope of the embodiments described herein. Instructions representing various logic within the processor which when read by a machine may also cause the machine to fabricate logic adhering to the architectures described herein and or to perform the techniques described herein. Such representations known as cell designs or IP cores may be stored on a tangible machine readable medium and supplied to various customers or manufacturing facilities to load into the fabrication machines that actually make the logic or processor.

While certain features set forth herein have been described with reference to exemplary embodiments this description is not intended to be construed in a limiting sense. Hence various modifications of the implementations described herein as well as other implementations which are apparent to persons skilled in the art to which the present disclosure pertains are deemed to be within the spirit and scope of the present disclosure.

In one or more first embodiments a computer implemented non local means image denoising method comprises receiving input pixel values of an image frame and computing an edge metric associated with a target input pixel. The method further comprises computing one or more parameters based on the edge metric that specify directionality of a spatial filter function. The method further comprises determining a filtered target pixel value by applying a similarity filter function and the spatial filter function having the specified directionality to the input pixel values. The method further comprises storing the filtered target pixel value to an electronic memory.

In furtherance of the first embodiments the adaptive spatial filter function comprises a directional Gaussian filter function having first and second filter widths at least one of which is dependent upon the edge metric.

In furtherance of the first embodiment immediately above the first and second filter widths are to vary between a most uniform filter width for a first edge metric value indicative of a failure to detect an edge and predetermined maximum width and minimum widths at a second edge metric value indicative of an edge detected with highest confidence wherein the uniform width is between the minimum and maximum widths.

In furtherance of the first embodiments the edge metric comprises a probability of an edge passing through the target input pixel and the directionality increases directly with the probability.

In furtherance of the first embodiments further comprises determining a direction of a spatial gradient in the pixel values at the target pixel and computing an adaptive directional spatial filter function further comprises orienting the directional filter relative to the gradient direction to decay weights of pixels on the edge more slowly than those off the edge.

In furtherance of the first embodiment immediately above orienting the filter relative to the gradient direction further comprises applying a rotation matrix to the target pixel coordinates.

In furtherance of the first embodiments computing the edge metric comprises thresholding a magnitude of a spatial gradient in the pixel values.

In furtherance of the first embodiments determining the filtered target pixel value further comprises weighting the input target pixel value with one or more pixel patch values weighted by both a similarity of one or more candidate patches to a target patch including the target pixel and a location of one or more candidate patches relative to an edge quantified by the edge metric.

In one more second embodiments image denoising apparatus comprising a means to perform any one of the first embodiments.

In one or more third embodiments an image denoising apparatus comprises an input port to receive input pixel values of an image frame. The apparatus further comprises a denoising module coupled to the input port and further including an edge detection module including logic to compute an edge metric associated with a target input pixel a directional spatial filter module include logic to compute one or more parameters based on the edge metric that specify directionality of a spatial filter function and a non local means module to determine a filtered target pixel value by applying a similarity filter function and the spatial filter function having the specified directionality to the input pixel values an output port coupled to the denoising module to output the filtered target pixel value to an electronic memory.

In furtherance of the third embodiments the directional spatial filter module includes logic to compute a directional Gaussian filter function having first and second filter widths at least one of which is dependent upon the edge metric.

In furtherance of the third embodiment immediately above the directional spatial filter module includes logic to vary the first and second filter width between a most uniform filter width for a first edge metric value indicative of a failure to detect an edge and predetermined maximum width and minimum widths at a second edge metric value indicative of an edge detected with highest confidence wherein the uniform width is between the minimum and maximum widths.

In furtherance of the third embodiments the edge detection module includes logic to compute a probability of an edge passing through the target input pixel and the edge detection module includes logic to compute increase the directionality directly with the probability.

In furtherance of the third embodiments the edge detection module includes logic determine a direction of a spatial gradient in the pixel values at the target pixel and the directional spatial filter module includes logic to orient the directional filter relative to the gradient direction and decay weights of pixels on the edge more slowly than those off the edge.

In furtherance of the third embodiments immediately above the directional spatial filter module includes logic to apply a rotation matrix to the target pixel coordinates.

In furtherance of the third embodiments the edge detection module includes logic to threshold a magnitude of a spatial gradient in the pixel values.

In furtherance of the third embodiments the non local means module includes logic to weight the input target pixel value with one or more pixel patch values weighted by both a similarity of one or more candidate patches to a target patch including the target pixel and by a location of one or more candidate patches relative to an edge quantified by the edge metric.

In one or more fourth embodiments a mobile computing platform comprises the image denoising apparatus of the third embodiments a camera hardware module CM coupled to the input to generate raw image data in an RGB space that includes the input pixel values and at least one of the electronic memory an encoder or display coupled to the output port the memory to store the filtered image pixel as a filtered representation of the image data the encoder to encode the filtered image pixel as a filtered representation of the image data and the display to present the filtered image pixel as a filtered representation of the image data.

In one or more fifth embodiments one or more computer readable storage media has instructions stored thereon which when executed by a processor cause the processor to perform any one of the first embodiments.

In one or more sixth embodiments one or more computer readable storage media includes instructions stored thereon which when executed by a processor cause the processor to perform a method comprising computing an edge metric associated with a target input pixel included in a set of input pixel values of an image frame computing one or more parameters based on the edge metric that specify directionality of a spatial filter function determining a filtered target pixel value by applying a similarity filter function and the spatial filter function having the specified directionality to the input pixel values and storing the filtered target pixel value to an electronic memory.

In furtherance of the sixth embodiments the media further includes instructions stored thereon which when executed by the processor cause the processor to perform a method further comprising determining a direction of a spatial gradient in the pixel values at the target pixel wherein computing an adaptive directional spatial filter function further comprises orienting the directional filter relative to the gradient direction to decay weights of pixels on the edge more slowly than those off the edge wherein the adaptive spatial filter function comprises a directional Gaussian filter function having first and second filter widths at least one of which is dependent upon the edge metric wherein the first and second filter width are to vary between a most uniform filter width for a first edge metric value indicative of a failure to detect an edge and predetermined maximum width and minimum widths at a second edge metric value indicative of an edge detected with highest confidence wherein the uniform width is between the minimum and maximum widths.

It will be recognized that the embodiments are not limited to the exemplary embodiments so described but can be practiced with modification and alteration without departing from the scope of the appended claims. For example the above embodiments may include specific combination of features. However the above embodiments are not limited in this regard and in embodiments the above embodiments may include undertaking only a subset of such features undertaking a different order of such features undertaking a different combination of such features and or undertaking additional features than those features explicitly listed. Scope should therefore be determined with reference to the appended claims along with the full scope of equivalents to which such claims are entitled.

