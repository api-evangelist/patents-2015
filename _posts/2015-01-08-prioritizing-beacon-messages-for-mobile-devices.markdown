---

title: Prioritizing beacon messages for mobile devices
abstract: Techniques and systems for prioritizing beacon messages are disclosed. Such a technique can include receiving, at a mobile device, beacon messages from multiple beacon devices over short-range communication links, the beacon devices being within a vicinity of an establishment, the beacon messages being configured to provide content associated with the establishment; determining, at the mobile device, priorities of the beacon messages based on one or more criteria; selecting, at the mobile device, a beacon message of the beacon messages based on the priorities to produce a selected beacon message; and presenting the selected beacon message through the mobile device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09426615&OS=09426615&RS=09426615
owner: Apple Inc.
number: 09426615
owner_city: Cupertino
owner_country: US
publication_date: 20150108
---
This patent document claims the benefit of the priority of U.S. Provisional Patent Application No. 62 057 589 filed on Sep. 30 2014. The above identified application is incorporated herein by reference in its entirety.

Many modern mobile devices e.g. a smart phone tablet computer wearable computer include one or more radio frequency receivers transmitters or transceivers that allow one way or two way communications with other devices. For example a mobile device can use a transceiver to communicate with a server on the Internet via a base station of a wireless network. In another example a mobile device can include a receiver to receive low powered RF signals from devices such as RF beacons.

Techniques and systems for prioritizing beacon messages for mobile devices are disclosed. An application running on a mobile device operating in a beacon equipped operating environment can be configured to receive beacon messages and intelligently prioritize a presentation of the received beacon messages through the mobile device. In some implementations beacon messages can be displayed by a user s mobile device based on one or more rule sets priority preferences priority configurations and contexts generally based on proximity of the mobile device to beacon devices user or environment context timing message frequency inter beacon border rules and the like. For example in a beacon equipped retail store an initial welcome to the store beacon message may be repeatedly received by a customer s mobile device from a beacon device near a store entrance but is desired by the store operator to be displayed on the mobile device only once in a given time period e.g. once per day so as not to annoy the customer with redundant displays of the same welcome message.

When the customer walks through a beacon equipped environment with their mobile device beacon messages broadcast from beacon devices throughout the environment can be received and prioritized by an application or operating system running on the user s mobile device and based on the prioritization are selectively presented e.g. displayed through the user s mobile device. Message priority can be determined based on one or more factors. In some implementations message priority can be based on proximity to a beacon device where messages broadcast from nearby beacon devices have a higher priority than messages broadcast from beacon devices farther away. In some implementations message priority can be determined based on context such as a user s reason for visiting the environment. In some implementations a message priority can be determined based on context and proximity. Context information can include a user s activities before arriving to the environment e.g. ordered a product to pick up scheduled an in store consultation scheduled a repair drop off pick up or what a user is doing while in the environment e.g. the type of mobile device being used the type of device the user is interacting with can be used to determine message priority.

In some implementations message priority can be based on inter beacon border rules. For example if a user s mobile device is receiving messages from more than one beacon device then inter beacon border rules can be used to determine which beacon message to present first. Some implementations can use priority stickiness to determine how to prioritize the presentation of competing beacon messages. For example if a user s mobile device is receiving a signal from a first beacon device and someone walks between the mobile device and the first beacon device the signal from that first beacon device may become weaker than a signal from a second beacon device. Instead of immediately switching to displaying beacon messages from the second beacon device an application or operating system running on the mobile device determines whether to present messages from the second beacon device rather than messages from the first beacon device. The decision can be based on length of time the signal strength dropped the magnitude of the change in signal strength and or other factors and contexts.

In some implementations message priority can be based on a history of previously presented messages including tracking a number of times a message has been presented to a mobile device user. For example if a beacon message has already been presented then the beacon message should not be presented again unless there is an overriding factor present e.g. new day phone reset retail store application restart etc. Beacon devices can continuously broadcast the same message throughout the day or can alternate among a group of messages. An application on a mobile device can filter the beacon messages and only present one or more pertinent messages which are based on the determined message priority. The application or operating system of the mobile device can dynamically update message priorities based on continuously changing information such as changes in a received signal strength indicator RSSI due to the user moving about in the store.

In some implementations an application or operating system can run a background process that monitors for beacon messages while the mobile device is in an idle state or while the screen of the mobile device is powered off. The application or operating system can determine whether to wake the mobile device and display a received beacon message. However if too many beacon messages are received by the mobile device and the mobile device is continually waking up to process the beacon messages significant drain on the mobile device battery may occur. For example if the mobile device user works in a mall the user may frequently pass by a beacon equipped store throughout the day and the user s mobile device may wake up each time the user passes the store due to proximity of the mobile device to a beacon device in the store. This and other scenarios can be mitigated by using a smart wake up process where the application or operating system of the mobile device can be configured to manage the frequency of wake ups by determining a priority value that accounts for wake up frequency and context. In some implementations the priority value is based on how many times the mobile device has awakened within a time period e.g. minute s hour s or day s .

A technique for prioritizing beacon messages for mobile devices can include receiving at a mobile device beacon messages from multiple beacon devices over short range communication links the beacon devices being within a vicinity of an establishment the beacon messages being configured to provide content associated with the establishment determining at the mobile device priorities of the beacon messages based on one or more criteria selecting at the mobile device a beacon message of the beacon messages based on the priorities to produce a selected beacon message and presenting the selected beacon message through the mobile device. Other implementations are directed to systems devices and computer readable storage mediums.

These and other implementations can include one or more of the following features. Implementations can include determining range estimations between the mobile device and the beacon devices based on received signal strength values corresponding respectively to the beacon messages. Determining the priorities can include using the range estimations such that a message from a beacon device that is closer to the mobile device has a higher priority than a message from a beacon device that is farther away from the mobile device. Receiving the beacon messages can include receiving first beacon messages from a first beacon device and receiving second beacon messages from a second beacon device. Determining priorities can include using hysteresis to prevent changes in the priorities that are due to transitory fluctuations in received signal strength values associated with the first beacon messages the second beacon messages or both. Determining the priorities can include determining a reason for a visit by a user of the mobile device to an environment including the beacon devices and applying a rule set that is based on the reason to determine the priorities. Determining the priorities can include determining whether a beacon message of the beacon messages is a duplicate of a previously received beacon message. Determining the priorities can include assigning a first priority to a first beacon message of the beacon messages based on the first beacon message being a duplicate of a previously received beacon message and assigning a second priority to a second beacon message of the beacon messages based on the second beacon message not being a duplicate of a previously received beacon message where the second priority is higher than the first priority. Implementations can include retrieving content corresponding to one or more values included in the selected beacon message. Presenting the selected beacon message can include displaying the retrieved content on a screen of the mobile device.

A system for providing beacon based applications can include a network interface configured to communicate with mobile devices and processor electronics configured to store applications including an application for download to the mobile devices via the network interface. The application can include instructions to cause a mobile device to perform operations. The operations can include receiving beacon messages from multiple beacon devices over short range communication links the beacon devices being within a vicinity of an establishment the beacon messages being configured to provide content associated with the establishment determining priorities of the beacon messages based on one or more criteria selecting a beacon message of the beacon messages based on the priorities to produce a selected beacon message and presenting the selected beacon message through the mobile device.

An apparatus such as a mobile device for prioritizing beacon messages can include circuitry configured to receive beacon messages from multiple beacon devices over short range communication links the beacon devices being within a vicinity of an establishment the beacon messages being configured to provide content associated with the establishment and a processor configured to perform operations. The operations can include determining priorities of the beacon messages based on one or more criteria selecting a beacon message of the beacon messages based on the priorities to produce a selected beacon message and presenting the selected beacon message through the apparatus. The apparatus can include a screen coupled with the processor. The operations can include retrieving content corresponding to one or more values included in the selected beacon message. Presenting the selected beacon message can include displaying the retrieved content on the screen.

Particular implementations disclosed herein provide one or more of the following advantages. Prioritizing a display of beacon messages can enhance a user s experience with an application that is configured to provide an interactive experience with a beacon equipped environment. Prioritizing a presentation of beacon messages can include filtering out low priority or irrelevant messages. Selectively waking a mobile device to present a beacon message can conserve power on the mobile device.

The details of the disclosed implementations are set forth in the accompanying drawings and the description below. Other features objects and advantages are apparent from the description drawings and claims.

The beacon devices can be configured locally or remotely over a network to transmit messages that provide information related to the retail store or events e.g. advertising campaigns occurring at the retail store . For example beacon device can transmit a store welcome message and beacon device can transmit a special offer message . In some implementations a beacon message includes a message number that the retail store application can map to content such as a text message for display on a screen of the mobile device . In some implementations the content e.g. a database table can be downloaded from a network based server computer to the mobile device when the user first enters the retail store .

In some implementations the retail store can include beacon equipped product demonstration tables . For example a table can include a product display area and product information placards having beacon devices configured to broadcast respective beacon messages corresponding to the respective products identified by the placards . In some implementations such beacon messages provide additional information about the respective products. In some implementations such beacon messages trigger a process for the user to order or customize the product using the retail store application. In some implementations the beacon devices can be fixed to or embedded inside of the information placards . If a user taps or swipes a mobile device on or near one of the beacon devices thereby selecting the product model associated with the corresponding placard the retail store application causes a display of a message associated with the user selected one of the placards i.e. beacon devices . The retail store can include additional tables each equipped with beacon devices that are configured to broadcast beacon messages associated with the respective products being displayed on the tables . Further the retail store can include a customer care center that is equipped with a beacon device that is configured to broadcast a beacon message associated with the center .

The beacon devices and the mobile devices can use a short range radio technology such as Bluetooth or a near field communication NFC technology for broadcasting and or receiving beacon messages. In some implementations the beacon devices can use a specific type of Bluetooth called Bluetooth low energy BLE . A wireless communication range of the beacon devices can be between 10 to 30 meters. Other ranges are possible. When a mobile device is within a wireless communication range of a beacon device it can receive a corresponding beacon message.

Various examples of mobile devices include smartphones tablet computers notebook computers or wearable computers. In some implementations the mobile devices can include a wireless receiver or transceiver that can scan the environment for beacon messages from other devices such as beacon devices in the environment . For example a mobile device can include a BLE receiver that scans for beacon messages. The mobile devices can communicate with servers using a base station of a wireless network such as one based on Long Term Evolution LTE or Code Division Multiple Access CDMA e.g. CDMA2000 and Wideband CDMA WCDMA . Other types of wireless networks are possible. In some implementations a mobile device can be configured to be a beacon device.

The process can estimate the range between the mobile device and each beacon device in communication with the mobile device based on received signal strength values corresponding respectively to the beacon messages . In some implementations process collects RF signal measurements associated with the beacon messages and computes RSSI values for each of the beacon messages. In some implementations an RSSI can be mathematically defined as being approximately a ratio of the power of a received signal and a reference received power e.g. 1 mW where the higher the RSSI number or less negative the stronger the signal. In some implementations a RSSI value can be expressed in dBm. Based on a predetermined transmission power for transmitting beacon messages range estimation can be computed based on the RSSI value. Determining range estimations can include using channel quality information such as a bit error rate BER or a packet error rate PER derived from a received beacon message.

The process can determine priorities of the beacon messages based on one or more criteria . Various examples of criteria include but are not limited to proximity based criteria context based criteria content based criteria and timing criteria. Other types of criteria are possible. In some implementations priorities can be stored as numerical values where higher values correspond to higher priorities. In some implementations determining priorities can include assigning beacon messages to priority classes such as high priority intermediate priority and low priority. More or fewer priority classes can be used as needed for an application. In some implementations a priority class can include two or more subclasses to provide additional priority granularity. In some implementations determining priorities of the beacon messages can include ordering beacon messages in a queue such that the highest priority message is at the top of the queue. In some implementations beacon messages that are determined to have a priority not exceeding a minimum priority threshold can be deleted.

In some implementations determining the priorities can include using the range estimations such that a message from a beacon device that is closer to the mobile device has a higher priority than a message from a beacon device that is farther away from the mobile device. In some implementations determining the priorities can include applying one or more rule sets to the beacon messages to compute priority values. In some implementations a rule set can be selected based on a reason for a visit to the retail store such as to pick up an earlier placed order or to have a consultation with a store employee.

The process can select a beacon message of the beacon messages based on the priorities to produce a selected beacon message . Selecting a beacon message can include determining the highest priority of the priorities and selecting a beacon message of the beacon messages that corresponds to the highest priority. In some implementations selecting a beacon message can include selecting a message at the top of a message queue that is organized by message priority. In some implementations the process can select multiple beacon messages for display and place them in order of priority in a display stack data structure where the top of the display stack is the highest priority message and is displayed first.

The process can present the selected beacon message through the mobile device . Presenting the selected beacon message can include displaying information corresponding to the selected beacon message on a screen of the mobile device. In some implementations the process can select multiple beacon messages for display and create a prioritized display order. In some implementations displaying information can include displaying a first one of multiple beacon messages based on the prioritized display order and later displaying a second one of multiple beacon messages that has a lower priority than the previously displayed message. In some implementations the second one is displayed after the first one has been dismissed or acknowledged. In some implementations the process can provide one or more notifications associated with the selected beacon message. An indication can include a force feedback e.g. vibration indication audio indication e.g. beep music etc. visual indication e.g. flashing light or a combination thereof. In some implementations beacon messages can include any content including but not limited to text graphics digital images audio video and animation. Beacon messages can be presented on the mobile device in the form of audio output to work with mobile devices without display capability or to assist visually impaired users. In some implementations presenting the selected beacon message can include retrieving content corresponding to one or more values included in the selected beacon message and displaying the content on the screen.

In some implementations the mobile device can be configured to provide a range class for a received beacon message that can be used by an application that needs to know at least an approximate distance between a mobile device and an RF signal source such as a beacon device. Determining range estimations can include assigning range classes to received beacon messages. For example RSSI values associated with received beacon messages can be assigned to range classes based on RSSI thresholds without converting the RSSI values to distances. In some implementations range classes include Immediate Near Far and Unknown. More or fewer range classes can be used as needed for an application. For example the Immediate range class can be defined as a range between a mobile device and a RF signal source that is e.g. 0 to 30 centimeters. The Near range class can be defined as a range between a mobile device and a RF signal source that is e.g. 30 centimeters to 4 meters. The Far range class can be defined as a range between a mobile device and a RF signal source that is e.g. 4 to 30 meters. The Unknown range class can be defined as the range between a mobile device and a signal source e.g. greater than 30 meters . Distance thresholds can separate the range classes. The distance thresholds e.g. in meters can be converted to RSSI thresholds in dBm to enable classification of RSSI values where the range classes are separated by RSSI thresholds. In some implementations the mobile device can be configured to assign priority classes to the beacon messages based on their correspondingly assigned range classes. For example a high priority class can be assigned to a message in an Immediate range class whereas a low priority class can be assigned to a message in a Far range class.

In some implementations assuming that the received signal strength values of both messages are above a minimum threshold the mobile device can use beacon message content e.g. a message type to override an initial determination of message priority that is based strictly on proximity. For example if special offer messages have a higher priority than product information messages then the special offer message can be selected for display over the product information message even though the product information message is coming from a beacon device that is closer to the mobile device .

In some implementations the mobile device can run a retail store application that uses one or more content based rule sets one or more user configurable content based priority settings or a combination thereof. For example a user configurable content based priority setting can set a special offer message type to have a higher priority than other message types such as a product information message type. In some implementations if a tie occurs in proximity based message priority determination e.g. two or more beacon messages are assigned to the same range class then a content based message priority determination can be performed to break the tie.

In the format includes a beacon identifier activity parameter application identifier and a user message . The application identifier can identify an application running on the mobile device for handling the beacon message upon reception at a mobile device. For example an operating system running on the mobile device can use the application identifier to forward the beacon message to an application corresponding to the application identifier . In some implementations if the application is not already installed on the mobile device a browser can be launched on the mobile device and direct the user e.g. using a URL to a website where the user can download and install the application corresponding to the application identifier . In some implementations the application can be downloaded automatically without user intervention in a manner that is transparent to the user e.g. as a background process . In some implementations if the application is installed but not running on the mobile device the application can be launched automatically by the operating system running on the mobile device to receive the beacon message.

In the format includes a beacon universally unique identifier UUID beacon identifier activity parameter major value and activity parameter minor value . A venue can include multiple beacon devices having the same beacon identifier . However such beacons can have different values for the beacon UUID . Thus the beacon UUID can serve to differentiate among beacon devices sharing the same beacon identifier . In some implementations the beacon identifier includes the beacon UUID . In some implementations the UUID is a 128 bit value.

An activity parameter can be split between a major value and a minor value . In some implementations the major value and a minor value are different 16 bit portions of a 32 bit value. In some implementations the minor value specifies a subtype from a group associated with the major value . For example the major value can specify a value associated with displaying user messages and the minor value can specify which user message to display.

In some implementations an application running on a mobile device can process the major value and the minor value based on an internal database that associates major and minor values with specific actions. In some implementations the internal database includes information from a JavaScript Object Notation JSON based file or data stream containing attribute value pairs e.g. one or more records containing a beacon identifier major value minor value and an action response such as a text string for displaying to a user. For example a JSON based file can include the following text 

Sensors devices and subsystems may be coupled to peripherals interface to facilitate multiple functionalities. For example motion sensor light sensor and proximity sensor may be coupled to peripherals interface to facilitate orientation lighting and proximity functions of the device. For example in some implementations light sensor may be utilized to facilitate adjusting the brightness of touch surface . In some implementations motion sensor e.g. an accelerometer gyros may be utilized to detect movement and orientation of the device. Accordingly display objects or media may be presented according to a detected orientation e.g. portrait or landscape . Other sensors may also be connected to peripherals interface such as a temperature sensor a biometric sensor or other sensing device to facilitate related functionalities. Location processor e.g. GPS receiver chip may be connected to peripherals interface to provide geo positioning. Electronic magnetometer e.g. an integrated circuit chip may also be connected to peripherals interface to provide data that may be used to determine the direction of magnetic North. Thus electronic magnetometer may be used as an electronic compass. Camera subsystem and an optical sensor e.g. a charged coupled device CCD or a complementary metal oxide semiconductor CMOS optical sensor may be utilized to facilitate camera functions such as recording photographs and video clips. Audio subsystem may be coupled to a speaker and one or more microphones to facilitate voice enabled functions such as voice recognition voice replication digital recording and telephony functions.

Communication functions may be facilitated through one or more communication subsystems . Communication subsystems may include one or more wireless communication subsystems. Wireless communication subsystems may include radio frequency receivers and transmitters and or optical e.g. infrared receivers and transmitters. Wired communication system may include a port device e.g. a Universal Serial Bus USB port or some other wired port connection that may be used to establish a wired connection to other computing devices such as other communication devices network access devices a personal computer a printer a display screen or other processing devices capable of receiving or transmitting data.

The specific design and implementation of the communication subsystems may depend on the communication network s or medium s over which the device is intended to operate. For example a device may include wireless communication subsystems designed to operate over LTE GSM a GPRS network an enhanced data GSM environment EDGE network 802.x communication networks e.g. Wi Fi Wi Max CDMA networks NFC and a Bluetooth network. Communication subsystems may include hosting protocols such that the device may be configured as a base station for other wireless devices. As another example the communication subsystems may allow the device to synchronize with a host device using one or more protocols such as for example the TCP IP protocol HTTP protocol UDP protocol and any other known protocol.

I O subsystem may include touch controller and or other input controller s . Touch controller may be coupled to a touch surface . Touch surface and touch controller may for example detect contact and movement or break thereof using any of a number of touch sensitivity technologies including but not limited to capacitive resistive infrared and surface acoustic wave technologies as well as other proximity sensor arrays or other elements for determining one or more points of contact with touch surface . In one implementation touch surface may display virtual or soft buttons and a virtual keyboard which may be used as an input output device by the user.

Other input controller s may be coupled to other input control devices such as one or more buttons rocker switches thumb wheel infrared port USB port and or a pointer device such as a stylus. The one or more buttons not shown may include an up down button for volume control of speaker and or microphone .

In some implementations device may present recorded audio and or video files such as MP3 AAC and MPEG video files. In some implementations device may include the functionality of an MP3 player and may include a pin connector for tethering to other devices. Other input output and control devices may be used.

Memory interface may be coupled to memory . Memory may include high speed random access memory or non volatile memory such as one or more magnetic disk storage devices one or more optical storage devices or flash memory e.g. NAND NOR . Memory may store operating system such as Darwin RTXC LINUX UNIX OS X WINDOWS or an embedded operating system such as VxWorks. Operating system may include instructions for handling basic system services and for performing hardware dependent tasks. In some implementations operating system may include a kernel e.g. UNIX kernel .

Memory may also store communication instructions to facilitate communicating with one or more additional devices. Communication instructions may also be used to select an operational mode or communication medium for use by the device based on a geographic location obtained by the GPS Navigation instructions of the device. Memory may include graphical user interface instructions to facilitate graphic user interface processing including a touch model for interpreting touch inputs and gestures sensor processing instructions to facilitate sensor related processing and functions phone instructions to facilitate phone related processes and functions electronic messaging instructions to facilitate electronic messaging related processes and functions web browsing instructions to facilitate web browsing related processes and functions media processing instructions to facilitate media processing related processes and functions GPS Navigation instructions to facilitate GPS and navigation related processes camera instructions to facilitate camera related processes and functions and application storage for storing applications such as a retail store application that is configured to receive and prioritize beacon messages. In some implementations such applications can be pre installed on the device downloaded from an application store server or a combination thereof. The retail store application can include a rules based engine that processes beacon messages according to rule sets as described in reference to .

Each of the above identified instructions and applications may correspond to a set of instructions for performing one or more functions described above. These instructions need not be implemented as separate software programs procedures or modules. Memory may include additional instructions or fewer instructions. Furthermore various functions of the device may be implemented in hardware and or in software including in one or more signal processing and or application specific integrated circuits ASICs .

Mobile devices can also receive beacon messages over a short range communication link from a beacon device . In some implementations the short range communication link can be based on Bluetooth radio technology. In some implementations the short range communication link can be based on NFC radio technology. In some implementations the mobile devices can be configured to continuously scan for beacon messages. In some implementations the mobile devices can be configured to scan for beacon messages for a predetermined time period based on an application invoking a beacon scan API. Based on receiving one or more beacon messages over short range communication links from one or more beacon devices the mobile devices can determine beacon message priorities.

In some implementations based on receiving a beacon message over a short range communication link from a beacon device the mobile devices can establish communications with one or more servers via a long range communication link associated with a base station that provides cellular data services. For example a beacon message from a beacon device can cause the mobile devices to retrieve a retail store application from a first server . In some implementations the mobile devices have already retrieved and are running the retail store application before receiving the beacon message from the beacon device . The retail store application can be configured to download beacon message content from a second server . In some implementations the retail store application can download beacon message content from the second server in response to an initial reception of a beacon message such as a welcome message. Further the retail store application can be configured to download one or more priority rule sets from the second server . The priority rule sets can be used to determine beacon message priorities.

In some implementations the second server can store data such as beacon message content and priority rule sets in a database . In some implementations the beacon message content includes mappings between beacon message values e.g. identifier major and or minor values and corresponding message data e.g. text picture video and or audio . After downloading the beacon message content from the second server the mobile devices can use the mappings and message texts to translate a received beacon message into a format that is suitable for display to users of the mobile devices . In some implementations beacon message content can be stored as a document within the database such as an Extensible Markup Language XML document or a JSON document. Other document types are possible. In some implementations the second server provides the entire beacon message content document to the mobile devices . In some implementations priority rule sets can be stored as a document within the database such as an XML document or a JSON document. Other document types are possible. In some implementations the second server includes processor electronics configured to store applications including a retail store application for download to the mobile devices 

Beacon devices can include circuitry such as a processor memory transmitter for broadcasting beacon messages and an interface for programming the beacon devices which can be a USB interface or a two way wireless interface such as an LTE or IEEE 802.11 based network interface. In some implementations the beacon devices can be programmed to periodically update data within the beacon messages. The beacon device can transmit different action codes e.g. different message values at different times during the day. Such codes for example can include a first message value for announcing an in store event that starts in 15 minutes and for after the event a second message value for retrieving product information for a product featured during the in store event.

The process receives beacon messages from beacon devices during a detection window . In some implementations a duration of the detection window is based on a predetermined value such as 10 milliseconds 50 milliseconds etc. In this example multiple different types of beacon messages are being received from the beacon devices. In more detail receiving beacon messages can include receiving multiple first beacon messages all having the same first information content that is represented by a first message value from a first beacon device and receiving multiple second beacon messages from a second beacon device the second beacon messages all having the same second information content that is represented by a second message value.

The process determines range estimations based on signal strength values corresponding respectively to the beacon messages . In some implementations the process can include averaging two or more received signal strength values corresponding to at least a portion of the first beacon messages from the first beacon device that have been received in the detection window and averaging two or more received signal strength values corresponding to at least a portion of the second beacon messages from the second beacon device that have been received in the detection window. Determining the range estimations can include using averaged received signal strength values.

The process determines priorities of the beacon messages based on the range estimations . Determining the priorities can include assigning priorities based on the range estimations such that a message from a beacon device that is determined to be closer to the mobile device has a higher priority than a message from a beacon device that is determined to be farther away from the mobile device. The process displays information corresponding to a first one of the beacon messages the first one being selected based on the priorities .

The process detects in subsequently received versions of the beacon messages one or more changes to the range estimations that cause a change in the priorities . Note that the subsequently received versions can be received during a subsequent detection window. The process determines whether the one or more changes exceed a threshold . If the one or more changes do not exceed the threshold the same information is continued to be displayed . If the one or more changes do exceed the threshold the process determines revised priorities based on the one or more changes . The process displays information corresponding to a different second one of the beacon messages the second one being selected based on the revised priorities .

Within the process running the retail store application the process tracks the beacon messages . Tracking the beacon messages can include storing the beacon messages in a data structure such as a table an array queue or linked list. The process determines whether the user of the mobile device is about to visit the retail store . For example the process can compare received signal strength values associated with at least a portion of the beacon messages to determine whether the received signal strength values are increasing with time which may indicate that the user is walking towards an entrance of the retail store the entrance being equipped with a beacon device.

If the user of the mobile device is not about to visit the process continues to track the beacon messages . If the user of the mobile device is about to visit the process determines a reason code for the visit to the retail store based on one or more of the beacon messages . In some implementations the process can access a database such as a user s calendar database or the retail store s appointment log to determine whether the user has an appointment at the retail store. Various examples of reason codes include codes for package pick up service consultation targeted browsing general browsing or non specified. Other types of codes are possible. In some implementations a general browsing code is used as a default code.

The process selects a rule set based on the reason code . Various examples of rule sets include a package pick up rule set service consultation rule set general browsing rule set or a non specified visit rule set. The process applies the rule set to determine priorities of the beacon messages . In some implementations a rule set includes a list of message types and corresponding priority values. A package pick up rule set for example can cause beacon messages associated with general solicitations such as specials of the day to have lower priority than beacon messages associated with a package pick up such as messages that provide instructions for the pick up. In contrast a general browsing rule set can assign beacon messages associated with general solicitations to have higher priority than beacon messages associated with a beacon device at a package pick up kiosk that is providing instructions about pick up. In another example a targeted browsing rule set if applied may cause a beacon message associated with a product that is on the user s wish list to have a higher priority than a beacon message associated with a product that is not on the user s wish list. In some implementations a user s wish list is stored within a data structure managed by the retail store application.

The process determines a message context associated with the beacon message . Determining a message context can include determining a reason code. In some implementations determining a message context can include accessing a calendar stored on the mobile device. In some implementations determining a message context can include determining whether an application such as a retail store application has been launched.

The process determines a priority value based on the message frequency and the message context . In some implementations a priority value can be computed based on a summation of multiple weighted components such as a context component and a frequency component. In some implementations message context such as a reason code priority value can be a component of the priority value. For example if a reason code indicates that the mobile device user is likely to benefit from a display of the message e.g. the mobile device user has a scheduled appointment at the store then assign a high context component value otherwise if a reason code indicates an unknown reason then assign a low or zero context component value. In some implementations message frequency information including previous device wake up information can be another component of the priority value. For example if the mobile device has already been woken to display a previously received version of the beacon message a frequency component of the priority value can take on a low or zero value if the mobile device has not previously received the beacon message then the frequency component can take on a high value.

The process determines whether the priority value exceeds a threshold value . In some implementations the threshold value is determined based on a user configurable parameter. If not exceeded the process continues to monitor for and receive beacon messages . If exceeded the process places the beacon message and its priority value in a queue for batch processing . In some implementations the process periodically evaluates messages in the queue and selects the message having the highest priority value for presentation through the mobile device. In some implementations messages with lower priority values can be presented after the message with the highest priority value has been presented. In some implementations messages can be deleted from the queue after the process evaluates the messages in the queue.

The features described may be implemented in digital electronic circuitry or in computer hardware firmware software or in combinations of them. The features may be implemented in a computer program product tangibly embodied in an information carrier e.g. in a machine readable storage device for execution by a programmable processor and method steps may be performed by a programmable processor executing a program of instructions to perform functions of the described implementations by operating on input data and generating output.

The described features may be implemented advantageously in one or more computer programs that are executable on a programmable system including at least one programmable processor coupled to receive data and instructions from and to transmit data and instructions to a data storage system at least one input device and at least one output device. A computer program is a set of instructions that may be used directly or indirectly in a computer to perform a certain activity or bring about a certain result. A computer program may be written in any form of programming language e.g. C C Objective C Java including compiled or interpreted languages and it may be deployed in any form including as a stand alone program or as a module component subroutine or other unit suitable for use in a computing environment.

Suitable processors for the execution of a program of instructions include by way of example both general and special purpose microprocessors and the sole processor or one of multiple processors or cores of any kind of computer. Generally a processor will receive instructions and data from a read only memory or a random access memory or both. The essential elements of a computer are a processor for executing instructions and one or more memories for storing instructions and data. Generally a computer may communicate with mass storage devices for storing data files. These mass storage devices may include magnetic disks such as internal hard disks and removable disks magneto optical disks and optical disks. Storage devices suitable for tangibly embodying computer program instructions and data include all forms of non volatile memory including by way of example semiconductor memory devices such as EPROM EEPROM and flash memory devices magnetic disks such as internal hard disks and removable disks magneto optical disks and CD ROM and DVD ROM disks. The processor and the memory may be supplemented by or incorporated in ASICs application specific integrated circuits .

To provide for interaction with an author the features may be implemented on a computer having a display device such as a CRT cathode ray tube or LCD liquid crystal display monitor for displaying information to the author and a keyboard and a pointing device such as a mouse or a trackball by which the author may provide input to the computer.

The features may be implemented in a computer system that includes a back end component such as a data server or that includes a middleware component such as an application server or an Internet server or that includes a front end component such as a client computer having a graphical user interface or an Internet browser or any combination of them. The components of the system may be connected by any form or medium of digital data communication such as a communication network. Examples of communication networks include a LAN a WAN and the computers and networks forming the Internet.

The computer system may include clients and servers. A client and server are generally remote from each other and typically interact through a network. The relationship of client and server arises by virtue of computer programs running on the respective computers and having a client server relationship to each other.

One or more features or steps of the disclosed embodiments may be implemented using an Application Programming Interface API . An API may define on or more parameters that are passed between a calling application and other software code e.g. an operating system library routine function that provides a service that provides data or that performs an operation or a computation.

The API may be implemented as one or more calls in program code that send or receive one or more parameters through a parameter list or other structure based on a call convention defined in an API specification document. A parameter may be a constant a key a data structure an object an object class a variable a data type a pointer an array a list or another call. API calls and parameters may be implemented in any programming language. The programming language may define the vocabulary and calling convention that a programmer will employ to access functions supporting the API. In some implementations an API call may report to an application the capabilities of a device running the application such as input capability output capability processing capability power capability communications capability etc.

As described above some aspects of the subject matter of this specification include gathering and use of data available from various sources to improve services a mobile device can provide to a user. The present disclosure contemplates that in some instances this gathered data may identify a particular location or an address based on device usage. Such personal information data can include location based data addresses subscriber account identifiers or other identifying information.

The present disclosure further contemplates that the entities responsible for the collection analysis disclosure transfer storage or other use of such personal information data will comply with well established privacy policies and or privacy practices. In particular such entities should implement and consistently use privacy policies and practices that are generally recognized as meeting or exceeding industry or governmental requirements for maintaining personal information data private and secure. For example personal information from users should be collected for legitimate and reasonable uses of the entity and not shared or sold outside of those legitimate uses. Further such collection should occur only after receiving the informed consent of the users. Additionally such entities would take any needed steps for safeguarding and securing access to such personal information data and ensuring that others with access to the personal information data adhere to their privacy policies and procedures. Further such entities can subject themselves to evaluation by third parties to certify their adherence to widely accepted privacy policies and practices.

In the case of advertisement delivery services the present disclosure also contemplates embodiments in which users selectively block the use of or access to personal information data. That is the present disclosure contemplates that hardware and or software elements can be provided to prevent or block access to such personal information data. For example in the case of advertisement delivery services the present technology can be configured to allow users to select to opt in or opt out of participation in the collection of personal information data during registration for services.

Therefore although the present disclosure broadly covers use of personal information data to implement one or more various disclosed embodiments the present disclosure also contemplates that the various embodiments can also be implemented without the need for accessing such personal information data. That is the various embodiments of the present technology are not rendered inoperable due to the lack of all or a portion of such personal information data. For example content can be selected and delivered to users by inferring preferences based on non personal information data or a bare minimum amount of personal information such as the content being requested by the device associated with a user other non personal information available to the content delivery services or publically available information.

A number of implementations have been described. Nevertheless it will be understood that various modifications may be made. Elements of one or more implementations may be combined deleted modified or supplemented to form further implementations. As yet another example the logic flows depicted in the figures do not require the particular order shown or sequential order to achieve desirable results. In addition other steps may be provided or steps may be eliminated from the described flows and other components may be added to or removed from the described systems. Accordingly other implementations are within the scope of the following claims.

