---

title: System, method, and apparatus for improving the utility of storage media
abstract: One method for improving the utility of solid-state storage media within a solid state storage device includes referencing one or more storage media characteristics for a set of storage cells of the solid-state storage media. The method also includes determining a configuration parameter for the set of storage cells based on the one or more storage media characteristics. The method includes configuring the set of storage cells to use the determined configuration parameter. The configuration parameter includes a parameter of the set of storage cells modifiable by a module external to the solid-state storage device by way of an interface. The module external to the solid-state storage device includes a device driver executing on a host device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09361029&OS=09361029&RS=09361029
owner: SANDISK TECHNOLOGIES, INC.
number: 09361029
owner_city: Plano
owner_country: US
publication_date: 20150130
---
This application is a continuation of and claims priority to U.S. patent application Ser. No. 14 486 974 entitled MANAGING NON VOLATILE MEDIA and filed on Sep. 15 2014 for John Strasser et al. which issued as U.S. Pat. No. 8 982 619 which is a continuation of and claims priority to U.S. patent application Ser. No. 14 106 566 entitled MANAGING NON VOLATILE and filed on Dec. 13 2013 for John Strasser et al. which issued as U.S. Pat. No. 8 873 286 which is a continuation of and claims priority to U.S. application Ser. No. 13 719 045 entitled MANAGING NON VOLATILE MEDIA and filed on Dec. 18 2012 for Robert Wood et al. which issued as U.S. Pat. No. 8 661 184 which is a continuation in part of and claims priority to U.S. patent application Ser. No. 13 189 402 entitled APPARATUS SYSTEM AND METHOD FOR DETERMINING A CONFIGURATION PARAMETER FOR SOLID STATE STORAGE MEDIA and filed on Jul. 22 2011 for Robert Wood et al. which issued as U.S. Pat. No. 8 380 915 which claims priority to U.S. patent application Ser. No. 13 015 458 entitled APPARATUS SYSTEM AND METHOD FOR DETERMINING A READ VOLTAGE THRESHOLD and filed on Jan. 27 2011 for John Strasser et al. which issued as U.S. Pat. No. 8 315 092 and U.S. patent application Ser. No. 13 175 637 entitled APPARATUS SYSTEM AND METHOD FOR USING MULTI LEVEL CELL STORAGE IN A SINGLE LEVEL CELL MODE and filed on Jul. 1 2011 for Robert Wood et al. which issued as U.S. Pat. No. 8 266 503 each of which are incorporated herein by reference U.S. patent application Ser. No. 13 015 458 claims priority to U.S. Provisional Patent Application No. 61 298 861 entitled APPARATUS SYSTEM AND METHOD FOR DETERMINING A READ VOLTAGE THRESHOLD FOR SOLID STATE STORAGE MEDIA and filed on Jan. 27 2010 for John Strasser et al. and to U.S. Provisional Patent Application No. 61 305 205 entitled APPARATUS SYSTEM AND METHOD FOR DETERMINING A READ VOLTAGE THRESHOLD FOR SOLID STATE STORAGE MEDIA and filed on Feb. 17 2010 for John Strasser et al. each of which are incorporated herein by reference.

The subject matter disclosed herein relates to non volatile media and more particularly relates to configuration parameters for non volatile media.

Many non volatile storage devices distinguish between different binary values that a storage cell may store based on a read voltage level of the storage cell based on a resistivity of the storage cell or based on another configuration parameter of the storage cell. Non volatile storage devices may use one or more read voltage thresholds resistivity thresholds or the like to separate discrete values that may be stored in a storage cell.

Stored values read voltage levels resistivity or the like however can shift over time. For example storage cell damage storage cell leakage temperature and other disturbances to storage cells can alter for the state of storage cells making different configuration parameters more optimal for the storage cells. The rate of leakage and other disturbances can also increase with age as storage cells are used over time. If the read voltage level or other configuration parameter of a storage cell shifts past a threshold for the storage cell a data error occurs as the value of the data read from the storage cell is different than the value of the data written to the storage cell.

A method is presented to manage non volatile media. In one embodiment a method includes determining a configuration parameter for a set of storage cells of a solid state recording medium. A method in a further embodiment includes reading data from a set of storage cells using a determined configuration parameter. In certain embodiments a method includes adjusting a configuration parameter based on read data.

An apparatus is presented to manage non volatile media. In one embodiment a configuration parameter module is configured to determine a read voltage threshold for one or more NAND flash storage cells. A storage cell configuration module in certain embodiments is configured to configure one or more storage cells to use a determined read voltage threshold. In a further embodiment an adjustment module is configured to adjust a read voltage threshold based on closed loop feedback from one or more NAND flash storage cells.

Another apparatus is presented to manage non volatile media. In one embodiment an apparatus includes means for detecting an uncorrectable error in data read from a set of non volatile memory cells. An apparatus in a further embodiment includes means for iteratively adjusting one or more read voltage thresholds for a set of memory cells and re reading data from the set of memory cells until an uncorrectable error in the data is correctable.

References throughout this specification to features advantages or similar language do not imply that all of the features and advantages may be realized in any single embodiment but are to be understood to mean that a specific feature advantage or characteristic is included in at least one embodiment. The described features advantages and characteristics of the embodiments may be combined in any suitable manner and may be practiced without one or more of the specific features or advantages of a particular embodiment. In other instances additional features and advantages may be recognized in certain embodiments that may not be present in all embodiments.

Many of the functional units described in this specification have been labeled as modules in order to more particularly emphasize their implementation independence. For example a module may be implemented as a hardware circuit comprising custom VLSI circuits or gate arrays off the shelf semiconductors such as logic chips transistors or other discrete components. A module may also be implemented in programmable hardware devices such as field programmable gate arrays programmable array logic programmable logic devices or the like.

Modules may also be implemented in software for execution by various types of processors. An identified module of executable code may for instance comprise one or more physical or logical blocks of computer instructions which may for instance be organized as an object procedure or function. Nevertheless the executables of an identified module need not be physically located together but may comprise disparate instructions stored in different locations which when joined logically together comprise the module and achieve the stated purpose for the module.

Indeed a module of executable code may be a single instruction or many instructions and may even be distributed over several different code segments among different programs and across several memory devices. Similarly operational data may be identified and illustrated herein within modules and may be embodied in any suitable form and organized within any suitable type of data structure. The operational data may be collected as a single data set or may be distributed over different locations including over different storage devices and may exist at least partially merely as electronic signals on a system or network. Where a module or portions of a module are implemented in software the software portions are stored on one or more computer readable media.

Reference throughout this specification to one embodiment an embodiment or similar language means that a particular feature structure or characteristic described in connection with the embodiment is included in at least one embodiment of the present disclosure. Thus appearances of the phrases in one embodiment in an embodiment and similar language throughout this specification may but do not necessarily all refer to the same embodiment.

Reference to a computer readable medium may take any form capable of storing machine readable instructions on a digital processing apparatus memory device. A computer readable medium may be embodied by a compact disk digital video disk a magnetic tape a Bernoulli drive a magnetic disk a punch card flash memory integrated circuits or other digital processing apparatus memory device.

Furthermore the described features structures or characteristics of the disclosure may be combined in any suitable manner in one or more embodiments. In the following description numerous specific details are provided such as examples of programming software modules user selections network transactions database queries database structures hardware modules hardware circuits hardware chips etc. to provide a thorough understanding of embodiments of the disclosure. One skilled in the relevant art will recognize however that the disclosure may be practiced without one or more of the specific details or with other methods components materials and so forth. In other instances well known structures materials or operations are not shown or described in detail to avoid obscuring aspects of the disclosure.

The schematic flow chart diagrams included herein are generally set forth as logical flow chart diagrams. As such the depicted order and labeled steps are indicative of one embodiment of the presented method. Other steps and methods may be conceived that are equivalent in function logic or effect to one or more steps or portions thereof of the illustrated method. Additionally the format and symbols employed are provided to explain the logical steps of the method and are understood not to limit the scope of the method. Although various arrow types and line types may be employed in the flow chart diagrams they are understood not to limit the scope of the corresponding method. Indeed some arrows or other connectors may be used to indicate only the logical flow of the method. For instance an arrow may indicate a waiting or monitoring period of unspecified duration between enumerated steps of the depicted method. Additionally the order in which a particular method occurs may or may not strictly adhere to the order of the corresponding steps shown.

The system includes at least one non volatile memory device . In other embodiments the system includes two or more non volatile memory devices . Each non volatile memory device may include non volatile memory media . The non volatile memory media may include solid state storage media such as NAND flash memory NOR flash memory nano random access memory nano RAM or NRAM magneto resistive RAM MRAM dynamic RAM DRAM phase change RAM PRAM racetrack memory memristor memory nanocrystal wire based memory silicon oxide based sub 10 nanometer process memory graphene memory silicon oxide nitride oxide silicon SONOS memory resistive random access memory RRAM programmable metallization cell PMC conductive bridging RAM CBRAM or the like. In other embodiments the non volatile memory media may comprise magnetic media optical media or another type of non volatile media.

While the non volatile memory media is referred to herein as memory media in various embodiments the non volatile memory media may more generally comprise a non volatile recording media capable of recording data which may be referred to as a non volatile memory media a non volatile storage media or the like. Further the non volatile memory device in various embodiments may comprise or be referred to as a non volatile recording device a non volatile memory device a non volatile storage device or the like. The non volatile memory device is described in more detail with respect to .

The non volatile memory device is depicted in a computer connected to one or more clients through a computer network . In one embodiment the non volatile memory device is internal to the computer and is connected using a system communications bus such as a peripheral component interconnect express PCI e bus a Serial Advanced Technology Attachment serial ATA bus or the like. In another embodiment the non volatile memory device is external to the computer and is connected using an external communications bus such as a universal serial bus USB connection an Institute of Electrical and Electronics Engineers IEEE 1394 bus FireWire or the like. In other embodiments the non volatile memory device is connected to the computer using a communications bus such as a peripheral component interconnect PCI express bus using external electrical or optical bus extension or bus networking solution such as Infiniband or PCI Express Advanced Switching PCIe AS or the like.

In various embodiments the non volatile memory device may be in the form of a dual inline memory module DIMM a daughter card or a micro module. In another embodiment the non volatile memory device is an element within a rack mounted blade. In another embodiment the non volatile memory device is contained within a package that is integrated directly onto a higher level assembly e.g. mother board lap top graphics processor . In another embodiment individual components comprising the non volatile memory device are integrated directly onto a higher level assembly without intermediate packaging.

The non volatile memory device includes one or more non volatile memory controllers each may include a write data pipeline and a read data pipeline and each includes non volatile memory media which are described in more detail below with respect to . In general the one or more non volatile memory controllers manage the non volatile memory media including determining configuration parameters for storage cells of the non volatile memory media and configuring the storage cells according to the configuration parameters.

As used herein a configuration parameter for a set of storage cells or other non volatile memory media is a parameter that is modifiable by way of an interface. The interface may comprise a publicly known interface or a proprietary interface and may include use of particular command instructions and or use of particular parameters register settings driver settings controller settings a particular set of command instruction sequences or other differences from regular commands general purpose commands or settings used to interface with or manage the set of storage cells. Configuration parameters may relate to writing to or programming storage cells reading from storage cells erasing storage cells managing storage cells device driver or storage controller settings for storage cells or the like. A configuration parameter for a set of storage cells may be associated with a device driver for the non volatile memory device with a non volatile memory controller or the like and may relate to how the device driver and or non volatile memory controller use manage and interact with the set of storage cells and or the non volatile memory media .

A configuration parameter in certain embodiments may include one or more storage thresholds such as a read voltage threshold a resistivity threshold a programming threshold an erase threshold a hardware driver level threshold a storage controller level threshold or the like. The configuration parameter may be set once during initialization of the non volatile memory media dynamically with each command issued to the non volatile memory media or during operation of the non volatile memory media in response to triggers such as events or time intervals. The non volatile memory controller in one embodiment proactively sets one or more configuration parameters for storage cells of the non volatile memory media to improve the utility of the non volatile memory media to reduce errors and the like.

The system includes one or more computers connected to the non volatile memory device . A computer may be a host a server a storage controller of a storage area network SAN a workstation a personal computer a laptop computer a handheld computer a supercomputer a computer cluster a network switch a router or appliance a database or storage appliance a data acquisition or data capture system a diagnostic system a test system a robot a portable electronic device a wireless device or the like. In another embodiment a computer may be a client and the non volatile memory device operates autonomously to service data requests sent from the computer . In this embodiment the computer and non volatile memory device may be connected using a computer network system bus or other communication means suitable for connection between a computer and an autonomous non volatile memory device .

In one embodiment the system includes one or more clients connected to one or more computers through one or more computer networks . A client may be a host a server a storage controller of a SAN a workstation a personal computer a laptop computer a handheld computer a supercomputer a computer cluster a network switch a router or appliance a database or storage appliance a data acquisition or data capture system a diagnostic system a test system a robot a portable electronic device a wireless device or the like. The computer network may include the Internet a wide area network WAN a metropolitan area network MAN a local area network LAN a token ring a wireless network a fiber channel network a SAN network attached storage NAS ESCON or the like or any combination of networks. The computer network may also include a network from the IEEE 802 family of network technologies such as Ethernet token ring WiFi WiMax and the like.

The computer network may include servers switches routers cabling radios and other equipment used to facilitate networking computers and clients . In one embodiment the system includes multiple computers that communicate as peers over a computer network . In another embodiment the system includes multiple non volatile memory devices that communicate as peers over a computer network . One of skill in the art will recognize other computer networks comprising one or more computer networks and related equipment with single or redundant connection between one or more clients or other computer with one or more non volatile memory devices or one or more non volatile memory devices connected to one or more computers . In one embodiment the system includes two or more non volatile memory devices connected through the computer network to a client without a computer . The non volatile memory controller in certain embodiments receives source data for storage in the non volatile memory media from a processor of the computer and or from a client over one or more communications buses as described above.

In an alternate embodiment the non volatile memory device controller includes a single non volatile memory controller with a single non volatile memory media . In another embodiment there are a plurality of non volatile memory controllers and associated non volatile memory media . In one embodiment one or more non volatile memory controllers coupled to their associated non volatile memory media control data while at least one non volatile memory controller coupled to its associated non volatile memory media controls index metadata.

In one embodiment at least one non volatile memory controller includes a field programmable gate array FPGA and controller functions are programmed into the FPGA. In a particular embodiment the FPGA is a Xilinx FPGA. In another embodiment the non volatile memory controller comprises components specifically designed as a non volatile memory controller such as an application specific integrated circuit ASIC or custom logic solution. Each non volatile memory controller typically includes a write data pipeline and a read data pipeline which are describe further in relation to . In another embodiment at least one non volatile memory controller is made up of a combination FPGA ASIC and custom logic components. In certain embodiments at least a portion of a non volatile memory controller is integrated with part of and or in communication with a device driver executing on the computer or the like.

The non volatile memory media is an array of non volatile memory elements arranged in banks and accessed in parallel through a bi directional storage input output I O bus . The storage I O bus in one embodiment is capable of unidirectional communication at any one time. For example when data is being written to the non volatile memory media data cannot be read from the non volatile memory media . In another embodiment data can flow both directions simultaneously. However bi directional as used herein with respect to a data bus refers to a data pathway that can have data flowing in only one direction at a time but when data flowing one direction on the bi directional data bus is stopped data can flow in the opposite direction on the bi directional data bus.

A non volatile memory element e.g. NVM 0.0 is typically configured as a chip a package of one or more die or a die on a circuit board. As depicted a non volatile memory element e.g. operates independently or semi independently of other non volatile memory elements e.g. even if these several elements are packaged together in a chip package a stack of chip packages or some other package element. As depicted a row of non volatile memory elements is designated as a bank . As depicted there may be n banks and m non volatile memory elements per bank in an array of n m non volatile memory elements in a non volatile memory media . Of course different embodiments may include different values for n and m.

In one embodiment the non volatile memory media includes twenty non volatile memory elements per bank with eight banks . In one embodiment the non volatile memory media includes twenty four non volatile memory elements per bank with eight banks . In addition to the n m storage elements one or more additional columns P may also be addressed and operated in parallel with other non volatile memory elements for one or more rows. The added P columns in one embodiment store parity data for the portions of an ECC chunk e.g. an ECC codeword that span m storage elements for a particular bank. In one embodiment each non volatile memory element is comprised of single level cell SLC devices. In another embodiment each non volatile memory element is comprised of multi level cell MLC devices.

In one embodiment non volatile memory elements that share a common storage I O bus e.g. are packaged together. In one embodiment a non volatile memory element may have one or more die per chip with one or more chips stacked vertically and each die may be accessed independently. In another embodiment a non volatile memory element e.g. NVM 0.0 may have one or more virtual die per die and one or more die per chip and one or more chips stacked vertically and each virtual die may be accessed independently. In another embodiment a non volatile memory element NVM 0.0 may have one or more virtual die per die and one or more die per chip with some or all of the one or more die stacked vertically and each virtual die may be accessed independently.

In one embodiment two die are stacked vertically with four stacks per group to form eight storage elements e.g. NVM 0.0 NVM 8.0 each in a separate bank . In another embodiment 24 storage elements e.g. NVM 0.0 NVM 0.24 form a logical bank so that each of the eight logical banks has 24 storage elements e.g. NVM 0.0 NVM 8.24 . Data is sent to the non volatile memory media over the storage I O bus to all storage elements of a particular group of storage elements NVM 0.0 NVM 8.0 . The one or more storage control buses are used to select a particular bank e.g. Bank 0 so that the data received over the storage I O bus connected to all banks is written just to the selected bank

In certain embodiments the storage control bus and storage I O bus are used together by the non volatile memory controller to communicate addressing information storage element command information and data to be stored. Those of skill in the art recognize that this address data and command information may be communicated using one or the other of these buses or using separate buses for each type of control information. In one embodiment addressing information storage element command information and storage data travel on the storage I O bus and the storage control bus carries signals for activating a bank as well as identifying whether the data on the storage I O bus lines constitute addressing information storage element command information or storage data.

For example a control signal on the storage control bus such as command enable may indicate that the data on the storage I O bus lines is a storage element command such as program erase reset read and the like. A control signal on the storage control bus such as address enable may indicate that the data on the storage I O bus lines is addressing information such as erase block identifier page identifier and optionally offset within the page within a particular storage element. Finally an absence of a control signal on the storage control bus for both command enable and address enable may indicate that the data on the storage I O bus lines is storage data that is to be stored on the storage element at a previously addressed erase block physical page and optionally offset within the page of a particular storage element.

In one embodiment the storage I O bus is comprised of one or more independent I O buses IIOBa m comprising wherein the non volatile memory elements within each column share one of the independent I O buses that accesses each non volatile memory element in parallel so that all banks are accessed simultaneously. For example one channel of the storage I O bus may access a first non volatile memory element of each bank simultaneously. A second channel of the storage I O bus may access a second non volatile memory element of each bank simultaneously. Each row of non volatile memory element is accessed simultaneously.

In one embodiment where non volatile memory elements are multi level physically stacked all physical levels of the non volatile memory elements are accessed simultaneously. As used herein simultaneously also includes near simultaneous access where devices are accessed at slightly different intervals to avoid switching noise. Simultaneously is used in this context to be distinguished from a sequential or serial access wherein commands and or data are sent individually one after the other.

Typically banks are independently selected using the storage control bus . In one embodiment a bank is selected using a chip enable or chip select. Where both chip select and chip enable are available the storage control bus may select one level of a multi level non volatile memory element . In other embodiments other commands are used by the storage control bus to individually select one level of a multi level non volatile memory element . Non volatile memory elements may also be selected through a combination of control and of address information transmitted on storage I O bus and the storage control bus .

In one embodiment each non volatile memory element is partitioned into erase blocks and each erase block is partitioned into pages. An erase block on a non volatile memory element may be called a physical erase block or PEB. A typical page is 2000 bytes 2 kB . In one example a non volatile memory element e.g. NVM 0.0 includes two registers and can program two pages so that a two register non volatile memory element has a capacity of 4 kB. A bank of 20 non volatile memory elements would then have an 80 kB capacity of pages accessed with the same address going out the channels of the storage I O bus .

This group of pages in a bank of non volatile memory elements of 80 kB may be called a logical page or virtual page. Similarly a physical erase block of each storage element of a bank may be grouped to form a logical erase block LEB or a virtual erase block. An LEB in certain embodiments is sized to fit within a bank with one PEB from each storage element of a bank forming an LEB or the like. In other embodiments an LEB may span banks and may comprise one or more PEBs from multiple banks . In one embodiment an erase block logical or physical of pages within a non volatile memory element is erased when an erase command is received within a non volatile memory element . Whereas the size and number of erase blocks pages planes or other logical and physical divisions within a non volatile memory element are expected to change over time with advancements in technology it is to be expected that many embodiments consistent with new configurations are possible and are consistent with the general description herein.

Typically when a packet is written to a particular location within a non volatile memory element wherein the packet is intended to be written to a location within a particular page which is specific to a particular physical erase block of a particular storage element of a particular bank a physical address is sent on the storage I O bus and followed by the packet. The physical address contains enough information for the non volatile memory element to direct the packet to the designated location within the page. Since all storage elements in a column of storage elements e.g. NVM 0.0 NVM N.0 are accessed simultaneously by the appropriate bus within the storage I O bus to reach the proper page and to avoid writing the data packet to similarly addressed pages in the column of storage elements NVM 0.0 NVM N.0 the bank that includes the non volatile memory element NVM 0.0 with the correct page where the data packet is to be written is simultaneously selected by the storage control bus .

Similarly satisfying a read command on the storage I O bus may require a substantially simultaneous signal on the storage control bus to select a single bank and the appropriate page within that bank . In one embodiment a read command reads an entire page and because there are multiple non volatile memory elements in parallel in a bank an entire logical page is read with a read command. However the read command may be broken into subcommands as will be explained below with respect to bank interleave. A logical page may also be accessed in a write operation.

An erase block erase command may be sent out to erase an erase block over the storage I O bus with a particular erase block address to erase a particular erase block. Typically an erase block erase command may be sent over the parallel paths of the storage I O bus to erase a logical erase block each with a particular erase block address to erase a particular erase block. Simultaneously a particular bank e.g. Bank 0 is selected over the storage control bus to prevent erasure of similarly addressed erase blocks in all of the banks Banks 1 N . Alternatively no particular bank e.g. Bank 0 is selected over the storage control bus to enable erasure of similarly addressed erase blocks in all of the banks Banks 1 N simultaneously. Other commands may also be sent to a particular location using a combination of the storage I O bus and the storage control bus . One of skill in the art will recognize other ways to select a particular storage location using the bi directional storage I O bus and the storage control bus .

In one embodiment packets are written sequentially to the non volatile memory media . For example packets are streamed to the storage write buffers of a bank of storage elements and when the buffers are full the packets are programmed to a designated logical page. Packets then refill the storage write buffers and when full the packets are written to the next logical page. The next logical page may be in the same bank or another bank e.g. . This process continues logical page after logical page typically until a logical erase block LEB is filled. In another embodiment the streaming may continue across logical erase block boundaries with the process continuing logical erase block after logical erase block.

In a read modify write operation data packets associated with requested data are located and read in a read operation. Data segments of the modified requested data that have been modified are not written to the location from which they are read. Instead the modified data segments are again converted to data packets and then written sequentially to the next available location in the logical page currently being written. The index entries for the respective data packets are modified to point to the packets that contain the modified data segments. The entry or entries in the index for data packets associated with the same requested data that have not been modified will include pointers to original location of the unmodified data packets. Thus if the original requested data is maintained for example to maintain a previous version of the requested data the original requested data will have pointers in the index to all data packets as originally written. The new requested data will have pointers in the index to some of the original data packets and pointers to the modified data packets in the logical page that is currently being written.

In a copy operation the index includes an entry for the original requested data mapped to a number of packets stored in the non volatile memory media . When a copy is made a new copy of the requested data is created and a new entry is created in the index mapping the new copy of the requested data to the original packets. The new copy of the requested data is also written to the non volatile memory media with its location mapped to the new entry in the index. The new copy of the requested data packets may be used to identify the packets within the original requested data that are referenced in case changes have been made in the original requested data that have not been propagated to the copy of the requested data and the index is lost or corrupted.

Beneficially sequentially writing packets facilitates a more even use of the non volatile memory media and allows the non volatile memory device controller to monitor storage hot spots and level usage of the various logical pages in the non volatile memory media . Sequentially writing packets also facilitates a powerful efficient garbage collection system which is described in detail below. One of skill in the art will recognize other benefits of sequential storage of data packets.

In various embodiments the non volatile memory device controller also includes a data bus a local bus a buffer controller buffers 0 N a master controller a direct memory access DMA controller a memory controller a dynamic memory array a static random memory array a management controller a management bus a bridge to a system bus and miscellaneous logic . In other embodiments the system bus is coupled to one or more network interface cards NICs some of which may include remote DMA RDMA controllers one or more central processing unit CPU one or more external memory controllers and associated external memory arrays one or more storage controllers peer controllers and application specific processors . The components connected to the system bus may be located in the computer or may be other devices.

The non volatile memory controller may also include control and status registers and control queues a bank interleave controller a synchronization buffer a storage bus controller and a multiplexer MUX . The non volatile memory controller in the depicted embodiment includes a configuration module that may be part of the write data pipeline and or part of the read data pipeline or may be independent from the write data pipeline and the read data pipeline . The components of the non volatile memory controller and associated write data pipeline and read data pipeline are described below. In other embodiments synchronous non volatile memory media may be used and synchronization buffers may be eliminated.

The write data pipeline includes an ECC encoder that that generates one or more error correcting codes ECC for the one or more packets received from the packetizer . The ECC encoder typically uses an error correcting algorithm to generate ECC check bits which are stored with the one or more data packets. The ECC codes generated by the ECC encoder together with the one or more data packets associated with the ECC codes comprise an ECC chunk codeword. The ECC data stored with the one or more data packets is used to detect and to correct errors introduced into the data through transmission and storage. In one embodiment packets are streamed into the ECC encoder as un encoded blocks of length N. A syndrome of length S is calculated appended and output as an encoded block of length N S. The value of N and S are dependent upon the characteristics of the algorithm which is selected to achieve specific performance efficiency and robustness metrics. In one embodiment there is no fixed relationship between the ECC blocks and the packets the packet may comprise more than one ECC block the ECC block may comprise more than one packet and a first packet may end anywhere within the ECC block and a second packet may begin after the end of the first packet within the same ECC block. In one embodiment ECC algorithms are not dynamically modified. In one embodiment the ECC data stored with the data packets is robust enough to correct errors in more than two bits.

Beneficially using a robust ECC algorithm allowing more than single bit correction or even double bit correction allows the life of the non volatile memory media to be extended. For example if flash memory is used as the storage medium in the non volatile memory media the flash memory may be written approximately 100 000 times without error per erase cycle. This usage limit may be extended using a robust ECC algorithm. Having the ECC encoder and corresponding ECC decoder onboard the non volatile memory device the non volatile memory device can internally correct errors and has a longer useful life than if a less robust ECC algorithm is used such as single bit correction. However in other embodiments the ECC encoder may use a less robust algorithm and may correct single bit or double bit errors. In another embodiment the non volatile memory media may comprise less reliable storage such as multi level cell MLC flash in order to increase capacity which storage may not be sufficiently reliable without more robust ECC algorithms.

In one embodiment the write data pipeline also includes a bias module that receives the one or more packets from the packetizer either directly or indirectly. The bias module biases the bits of the data packets toward a bias of storage cells of the non volatile memory media . As used herein a bias is a preference probability tendency or desirability of values for bits within a set of bits to exhibit a specific data pattern. A bias may be a natural property a designed attribute a property of performing an operation on non volatile memory media or a random occurrence. Data itself may have a bias and non volatile memory media may have a bias. A bias may be toward binary ones toward binary zeroes toward a balance of binary ones and zeroes toward a certain binary value for certain bits or the like.

For example in one embodiment end sections of data files may be padded with binary zeroes causing the data packets that store the end sections to exhibit a bias toward binary zeroes meaning that the data packets have more binary zeroes than binary ones. Other data packets may have more binary ones than zeroes or a balance of binary ones and zeroes. While data packets may each have an individual bias based on data within the packets a bias of the storage cells of the non volatile memory media may be based on some benefit associated with the storage of a particular binary value or pattern or some property of the storage cells. One example of a storage cell property NAND flash storage cells presently are biased to all binary one values or almost all binary one values when provided by a manufacturer. In addition performing an erase operation on the NAND flash storage cells sets the binary values in each storage cell to a binary one such that programming of the storage cells comprises changing certain storage cells to a binary zero value. This bias to all binary one values or almost all binary one values when provided by a manufacturer or when erased represents one example of an empty state for storage cells of a non volatile memory media .

Each of the storage elements in one embodiment store binary data in a plurality of storage cells that exhibit a bias. Each storage cell stores one or more binary bits or values. Flash memory storage cells may be single level cells SLC that each store a single binary bit or multi level cells MLC that each store two or more binary bits. Examples of storage cells include transistors capacitors magnetic elements mechanical elements optical elements and the like. In flash memory each storage cell is typically a floating gate transistor. NRAM MRAM DRAM PRAM and other types of non volatile memory may have other types of storage cells and may store either a single binary bit or two or more binary bits per storage cell.

In one embodiment the storage cells in the storage elements in an empty or erased state store initial binary values. The initial binary values represent a bias for the storage cells. For example the storage cells may have a physical electrical mechanical or other quality that causes them to store a certain value by default. In another embodiment the bias may be intentionally selected based on design considerations of the non volatile memory media on security considerations on compatibility issues or the like and may not be based on a default property of the storage cells.

For example in one embodiment the storage cells of the storage elements may each store a binary value of one upon delivery from a manufacturer and may each be erased to a value of one prior to being programmed or written to as is typical with flash memory. In another embodiment the storage cells of the storage elements may be biased toward binary zeroes toward a balance or equal amount of binary ones and zeroes toward a certain binary value for a plurality of bits toward a binary pattern or the like.

In certain embodiments a bias of one or more storage cells may be influenced by or based on a state of other storage cells physically adjacent to or otherwise in proximity to the one or more storage cells. For example it may be desirable to bias data stored in storage cells to minimize inter cell interference between the storage cells and other storage cells or the like. Inter cell interference can be caused by voltage differentials between physically adjacent storage cells and in certain embodiments biasing data to reduce or minimize the voltage differentials between storage cells based on a physical geometry of the storage cells can reduce inter cell interference. In one embodiment storage cells of the non volatile memory media may have a bias toward a binary pattern that satisfies a predefined voltage differential threshold between the storage cells and other physically adjacent storage cells or the like.

In addition to local types of inter cell interference larger multi cell structures such as bit strings word lines or the like may experience inter cell interference. Certain stripes or other patterns in data such as stripes of binary ones or of binary zeroes may interfere with the accuracy or effectiveness of sense amplifiers and or other management circuitry for these larger multi cell structures and it may be advantageous to bias data away from such stripes or other patterns.

For certain types of storage cells such as SLC flash memory the voltage level of a storage cell and associated voltage differentials between storage cells may be based on a single bit value for each storage cell and biasing data may include biasing toward a binary pattern with minimal transitions between binary one values and binary zero values within a data packet and or within a physical region of storage cells. For other types of storage cells such as MLC flash memory the voltage level of a storage cell and associated voltage differentials between storage cells may be based on groups of bits forming a sub pattern or symbol and biasing data may include biasing toward a binary pattern with minimal transitions between certain sub patterns or symbols. One example of using sub patterns or symbols includes binary or Gray code mapping of multiple binary values to associated charge levels within MLC storage cells. The bits stored by a single MLC storage cell in certain embodiments may not have adjacent addresses but may be stored on different physical pages logical pages or the like.

In one embodiment the bias module biases source data to reduce inter cell interference as a separate step performed separately from instead of or in addition to other biasing techniques. For example upon flipping whitening compressing relocating and or otherwise biasing source data separate blocks of source data may still exhibit patterns that cause inter cell interference and the bias module may bias one or more of the separate blocks of source data toward a pattern that minimizes inter cell interference or the like.

The bias module biases a packet by changing a bias of the packet to more closely match a bias of the storage cells of the non volatile memory media . The bias module biases the packets in a reversible manner such that the inverse bias module can convert the packets back to their original source data values with their original source biases. In one embodiment the packets that the bias module biases are sized for storage in a specific logical or physical storage region or division of the non volatile memory media such as an erase block a virtual erase block a page a virtual page an ECC chunk codeword a division within a page or the like. In one embodiment the bias module selectively biases certain packets based on a bias of the packets and may not bias other packets.

Those of skill in the art recognize that the bias module may alternatively operate on one or more data segments that form a subset of a data packet. Similarly the inverse bias module may operate on data segments as well. Alternatively or in addition in one embodiment the data packet or data packet subsets such as a data segment may be sized based on a size of a storage region in the non volatile memory media a size of a bus or buffer a size of a pipeline a number of extra bits available for storage of an indicator or the like.

By biasing data packets toward the bias of the storage cells the bias module increases performance and endurance of the non volatile memory media and the non volatile memory device . For example biasing packets to more closely match the bias of the storage cells decreases write times and erase times because fewer actual storage cells must be changed to execute the operation. It also increases the writable life of the storage cells because fewer operations that are executed on a storage cell mean that the storage cell will last longer before wear begins to affect the storage cell performance reliability. In certain embodiments biasing data packets may decrease power consumption or have other additional benefits. Because in one embodiment the storage cells store initial binary values that satisfy a bias just prior to being programmed or written to the closer that the data packets match the bias of the storage cells the fewer the number of storage cells that are changed to store the data packets and the more storage cells that remain in a biased state.

As depicted the bias module biases the one or more packets prior to sending the packets to the ECC encoder . Depending on the method that the bias module uses to bias the packets and on other design considerations in a further embodiment the bias module may receive data subsequent to the ECC encoder in the write data pipeline or be placed elsewhere in the write data pipeline . For example in certain embodiments it may be beneficial to keep ECC data separate from data that the bias module biases while in other embodiments it may be beneficial for the bias module to bias data that includes ECC data from the ECC encoder .

In one embodiment the bias module biases one or more data segments prior to sending the data segments to the ECC encoder . The data segment may be a grouping of bits smaller than a data packet in one embodiment. In such an embodiment the data segment may comprise the width in bits bytes of the write data pipeline . Similarly the inverse bias module may convert biased data segments back to their original source state after they are read. Biasing and inverse biasing a data segment may facilitate use of the bias module and the inverse bias module in a write data pipeline and a read data pipeline because the data segment may be sized to match the size bus width of data streaming through the pipelines .

In another embodiment the bias module may be integrated with another element of the write data pipeline such as the compression module the encryption module the ECC encoder or the like. The bias module and corresponding inverse bias module transparently increase the performance of the non volatile memory media as the bias module biases data packets before they are written and the inverse bias module converts the biased data packets back to their original source state after they are read. In certain embodiments the order of the stages may be altered from the depicted order. There are other workable alterations to the order of the stages based on particular user requirements or the like.

The read data pipeline includes an ECC decoder that determines if a data error exists in ECC blocks a requested packet received from the non volatile memory media by using ECC stored with each ECC block of the requested packet. The ECC decoder then corrects any errors in the requested packet if any error exists and the errors are correctable using the ECC. For example if the ECC can detect an error in six bits but can only correct three bit errors the ECC decoder corrects ECC blocks of the requested packet with up to three bits in error. The ECC decoder corrects the bits in error by changing the bits in error to the correct one or zero state so that the requested data packet is identical to when it was written to the non volatile memory media and the ECC was generated for the packet.

In certain embodiments the ECC decoder may provide error information for correctable errors to the configuration module described below such as locations of the bits in error values for the bits in error and or other error information. For example the ECC decoder may provide an error bias to the configuration module indicating one or more bits of a data set that are in error or the like. An error bias as used herein is a representation of one or more detected bit errors in a data set. In one embodiment an error bias includes a location or position of a detected bit error in a data set. In another embodiment an error bias includes a value for a detected bit error. A value for a detected error may include an error corrected value of a bit in error an error value of the bit in error or the like. For example in one embodiment the ECC decoder may provide the configuration module with an uncorrected data set and an error bias indicating locations of detected bit errors and the configuration module may determine a known bias by inverting or flipping the bits in those locations. In another embodiment for example the ECC decoder may provide the configuration module with an error corrected data set and an error bias indicating locations of detected bit errors and the configuration module may determine a read bias by inverting or flipping the bits in those locations.

If the ECC decoder determines that the requested packets contains more bits in error than the ECC can correct the ECC decoder cannot correct the errors in the corrupted ECC blocks of the requested packet and sends an interrupt. In one embodiment the ECC decoder sends an interrupt with a message indicating that the requested packet is in error. The message may include information that the ECC decoder cannot correct the errors or the inability of the ECC decoder to correct the errors may be implied. In another embodiment the ECC decoder sends the corrupted ECC blocks of the requested packet with the interrupt and or the message.

In one embodiment a corrupted ECC block or portion of a corrupted ECC block of the requested packet that cannot be corrected by the ECC decoder is read by the master controller corrected and returned to the ECC decoder for further processing by the read data pipeline . In one embodiment a corrupted ECC block or portion of a corrupted ECC block of the requested packet is sent to the device requesting the data. The requesting device may correct the ECC block or replace the data using another copy such as a backup or mirror copy and then may use the replacement data of the requested data packet or return it to the read data pipeline . The requesting device may use header information in the requested packet in error to identify data required to replace the corrupted requested packet or to replace the data structure to which the packet belongs. In another embodiment the non volatile memory controller stores data using some type of RAID and is able to recover the corrupted data. In another embodiment the ECC decoder sends an interrupt and or message and the receiving device fails the read operation associated with the requested data packet. One of skill in the art will recognize other options and actions to be taken as a result of the ECC decoder determining that one or more ECC blocks of the requested packet are corrupted and that the ECC decoder cannot correct the errors.

In one embodiment the non volatile memory controller includes a configuration module that sets and adjusts configuration parameters for the non volatile memory media such as read voltage thresholds and the like. In a further embodiment the configuration module may be integrated with the non volatile memory media such that it operates independently from the read data pipeline and or the write data pipeline . In certain embodiments as described in greater detail below with regard to the proactive configuration module of and the configuration module proactively determines one or more configuration parameters for storage cells of the non volatile memory media based on media characteristics for the storage cells in an open loop manner with little or no feedback from the storage cells. In the depicted embodiment the configuration module is in communication with the storage control bus and the storage bus controller to configure storage cells of the non volatile memory media to use various configuration parameters. In another embodiment the configuration module manages configuration parameters and or settings for the non volatile memory controller and or for the non volatile memory device .

In other embodiments the configuration module may receive a data set from the non volatile memory media either directly or indirectly to determine configuration parameters for corresponding storage cells in a closed loop manner with read data sets as feedback from the storage cells. In certain embodiments the configuration module may receive one or more requested biased packets from the ECC decoder . In a further embodiment the configuration module may receive a data set from the read synchronization buffer directly from the storage I O bus from the inverse bias module or otherwise. The configuration module is described in greater detail with regard to . Another embodiment where the configuration module receives input from both the ECC decoder and the inverse bias module is described below with regard to .

In general the configuration module sets and adjusts one or more configuration parameters for one or more storage cells from the non volatile memory media such as setting and adjusting read voltage thresholds resistivity thresholds programming thresholds erase thresholds or the like. A read voltage threshold is a voltage level that separates discrete values stored in the storage cells of the non volatile memory media . Different non volatile memory technologies may use different thresholds other than voltages to distinguish between discrete states. Phase change RAM or PRAM for example stores data in chalcogenide glass that has different electrical resistivity in different states. For PRAM the configuration module may determine set and or adjust resistivity thresholds that distinguish between discrete storage states. One of skill in the art in light of this disclosure will recognize that the configuration module may determine set and adjust resistivity thresholds or other configuration parameters in a substantially similar manner to that described herein with regard to read voltage thresholds.

For SLC storage cells that store a single binary value the read voltage threshold is the boundary between a binary one state and a binary zero state. For example in one embodiment a storage cell with a read voltage level above the read voltage threshold stores a binary one while a storage cell with a read voltage level below the read voltage threshold stores a binary zero. Other types of storage cells such as MLC storage cells may have multiple read voltage thresholds to distinguish between more than two discrete states.

For example in one embodiment MLC storage cells that store two bits may have three read voltage thresholds separating binary values of 11 01 00 and 10. The three example read voltage thresholds may be x volts y volts and z volts described in greater detail below with regard to the read voltage thresholds of . If the voltage read from a storage cell falls between Vmin and x volts a binary 11 state is indicated. In certain embodiments Vmin may be a negative voltage. If the voltage read from a storage cell falls between x volts and y volts a binary 01 state is indicated. If the voltage read from a storage cell falls between y volts and z volts a binary 00 state is indicated. If the voltage read from a storage cell falls between z volts and Vmax volts a binary 10 state is indicated.

The voltages for Vmin Vmax x y z may vary based on the manufacturer of the storage cells. Read voltages for example may range between 3.5 and 5.8 volts or between another predefined range of voltages. Similarly the order of binary state changes 11 01 00 and 10 relative to read voltage thresholds may vary based on the encoding type used such as a Gray code encoding type a binary code encoding type or the like. One example encoding type is described below with regard to . As described in greater detail with regard to although a single MLC storage cell stores multiple bits bits from a single storage cell may not have adjacent addresses and may be included in different physical pages logical pages or the like. Accordingly in various embodiments the configuration module may manage configuration parameters such as read voltage thresholds or other storage thresholds at various granularities such as per abode storage state per page logical or physical per erase block logical or physical per set of pages per ECC chunk codeword per wordline per chip per die per die plane or the like.

In certain embodiments instead of referring to a boundary between discrete values a read voltage threshold comprises a range of voltages a maximum and a minimum that indicate a value. A voltage threshold that is a range can be adjusted by changing the boundary at either end or at both ends of the range. The read voltage thresholds or other configuration parameters for the non volatile memory media in one embodiment are initially set at a default level that may be defined by a manufacturer. Often such configuration parameter default levels are set to accommodate a large range of general purpose uses of the non volatile memory media . Advantageously embodiments of the configuration module allow the non volatile memory media to be used most optimally based on more specific use characteristics. The configuration module in certain embodiments overrides the default level for one or more configuration parameters setting the one or more configuration parameters to a different level based on media characteristics of the non volatile memory media . The configuration module may set the configuration parameters to a level that decreases the amount of errors that the non volatile memory media encounters when compared to the default level to a level that increases the amount of errors that may be detected and corrected when compared to the default level to a level that increases the number of input output operations per second IOPS of the non volatile memory media when compared to the default level to a level that increases the usable life of the non volatile memory media when compared to the default level and or that otherwise improves the utility of the non volatile memory media when compared to the default level.

The read voltage levels of storage cells and other configuration parameters can also shift over time due to leakage and other disturbances of the non volatile memory media . The rate of leakage can also increase with the wear and age of the non volatile memory media . If the read voltage level of a storage cell shifts past the read voltage threshold a data error occurs as the value of the data read from the storage cell is different than the value of the data written to the storage cell. The configuration module in one embodiment adjusts a read voltage threshold or other configuration parameter for one or more storage cells from the non volatile memory media to compensate for shifts in the read voltage levels of the storage cells. By proactively and or dynamically adjusting read voltage thresholds the configuration module can increase the retention rate for and or the reliability of data stored in the non volatile memory media and extend the useable lifetime of the non volatile memory media itself improving the utility of the non volatile memory media .

The configuration module in one embodiment uses a known bias of the data set or packet from the non volatile memory media to adjust the read voltage threshold or other configuration parameter. As described above with regard to the bias module a bias is a preference probability tendency or desirability of values for bits within a set of bits to exhibit a specific data pattern. A bias may be a natural property a designed attribute a property of performing an operation on non volatile memory media or a random occurrence. A bias may be toward binary ones toward binary zeroes toward a balance of binary ones and zeroes toward a certain binary value for certain bits toward a specific ratio of binary ones and binary zeroes toward a binary pattern or the like.

In one embodiment the data set or packet that the configuration module receives has a known bias. The data set or packet has a known bias for one of at least three reasons. First the data set or packet may have a known bias because the bias module biased the data set or packet when the data set or packet was written. In one embodiment the bias module and or the inverse bias module cooperate with the configuration module communicating the known bias to the configuration module . Second the data set or packet may have a known bias because the data set or packet is read from a virgin unwritten region of the non volatile memory media . For example in one embodiment virgin unwritten regions of the non volatile memory media may typically have a known bias of exclusively binary ones or exclusively binary zeroes in an unwritten state. Third the data set or packet may have a known bias because the ECC decoder has corrected the data set or packet and has determined the original correct values of one or more bits of the data set that were in error. The correct values for the bits in the data set comprise this known bias. A deviation from the known bias caused by errors in the data set is an error bias.

The configuration module in one embodiment determines that a read bias for the data set or packet deviates from the known bias and determines a direction of deviation for the data set based on a difference between the read bias and the known bias. In a further embodiment the configuration module adjusts the read voltage threshold or another read threshold such as a resistivity threshold for storage cells corresponding to the data set based on the direction of deviation. For example in one embodiment the configuration module may lower the read voltage threshold from the previous read voltage threshold to a new read voltage threshold for the storage cells if the data set has more binary zeroes than expected based on the known bias. For MLC storage cells in one embodiment a data set may include data from different addresses different pages or the like so that the data set includes all data that the associated storage cells store. The configuration module may base a read voltage threshold adjustment on known characteristics of the storage cells such as an encoding type used for the storage cells based on a physical and or electrical architecture of the storage cells or the like. In a further embodiment the configuration module may transform translate or combine data from different addresses or pages to facilitate a determination of a known bias a read bias and or a deviation from a known bias for MLC storage cells. In another embodiment for MLC storage cells the configuration module may adjust a read voltage threshold for the MLC storage cells based on a subset of the data stored by the MLC storage cells.

The configuration module in one embodiment may request that the data set be re read with the new read voltage threshold. The configuration module may determine whether the re read data set has a read bias that deviates from the known bias and may iteratively adjust the read voltage threshold to a new read voltage threshold until the read bias of the data set no longer deviates from the known bias more than a threshold amount which may be zero until the ECC decoder can correct errors in the data set or the like. In one embodiment the configuration module stores the new read voltage threshold such that the new read voltage threshold is persistent for subsequent data reads from the non volatile memory media . In a further embodiment the non volatile memory media stores the new read voltage threshold for subsequent data reads.

The configuration module in one embodiment may monitor the read bias of each packet read and compare the bias of the packet or other data set to the known bias in response to a read request. In a further embodiment the configuration module may monitor the read bias of each packet read and may compare the bias of the data set or packet to the known bias in response to a data error such as for example an uncorrectable bit error that the ECC decoder cannot correct or the like. In a further embodiment the configuration module may not monitor the read bias of each packet read and may determine and compare the bias of the data set or packet to the known bias exclusively in response to a data error. As described below with regard to the proactive configuration module of in certain embodiments the configuration module sets or adjusts a read voltage threshold or other configuration parameter proactively based on media characteristics instead of or in addition to adjustments based on read data sets or packets.

In one embodiment the non volatile memory controller may read data in a data packet from multiple channels storage elements die chips physical erase blocks PEBs groupings of storage cells or the like within the non volatile memory media each of which may have independent read voltage thresholds. The manufacturer of the channels storage elements die chips and or grouping of storage cells may make the read voltage thresholds for each channel storage element die chip and or grouping of storage cells independently adjustable by the non volatile memory controller . Alternatively or in addition the manufacturer of the channels storage elements die chips and or grouping of storage cells may make the read voltage thresholds for groups of channels groups of storage elements groups of die groups of chips and or groups of groupings of storage cells adjustable by the non volatile memory controller as separate groups.

In one embodiment the ECC encoder creates independent ECC checkbits for each channel storage element die chip PEB or other grouping of storage cells. The ECC checkbits are stored with the data on a particular grouping of storage cells rather than being distributed across multiple groupings. If ECC checkbits are created and stored independently for each grouping of storage cells the configuration module in response to a data error may use the ECC checkbits and the known architecture for how an ECC checkbits are written to the groupings of storage cells to determine in which grouping of storage cells the data error occurred and adjust the read voltage thresholds of those groupings. If ECC checkbits for the data packet are stored across multiple groupings of storage cells the configuration module may separately check the read biases of data sets from each grouping of storage cells and adjust one or more of the corresponding read voltage thresholds. An array of storage elements with multiple channels is described in greater detail with regard to .

In one embodiment the read data pipeline includes an inverse bias module that receives one or more requested biased packets from the ECC decoder either directly or indirectly and converts the one or more requested packets back to their original source form by reversing the biasing process of the bias module prior to sending the one or more requested packets to the depacketizer . In one embodiment the inverse bias module may use one or more indicators stored by the bias module to convert the biased packets back to their original source data. In certain embodiments the inverse bias module may provide a known bias a read bias and or a deviation from a known bias for a packet or other data set to the configuration module as described below with regard to .

In a further embodiment the inverse bias module converts the biased packets back to their original source data without using an indicator. Instead of using an indicator the inverse bias module may implement an algorithm that is the inverse operation of the bias module . This algorithm may inverse the bias for each data packet received and or a select number of data packets received. In the depicted embodiment the inverse bias module is located between the ECC decoder and the depacketizer . In a further embodiment the inverse bias module may be located elsewhere in the read data pipeline based on the location of the bias module in the write data pipeline .

As with the write data pipeline the stages of the read data pipeline may be rearranged and other orders of stages within the read data pipeline are possible. The non volatile memory controller includes control and status registers and corresponding control queues . The control and status registers and control queues facilitate control and sequencing commands and subcommands associated with data processed in the write and read data pipelines . For example a data segment in the packetizer may have one or more corresponding control commands or instructions in a control queue associated with the ECC encoder . As the data segment is packetized some of the instructions or commands may be executed within the packetizer . Other commands or instructions may be passed to the next control queue through the control and status registers as the newly formed data packet created from the data segment is passed to the next stage.

Commands or instructions may be simultaneously loaded into the control queues for a packet being forwarded to the write data pipeline with each pipeline stage pulling the appropriate command or instruction as the respective packet is executed by that stage. Similarly commands or instructions may be simultaneously loaded into the control queues for a packet being requested from the read data pipeline with each pipeline stage pulling the appropriate command or instruction as the respective packet is executed by that stage. One of skill in the art will recognize other features and functions of control and status registers and control queues .

The non volatile memory controller and or non volatile memory device may also include a bank interleave controller a synchronization buffer a storage bus controller and a multiplexer MUX .

In the depicted embodiment the configuration module receives inputs from the inverse bias module the ECC decoder and the device factor module and the configuration module determines a configuration parameter adjustment based on the inputs. In other embodiments the configuration module may receive inputs from just the inverse bias module from just the ECC decoder from just the device factor module or from a different combination of the inverse bias module the ECC decoder and or the device factor module .

The inverse bias module in one embodiment provides a known bias and or an actual read bias of a data set to the configuration module . The inverse bias module may provide the known bias as an expected bias based on a reversible biasing algorithm that the bias module applies to data written to the non volatile memory media . The expected bias in certain embodiments may be an exact bias where the bias module uses a reversible biasing algorithm that biases data to exactly match a bias. For example the bias module may add padding data to a data set so that the data set has an exact balance of binary ones and binary zeroes or the like and the known bias may be exact.

In another embodiment the inverse bias module may provide the expected bias as a range a distribution an average an estimate or the like based on the reversible biasing algorithm that the bias module applies to data. For example the inverse bias module may measure or learn an expected bias over time as the inverse bias module applies an inverse biasing algorithm to data read from the non volatile memory media . In one embodiment the expected bias may be mathematically or otherwise derived from the reversible biasing algorithm of the bias module as a range or distribution of possible or likely biases.

For example where the bias module biases data toward a balance of one half binary ones and one half binary zeroes which may also be referred to as a direct current DC balance a range of actual biases for biased data may range between about forty six percent binary ones and fifty four percent binary ones or the like. The known bias and the read bias of the data set in other embodiments may also be based on multi bit symbols or patterns of bits instead of being based exclusively on individual binary ones and zeroes or the like. While the inverse bias module in the depicted embodiment provides input to the configuration module in certain embodiments the bias module may provide an expected bias to the configuration module as a known bias the known bias may be hard coded or programmed into the configuration module or the like.

In one embodiment the inverse bias module provides a read bias of a data set read from the non volatile memory media to the configuration module . For example as the inverse bias module converts biased data packets or other data sets back to their original source form by reversing the biasing process of the bias module the inverse bias module may determine measure or detect the read bias of the data packets or other data sets. The inverse bias module may determine a read bias prior to during or after reversing the biasing process depending on the biasing process used. In certain embodiments if the inverse bias module determines that a read bias of a data set deviates from the known expected bias of the data set the inverse bias module may provide the data set to the configuration module to make a configuration parameter adjustment to storage cells of the data set so that the data set may be re read. In other embodiments as described above with regard to the configuration module may adjust a read voltage threshold for a data set before the inverse bias module receives the data set. Other arrangements of the configuration module the inverse bias module and the ECC decoder may also be used.

The ECC decoder in one embodiment provides a known bias and or a read bias for a data set to the configuration module . The ECC decoder may provide a known bias for a data set having a correct state of bits for the data set. For example once the ECC decoder has corrected one or more correctable bit errors in a data set the ECC decoder may provide the error corrected state of the bits of the data set to the configuration module as a known bias with which the data set was written to the non volatile memory media . The ECC decoder in a further embodiment may provide the read bias for a data set as an error bias that indicates one or more bits of a data set that were in error when the data set was read from the non volatile memory media .

Because the ECC decoder for correctable errors determines the exact original correct values of bits known bias of a data set and an exact location of bits in error error bias of the data set the configuration module can determine an exact deviation of the data set from the known bias. For this reason in certain embodiments the configuration module may make more precise configuration parameter adjustments using a known bias and an error bias from the ECC decoder when available than using an expected bias and a read bias from the inverse bias module .

The configuration module in one embodiment uses a known bias and or an error bias for a data set from the ECC decoder in response to one or more correctable bit errors in the data set. In a further embodiment the configuration module uses an expected bias that is based on a reversible biasing algorithm as a known bias. In certain embodiments the expected bias is used as the known bias in response to one or more uncorrectable bit errors in the data set. An error bias from the ECC decoder may not be available to the configuration module for uncorrectable bit errors because the uncorrectable bit error condition makes the bias undefined. For uncorrectable bit errors in a data set in certain embodiments the read bias of the data set may deviate from the known expected bias for the data set more than for correctable bit errors because of the greater severity of the errors. Due to the greater magnitude of deviation of the read bias of a data set from the known expected bias of the data set for uncorrectable bit errors the bias information from the inverse bias module may provide a better indicator of a direction for a configuration parameter adjustment for uncorrectable bit errors than for correctable bit errors.

The device factor module in one embodiment provides one or more statistics for the non volatile memory device to the configuration module . The configuration module in certain embodiments may make a configuration parameter adjustment based on the one or more statistics may supplement information from the inverse bias module and or the ECC decoder with the one or more statistics or the like. The one or more statistics for the non volatile memory device in one embodiment include statistics that may affect read voltages or other configuration parameters of storage cells of the non volatile memory device . For example in certain embodiments the one or more statistics may include a temperature for the non volatile memory device an error rate for the non volatile memory device such as an uncorrectable bit error rate UBER a raw bit error rate RBER or the like a program erase cycle count for the non volatile memory device a storage request latency for the non volatile memory device such as an average maximum or other storage request execution latency an age of the non volatile memory device and or other statistics or characteristics.

In the depicted embodiment the device factor module receives input from one or more sensors . The one or more sensors each detect a statistic or characteristic for the non volatile memory device such as temperature moisture movement and or other statistics. For example in various embodiments the one or more sensors may include a temperature sensor a moisture sensor an accelerometer and or another type of sensor for the non volatile memory device . In one embodiment the device factor module and or the configuration module may receive one or more statistics for the non volatile memory device from one or more other modules or elements. For example the device factor module and or the configuration module may receive an error rate for the non volatile memory device such as a UBER a RBER or the like from the ECC decoder .

The configuration module in various embodiments may base a configuration parameter adjustment on a single input or on a combination of inputs from the inverse bias module the ECC decoder and or the device factor module . In certain embodiments one or more inputs from the inverse bias module the ECC decoder and or the device factor module may not be available for a data set. For example the ECC decoder may not provide an error bias and a known bias for a data set with an uncorrectable bit error the inverse bias module may not provide a known expected bias or a read bias for a data set during a learning period while the inverse bias module is determining an expected bias the device factor module may not provide one or more statistics during an initial startup period or the like.

In one embodiment the configuration module bases a configuration parameter adjustment on a best available input according to a predefined hierarchy or ranking of inputs. For example the configuration module may base a configuration parameter adjustment on a known bias and error bias from the ECC decoder if available on a known expected bias and a read bias from the inverse bias module if input from the ECC decoder is not available and on one or more statistics from the device factor module if input from both the ECC decoder and the inverse bias module is unavailable.

In a further embodiment the configuration module may make a random configuration parameter adjustment in response to a data error or the like if input from each of the inverse bias module the ECC decoder and the device factor module is unavailable. For example the configuration module may try a configuration parameter adjustment in one direction re read the data set and check for errors and try a configuration parameter adjustment in the other direction if the error persists.

In another embodiment the configuration module may base a configuration parameter adjustment on multiple inputs by combining the inputs from the inverse bias module the ECC decoder and or the device factor module . The configuration module may scale the inputs weight the inputs convert the inputs to common units or the like to facilitate combination of the inputs. For example the configuration module in one embodiment may convert each of the inputs to individual preliminary threshold adjustments and then sum the preliminary threshold adjustments to provide a configuration parameter adjustment . The configuration module in the example may weight each preliminary threshold adjustment based on a predefined hierarchy or ranking of the associated inputs. For example if a known bias and an error bias from the ECC decoder indicates a configuration parameter adjustment in one direction and the known expected bias and the read bias from the inverse bias module indicates a configuration parameter adjustment in the other direction the input with greater weight or priority in the predefined hierarchy or ranking will dictate the direction of the configuration parameter adjustment .

The configuration module in one embodiment sets configuration parameters proactively with an open loop model using the proactive configuration module . In another embodiment the configuration module sets configuration parameters reactively with a closed loop model using the data set read module the deviation module the direction module and or the adjustment module . In certain embodiments the configuration module may make several layers or phases of adjustments to configuration parameters determining configuration parameters proactively using the proactive configuration module and adjusting the configuration parameters reactively as the data set read module reads data sets from the non volatile memory media .

In one embodiment the data set read module reads a data set from storage cells of the non volatile memory media . The data set read module may read the data set either directly or indirectly from the non volatile memory media . For example in one embodiment the data set read module may receive the data set from another module or element in the read data pipeline the non volatile memory media or the like.

In one embodiment the data set read module reads the data set in response to a testing operation and the data set may be a sample data set read as part of the testing operation. In a further embodiment the data set read module reads the data set in response to a read request from a client and the data set may be a data set that the client requested. The data set in one embodiment may be a full packet a portion of a packet or the like. In another embodiment a size of the data set may be set by the test operation by a read request from a client or the like. In a further embodiment the data set may be raw data from the non volatile memory media independent of packets or other data structures.

The data set in a further embodiment was originally stored in the storage cells with a known bias. For example the data set may be from a packet that the bias module biased may be from storage cells of the non volatile memory media that are in a virgin state storing default data or other data programmed to the non volatile memory media with a known bias for example by a manufacturer of the non volatile memory media or the like.

In one embodiment the data set may be sized relative to a biasing scheme that the bias module employs to bias packets. For example in one embodiment the data set may be sized based on the period of a deterministic sequence such as a pseudorandom binary sequence that the bias module uses to bias packets. The closer the size of the data set is to an integer multiple of the period of the pseudorandom binary sequence the more likely it is that the bias of the resulting data set will match the known bias. In a further embodiment the bias module may guarantee that a data set of a predefined size has a bias that does not deviate from the known bias by more than a threshold amount. The threshold amount may range from zero to a given integer value or percentage value.

As described above a bias is a preference probability or tendency of values for bits within a set of bits to exhibit a specific data pattern. In one embodiment the known bias is a known ratio of binary ones and binary zeroes within a set of bits or groupings of sets of bits. The known ratio in one embodiment may be expressed as a proportion or percentage between zero and one a ratio of zero representing a bias of exclusively one value and a ratio of one representing a bias of exclusively the other value. In one embodiment the known ratio is greater than zero and less than one meaning that the known ratio is offset between a ratio of exclusively one binary value and a ratio of exclusively the opposite binary. If the known ratio is greater than zero and less than one a deviation in the read bias of the data set may occur in either direction from the known ratio and still remain detectable by the configuration module .

In the depicted embodiment the data set read module includes a monitor module and a read error module . The data set read module in one embodiment may read the data set using the monitor module and or the read error module . In one embodiment the monitor module monitors data sets that are read from the non volatile memory media in response to read requests from a computer or other client . The monitor module may monitor each data set that is read from the non volatile memory media or may select certain data sets that are read from the non volatile memory media at predefined intervals in response to a command or directive from a storage client or the like. By using the monitor module to monitor data sets that are read from the non volatile memory media the configuration module may adjust read voltage thresholds for the non volatile memory media dynamically preventing uncorrectable data errors from occurring.

In one embodiment the read error module reads the data set in response to a data error identified in the data set. For example the ECC decoder or another module may determine that a data error has occurred. In one embodiment the data error is an uncorrectable bit error that the ECC decoder does not have enough information to correct. Specifically the ECC decoder in one embodiment is configured to detect and correct up to a certain number of bits of Bits in Error BER in error in a data set. When the number of bits in error exceeds the BER the ECC decoder may signal an uncorrectable data error an uncorrectable bit error or the like.

The data error may occur due to a shift in a voltage level retained in one or more storage cells of the non volatile memory media . This retained voltage level of a storage cell is referred to herein as a read voltage level. The read error module in one embodiment reads the data set as part of a testing operation. The configuration module may conduct the testing operation in response to the data error in response to a scheduled maintenance operation in response to an initial calibration operation or the like. The data set used by the read error module may come from a client requested packet or may be sample data read as part of the testing operation.

In certain embodiments the data set read module when reading a data set of sample data in response to a testing operation periodically during monitoring or the like may size the sample data set to fit within excess read bandwidth of the non volatile memory media . By sizing sample data to fit within excess read bandwidth of the non volatile memory media in one embodiment reading the sample data may not affect a read bandwidth for servicing read requests to the non volatile memory media or a read throughput of the non volatile memory media . In one embodiment the data set read module may read a data set from the non volatile memory media with a greater amount of data than is requested by a read request to provide a greater sample size of bits for the configuration module to use to determine an adjustment to a read voltage threshold or the like. A sample size that is greater than an amount of data requested in certain embodiments may improve the accuracy of a read voltage threshold adjustment.

For example if a user application requests 512 bytes of data and the non volatile memory media can read 800 bytes of data in a read request at substantially the same speed as 512 bytes of data in one embodiment the data set read module may read a data set of 800 bytes for adjusting a read voltage threshold and provide the requested 512 bytes a subset of the 800 byte data set to the user application without affecting the read time of the operation. In one embodiment the data set read module sets a minimum data set request size and retrieves at least the minimum data set request size amount of data for each read request even if the read request is for less than the minimum data set request size. The minimum data set request size in certain embodiments may be selected to fit within a boundary of one or more ECC chunks codewords one or more pages one or more erase blocks within excess bandwidth of the non volatile memory media or the like. In one embodiment the minimum data set request size may be selected based on an architecture or geometry of the non volatile memory media the read data pipeline or the like.

In one embodiment the deviation module determines that a read bias for a data set deviates from a known bias with which the data set was originally stored. The read bias of the data set deviates from the known bias when there is a difference between the read bias and the known bias. In one embodiment where the known bias is exact such as where the known bias includes error corrected bit values or where the bias module biases to an exact bias the deviation module may determine that any difference between a read bias and the known bias comprises a deviation from the known bias. In other embodiments the known bias may include an average bias an estimated bias a distribution of biases a range of biases or the like. The deviation module in these embodiments may determine that a read bias outside of a range or distribution of known biases at least a predefined deviation threshold away from a known bias or the like deviates from the known bias.

In one embodiment the difference between the read bias of the data set and the known bias may be a difference in the ratios of binary ones and binary zeroes. In other embodiments the difference between the bias of the data set and the known bias may be a difference in a binary pattern a difference in multi bit binary symbols or the like. As described above with regard to in various embodiments the deviation module may receive an original known bias and or a read bias for a data set from the ECC decoder from the inverse bias module or the like.

The deviation module in one embodiment determines whether the read bias of the data set deviates from the known bias by comparing the read bias to the known bias. The deviation module may compare the read bias to the known bias by counting the number of binary ones and the number of binary zeroes in the data set to determine the ratio of binary ones and binary zeroes in the data set and comparing that ratio to a ratio of the known bias. In a further embodiment the deviation module may search for and or count the occurrences of an expected pattern or other expected attribute of the known bias and compare the results of a similar search and or count in the data set to the expected attribute. In certain embodiments the ECC decoder indicates to the deviation module that the read bias of the data set deviates from the known bias by providing an error bias for the data set to the configuration module or the like.

In embodiments where the known bias includes a pattern of bits multi bit binary symbols or the like the deviation module may perform a transform on bits of the data set may analyze a subset of bits of the data set or the like to determine whether the read bias of the data set deviates from the known bias. For example the deviation module may perform a transform based on an encoding type used for storage cells of the non volatile memory media such as a Gray code encoding type a binary code encoding type or the like. The transform in certain embodiments may be based on a physical and or electrical architecture of the storage cells of the non volatile memory media .

For example as described below with regard to a multi level storage cell stores at least a most significant bit MSB and a least significant bit LSB . In certain embodiments the MSB and the LSB though part of the same physical multi level storage cell may be assigned to different pages of the non volatile memory media . In certain embodiments a plurality of the multi level storage cells are organized on the non volatile memory media such as NAND flash for example as a physical page. In certain non volatile memory media a physical page is the smallest unit that can be written to the non volatile memory media . In such embodiments a multi level storage cell may be associated with a page pair. A page pair is a pair of pages upper and lower that are associated with a single set of physical multi level storage cells. For example a multi level storage cell may be associated with a page pair that includes an upper page and a lower page. An upper page may be associated with the MSBs and the lower page may be associated with the LSBs or vice versa.

Thus the MSB and LSB in the same multi level storage cell may have different addresses in the storage device . In certain embodiments the upper page includes the MSBs of a plurality of multi level storage cells and the lower page includes the LSBs of the same multi level storage cells. Writes directed to the upper page may therefore cause changes only in the MSBs of the associated multi level storage cells while writes directed to the lower page cause changes only in the LSBs of the associated multi level storage cells.

As described in greater detail below with regard to in certain embodiments the data set read module may read a data set that includes only a subset of the bits stored by a grouping of multi level storage cells and the deviation module may determine whether or not the read bias of the data set deviates from the known bias based on the subset of the bits. For example a data set may include only data values from LSBs lower pages only values from MSBs upper pages or the like. In another embodiment the deviation module may determine whether or not a read bias of a data set deviates from a known bias based at least partially on an encoding type used for storage cells of the non volatile memory media a physical and or electrical architecture of the storage cells of the non volatile memory media or the like. In other embodiments the deviation module may perform a transform on a data set that may combine data from different pages to include both LSB and MSB bits in a single data set to coordinate LSB and MSB bits and or pages from different data sets or the like.

The deviation module in one embodiment checks the read bias of each data set that the data set read module reads. For example if the data set read module uses the monitor module the deviation module may monitor the read biases of data sets regularly as they are read from the non volatile memory media . The monitor module in one embodiment may compare read biases of each data set that is requested by a client. In a further embodiment the monitor module may check read biases of requested data sets for example at regular intervals and or in response to a command or the like. In another embodiment if the data set read module uses the read error module the deviation module may check the read bias of a data set in response to a data error as part of a testing operation or the like.

In one embodiment the direction module determines a direction of deviation for the data set. The direction of deviation in one embodiment is a difference between the read bias of the data set and the known bias. The direction or difference may be represented as a value a sign e.g. positive or negative a relationship e.g. greater than less than a direction e.g. up down or the like. The direction module in certain embodiments may determine a direction of deviation based on an encoding type used for storage cells of the non volatile memory media based on a physical and or electrical architecture of the storage cells of the non volatile memory media or the like. For example the direction module may examine the bias deviation in the data set to determine a direction of deviation based on a media type 2 bit MLC 3 bit MLC n bit MLC which page of a multi phase programming model was read an encoding type for the non volatile memory media such as a Gray code encoding type a binary code encoding type or the like and or a magnitude of the determined deviation.

The direction module in one embodiment may determine the direction by subtracting a ratio proportion or other representation of the known bias from a representation of the read bias of the data set. For example in one embodiment the direction module may subtract the proportion of binary ones zeroes multi bit binary symbols or the like that are expected based on the known bias from the proportion of binary ones zeroes multi bit binary symbols or the like that are in the data set. Depending on whether ratios of binary ones are compared or ratios of binary zeroes are compared and whether a high voltage represents a binary one or a binary zero or other specific architectures of the storage cells the direction module may invert the difference or perform another transform to determine the direction.

In embodiments where an error bias from the ECC decoder is available the direction module may determine the direction of deviation based on one or more bits of the data set that are in error as indicated by the error bias. In other embodiments as described above with regard to the direction module may combine directions based on input from the inverse bias module the ECC decoder and or the device factor module to determine a direction of deviation or the like.

In one embodiment a binary zero is represented by a voltage below the read voltage threshold and a binary one is represented by a voltage above the read voltage threshold. In one example a data set is stored with a known bias of 0.5 representing that the expected bias of the data set should be one half binary ones or DC balanced. In this example the data set is read from the storage cells and the data set has a read bias of 0.7 meaning that seventy percent of the data bits are binary ones. To determine the direction in one embodiment the direction module subtracts the expected bias 0.5 from the read bias of the data set 0.7 for a direction of 0.2. The direction may be the entire result e.g. 0.2 the sign of the result e.g. positive a relationship e.g. greater than a direction e.g. up or another indicator that represents the difference between the expected bias of 0.5 and the read bias of 0.7.

In another example if the read bias of the data set is 0.3 meaning that thirty percent of the data bits are binary ones the direction module in one embodiment would subtract the expected bias 0.5 from the read bias of the data set 0.3 for a difference of 0.2. In this example the direction would be the opposite of the first example 0.2 negative less then down or the like.

Because the expected bias is known comparing a read bias relative the known bias indicates that certain bits which should have satisfied the known bias presently do not which may be due to a data error or due to changes in the voltage level stored in the storage cells after they were written. In addition determining that the difference is positive or negative indicates whether the read voltage should be increased or decreased such that a re read of the data set will result in a read bias that is the same as or comes closer to the known bias. In one embodiment the configuration module adjusts the read voltage level in the same direction as the direction indicated by the direction module .

Advantageously having an indication as to which direction to adjust the read voltage threshold provides a significant reduction in time and resources needed to identify a new adjusted read voltage level. If the direction in which to make a read voltage threshold was unknown identifying a new read voltage threshold may require a labor and time intensive process of trial and error as different possible read voltage thresholds are set and then tested and then adjusted as needed. The process may be used to find a read voltage threshold that results in a re read of the data packet substantially matching the known bias.

In one embodiment the adjustment module adjusts a read voltage threshold for the storage cells of the non volatile memory media based on the direction of deviation that the direction module determines. The adjustment module in one embodiment may adjust the read voltage threshold in the direction of deviation away from the direction of deviation or the like. For example in one embodiment the adjustment module may raise the read voltage threshold from a previous read voltage threshold in response to the direction module detecting more binary ones than expected in the known bias and lower the read voltage threshold in response to fewer binary ones than expected. While the relative directions may change based on characteristics of the storage cells of the non volatile memory media and the storage scheme employed the adjustment module adjusts the read voltage threshold to correct or compensate for the difference determined by the direction module .

In a further embodiment the adjustment module determines an amount to adjust the read voltage threshold based on an amplitude of the direction or amplitude of the difference determined by the direction module . In another embodiment the adjustment module may scale or otherwise adjust the amplitude from the direction module and adjust the read voltage threshold the adjusted amount. For example the adjustment module in one embodiment may adjust the read voltage threshold by several adjustment levels in a single adjustment based on the amplitude of the direction. In a further embodiment the adjustment module may select an amount to adjust the read voltage threshold based on additional factors such as age amount of wear usage history error history or other aspects of the non volatile memory media . As described above with regard to in certain embodiments the adjustment module may make a read voltage threshold adjustment based on one or more statistics for the non volatile memory device that the configuration module receives from the device factor module .

In another embodiment the adjustment module uses a search algorithm to determine the read voltage threshold based on the direction of deviation. For example the range of voltages in the direction of deviation from the current read voltage threshold may be the search space for the search algorithm. The adjustment module in one embodiment may use a linear search a binary search or the like to determine the read voltage threshold. To check each step as part of the search algorithm the data set read module may re read the data set in response to each adjustment and the deviation module may re determine whether the read bias of the re read data set deviates from the known bias. The direction module may re determine a direction of deviation for the re read data set to further the search. The adjustment module may iteratively readjust the read voltage threshold based on the re determined direction of deviation until the deviation module determines that the read bias of a re read data set does not deviate from the known bias or until each of the read voltage threshold level has been tested and or until the data set can be corrected using ECC checkbits or the like.

In one embodiment the adjustment module stops readjusting a read voltage threshold once a retry threshold is satisfied. For example if the ECC decoder cannot correct a data error and or if the read bias for the data set continues to deviate from the known bias when a retry threshold for the data set is satisfied the adjustment module may cease making adjustments to the read voltage threshold. The retry threshold may be selected based on a set of possible read voltage threshold levels or the like. In one embodiment a retry threshold sets a number of times which the adjustment module may adjust a read voltage threshold. In another embodiment a retry threshold may set an amount of time in which the adjustment module may make read voltage threshold adjustments. The non volatile memory controller in certain embodiments may take further remedial action in response to the retry threshold being satisfied such as retiring the storage cells associated with the data set logically replacing the storage cells associated with the data set or the like.

In one embodiment the adjustment module does not adjust a read voltage threshold even if the deviation module determines that the read bias of a data set deviates from the known bias a data error has occurred a retry threshold has not been met or the like. The adjustment module in certain embodiments may selectively adjust a read voltage threshold based on one or more risk factors associated with an adjustment to a grouping of storage cells. For example risk factors may include an error rate for the grouping of storage cells such as an UBER or the like an erase cycle count for the grouping of storage cells a storage request latency for the grouping of storage cells such as an average maximum or other storage request execution latency an age of the grouping of storage cells a number of previous adjustments to a read voltage threshold of the grouping of storage cells and or other potential risk factors. In one embodiment the adjustment module may cancel or delay an adjustment to a read voltage threshold in response to one or more risk factors satisfying a risk threshold. In a further embodiment the non volatile memory controller may take further remedial action in response to one or more risk factors satisfying a risk threshold.

The adjustment module in one embodiment adjusts the read voltage threshold using a procedure or command provided by a manufacturer of the non volatile memory media . For example in one embodiment the adjustment module may adjust the read voltage threshold by writing a value to a settings register of the non volatile memory media sending a read voltage threshold parameter to the non volatile memory media or otherwise communicating an adjustment to a read voltage threshold to the non volatile memory media . The adjustment module may communicate the adjustment as an absolute value of a read voltage threshold an amount to adjust the read voltage threshold or the like. In a further embodiment the non volatile memory media provides a plurality of discrete levels e.g. between 2 and 15 different levels to which the read voltage threshold may be adjusted. In other embodiments the magnitude of a read voltage threshold adjustment may be defined or recommended by a manufacturer or vendor of the non volatile memory media .

The adjustment module in one embodiment adjusts the read voltage threshold individually for a die chip PEB or other discrete segment of the non volatile memory media . The adjustment module in a further embodiment adjusts multiple read voltage thresholds for each storage cell. For example in one embodiment the storage cells of the non volatile memory media are MLC storage cells with multiple read voltage thresholds per cell e.g. a 2 bit MLC storage cell may have three distinct read voltage thresholds . The adjustment module may move each of the multiple read voltage thresholds together or it may move them independently.

In embodiments where the storage cells have multiple read voltage thresholds each read voltage threshold is separated by a separation distance. In one embodiment the separation distances are uniform between each read voltage threshold. In a further embodiment the adjustment module adjusts the multiple read voltage thresholds with a single command or procedure and the separation distances between the multiple read voltage thresholds scale with the adjustment. For example in one embodiment the separation distances between read voltage thresholds may increase with larger read voltage thresholds and decrease with lower read voltage thresholds. Scaling the separation distances between read voltage thresholds upon adjustment in one embodiment provides a more even distribution of read voltage thresholds so that the ranges of voltages at the ends of the ranges are not reduced or enlarged while middle ranges remain the same.

In one embodiment the persistence module stores a state of the read voltage threshold. The persistence module in one embodiment is part of the non volatile memory controller . The persistence module in another embodiment may send the read voltage threshold to the non volatile memory media with each read operation. In a further embodiment the persistence module is part of the non volatile memory media causing the non volatile memory media to retain adjustments to the read voltage thresholds that the adjustment module makes. The persistence module in one embodiment stores multiple read voltage thresholds each read voltage threshold for a different segment or grouping of storage cells of the non volatile memory media .

In one embodiment a manufacturer of the non volatile memory media provides a command or procedure to adjust a read voltage threshold for a predefined grouping of storage cells such as a chip physical erase block physical page or a die. In a further embodiment the persistence module stores read voltage thresholds for sub groupings of storage cells that are smaller than the predefined groupings of storage cells for which the adjustment module can make adjustments using the manufacturer provided command or procedure. The adjustment module may then in another embodiment readjust the read voltage threshold when a data set is read from a sub grouping based on the read voltage thresholds that the persistence module stores. Examples of sub groupings may include PEBs pages ECC chunks codewords or other physical or logical divisions of a grouping of storage cells.

For example in response to a read request for a data set from a first sub grouping of storage cells the adjustment module may adjust the read voltage threshold of the entire grouping of storage cells to a level that the persistence module stores for the first sub grouping. In response to a read request for a data set from a second sub grouping in one embodiment the adjustment module may readjust the read voltage threshold for the entire grouping to a level that the persistence module stores for the second sub grouping. This allows the configuration module to adjust the read voltage thresholds for the non volatile memory media at a finer scope than may be provided for in commands or procedures available for the non volatile memory media . For example a manufacturer may provide a command procedure or methodology for adjusting a read voltage threshold for a die chip or other grouping of storage cells and the adjustment module may adjust read voltage thresholds for individual PEBs or other sub groupings in accordance with that command procedure or methodology.

In one embodiment the configuration module processes the data set in response to an uncorrectable meaning herein uncorrectable by the ECC decoder as discussed herein a correction may be possible after an adjustment of the read voltage threshold data error as described above and adjusts the read voltage threshold one or more times until the data error is no longer uncorrectable and can be repaired using ECC checkbits for the data set. In one embodiment the ECC module cooperates with the ECC decoder to determine whether or not the ECC decoder can correct an error in the data set. Alternatively the configuration module cooperates with the ECC decoder to determine whether or not the ECC decoder can correct an error in the data set.

The configuration module in one embodiment repeats the processing steps described above until the ECC module determines that the ECC decoder can correct the error. For example in a further embodiment the data set read module the deviation module the direction module and the adjustment module may repeatedly read the data set determine that the read bias for the data set deviates from the known bias determine the direction of deviation for the data set and adjust the read voltage threshold as described above until the ECC module determines that the ECC decoder can correct the error.

As described in greater detail with regard to in one embodiment a data set may be stored across several die chips channels storage elements PEBs or other grouping of storage cells. ECC checkbits in one embodiment may be calculated and stored independently for each grouping of storage cells. In another embodiment the ECC checkbits stored together with each grouping of storage cells for example as part of an ECC chunk codeword.

In a further embodiment the ECC module uses ECC checkbits to determine in which die chip channel storage element PEB or other grouping of storage cells of the non volatile memory media an uncorrectable error has occurred. The ECC module in one embodiment verifies data sets of each grouping of storage cells using ECC checkbits to determine which particular grouping from a set of groupings of storage cells have uncorrectable errors. The configuration module in one embodiment adjusts one or more read voltage thresholds in the particular groupings of storage cells with an uncorrectable error.

In one embodiment the distribution module determines that the read bias of the data set is within an expected distribution of the known bias and that no additional adjustments of the read voltage threshold should be made. In a further embodiment the data set read module the deviation module the direction module and the adjustment module continue to re read the data set with a new read voltage threshold re determine that the read bias for the data set deviates from the known bias re determine the direction of deviation for the data set and readjust the read voltage threshold until the distribution module determines that the read bias of the data set is within the expected distribution.

The distribution module in one embodiment may cooperate with or be integrated with the deviation module . In one embodiment the configuration module uses either the ECC module or the distribution module to determine when adjustment of the read voltage threshold should be made or is complete. In a further embodiment the distribution module compares read biases of data sets from several die chips channels storage elements PEBs or other grouping of storage cells of the non volatile memory media to the distribution of the known bias to determine in which grouping of storage cells an error has occurred and the configuration module adjusts one or more read voltage thresholds in a grouping of storage cells with an error.

In one embodiment the ECC module and or the distribution module cooperate with the data set source module . The data set source module in one embodiment determines from which specific grouping of storage cells the data set was read. For example the data set source module may determine which die chip channel storage element PEB or other grouping of storage cells is the source of the data set. In one embodiment the data set source module determines from which specific grouping of storage cells the data was read in response to the deviation module the ECC module and or the distribution module determining that the data set has a read bias that deviates from a known bias has a data error or the like.

In one embodiment the data set source module determines from which specific grouping of storage cells the data set was read based on a position of the data set within a sequence of data sets. For example in one embodiment the non volatile memory media may comprise a plurality of groupings of storage cells and each grouping of storage cells may be read in parallel during a read operation. The data set source module in one embodiment may use known information about how the write data pipeline and or the read data pipeline processes data and known information about the plurality of groupings of storage cells to determine from which grouping of storage cells the data set was read.

For example in one embodiment the write data pipeline and the read data pipeline may each have a 64 bit 8 byte data path the non volatile memory media may comprise a 24 die wide array and 8 bytes may be read in parallel from each of the 24 die during a read operation for a total of 192 bytes per read operation. Based on this information the data set source module in one embodiment can determine from which die or other grouping of storage cells a data set was read based on the position of an 8 byte data set within the 192 bytes.

The data set source module in a further embodiment may count or otherwise track the number of data sets processed as part of a read operation to determine the position of the data set in the sequence of data sets. For example 8 bytes may be read in sequence from the 24 die starting with a first die thus if the ECC module and or the distribution module detects a read bias deviation or a data error during operations on the fifth 8 byte set of data the data set source module identifies that this 8 byte set of data came from the fifth die of the 24 die.

By using the position of the data set in a sequence of data sets and other known information the data set source module in one embodiment can determine the grouping of storage cells from which the data set was read without using an identifier or other external information. Identifying the die chip channel PEB or other grouping of storage cells that exhibit the read bias difference permits prompt remedial actions to be taken such as changing the read voltage threshold logical swapping of the grouping of storage cells with a reserved grouping and other forms of remedial action.

In one embodiment the proactive configuration module manages the non volatile memory media by proactively setting and adjusting configuration parameters for storage cells of the non volatile memory media . By determining configuration parameters proactively before an error occurs the proactive configuration module may prevent certain errors from occurring without the performance penalty of retrying reads or performing other remedial measures for the prevented errors. The proactive configuration module in certain embodiments optimizes configuration parameters for a use case of the non volatile memory device to optimize storage cells for the use case instead of using default parameters.

As described above a configuration parameter is a parameter of a set of storage cells that is modifiable by way of an interface such as a read threshold a write or program threshold an erase threshold or the like. An interface for modifying a configuration parameter may include a programmable data register a command interface of a control bus for the non volatile memory media an API of a device driver of the non volatile memory device a control parameter for the non volatile memory controller or the like.

The proactive configuration module references one or more media characteristics for a set of storage cells to determine a configuration parameter for the set of storage cells. A media characteristic is a statistic heuristic mathematical model transform or other descriptor associated with an attribute of the non volatile memory media . A media characteristic for a set of storage cells may be substantially static or may be dynamic and change over time.

A media characteristic in one embodiment includes or relates to a make a model a manufacturer a product version or the like for the non volatile memory device and or for the non volatile memory media . In another embodiment a media characteristic describes an attribute or statistic for a set of particular storage cells such as a program erase cycle count for the set of storage cells a read count for the set of storage cells a retention time since a previous write for the set of storage cells a dwell time for the set of storage cells such as a logical or physical erase block e.g. a time between a program of an erase block and an erase of the erase block an average of multiple previous dwell times for the set of storage cells an error statistic for the set of storage cells or the like. A media characteristic in a further embodiment may include or relate to an environmental condition or a use of the non volatile memory device and or of the non volatile memory media such as a temperature a use case e.g. a cache use case an archival use case a server use case an enterprise use case a consumer use case etc. or the like.

The proactive configuration module in response to determining a configuration parameter for a set of storage cells configures the set of storage cells to use the determined configuration parameter. The proactive configuration module may periodically update media characteristics for a set of storage cells update a configuration parameter for the set of storage cells and reconfigure the set of storage cells to use the updated configuration parameter. The proactive configuration module may configure storage cells with configuration parameters during execution of input output operations during a startup operation in response to a background scan of a set of storage cells indicating a changed media characteristic or the like.

In order to reduce the overhead associated with tracking configuration parameters for each storage cell each page each erase block or the like in one embodiment the proactive configuration module manages configuration parameters in groups or sets. For example the proactive configuration module may determine and manage configuration parameters for groups or sets of pages physical erase blocks logical erase blocks wordlines ECC chunks codewords chips die planes in a die or other storage regions. The proactive configuration module may group pages or other storage regions that have similar media characteristics such as similar error rates e.g. RBER UBER similar ages similar program erase counts similar physical media locations similar locations in a programming order similar architectures or the like and determine different configuration parameter settings for the different groups. For example the proactive configuration module in certain embodiments may group upper pages e.g. MSB pages lower pages e.g. LSB pages subsets of upper and or lower pages a set of the first N pages in a page programming order a set of the middle N pages in a page programming order a set of the last N pages in a page programming order and or other subsets of pages or other storage regions and may manage configuration parameter settings by group or set.

In certain embodiments the proactive configuration module configures storage cells independently of the adjustments described above with regard to the adjustment module . For example the proactive configuration module may be separate from the configuration module the proactive configuration module may be part of a storage controller without a configuration module or the like. In other embodiments the adjustment module and the proactive configuration module may cooperate. For example the adjustment module may make closed loop feedback based adjustments to one or more configuration parameters that the proactive configuration module has set using an open loop model or the like.

In one embodiment the write voltage module sets a write voltage level for writing data to the storage cells of the non volatile memory media . The write voltage level is a programming voltage that specifies the minimum or maximum voltage used to program or change a state of a storage cell a step magnitude for an incremental step pulse programming operation a maximum number of iterations for an incremental step pulse programming operation a program verify threshold for a program operation an initial bias for an incremental step pulse programming operation or the like. In one embodiment the write voltage module may be integrated with the configuration module and or the proactive configuration module .

For example for NAND flash non volatile memory the write voltage and or other program related configuration parameters changes the state of a storage cell from a binary one to a binary zero. The write voltage module in one embodiment writes known patterns to the storage cells then reads the pattern back determining the read voltage threshold and adjusts the write threshold until the desired read threshold is met. The write voltage module in a further embodiment adjusts the write voltage level based on a mathematical model that specifies write voltage level values based on endurance and data retention requirements of a storage cell relative to an age of the storage cell. In one embodiment the age of the storage cell is computed in terms of program and erase cycles. The write voltage module in one embodiment performs a test write to one or more storage cells detects the read voltage of at least one of the storage cells and adjusts the write voltage level until the read voltage meets a threshold value. The write voltage module in a further embodiment performs the test write by writing a data set with a known bias to the storage cells and tests the read voltage by determining if a read bias of the read data set deviates from the known bias.

The write voltage module in one embodiment may begin with a minimum write voltage and increase the write voltage until the read voltage meets a threshold value. In a further embodiment the write voltage module may begin with a maximum write voltage and decrease the write voltage until the read voltage meets a threshold value. The write voltage module in one embodiment may select a write voltage level that balances the time to program the storage cells with a desired endurance and or data retention for the storage cells.

In one embodiment the media characteristic module references or otherwise determines one or more media characteristics for a set of storage cells of the non volatile memory media for abodes or storage states of a set of storage cells of the non volatile memory media or the like. The set of storage cells may comprise a single storage region such as a physical page a logical page a physical erase block a logical erase block a wordline an ECC chunk codeword a chip a die a plane in a die or the like or may comprise a set of multiple storage regions. In certain embodiments different storage states abodes encoding digits e.g. LSB MSB of the storage cells of the non volatile memory media as described in greater detail below with regard to may have different media characteristics and the media characteristic module may monitor or otherwise determine the different media characteristics separately for different abodes storage states or the like.

The media characteristic module may determine one or more media characteristics itself may receive media characteristics from another module may retrieve media characteristics from a media characteristic repository or the like. As described above a media characteristic is a statistic heuristic or other descriptor associated with an attribute of the non volatile memory media . Media characteristics may include and or relate to a make a model a manufacturer a product version or the like for the non volatile memory device and or for the non volatile memory media an attribute or statistic for a set of storage cells an environmental condition or a use case of the non volatile memory device and or of the non volatile memory media and or another statistic heuristic or other descriptor for an attribute of the non volatile memory media .

A media characteristic for a set of storage cells affects or informs the determination of a configuration parameter for the set of storage cells. In one embodiment the media characteristics include a program erase cycle count for a set of storage cells. In another embodiment the media characteristics include a read count for a set of storage cells. The media characteristics in a further embodiment include a retention time since a previous write for a set of storage cells. In an additional embodiment the media characteristics include a temperature for a set of storage cells. The media characteristics in certain embodiments include a use case for a set of storage cells. In another embodiment the media characteristics include an error statistic for a set of storage cells such as an UBER a RBER or the like. In a further embodiment the media characteristic may include previous or historical configuration parameters for a set of storage cells configuration parameters or media characteristics for other sets of storage cells or the like.

The media characteristic module in certain embodiments manages the collection of and or maintenance of media characteristics. The media characteristic module may maintain media characteristics in and or retrieve media characteristics from a media characteristic repository. One example of a media characteristic repository is described in greater detail below with regard to . The media characteristic module in certain embodiments references determines and or manages media characteristics for several different sets of storage cells such as each storage region or storage division of the non volatile memory device . A media region may include an erase block logical or physical a page logical or physical an ECC chunk codeword a division within a page a set of pages a die a plane in a die a chip or the like.

In one embodiment the media characteristic module may be similar to may work with and or may be integrated with the device factor module described above with regard to . For example the media characteristics may include one or more of the statistics described above with regard to the device factor module such as a temperature for the non volatile memory device an error rate for the non volatile memory device such as an UBER RBER or the like a program erase cycle count for the non volatile memory device a storage request latency for the non volatile memory device such as an average maximum or other storage request execution latency an age of the non volatile memory device and or other statistics or characteristics. The media characteristic module in certain embodiments may receive input directly or indirectly from the one or more sensors from other modules or elements such as the ECC decoder or the like.

In one embodiment the configuration parameter module determines a configuration parameter for a set of storage cells based on one or more media characteristics from the media characteristic module for the set of storage cells. The set of storage cells for which the configuration parameter module determines the configuration parameter may include an erase block logical or physical a page logical or physical an ECC chunk codeword a division within a page a set of pages a die a plane in a die a chip or the like. The configuration parameter module may determine different configuration parameters for different sets of storage cells different sets of pages different abodes storage states of storage cells or the like based on the corresponding media characteristics. The configuration parameter module in certain embodiments determines configuration parameters dynamically during operation or runtime of the non volatile memory device as adjustments or updates to initial or default settings.

As described above a configuration parameter is a parameter of a set of storage cells that is modifiable by way of an interface. Configuration parameters may relate to writing to or programming storage cells reading from storage cells erasing storage cells and or to another parameter for storage cells. The configuration parameter module may determine a configuration parameter as an absolute data value as an offset or adjustment to a data value or as another parameter with which the cell configuration module can configure a set of storage cells as described below.

One embodiment of a configuration parameter for reading from storage cells is a read threshold such as a read voltage threshold a resistivity threshold or the like. Other embodiments of configuration parameters for reading from storage cells may include whether to perform a read retry in response to an error whether to adjust a read threshold or other configuration parameter prior to a read retry or the like. For example the configuration parameter module may determine a number of read retries to perform a maximum number of read retries configuration parameters for each read retry or the like based on discovered or monitored media characteristics media characteristics from a vendor or manufacturer or the like.

Various embodiments of configuration parameters for writing programming storage cells include a step magnitude for an incremental step pulse programming operation a maximum number of iterations for an incremental step pulse programming operation a program verify threshold for a program operation an initial bias for an incremental step pulse programming operation a duration for an incremental step pulse programming operation or the like. A configuration parameter for erasing storage cells in certain embodiments may include a step magnitude for an incremental step pulse erase operation a maximum number of iterations for an incremental step pulse erase operation an erase verify threshold for an erase operation an initial bias for an incremental step pulse erase operation a duration for an incremental step pulse programming operation or the like. One of skill in the art in light of this specification will recognize other configuration parameters for storage cells that may be modifiable by way of an interface.

A configuration parameter for managing reading from writing programming to and or erasing storage cells as described above may generally be referred to as a storage threshold for the storage cells. For example a storage threshold in various embodiments may include a read voltage threshold a resistivity threshold a number of read retries to perform a maximum number of read retries a step magnitude for an incremental step pulse programming operation a maximum number of iterations for an incremental step pulse programming operation a program verify threshold for a program operation an initial bias for an incremental step pulse programming operation a duration for an incremental step pulse programming operation a step magnitude for an incremental step pulse erase operation a maximum number of iterations for an incremental step pulse erase operation an erase verify threshold for an erase operation an initial bias for an incremental step pulse erase operation a duration for an incremental step pulse programming operation or another storage threshold.

The configuration parameter module may base a configuration parameter on one or more media characteristics by entering the one or more media characteristics into an equation into a mathematical model into a lookup table LUT into a matrix or the like by performing a predefined transform or operation on the one or more media characteristics or by otherwise referencing and or manipulating the one or more media characteristics to determine the configuration parameter. A configuration parameter equation mathematical model LUT matrix or the like may be based on empirical data such as test data historical data and the like. A design engineer or the like in one embodiment may test sets of storage cells with various media characteristics such as non volatile memory media from various manufacturers or the like and determine optimal configuration parameters for storage cells with the various media characteristics. For example an equation mathematical model LUT matrix or the like may indicate that non volatile memory media from manufacturer X tends to have Y amount of natural drift in cell values after 1 000 program erase cycles such that a read threshold can be increased by Z volts to compensate or the like.

In other embodiments the configuration parameter module may dynamically determine a configuration parameter an equation mathematical model LUT matrix transform or the like to define a configuration parameter an adjustment to a configuration parameter or the like during operation of the non volatile memory device as described above with regard to the adjustment module . For example the configuration parameter module may determine configuration parameters for various media characteristics initially based on trial and error based on a direction from the direction module or the like and may autonomously correlate the effectiveness of the configuration parameter based on a change in an error rate such as RBER UBER or the like to determine an equation mathematical model LUT matrix transform or the like for determining subsequent configuration parameters and or configuration parameter adjustments.

In one embodiment the media characteristics for a set of storage cells include a temperature. A temperature for a set of storage cells may affect the speed of the effects of one or more other media characteristics on the set of storage cells. For example at higher temperatures the rate of change for media characteristics relating to error statistic such as Raw Bit Error Rates RBER and data retention times may increase and certain adjustments to configuration parameters may mitigate the effect. In certain embodiments the configuration parameter module may adjust or scale a configuration parameter a media characteristic or the like by a temperature to compensate for the effects of temperature normalizing the data for temperature. The temperature for a set of storage cells may be an average temperature a temperature over a sliding window a current temperature a temperature for the non volatile memory device or another temperature measurement associated with one or more sets of storage cells.

The one or more media characteristics in one embodiment indicate to the configuration parameter module a trend an optimization or the like for a configuration parameter and the configuration parameter module determines a configuration parameter to satisfy the trend or optimization. For example a magnitude of a program erase cycle count a read count a UBER a RBER or another media characteristic may indicate an amount that a read voltage or other configuration parameter has drifted and the configuration parameter module may proactively determine a read voltage threshold or other configuration parameter based on the media characteristic without direct feedback from the storage cells such as a read a read retry or the like.

In one embodiment the configuration parameter module maintains configuration parameters for sets of storage cells of different storage regions or storage divisions of the non volatile memory media such as an erase block logical or physical a page logical or physical an ECC chunk codeword a division within a page a set of pages an abode storage state a die a plane in a die a chip or the like in a configuration parameter repository. One example of a configuration parameter repository is described in greater detail below with regard to . By determining and managing separate media characteristics and or configuration parameters for different storage regions for different abodes storage states or the like the proactive configuration module in certain embodiments may customize configuration parameters for each storage region or abode storage state individually thereby reducing errors extending the lifetime of the non volatile memory media or the like.

Different abodes storage states of storage cells may have different media characteristics. For example certain abodes storage states such as the L0 state described below with regard to may be more prone to program read or other disturbances. An abode or storage state as used herein is the range of read levels such as a read voltage level for flash media a read resistivity level for PCM media or the like associated with a particular set of data values. Read thresholds such as a read voltage threshold a read resistivity threshold or the like may separate abodes or storage states. One example of abodes or storage states is described below with regard to where abode L0 corresponds to data values 11 L1 corresponds to 01 L2 corresponds to 00 and L3 corresponds to 10 and abodes L0 L1 L2 and L3 are divided by read voltage thresholds in and by adjusted read voltage thresholds in .

For a given storage cell or set of storage cells in one embodiment the configuration parameter module may determine and manage multiple configuration parameters. In certain embodiments the configuration parameter module may individually determine and manage different settings or adjustments for configuration parameters for each storage state or abode of storage cells of the non volatile memory media . For example the configuration parameter module may determine different read voltage threshold settings for abodes storage states L0 L1 L2 and L3 as described below with regard to may determine different settings or adjustments for read level R1 read level R2 and read level R3 for storage cells as described below with regard to may determine an incremental step pulse programming parameter for a programming operation as described above may determine an incremental step pulse erase parameter for an erase operation as described above or the like. In this manner the configuration parameter module may optimize configuration parameter settings individually for different abodes storage states.

In certain embodiments to reduce the overhead of tracking media characteristics and or configuration parameters at a fine grain such as for each storage cell each page each erase block or the like the configuration parameter module may determine select or otherwise manage configuration parameters in groups or sets. For example the configuration parameter module may determine and manage configuration parameters for groups or sets of pages physical erase blocks logical erase blocks wordlines ECC chunks codewords chips die planes in a die or other storage regions. The configuration parameter module may group pages or other storage regions that have similar media characteristics such as similar error rates e.g. RBER UBER similar ages similar program erase counts similar physical media locations similar architectures or the like and determine different configuration parameter settings for the different groups or sets.

For example in one embodiment even and odd pages may have different error rates such as RBERs UBERs or the like and the configuration parameter module may determine a first configuration parameter for a set of even pages and a second configuration parameter for a set of odd pages. In another embodiment upper and lower pages of multi level storage cells may have different error rates such as RBERs UBERs or the like and the configuration parameter module may determine a first configuration parameter for a set of lower pages and a second configuration parameter for a set of upper pages. In a further embodiment one or more pages toward a first end of the upper pages and one or more pages toward a second end of the upper pages may have higher error rates such as RBERs UBERs or the like than the other upper pages and the configuration parameter module may determine a third configuration parameter for a set including the one or more pages toward the first end and the one or more pages toward the second end.

In general pages or storage regions may be divided into groups or sets with similar media characteristics such as error rates ages program erase counts physical media locations architectures or the like and the configuration parameter module may determine different configuration parameters for the different groups or sets. The configuration parameter module in certain embodiments may base a configuration parameter for a set of pages or other storage regions on an average media characteristic for the set such as a mean median mode or the like. Examples of sets of pages grouped by error rate are described below with regard to . Even when managing or determining configuration parameters by sets groups or storage regions in certain embodiments the configuration parameter module may also determine different configuration parameters for different abodes storage states of the storage cells within the sets groups or storage regions.

For example the configuration parameter module may determine settings for the R1 R2 and R3 read voltage thresholds for a first set of pages and may determine different settings for the R1 R2 and R3 read voltage thresholds for a second set of pages as described below with regard to . In one embodiment storage cells may be in more than one set of pages such as a set of upper pages and a set of lower pages or the like and the configuration parameter module may determine different configuration parameters for the same storage cells depending on which page is being accessed or used. While the three read voltage thresholds R1 R2 R3 of are provided as one example embodiment in other embodiments storage cells may have different numbers of storage states abodes read voltage thresholds or other configuration parameters. For example in one embodiment certain 20 nm non volatile memory media may have ten different read voltage thresholds R1 R10 set using different registers or the like and the configuration parameter module may determine different values for R1 R10 for different sets groups storage regions and or different abodes storage states.

In certain embodiments the configuration parameter module may determine a configuration parameter for one set of storage cells based on another target set of storage cells. The target set of storage cells may have known and or controlled use characteristics e.g. media characteristics or the like that the configuration parameter module uses to determine a configuration parameter for another set of storage cells. In particular the configuration parameter module may compare media characteristics of the target set of storage cells to media characteristics of a set of storage cells presently being configured. Such a comparison can be used to further optimize the determined configuration parameter for the set of storage cells. The target set of storage cells may store known data such as metadata system data a known pattern of data or the like and the configuration parameter module may determine a configuration parameter for another set of data based on the known data.

In another embodiment the configuration parameter module determines a configuration parameter for a set of storage cells based on a determined configuration parameter for a target set of storage cells based on one or more media characteristics for a target set of storage cells or the like. For example the configuration parameter module may use a configuration parameter for a target set of storage cells as a configuration parameter for another set of storage cells may adjust a configuration parameter of a target set of storage cells for use in determining the configuration parameter for another set of storage cells may use media characteristics for a target set of storage cells to determine a configuration parameter for another set of storage cells or the like. In this manner the target set of storage cells serves as a control group for use in managing other sets of storage cells. The target set of storage cells may be used in certain embodiments in a manner analogous to how system tracks have been used in hard disk drive technologies to make modifications to configuration parameters over the life of the storage device . In a further embodiment the configuration parameter module compares one or more media characteristics for a set of storage cells to one or more media characteristics for a target set of storage cells and determines a configuration parameter for the set of storage cells based on a difference between the media characteristics.

The configuration parameter module in certain embodiments bases a configuration parameter for a set of storage cells on a target set of storage cells to bootstrap the configuration parameter in response to a lack of known media characteristics for the set of storage cells. The configuration parameter module may bootstrap a configuration parameter for a set of storage cells during a startup operation or another operation where media characteristics for the set of storage cells may not yet be available but media characteristics or other data may be available for a target set of storage cells. For example metadata stored in a metadata region of the non volatile memory media may have a known or controlled program erase count and the configuration parameter module may base a configuration parameter for a region of the non volatile memory media storing user data on the known or controlled program erase count for the metadata region.

In one embodiment the cell configuration module configures a set of storage cells to use a configuration parameter that the configuration parameter module determines for the set of storage cells. As described above a set of storage cells may include groups or sets of pages physical erase blocks logical erase blocks wordlines ECC chunks codewords chips die planes in a die or other storage regions including one or more storage cells. The storage cell configuration module may configure different sets of storage cells different sets of pages different storage states or abodes of storage cells or the like to use different configuration parameters as determined by the configuration parameter module . The cell configuration module in one embodiment configures storage cells to use a configuration parameter such that the configuration parameter is used for subsequent accesses to and or operations on the storage cells.

The cell configuration module uses an interface of a set of storage cells to configure the set of storage cells. The interface may comprise a publicly known interface or a proprietary interface. The configuration module may configure a set of storage cells by setting a data register by sending a command over a command interface of a control bus for the non volatile memory media by calling an API of a device driver of the non volatile memory device by setting a control parameter for the non volatile memory controller or otherwise configuring the set of storage cells. The cell configuration module may use particular command instructions a particular sequence of command instructions and or use particular parameters register settings or other differences from regular commands general purpose commands used to interface with the set of storage cells. The cell configuration module may receive configuration parameters from the configuration parameter module may retrieve configuration parameters from a configuration parameter repository or the like.

The cell configuration module in one embodiment configures a set of storage cells to use a determined configuration parameter in response to a trigger. The trigger in certain embodiments is selected based on an architecture of the non volatile memory device and or of the non volatile memory media . For example certain non volatile memory devices and or non volatile memory media may retain a configuration parameter across multiple input output operations while another non volatile memory device and or non volatile memory media may require a configuration parameter to be set with each input output operation or the like. The cell configuration module may configure a set of storage cells once during initialization of the non volatile memory media dynamically with each command issued to the set of storage cells during operation of the non volatile memory media in response to events or time intervals in response to another trigger or the like.

In one embodiment a trigger for the cell configuration module includes a change in a media characteristic for a set of storage cells a change of a predefined magnitude in a media characteristic for the set of storage cells or the like and the cell configuration module configures the set of storage cells in response to a change in the media characteristics. In another embodiment a trigger for the cell configuration module includes an input output request for a set of storage cells such as a read request a write request an erase request or the like. For example in certain embodiments the cell configuration module may configure a set of storage cells to use a read configuration parameter in response to a read request for the storage cells may configure a set of storage cells to use a write configuration parameter in response to a write request for the storage cells may configure a set of storage cells to use an erase configuration parameter in response to an erase request or the like.

In a further embodiment a startup operation for the non volatile memory device a regular shutdown operation for the non volatile memory device or the like is a trigger for the cell configuration module to configure one or more sets of storage cells. In certain embodiments once the cell configuration module configures a set of storage cells with a configuration parameter in response to a startup operation the set of storage cells retain the configuration parameter until a shutdown operation and a subsequent startup operation or the like. How a set of storage cells retain configuration parameters may vary depending on the type of configuration parameter the architecture of the set of storage cells and the like.

The cell configuration module in a further embodiment may configure only a subset of one or more abodes storage states of a set of storage cells to use a configuration parameter. For example if a configuration parameter setting for an abode storage state has little or no change from a previous configuration parameter setting from a default configuration parameter setting or the like the cell configuration module may configure one or more other abodes storage states without configuring the abode storage state with little or no change in the configuration parameter setting. In certain embodiments configuration settings for different abodes storage states of a set of storage cells may be set by writing the settings to different registers associated with the different abodes storage states and the cell configuration module may write configuration settings such as read voltage thresholds or the like only to registers for which the configuration settings have changed. In other embodiments the cell configuration module may set configuration settings for each abode storage state of a set of storage cells in response to each storage request or other trigger event.

The cell configuration module may configure storage cells a storage region at a time writing configuration parameter settings to registers for a group or set of pages a physical erase block a logical erase block a wordline an ECC chunk codeword a chip a die a plane in a die or another storage region. In certain embodiments the cell configuration module may configure storage cells by storing configuration parameter settings in a bank cache such as a buffer or the like for the non volatile memory media . In a further embodiment the cell configuration module may configure storage cells using a configuration parameter override table or other override metadata configured scaled or otherwise structured according to an architecture of the non volatile memory media .

In one embodiment the characteristic update module updates one or more media characteristics for a set of storage cells in response to an update event for the set of storage cells. An update event is a trigger in response to which the characteristic update module updates media characteristics. Certain media characteristics such as a make a model a manufacturer a product version or the like of the non volatile memory device and or the non volatile memory media may be substantially static and the characteristic update module in certain embodiments may not update such media characteristics may update such media characteristics less frequently or the like. Other media characteristics such as a program erase cycle counts read counts retention times temperatures use cases error statistics and the like may be dynamic and change frequently.

In one embodiment a background scan of the non volatile memory media may be an update event. For example the characteristic update module may perform a background scan of the non volatile memory media and update records of media characteristics for sets of storage cells in response to scanning the sets of storage cells during the background scan. A background scan in certain embodiments may be informed by or optimized based on media characteristics of the non volatile memory media may be configured to determine media characteristics per abode storage state or the like.

In another embodiment an input output request for the set of storage cells or for a neighboring set of storage cells such as a read request a write request an erase request or the like is an update event and the characteristic update module updates media characteristics for a set of storage cells in response to the input output request. An update event for the characteristic update module in a further embodiment may include a startup operation and or shutdown operation for the non volatile memory device . In certain embodiments a garbage collection operation for a set of storage cells is an update event. For example the characteristic update module may update media characteristics for a set of storage cells as a garbage collection operation recovers storage capacity of the set of storage cells or the like.

The characteristic update module in one embodiment updates media characteristics in cooperation with the media characteristic module using the media characteristic module or the like. In certain embodiments the characteristic update module may update media characteristics stored in a media characteristic repository as described in greater detail below with regard to .

In one embodiment the configuration update module updates a configuration parameter for a set of storage cells. The configuration update module in certain embodiments updates a configuration parameter in response to a change in one or more media characteristics corresponding to the configuration parameter. The characteristic update module may notify the configuration update module that the characteristic update module has updated a media characteristic the configuration update module may periodically scan media characteristics for changes the configuration update module may check media characteristics for changes in response to a configuration trigger for a set of storage cells or the like.

In certain embodiments the configuration update module updates a configuration parameter in response to a change in a media characteristic that is greater than a predefined change threshold. The configuration update module in one embodiment updates configuration parameters in cooperation with the configuration parameter module using the configuration parameter module or the like. The configuration update module in another embodiment may update configuration parameters stored in a configuration parameter repository as described in greater detail below with regard to .

In one embodiment the adaptive configuration module dynamically adjusts and adapts one or more configuration parameters thresholds management techniques or the like for the non volatile memory device and or for the non volatile memory media . In certain embodiments the adaptive configuration module may adjust or adapt as the non volatile memory device ages as a use case for the non volatile memory device changes or the like. Examples of use cases may include a cache use case an archival use case a server use case an enterprise use case a consumer use case or the like.

The adaptive configuration module in one embodiment bases adjustments or adaptations on a priori knowledge for the non volatile memory device collected run time statistics for the non volatile memory device media characteristics for storage cells of the non volatile memory device or the like. Unlike magnetic storage media attributes for non volatile memory typically vary over a storage device s useful life. For example storage regions of the non volatile memory media may be periodically processed for storage capacity recovery or garbage collection to manage the impact of read disturbs and to ensure reliable data retention.

In non volatile memory media an effect called read disturb can occur in unselected storage cells when adjacent storage cells are selected and read causing charge to collect on the floating gates of the unselected storage cells making the unselected storage cells have an increased voltage that has not been deliberately applied. One approach to combating the effects of read disturb is to move valid data out of the disturbed cells while the values in those cells are still determinable. The valid data may be re written to a new physical location and the disturbed cells are erased to remove the effects of the read disturb. This approach is called a refresh and the time between refresh operations is referred to as a data refresh interval. A read disturb threshold is a number of reads of neighboring cells before remedial action is needed to mitigate the effects of read disturb. A data refresh interval at which storage regions are processed for storage capacity recovery and or data refresh that is appropriate for a non volatile memory device near an end of life may be too aggressive for a non volatile memory device at the beginning of use.

The adaptive configuration module in various embodiments may dynamically adjust or adapt a data refresh interval based on an age in absolute time in powered on time in an amount of user data written or the like of the non volatile memory device a read disturb threshold e.g. a number of read operations before data is refreshed to mitigate effects of read disturb based on wear of the non volatile memory device an erase block retirement policy based on an age of the non volatile memory device a garbage collection method for the non volatile memory device based on host workload garbage collection by zone of the non volatile memory device based on levels of extent activity to minimize stir between active and inactive data scrubbing intervals to increase scrubbing as the non volatile memory device ages or the like.

In one embodiment the adjustment threshold module cooperates with the configuration parameter module and or the cell configuration module to use a current configuration parameter setting for a set of storage cells in response to a target configuration parameter setting that the configuration parameter module determines for the set of storage cells being within a threshold range of the current configuration parameter setting. For example if a target configuration parameter such as a read voltage threshold is within a predefined range of a current setting for the configuration parameter the adjustment threshold module may determine not to adjust the configuration parameter to the target but to use the current setting e.g. a no op or gimme . In certain embodiments based on differences between target settings and current settings for a set of configuration parameters the cell configuration module may set one or more configuration parameters to their target settings while leaving one or more other configuration parameters at their current settings. For example the adjustment threshold module may determine that the cell configuration module sets one or two read voltage thresholds for a read operation without setting the other read voltage thresholds for the particular read operation because the target settings for the other read voltage thresholds may be within a threshold range of the current settings or the like.

The threshold range for the adjustment threshold module may be selected such that errors caused by the difference between the target setting and the current setting are minimal are correctable or the like. Configuring a set of storage cells to use a new configuration parameter setting in certain embodiments may incur overhead increase latency of a storage operation or the like. Continuing to use a current configuration parameter setting without reconfiguring the set of storage cells when a target setting is close to the current setting e.g. within a threshold range may remove the overhead or latency thereby reducing a performance or latency impact of managing and adjusting configuration parameters.

The adjustment threshold module in certain embodiments may use different threshold ranges for different sets of pages different abodes storage states or the like customizing the threshold ranges. In one embodiment the configuration parameter module may determine a threshold range for the adjustment threshold module as a configuration parameter based on one or more media characteristics or the like. For example a set of storage cells abode or the like that is more prone to errors leakage interference with a higher RBER or the like may have a smaller narrower threshold range for adjustments than a set of storage cells abode or the like that is less prone to errors leakage interference with a lower RBER or the like. In certain embodiments the configuration parameter module and or the cell configuration module may override a threshold range of the adjustment threshold module based on a storage media characteristic a background scan or the like.

In one embodiment the sparse adjustment module cooperates with the configuration parameter module the cell configuration module and or the adaptive configuration module to use a default configuration parameter setting for a set of storage cells until the non volatile memory media and or the set of storage cells satisfy an age threshold. The default configuration parameter setting may include an initial setting a previous setting a current setting a manufacturer recommended setting or other default setting. The age threshold may be a predetermined program erase count a predetermined error rate a predetermined temporal age a predetermined powered on time or the like for the non volatile memory device the non volatile memory media and or the set of storage cells.

The age threshold in one embodiment may be selected such that errors that occur prior to the age threshold being reached are minimal correctable using ECC data or the like. For example in certain embodiments the age threshold may be selected based on a number of bit errors that the ECC module is configured to correct so that the cell configuration module does not adjust or reconfigure one or more configuration parameters during a period when an ECC of the ECC module is sufficient to correct errors that are likely to occur. The configuration parameter module in a further embodiment may determine different age thresholds for different storage regions sets of pages abodes or the like. In certain embodiments the likelihood of errors read disturb voltage drift and the like increases as the non volatile memory media ages. By using a default configuration parameter until the age threshold is satisfied instead of reconfiguring storage cells with new adjusted configuration parameter settings the sparse adjustment module may remove or minimize the overhead and latency associated with reconfiguring the storage cells while errors are typically infrequent and correctable.

In one embodiment the backstop module in cooperation with the adaptive configuration module or the like increases a frequency of storage capacity recovery operations such as garbage collection or grooming for at least a subset of the non volatile memory media over time. For example the backstop module may decrease the data refresh interval over time to combat the effects of read disturb as described above with regard to the adaptive configuration module . In one embodiment the configuration parameter module may determine a data refresh interval for a set of storage cells as a configuration parameter based on media characteristics for the set of storage cells such that different sets of storage cells have different storage capacity recovery frequencies.

In this manner in certain embodiments the backstop module may provide variable grooming garbage collection or other storage capacity recovery thresholds or frequencies overtime as the non volatile memory media ages. In one embodiment the backstop module may manage a single frequency of storage capacity recovery operations for the entire non volatile memory device . In a further embodiment the backstop module may manage frequencies of storage capacity recovery operations individually for logical or physical erase blocks of the non volatile memory media . The backstop module in another embodiment may manage frequencies of storage capacity recovery operations by group or set of logical or physical erase blocks of the non volatile memory media .

Increasing the frequency of storage capacity recovery operations in certain embodiments ensures that configuration parameter settings for storage cells of the non volatile memory media are not adjusted beyond a backstop value. For example in some embodiments the non volatile memory media may become more susceptible to the effects of read disturb over time in some cases by a factor of ten or more. Instead of adjusting a configuration parameter such as a read voltage threshold further and further over time to compensate for the increasing effects of read disturb by increasing the frequency of storage capacity recovery options the backstop module places a backstop value or cap on the configuration parameter adjustments used. Providing a backstop value or cap in certain embodiments may decrease bit errors make data storage more reliable or the like.

The array of storage elements in one embodiment includes N number of storage elements . . . . Each storage element may comprise a device a chip a portion of a chip a die a plane in a die or the like. In the depicted embodiment the storage elements form a bank . The array in one embodiment includes several banks . . . . The banks in the depicted embodiment include several channels . . . . In one embodiment a packet or data set is written across the several channels and data is read separately from each channel and reassembled into the packet. In another embodiment an ECC chunk packet or data set is written across the several channels and data is read in parallel from all the channels . One read operation on a bank may read a whole ECC chunk packet or data set or a portion of an ECC chunk packet or data set that is reassembled into a whole ECC chunk packet or data set. In the depicted embodiment each channel includes at least one storage element in each bank .

Furthermore in one embodiment each storage element includes a physical erase block or PEB . For example storage element one includes PEB one . A physical erase block is typically an erase block located on one die chip or other storage element . Each PEB includes m physical pages . For example PEB one includes page 0 . . . page m PEB 2 includes page 0 . . . page m PEB 3 includes page 0 . . . page m and PEB m includes page 0 . . . page m . Each physical page stores a portion of data D 0 D 1 . . . D m and ECC checkbits distributed with the data .

In one embodiment a group of PEBs PEB 1 PEB m forms a logical erase block LEB . An LEB may span the array of N storage elements . In certain embodiments an LEB is sized to fit within a bank with one PEB from each storage element or the like. In other embodiments a LEB may span different banks and may include one or more PEBs from multiple banks . Furthermore in an embodiment a logical page LP spans a plurality of physical pages in a row. In another embodiment a logical page spans N storage elements 

In one embodiment the ECC is a block code that is distributed with the data. Furthermore the data and the ECC may not align with any particular physical hardware boundary. As a result error correction with the ECC codes is not dependent on a particular hardware configuration. Therefore the ECC and corresponding data may form an ECC chunk and the ECC chunk may be divided and stored on one or more of the N storage elements . An ECC chunk typically spans at least a portion of a plurality of physical pages of a logical page where the data and ECC generated from the data . . . are spread across the N storage elements . In one embodiment a LP includes a plurality of ECC chunks . A physical page may contain one or more data bytes of the ECC chunk . An ECC chunk may span multiple rows within a physical page and a physical page may include a plurality of ECC chunks .

Because in the depicted embodiment the ECC checkbits for the ECC chunk are distributed across several storage elements and channels when a data error occurs due to a read voltage shift in one or more of the storage elements the ECC module may not be able to determine which storage elements have an error that is correctable by adjusting the read voltage threshold. In one embodiment the distribution module determines which storage elements or channels have data with a read bias that is outside an expected distribution of the known bias and the configuration module adjusts the read voltage thresholds of the storage elements determined by the distribution module .

In one embodiment the deviation module the ECC module and or the distribution module determines that a data set has an error or a read bias that deviates from the known bias and the data set source module determines from which storage element the data set was read. For example in one embodiment the array may have 24 channels and 8 bytes may be read in parallel from 24 storage elements of a single bank during a read operation for a total of 192 bytes per read operation. Based on this information the data set source module in one embodiment can determine from which storage element a data set was read based on the position of an 8 byte data set within the 192 bytes. In one embodiment the 192 bytes comprise the ECC chunk .

By comparing read biases of data from each of the channels to the known bias the configuration module can correct data errors that occur due to changes in read voltages for particular channel s even without the use of ECC checkbits. Without comparing the read biases of data from the channels to the known bias adjustment of the read voltage thresholds would require a large number of trial and error tests adjusting and testing every possible read voltage threshold adjustment for each possible combination of channels . By comparing the read biases of data from the channels to the known bias the configuration module can determine exactly which channel to adjust. By determining the direction of deviation for those channels the configuration module further decreases the search space for the read voltage thresholds for those channels by half.

To illustrate the potential size of the search space for a suitable adjusted read voltage threshold suppose an ECC chunk e.g. ECC code word comprising both data and the corresponding ECC checkbits is stored on the storage elements . Further suppose that the storage elements in a row of the array that stores the ECC chunk each have an independent adjustable read voltage threshold. For example in one embodiment the number of different combinations of read voltage threshold settings for the array with channels number of levels at which the read voltage threshold can be set per channel and x number of channels that have a read voltage threshold that needs to be adjusted is given by equation 1 

The number of different combinations of read voltage threshold settings for the array with all permutations of up to channels in one embodiment is given by equation 2 2 

Using equation 1 for example if there are twenty four channels 24 eight possible read voltage threshold settings for each channel 8 and only two of the twenty four channels have read voltage thresholds that need to be adjusted x 2 there are 17 644 total different combinations of read voltage threshold settings. If the number of channels with read voltage thresholds that need adjusting increases to three the number of different combinations increases to 1 036 288. The configuration module drastically reduces these numbers by detecting which channels have read voltage thresholds that need adjusting. In addition comparing the known bias of the data on the media in a storage grouping to the current bias indicates the direction to adjust the read voltage thresholds. Knowing the direction in which to adjust the read voltage threshold greatly reduces the search space for a suitable voltage in the channels known to have a data error.

Consequently the number of combinations that may need to be attempted changes from 17 644 where x 2 to 32 and from 1 036 288 where x 3 to 256 because the configuration module uses the known bias to determine which channels have read voltage thresholds that need adjusting and the direction of the adjustment. However each of these combinations may not need to be tried because as the adjustments are iteratively made the known bias of the data continues to indicate which direction to make each subsequent adjustment potentially cutting the search space at least in half with each iteration. Various search algorithms can be used to quickly identify a suitable adjusted read voltage threshold. e.g. a binary search .

The non volatile memory controller interprets the four discrete levels of voltage stored in the multi level storage cell as representing two binary bits one represented by a most significant bit MSB in the cell encoding and one represented by a least significant bit LSB in the cell encoding. As explained above other programming and encoding models may be used. Also certain non volatile memory media may have more than four possible states allowing more than two binary values to be stored in a single multi level storage cell. The voltage levels L0 L1 L2 and L3 may or may not be contiguous for example in certain embodiments the voltage levels are separated by band gaps known as guard band. For example L0 and L1 may be separated by 0.3V.

In one embodiment the LSB corresponds to a lower page of data and the MSB corresponds to an upper page of data. In certain embodiments the multi level storage cell may adhere to a two phase programming model described below which requires that the LSB be written to before the MSB can be written or vice versa. In another embodiment the LSB and MSB may be programmed separately by the non volatile memory controller . Such an approach may be taken due to vendor or manufacturer requirements for page pairing e.g. a LSB bit of MLC cell is paired with an MSB bit of a different MLC cell and page addressing e.g. LSB page must be programmed before the MSB page or vice versa . In certain instances the LSB must be written before the MSB is written the MSB must be written before the LSB is written or the like.

In certain embodiments the non volatile memory media may employ a two phase programming model. In such a model a binary value is first written to the LSB by way of a first write command to the lower page. The write command causes the multi level storage cell to move from its initial state for example a 11 state in L0 to an intermediate state the lower to middle LM state between L1 and L2 configured such that a 00 state is subsequently read. For example writing a 0 to the lower page causes the multi level storage cell to change from the L0 state where both the LSB and the MSB are 1 to the L2 state where the LSB is changed to a 0 . A subsequent write of a 0 to the upper page moves the multi level storage cell from the intermediate state typically between the L1 state and the L2 state to L2 state such that both bits of the MLC are 0 . Thus in such an embodiment two writes one to the lower page and one to the upper page are needed to move the multi level cell from L0 to L2 since the cell transitions through the intermediate state and the MLC device requires that the lower page be programmed before the upper page and does not allow partial programming of a page without an intervening erase operation. Writing a 1 to either of the upper page or lower page will cause the MLC to transition to either L1 or L3 depending on the binary value of the lower page at the time. In addition certain non volatile memory media vendors may impose a requirement that the lower page must be written to before the upper page or the like. In other embodiments the non volatile memory media may employ a two phase programming model where a binary value is first written to the MSB by way of a first write command to the upper page.

In certain embodiments the configuration parameter module determines and manages read voltage thresholds or other configuration parameters individually for one or more of the abodes L0 L1 L2 L3 determining different settings or adjustments to configuration parameters in different abodes L0 L1 L2 L3. In one embodiment the configuration module adjusts one or more read voltage thresholds based on a subset of binary data that multi level storage cells store such as just an upper page just a lower page or the like. In such embodiments examining the state changes for the LSB bit s indicate the direction the voltage in the multi level storage cell is changing. For both Gray code encoding as depicted in and binary code encoding of bit values the LSB of a multi level storage cell transitions between a binary zero and a binary one between the middle two abodes or states the L1 state and the L2 state in the depicted embodiment.

For other encoding models the MSB may transition between a binary zero and a binary one between the middle two abodes or states or the like. For Gray code or binary code encoding models the LSB has a value of 1 for read voltages in a lower range including the lower two states or abodes L0 and L1 and the LSB has a value of 0 for read voltages in an upper range including the upper two states or abodes L2 and L3 . By using just the LSB of MLC storage cells to determine whether a read bias deviates from a known bias the configuration module in one embodiment may make the determination in a substantially similar manner to determining whether a read bias for SLC storage cells deviates from a known bias by counting or tallying binary ones and or binary zeroes of an LSB data set or the like.

For certain types of multi level storage cells the middle read voltage threshold and the adjacent L1 and L2 states may be more sensitive to read disturb or other factors that can cause read voltages to drift. Further as described above in certain embodiments the LSB and the MSB of a single multi level storage cell may represent data stored in different physical pages. Using a single bit from each of a plurality of multi level storage cell as a data set in one embodiment may reduce a number of read operations to retrieve the data set. In other embodiments use of a single bit from each of a plurality of multi level storage cells in the lower page simplifies a process of detecting a deviation and direction of a read bias from a known bias for multi level storage cells.

In one embodiment the direction module determines a direction of deviation for a grouping of multi level storage cells based on a data set that includes data from one or more lower pages of the multi level storage cells. Because the lower pages include the LSBs in certain embodiments the direction module determines that a read voltage threshold deviates toward a larger read voltage in response to a difference between a read bias for the lower pages and a known bias for the lower pages indicating that storage cell values for the LSBs have transitioned from a binary one to a binary zero. For an LSB to transition from a binary one to a binary zero a read voltage for a multi level storage cell using the encoding model of must drift from either an L0 or L1 state to an L2 or L3 state indicating that one or more of the read voltage thresholds should be increased to place the read voltage back in the original L0 or L1 state.

Similarly in certain embodiments the direction module determines that a read voltage threshold deviates toward a smaller read voltage in response to a difference between a read bias for the lower pages and a known bias for the lower pages indicating that storage cell values for the LSBs have transitioned from a binary zero to a binary one. For an LSB to transition from a binary zero to a binary one a read voltage for a multi level storage cell using the encoding model of must drift from either an L3 or L2 state to an L1 or L0 state indicating that one or more of the read voltage thresholds should be decreased to place the read voltage back in the original L3 or L2 state. In certain embodiments a deviation across multiple states may be unlikely and deviations detectable using LSBs may be between the L1 and L2 states indicating a clear direction of deviation in either direction.

In another embodiment the direction module determines a direction of deviation based at least partially on an encoding type used for storage cells of the non volatile memory media a physical and or electrical architecture of the storage cells of the non volatile memory media or the like. For example based on the encoding model of the direction module may determine a direction of deviation based on a 2 bit MLC media type based on whether the data set includes an upper page or a lower page based on the depicted Gray code encoding type based on a magnitude of the determined deviation or the like. In a further embodiment the direction module may transform or combine LSBs and MSBs from separate or disparate addresses such as different physical pages or the like into a single data set or may otherwise coordinate LSBs and MSBs to determine a direction of deviation.

Using each bit stored in multi level storage cells to determine a read voltage threshold adjustment in certain embodiments can increase the accuracy of the read voltage threshold adjustment but may increase the number of read operations or add complexity to the determination. In one embodiment if the ECC decoder detects a data error in an upper page of a grouping of multi level storage cells the data set read module retrieves one or more lower pages for the grouping and the configuration module adjusts a read voltage threshold for the grouping based on the lower pages.

The adjusted configuration parameters more closely match the actual distributions of storage cell states of than do the default configuration parameters . Were a corresponding set of storage cells to use the default configuration parameters with the distributions of storage cell states of the portions of the distributions that have drifted past the locations of the default configuration parameters would register data errors. Similarly because the charge levels of the different abodes L0 L1 L2 L3 have drifted leaked been disturbed or the like by different amounts and in different directions using the same adjustment for each abode L0 L1 L2 L3 in certain embodiments may register data errors. By configuring the corresponding set of storage cells to use the individually adjusted configuration parameters the configuration module and the configuration parameter module prevent avoid or correct the potential data errors.

In one embodiment the configuration module determines the adjusted configuration parameters reactively using the deviation module the direction module the adjustment module or the like as described above. In another embodiment the configuration module determines the adjusted configuration parameters proactively using the proactive configuration module the media characteristic module and the configuration parameter module based on media characteristics for a corresponding set of storage cells as described above.

The pages of are grouped into a first set of pages and a second set of pages based on the RBERs of the pages . In the embodiment depicted in the first set of pages have higher RBERs than the second set of pages . The first set of pages for example may include even pages with higher RBERs than odd pages in the second set of pages or vice versa. Even pages may have higher RBERs than odd pages or vice versa due to the effects of program disturb or the like. In another embodiment the first set of pages for example may include upper pages of multi level storage cells with higher RBERs than lower pages of the multi level storage cells in the second set of pages or the like. The media characteristic module may reference determine or maintain different media characteristics for the different sets of pages and the configuration parameter module may determine different configuration parameter settings for the different sets of pages based on the different media characteristics such as the different RBERs or the like.

In the one or more pages toward each end of the pages with the highest RBERs are part of the first set . In certain embodiments the pages of the first set may comprise one or more pages toward a first end of the upper pages of multi level storage cells and one or more pages toward a second end of the upper pages such as the first two upper pages and the second to last upper page or the like. The second set of pages may include the rest of the upper pages while the third set of pages may include the lower pages of the multi level storage cells or the like. The media characteristic module may reference determine or maintain different media characteristics for the different sets of pages and the configuration parameter module may determine different configuration parameter settings for the different sets of pages based on the different media characteristics such as the different RBERs or the like.

The example embodiments depicted in are for purposes of illustration and are non limiting. The RBERs for pages may vary based on vendor architecture and geometry of the non volatile memory media usage patterns or the like and other embodiments may have different amounts of sets of pages different configurations for sets of pages or the like.

The media characteristic module may store the media characteristic repository in one or more of a metadata area of the non volatile memory media in volatile memory of the non volatile memory device and or of the computer in a configuration file for the non volatile memory device stored in other non volatile storage of the computer in dedicated non volatile storage of the non volatile memory device or the like. The media characteristic module may store the media characteristic repository and or media characteristics in a single location or may divide storage between multiple locations.

For example in one embodiment the media characteristic module may access static media characteristics such as a make a model a manufacturer a product version or the like for the non volatile memory device and or the non volatile memory media from nonvolatile storage of the non volatile memory device such as in a programmable read only memory PROM or the like that is programmed by a manufacturer or vendor. The media characteristic module may store dynamic media characteristics such as a program erase cycle counts read counts retention times temperatures use cases error statistics and the like in volatile memory of the non volatile memory device and or of the computer metadata on the non volatile memory media or the like. If the media characteristic module stores at least a portion of the media characteristic repository in volatile memory in certain embodiments the media characteristic module may periodically save data of the media characteristic repository to the non volatile memory media or to other nonvolatile storage so that the media characteristic module may rebuild a media characteristic repository in response to a power failure an improper shutdown or the like.

Each entry further includes media characteristics for the corresponding storage region . The media characteristics in the depicted embodiment include a program erase P E cycle count a read count a retention time a temperature and a bit error rate . The characteristic update module may cooperate with the media characteristic module to update the media characteristic repository as described above.

In the depicted embodiment the P E cycle count varies between 0.7 k and 2.0 k i.e. between 700 and 2000 k representing 1000 . Similarly the read count varies between 0.5 k and 4.1 k i.e. between 500 and 4100 . The retention time varies from 10 min minutes to 100 min and the temperature varies from 43 C. degrees Celsius to 48 C. Lastly the bit error rate varies between 9.7E 5 9.7 times 10 to the 5th power or 0.000097 and 2.5E 4 2.5 times 10 to the 4th power or 0.00025 . The depicted storage media characteristics are representative examples and are not limiting in light of this disclosure it is clear that storage media characteristics outside the depicted ranges are possible as well as other types of storage media characteristics not depicted in .

While the configuration parameters in the depicted embodiment are illustrated as read voltage threshold adjustments as described above in other embodiments configuration parameters may include resistivity thresholds write or program thresholds erase thresholds and or other modifiable parameters of the non volatile memory media . Further the three configuration parameters are provided by way of example and in other embodiments other amounts and types of configuration parameters may be included. For example in one embodiment certain 20 nm non volatile memory media or the like may have ten different read voltage thresholds R1 R10 set using different registers or the like and the configuration parameter module may determine different values for R1 R10 for different sets groups storage regions and or different abodes storage states. As described above a configuration parameter may include an absolute data value an offset or adjustment to a data value or another parameter. The configuration update module may cooperate with the configuration parameter module to update the configuration parameter repository as described above.

The configuration update module determines whether or not there is a change in one or more media characteristics due to the characteristic update module updating the one or more media characteristics or the like. If the configuration update module determines that there is a change in the one or more media characteristics the media characteristic module determines one or more media characteristics for the non volatile memory media and the configuration parameter module and or the configuration update module determines different configuration parameters for different divisions of the non volatile memory media such as different erase blocks logical or physical pages logical or physical sets of pages ECC chunks codewords abodes storage states of storage cells die planes in a die chips or the like. If the configuration update module determines that there is no change in the one or more media characteristics for the non volatile memory media the method skips the referencing step and the determining updating step .

The cell configuration module determines whether or not a configuration trigger has occurred. If the cell configuration module determines that a configuration trigger has occurred the cell configuration module configures the non volatile memory media to use the determined different configuration parameter settings and the method repeats. If the cell configuration module determines that no configuration trigger has occurred the method repeats.

A means for determining media characteristics for non volatile memory media in various embodiments may include a non volatile memory controller a non volatile memory device controller a device factor module an inverse bias module an ECC decoder a configuration module a proactive configuration module a media characteristic module a characteristic update module a media characteristic repository other logic hardware and or other executable code stored on a computer readable storage medium. Other embodiments may include similar or equivalent means for determining media characteristics for non volatile memory media .

A means for determining different configuration parameter settings for different sets of pages of non volatile memory media based on media characteristics in various embodiments may include a non volatile memory controller a non volatile memory device controller a configuration module a direction module an adjustment module a proactive configuration module a configuration parameter module a configuration update module an adjustment threshold module a sparse adjustment module a backstop module a configuration parameter repository other logic hardware and or other executable code stored on a computer readable storage medium. Other embodiments may include similar or equivalent means for determining different configuration parameter settings for different sets of pages of non volatile memory media based on media characteristics.

A means for configuring non volatile memory media to use the different configuration parameter settings for different sets of pages in various embodiments may include a non volatile memory controller a non volatile memory device controller a configuration module an adjustment module a write voltage module a proactive configuration module a cell configuration module other logic hardware and or other executable code stored on a computer readable storage medium. Other embodiments may include similar or equivalent means for configuring non volatile memory media to use the different configuration parameter settings for different sets of pages.

A means for using a default setting for a set of pages in response to one or more of a target setting being within a threshold range of the default setting and the set of pages failing to satisfy an age threshold in various embodiments may include a non volatile memory controller a non volatile memory device controller a configuration module a proactive configuration module a configuration parameter module a configuration update module an adjustment threshold module a sparse adjustment module a backstop module a configuration parameter repository other logic hardware and or other executable code stored on a computer readable storage medium. Other embodiments may include similar or equivalent means for using a default setting for a set of pages in response to one or more of a target setting being within a threshold range of the default setting and the set of pages failing to satisfy an age threshold.

The present disclosure may be embodied in other specific forms without departing from its spirit or essential characteristics. The described embodiments are to be considered in all respects only as illustrative and not restrictive. The scope of the disclosure is therefore indicated by the appended claims rather than by the foregoing description. All changes which come within the meaning and range of equivalency of the claims are to be embraced within their scope.

