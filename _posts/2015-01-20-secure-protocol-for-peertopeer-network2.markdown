---

title: Secure protocol for peer-to-peer network
abstract: A wireless computing device operating as a controller of a peer-to-peer group configured to generate unique master keys for each device joining the group. The wireless computing device may use the unique master keys to selectively remove remote devices from the group such that the remote device cannot later rejoin the group. Other remote devices, each possessing a master key that remains valid, can disconnect from the group and later reconnect to the group without express user action. To support such behavior, the wireless device may provide a user interface through which a user may manage connected remote devices by providing commands to selectively disconnect or remove remote devices from the group.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09596220&OS=09596220&RS=09596220
owner: Microsoft Technology Licensing, LLC
number: 09596220
owner_city: Redmond
owner_country: US
publication_date: 20150120
---
This application is a continuation of U.S. patent application Ser. No. 12 970 159 filed Dec. 16 2010 entitled SECURE PROTOCOL FOR PEER TO PEER NETWORK now U.S. Pat. No. 8 948 382 issued Feb. 3 2015 . The entirety of this afore mentioned application is incorporated herein by reference.

Many computers today have radios to support wireless communication. Wireless communication is used for example to connect to an access point of a network. By associating with the access point a wireless computer can access devices on the network or on other networks reachable through that network such as the Internet. As a result the wireless computer can exchange data with many other devices enabling many useful functions.

To enable computers to be configured for association with an access point it is common for the access points to operate according to a standard. A common standard for devices that connect to access points is called Wi Fi. This standard was promulgated by the Wi Fi Alliance and is widely used in portable computers. There are multiple versions of this standard but any of them can be used to support connections through access points.

Wireless communications may also be used to form connections directly to other devices without using an access point. These connections are sometimes called peer to peer connections and may be used for example to allow a computer to connect to a mouse or keyboard wirelessly. More generally peer to peer connections may be used to establish a group of devices of any type that may communicate without requiring an infrastructure. Wireless communications for these direct connections also have been standardized. A common standard for such wireless communications is called BLUETOOTH .

In some instances a wireless computer may concurrently connect to other devices through an access point and as part of a group engaging in peer to peer communications. To support such concurrent communication some computers have multiple radios. More recently a standard has been proposed called Wi Fi Direct that enables both an infrastructure connection and communication as part of a peer to peer group with similar wireless communications that can be processed with a single radio. This standard also published by the Wi Fi Alliance extends the popular Wi Fi communications standard for infrastructure based communications to support direct connections.

Equipping computing devices to support direct connections is expected to expand the scenarios in which a wireless computing device can connect to other wireless devices. For example computer users working together may more readily form a group that allows the users to share data without requiring any specific infrastructure. Similarly a computer may more readily connect wirelessly to a printer camera or devices providing other desired services.

Secure communications are achieved with very low user burden in a peer to peer group by configuring a device capable of operating as a controller of the peer to peer group to provide unique master keys for each remote device that joins the group. The group controller may selectively remove one or more remote devices from the group by selectively invalidating the master keys for the devices to be removed. Other remote devices may continue on in the peer to peer group without disruption or a need to re form the group.

Upon removal of a device from the group the group controller in addition to invalidating a master key associated with the device may invalidate other keys generated from the master key. If the removed device attempts to further communicate as part of the group its communications will not be recognized because the group controller does not have a key that will decrypt those communications. If the removed device attempts to re join the group the group controller will not recognize the master key used by that remote device. When an unrecognized device attempts to join the group without a recognized master key the group controller may deny access require user input or take other security actions.

However remote devices that retain their master keys may continue on in the group. Such devices may even disconnect from the group and using their master keys that remain valid reconnect with the group.

The inventors have recognized and appreciated a need for enhanced security in peer to peer groups. As peer to peer groups become more prevalent and are formed with protocols such as the Wi Fi Direct protocol that are more powerful usage patterns may create subtle security issues. However it is undesirable for enhancing security to interfere with ease of use of peer to peer groups. Accordingly the inventors have recognized and appreciated techniques to address security issues without significant impact on a user.

Security may be enhanced in a peer to peer group by equipping a device capable of acting as a controller for the group to generate a unique master key for each remote device connecting to the group. The controlling device may be further configured to selectively invalidate a master key for a device to be removed from the group thereby preventing the removed device from later reconnecting to the group and possibly accessing data that a user of the removed device is not intended to view or creating other security issues. Other remote devices for which a master key remains valid can remain in the peer to peer group and even may disconnect and later reconnect in the group.

Such a controlling device may be readily implemented using known techniques for implementing a device controlling a peer to peer group with modifications to support the generation distribution and selective invalidation of unique master keys and to support selection of the appropriate unique master key for authentication of remote devices. A component to provide a user interface through which a user may control the selective invalidation of master keys may be included. However each remote device may receive and use its unique master key in a conventional way such that enhanced security may be provided even with remote devices having conventional configurations.

As an example of how a subtle security issue may arise using conventional peer to peer techniques illustrates a peer to peer group formed in accordance with a peer to peer protocol. Such a peer to peer protocol may allow multiple wireless devices to connect without requiring any infrastructure.

In the example of five devices have joined in a group A in accordance with the protocol. One device in this example device serves as a controller for the group. The controller may perform functions that allow other wireless devices to join the group. Those functions may include for example provisioning each device in the group with a group address such that information may be routed to the device. Additionally the group controller may provision other wireless devices in the group with security information that allows those devices to be authenticated as they join or re join the group. Further the security information may be used to encrypt communications between the device controlling the group and other devices in the group.

Any suitable device may control a group. In the embodiment illustrated in device is a general purpose computing device such as a laptop computer. Such a device may be readily configured to perform control operations as described herein. For example such a computing device may be configured to perform operations associated with the control of a peer to peer group by appropriately configuring communication software in the computing device. Though it should be appreciated that the form of computing device that controls the group is not critical to the invention. To the contrary in accordance with some peer to peer protocols including the Wi Fi Direct protocol the device that controls a group may be identified by a negotiation among the devices seeking to form a group such that any suitably equipped device may act as the group controller.

In the example of remote devices and have joined in group A with computing device . As a result of negotiation among those devices in accordance with a peer to peer protocol or based on any other suitable selection criteria computing device has been determined to be the controller of group A and remote devices and have been determined to be clients. Accordingly computing device has provisioned each of the remote devices and with an address and keys for communication with computing device as part of peer to peer group A. The formation and operation of group A maybe performed in accordance with a known standard or in any other suitable way.

As an example computing device may generate a master key for each of the remote devices and . Conventionally the same master key is provided to each of the devices that is admitted to group A. The master key may be distributed to each device authorized to join group A using a protocol that uses cryptographic techniques to avoid unauthorized entities from obtaining the master key. An example of such cryptographic techniques are reflected in a protocol called Wi Fi protected setup WPS . In that protocol a user may input into computing device a PIN or other identifying information for a remote device. Input of that information may signify to computing device that a remote device is authorized by the user to join group A if the remote device similarly can demonstrate that it has a copy of the identifying information.

Input of a PIN or other identifying information provides computing device with information shared with a remote device that is not obtainable by other devices in the vicinity. Accordingly this information may be used in encrypting communications exchanged between computing device and a remote device seeking to join network A. Through use of cryptographic techniques based on this information computing device may securely communicate the master key for group A to a remote device authorized to join group A.

Once a remote device has the master key for group A the remote device can enter into a further exchange with computing device to generate a transient key. Though the same master key is conventionally used for each of the remote devices in a group a different transient key may be generated for each device. This transient key may then be used to encrypt and decrypt communications exchanged between the remote device for which the transient key was generated and computing device acting as the controller for group A.

The exchange between computing device and a remote device by which a transient key is generated may be performed according to any suitable protocol. An example of a suitable protocol is the Wi Fi Protected Access WPA2 protocol. An exchange of messages in accordance with this protocol in addition to generating a transient key for a remote device may also be used to authenticate that a device has the master key for the group.

Accordingly a device that temporarily is disconnected from group A may re join the group without further user authentication. Such a capability may be particularly useful for groups involving portable electronic devices. Because peer to peer networking is generally performed with low power communications when mobile devices are moved sometimes as little as 10 or 50 feet the devices forming the group may lose the ability to communicate. However when the devices are brought back into proximity a user may intend that the devices reconnect to re form the group. In order to re form the group a remote device with the group master key may exchange communications with the device acting as the group controller in accordance with the WPA2 protocol or other protocol used by the group such that the remote device with the master key is authenticated to the device acting as the group controller and a new transient key is generated for that device.

The Applicants have recognized and appreciated that this flexibility to form and later re form a group though desirable in some scenarios may be undesirable in other scenarios. illustrates a scenario in which computing device acting as a controller for group A is in close proximity to remote devices and . These remote devices may represent other devices used by a user of computing device . For example remote device may be a Smartphone. Remote device may be a camera and remote device may be a printer. The user of computing device may intend that computing device re form a group including any or all of remote devices and whenever computing device is moved to be near those remote devices. In this way for example a user of computing device may be able to print on the printer represented as remote device . Similarly the user may be able to upload pictures from the camera represented as remote device or synchronize contact information with the Smartphone represented as remote device .

So long as the user of computing device controls the remote devices little security risk is posed by allowing a group to be reformed without further user action. However if a user of computing device allows another remote device to join the group even if that remote device is disconnected from the group it may re join the group at any time which may not be a behavior expected or desired by a user of computing device .

For example a user of computing device may authorize remote device representing another portable computing device to join group A. Such authentication may be given to temporarily allow a user of computing device to use device to print a document or to access another of the remote devices in group A. Such authorization may be given to allow the user of computing device to exchange a file or some other limited amount information with computing device . Though once these actions are complete particularly if remote device is disconnected from group A a user of computing device may neither expect nor want remote device to rejoin group A.

The ability of a remote device to join a group without user authorization may pose a security issue in some circumstances. A security issue may be posed for example if a third party operating remote device can access information on computing device or other remote devices within group A. Moreover a security issue may arise if remote device can access information on other devices within group A. Further a security issue may arise if remote device can through computing device access services from computing device or other remote devices in group A. As a specific example the Wi Fi Direct protocol allows a computing device such as computing device to be a member of a peer to peer group while being connected to an infrastructure network such as may exist in an enterprise. If a third party using remote device can access other networks to which computing device is connected security issues may be compounded.

With a conventional implementation of a peer to peer group in which each remote device obtains a copy of a master key for the group removing a remote device from the group if a user of computing device is even aware of the need to completely remove the device would entail disbanding the group and forming a new peer to peer group. shows that a new group B has been formed including remote devices and but excluding remote device . Such a group may be formed by repeating the group formation steps including obtaining user authorization to admit each of the devices and into the group.

The applicants have recognized and appreciated that making a new group in order to remove a remote device may be undesirable for a user. Accordingly in some embodiments computing device or other device that may act as a group controller may be configured such that a remote device may be removed from a group. A device that is removed from the group may not be able to re join the group without reauthorization from a user.

As an example computing device may be configured with components that represent a graphical user interface through which a user may input a command to remove a remote device from a group. shows a graphical user interface through which a user may input such a command.

In the example of the user interface may be a portion of a user interface presented by a device manager component executing within the operating system of computing device . Such a user interface may be presented in response to user input indicating a desire to provide commands related to devices installed in or coupled to computing device . Through such a device manager interface the user may select a display area relating to managing wireless devices in a group involving computing device .

In the embodiment illustrated each of the devices actively in the group A is illustrated in display area by an icon. In this example icon represents remote device . Icon represents remote device . Icon represents remote device . Icon represents remote device . Additionally display area contains an icon .

Icon is shown in a fashion that is visually distinct from the icons and . The different visual presentation of icon may represent that a device corresponding to icon is not actively connected in the group A at the time display area was rendered. In this example icon is shown grayed out and appears in phantom. Though any suitable representation of a device that is not actively connected in the group may be used. In this example a grayed out icon represents a device that has been given the master key for group A and could re join group A at a later time.

Command corresponds to a disconnect command. Upon user selection of disconnect command computing device may take action that precludes remote device from communicating as part of group A. That action for example may include invalidating a transient key used by remote device to encrypt or decrypt information exchanged with computing device . Invalidation of this transient key though it temporarily precludes remote device from participating in group A does not preclude remote device from re joining the group. Specifically the remote device may use the master key it has previously obtained to re join the group and receive a new transient key to replace the transient key invalidated in response to user selection of disconnect command .

To preclude remote device from re joining group A a user may select from menu command . Command is a remove command. Upon selection of remove command computing device may instead of or in addition to invalidating the transient key generated for remote device invalidate the master key used by remote device .

In conventional systems in which all remote devices joined in a group are provided with the same master key invalidating the master key for remote device would invalidate the master key for all remote devices in group A. Accordingly removing a device would require re establishing a group B for the remote devices that the user desires to remain joined in the group. Re forming the group entails executing a key generation and distribution protocol such as the WPS protocol for each of the devices. The WPA2 protocol or other protocol used for the peer to peer group would also have to be repeated. Because the WPS protocol requires user interaction forming a new group B may be undesirable.

To avoid requiring a user to form a new group as a way to exclude a removed device from re joining the group in some embodiments computing device may be configured to provide a unique master key for each remote device that joins group A. Unique master keys may be generated for each device by repeating the key generation protocol for each device. Thereafter when a remote device seeks to authenticate to the computing device the computing device may access the appropriate master key for the device. That unique master key could then be used to authenticate the device and generate a transient key for the device. Thereafter communication between computing device and the remote device could be performed as in a conventional peer to peer protocol until an event is encountered that triggers computing device to remove a remote device from the group. Such a triggering event for example may be a user selecting command .

Regardless of an event triggering removal of a device from a group in response to such an event computing device could invalidate the master key assigned to the device to be removed. Invalidating a master key for a remote device precludes that remote device from re joining a group. However because all of the other remote devices that are joined in group A may have unique master keys invalidating the master key for remote device does not impact the validity of the master keys assigned to other devices such as remote device and . Accordingly those remote devices are not impacted by the removal of remote device .

Computing device may be configured in any suitable way to provide unique master keys for each remote device that joins in a group according to a peer to peer protocol. is an example of an architecture for a computing device which may represent an embodiment of a computing device such as computing device that may act as a controller for a peer to peer group.

In the example of an application is illustrated. Application may generate information for wireless transmission or may process information received wirelessly. In the embodiment illustrated that information may be sent to or received from one or more remote devices joined in a peer to peer group. Accordingly application may represent any suitable application that generates or processes information exchanged in a peer to peer group. It may for example be an application for processing photographs or a word processing application that generates text for printing. Though in some instances application may perform any suitable actions including actions that connect or disconnect from devices in a peer to peer group. As an example in some embodiments action described as being done by a user may done indirectly by the user by initiating execution of application .

In the example of application interfaces with operating system . In some embodiments operating system may be a general purpose operating system such as the WINDOWS operating system. Such a configuration may be desirable when computing device executes applications other than application . Though in embodiments in which computing device is configured specifically for communication as part of a peer to peer group operating system may have more limited functionality.

Regardless of whether operating system is a special purpose or general purpose operating system in the embodiment illustrated a function of operating system is to provide services that facilitate wireless transmission and reception of information processed by application . For transmission operating system may receive a request from application to establish a connection with a nearby device. Thereafter operating system may receive from application a stream of data representing audio video content to be transmitted over that connection. Such a connection may be formed using techniques as are known in the art. In the illustrated example that connection may be a direct device to device connection. Though any suitable technique may be used.

In the embodiment illustrated operating system includes a network stack . Network stack may perform functions as are known in the art for wireless communication including successively formatting data from application in accordance with different protocol layers used as part of the wireless communication. Network stack may perform a reverse operation on received information by successively checking compliance with various protocol layers and removing header and other information added in accordance with those protocol layers to recover data intended for use by application . Such processing may be performed using techniques as are known in the art.

To send and receive data stack may interact with one or more radios of which radio is illustrated. Radio may be controlled through software represented as driver in . Here driver includes an interface through which operating system may issue commands to driver and through which driver may report status and notify operating system of received data. Interface may be implemented in any suitable way including according to a known standard. An example of such a known standard is called NDIS but that standard is not critical to the invention.

Interface may support a number of commands in a format that does not depend on the construction of radio . These commands may include commands to configure radio for transmission at certain frequencies or to use certain modulation schemes or error control coding for symbols to be transmitted. Additionally through interface driver may receive data for transmission by radio .

Regardless of the specific commands driver may translate the commands in the standardized format of interface into specific control signals that are applied to radio . Additionally driver may be programmed to perform certain low level functions associated with a wireless connection. For example upon receipt of a packet driver may check that the packet is properly formatted. If the packet is properly formatted driver may control radio to generate an acknowledgement. Conversely if the packet is not properly formatted driver may control radio to transmit a negative acknowledgement.

Though driver and in some instances radio may automatically perform low level functions associated with establishing and maintaining a wireless connection higher level functions may be performed under control of operating system or applications . In some embodiments an application or operating system may provide a user interface such that ultimate control of wireless communication is provided by a user of computing device .

The architecture illustrated in may be modified in any suitable way to configure computing device to issue use and selectively invalidate a unique master key for each device joining a peer to peer group. For example components to control such operation of computing device may be incorporated within application operating system or within driver . In some embodiments some or all of the functions of a controller may be implemented in radio . Accordingly the specific components configured for implementation of the controller functions are not critical to the invention.

In the example illustrated controller includes interfaces and which are configured for connecting to portions of stack where frames representing wireless communication in accordance with a peer to peer protocol may be diverted to controller and where such frames may be passed to stack for wireless transmission. In the embodiment illustrated each of the interfaces and may be integrated into stack such that frames in accordance with the peer to peer protocol implemented by computing device may pass between controller and stack . Though three interfaces are illustrated it should be appreciated that any number of interfaces may be provided. For example a single interface may be provided or more than three interfaces may be provided to accommodate different types of interactions between controller and stack . Moreover it should be appreciated the form of these interfaces is not critical to the invention and the specific form of the interfaces may depend on the implementation of controller . For example the interfaces may be implemented as defined application programming interfaces APIs and controller may be implemented in way that it makes calls on the interfaces. Though it other embodiments interfaces and may be any other form of connection.

In the illustrated embodiment of controller includes a key setup component . Key setup component may control interactions with a remote device during a setup phase for the device in which controller and the remote device each arrive at the same unique master key for the remote device.

Setup component may interact with the remote device in any suitable way. As one example setup component may interact via interface and stack such that frames that constitute exchanges of messages between computing device and a remote device may pass to setup component for processing or may be generated by setup component for transmission to the remote device. The specific message that pass through interface for processing by setup component may depend on the protocol used for the peer to peer group being formed. As one example these messages may be formatted as management frames defined by the peer to peer protocol. One or more of these frames may include information elements indicating a request or a response to a request that is not expressly provided for in the protocol.

For example an initial message may indicate a request from a remote device to obtain a master key for use in joining or communicating within the group. Other messages may include responses by which such a key is generated.

In response to such message key setup component may determine whether the remote device is authorized to receive a master key. Key setup component may determine if a remote device is authorized in part based on an exchange of messages with the remote device. Key setup component may access additional authentication information to determine whether the remote device is authorized to receive a master key.

Those additional sources of authentication information may include interaction with a user. Such interactions may be performed through user interface component or in any other suitable way. In some embodiments for example key setup component may through user interface prompt a user to provide a PIN or other suitable identification code associated with an authorized remote device. Key setup component may use this identification code to verify whether messages received from the remote device were generated using the same identification code. Though it should be appreciated that the specific source of the authentication information is not critical to the invention and it need not be provided directly by a user through a user interface. As an example of an alternative source of such authenticating information computing device may maintain a store not shown of PIN numbers for authorized devices which key setup component may access when receiving a request for a master key from a device seeking to join a peer to peer group.

The specific messages processed by key setup component are not critical to the invention. In some embodiments key setup component may be configured to implement the Wi Fi Protected Setup protocol WPS when receiving a request for a master key and communicating the master key to the remote device if the remote device is authorized to receive the master key.

To obtain a master key when the remote device is authorized to receive one key setup component may interact with key generator . Key generator may utilize cryptographic techniques to generate a key in response to a request from key setup component . Key generator may operate according to known cryptographic principles and may be implemented using techniques as are known in the art. However in contrast to a conventional wireless computing device implementing a peer to peer group key generator and key setup component may interact such that a unique master key is generated for each remote device requesting to join the group.

Key setup component may record the unique master keys for subsequent use in authenticating the remote devices. In the example of key setup component records master keys in key store . Key store may represent any suitable computer storage medium on or accessible to computing device . Key store may be implemented in non volatile storage medium such as a disk drive and for example may be formatted as a file or other data structure maintained by a file management system on computing device . Though in other embodiments key store may be stored in an encrypted format and may have no readily recognizable structure in the non volatile storage medium. Accordingly it should be appreciated that the specific implementation of key store is not critical to the invention.

Other components within controller may perform other functions associated with interactions with one or more remote devices in connection with a peer to peer group including use and selective invalidation of the master keys in key store . For example shows that controller may also include an authentication and transient key component . Authentication and transient key component may interact with a remote device seeking to connect with other devices in the peer to peer group. Authentication and transient key component may validate that the remote device seeking to connect as a member of the group possesses a valid master key for the group.

Accordingly authentication and transient key component may interact with key store to verify that the remote device has access to a valid master key for the group. Upon authenticating a remote device authentication and transient key component may generate one or more transient keys for use in encrypting and or decrypting communications with the remote device. As part of generating the transient key. Authentication and transient key component may interact with the remote device. Accordingly authentication and transient key component is shown having an interface which may connect to stack or other suitable component that allows authentication and transient key component to exchange messages with the remote device.

The exchanged messages allow the remote device to generate transient key or keys that match the keys generated by authentication and transient key component . In this way authentication and transient key component may provide a transient key or keys to the remote device.

Authentication and transient key component may interact with the remote device using messages appropriate for the peer to peer protocol used in forming the group. In some embodiments authentication and transient key component may implement a four way hand shake in accordance with the WPA2 protocol and may therefore be implemented using techniques as are known in the art. However in contrast to a conventional computing device serving as a controller for a peer to peer group authentication and transient key component may access key store to obtain the unique device key for the remote device attempting to connect to the peer to peer group.

Authentication and transient key component may retrieve the unique master key applicable to the remote device in any suitable way. For example illustrates a possible organization of data maintained in key store which may allow authentication in transient key component to obtain the appropriate unique master key for the remote device. In the example of a data set represents information in key store for the set of remote devices for which unique master keys have been generated. In this example each remote device is represented by a record in data set . In four record A B C and D are illustrated each of the records A . . . D corresponds to a remote device.

In this example each of the records has the same format. Taking record A as illustrated the record contains multiple fields. In this example three fields fields and are shown. Field stores a value indicating the master key for a remote device associated with record A. Field contains a value that may be used to identify the remote device. In this example Field stores a value representing a Media Access Control MAC address for the remote device. In accordance with some peer to peer protocols the MAC address of a device sending or intended to receive a frame is incorporated into the frame. Accordingly key setup component may have access to the MAC address of a remote device at the time it generates a unique master key for the device. When key setup component generates a unique master key and writes a record to key store it may include in that record a value of the MAC address for the remote device. Authentication and transient key component may similarly receive a MAC address for a remote device in conjunction with messages from a remote device seeking to be authenticated as part of connecting in the peer to peer group. Accordingly authentication and transient key component may identify an appropriate master key for a remote device by comparing a MAC address received from the remote device with a MAC address stored in data set .

Though other mechanisms are possible. For example illustrates an alternative embodiment of a data set that may constitute key store . Data set in this example contains a structure similar to that of data set . Multiple records A B C and D are illustrated. Each such record may correspond with a remote device for which a master key has been generated. Taking record as illustrated each record may include fields such as fields and . Field may contain a value of the master key. In this example fields and do not contain identification information comparable to that in field . Rather fields and contain information that may be used in other operations. For example field may contain a value defining a time at which the master key was generated. Such information for example may be used in an embodiment in which keys time out or devices otherwise are removed from a group after some threshold period of time. Field may contain information useful for example in rendering a user interface such as user interface . Field for example may contain a code or other description of the device for which the master key was generated. Such information may be used by user interface component to select icons to use in interface .

In this example data set does not include MAC addresses or other direct identification of the remote devices. Nonetheless authentication and transient key component may use data set to determine whether the remote device requesting authentication has a valid master key.

As part of the protocol applied by authentication and transient key component to determine whether a remote device as a valid key authentication and transient key component performs a cryptographic function on a block of data sent by the remote device. In accordance with the protocol used by authentication and transient key component the remote device is expected to encrypt with a valid master key a block of data having a value known by authentication and transient key component . Authentication and transient key component authenticates the remote device if it can decrypt a block of data received from the remote device to generate that known value. Accordingly even if authentication and transient key component does not know the specific master key used by the remote device if any of the master keys in data set can be used to decrypt the received block of data in order to generate the expected value authentication and transient key component may conclude that the remote device has access to a valid master key thereby authenticating the remote device.

Accordingly in embodiments in which a specific identifier for the remote device is not stored in data set authentication and transient key component may identify the appropriate master key by testing multiple master keys in the data set until a master key can be used to appropriate decrypt the block of data is identified. That master key can thereafter be used in the generation of a transient key for the remote device.

Regardless of the manner in which authentication and transient key component identifies the appropriate master key for the device requesting connection to the peer to peer group once the appropriate master key is identified authentication and transient key component may use the master key to provide a transient key to the remote device for connection to the peer to peer group.

Operations performed by group owner control component may entail sending and receiving data from one or more of the remote devices that are connected in the peer to peer group. Such data may be communicated in an encrypted format. Accordingly group owner control component may be coupled to interface through encryption decryption component . Interface may couple encryption decryption component to stack or other component of computing device that facilitates the transmission and receipt of information exchanges wireless with the remote device.

Group owner control component and encryption decryption component may be implemented in any suitable way including using components as are known in the art. These components may operate such that data frames or other frames exchanged with a remote device that is connected in the peer to peer group may be encrypted with the transient key generated for that remote device. Encryption decryption component may access such a transient key in any a suitable way. For example authentication and transient key component may generate a key table or other suitable data structure linking transient keys with addresses used by remote devices to communicate as part of the peer to peer group.

As one example illustrates that each of the records A B C and D in data set may include a field such as field containing a transient key for the remote device represented by the record. In this example a MAC address in field may be used to selected an appropriate record from data set such that a transient key may be identified for use in encrypting or decrypting data. Though it is not a requirement that the transient keys be stored in the same data store as the master keys. In some embodiments the transient keys may be stored in volatile memory for example such that the transient keys are not retained if computing device powers down. Also it is not a requirement that the transient keys be linked to a MAC address. In some embodiments the transient keys may be linked to a group address assigned to each remote device as it is admitted to the peer to peer group.

Regardless of the manner in which the transient key is identified encryption decryption component may use the transient key to encrypt and decrypt frames exchanged between group owner control component and the remote device. These operations may be performed using techniques as are known in the art or in any other suitable way.

User interface component may be implemented using techniques as are known in the art or in any other suitable way. User interface component may be configured to respond to user input in any suitable way. For example in response to user input received through user interface indicating that a remote device is to be removed from a peer to peer group user interface component may modify key store to invalidate a master key associated with the device to be removed. User interface component may invalidate a master key in any suitable way. In some embodiments user interface component may invalidate a key either by deleting from a record associated with the device a value of the master key or deleting the entire record. Though any suitable mechanism signifying that a master key has been invalidated may be used. For example user interface component may write a value to the record associated with the master key to indicate that the key has been invalidated.

In contrast in response to user information received through user interface to disconnect a remote device from a peer to peer group user interface may leave the master key value in key store intact. Rather user interface component may delete transient keys or other data structures used to establish the connection with the remote device to be disconnected. But leaving the master key in key store allows the disconnected remote device to reconnect at a later time.

The components illustrated in or any other suitable components may interact to control computing device to perform a method of secure operation in which remote devices may be selectively removed from the group. when joined at the point labeled A represent a flow chart of such a method of secure operation.

In the example of method begins at block where a remote device is discovered. Remote discovery of a device may be performed in any suitable way and may be initiated by either the computing device executing method or the remote device. Processing at block may be performed in any suitable way. In the embodiment illustrated that processing may be performed using techniques specified as part of a peer to peer protocol as is known in the art.

For example processing at block may include sending and or responding to management frames. As an example discovery at block may include transmitting a beacon and or receiving a probe request. Accordingly the specific actions taken by which a computing device identifies that a remote device desires to engage in peer to peer communication is not critical to the invention. Regardless of the manner in which the device is identified processing may proceed to decision block .

At decision block process may branch depending on whether the remote device identified at block is known to the computing device executing process . In this example a device is deemed known when it is a device that has previously been admitted as a member of a peer to peer group controlled by the computing device executing process . If so process branches from decision block to perform subprocess .

In scenarios in which the discovered device is not known the process precedes from decision block to subprocess . At subprocess the computing device executing process and the remote device may exchange further management frames to negotiate a group owner. The negotiations performed as part of subprocess may be specified in the peer to peer protocol being used by the devices to form a peer to peer group. Accordingly subprocess may be performed as known in the art. In this example the negotiations are performed in accordance with the Wi Fi Direct protocol such that as a result of the negotiations one of the devices will be identified as the group owner and will perform control functions for the peer to peer group.

Upon completion of the negotiations in subprocess the process continue to decision block . At decision block process may branch depending on the result of the group owner negotiations conducted in .

If the computing device executing process is not selected as the group owner process may branch from decision block to subprocess . In scenarios in which the device executing process is not identified as the group owner no special action on the part of the device is necessary in order to receive a unique master key. Accordingly when the process branches from decision block to subprocess operations within subprocess may be conventional operations as are appropriate for a computing device designated to have the role of a client device in the peer to peer network.

Processing within subprocess may result in the client authenticating and associating with the device selected as the group owner as a result of the negotiations conducted in subprocess . Additionally subprocess may include provisioning steps as in a conventional peer to peer network. Regardless of the specific steps taken upon execution of subprocess the computing device may be equipped for communication with the selected group owner. Accordingly from subprocess the process may proceed to subprocess where the computing device executing process and the remote device discovered at block may communicate using techniques as are known in the art. Such communication may continue for any amount of time but when communication is completed process may end.

Conversely when as a result of negotiations in subprocess the computing device executing process is identified as the group owner the process branches from decision block to decision block . Processing at decision block may determine in any suitable way whether the device discovered at block is authorized to join the group being controlled by the device executing process . As an example user input may be provided indicating whether the device is authorized.

The input may be in a form that allows cryptographic functions used in communications with the remote device that can indicate whether the device is authorized. For example the controlling device executing process may send a message containing text or a numeric code that operates as a challenge phrase. The remote device may encrypt that challenge phrase with the PIN or other valued derived from authentication information to perform a cryptographic function on the challenge phrase. The cryptographic function may involve encryption digital signing a hash function or other suitable cryptographic function.

Regardless of the specific cryptographic function performed the remote device may then send back to the controlling device the challenge phrase suitably processed. The controlling device may perform a similar operation on the challenge phrase based on the authentication information provided by the user. If the processed value generated by the controlling device matches the value returned by the remote device the controlling device may deem that the remote device is authorized to connect to the peer to peer group. Though it should be appreciated that such an exchange of messages based on authentication information provided by a user is just one example of an approach that the controlling device may use to determine whether the remote device is authorized to join the group. Regardless of the manner in which the authorization is validated if the remote device is not authorized for access to the group the process may branch from decision block to the end of the process such that the remote device is not granted access to the peer to peer group.

Conversely if as a result of processing at decision block the controlling device determines that the remote device is authorized to join the peer to peer group the process branches from decision block to block . At block the controlling device may generate and store a unique master key for the remote device. The master key may be generated in any suitable way such as through the use of a random number generator and or computations involving one or more cryptographic functions.

Regardless of the manner in which the master key is generated process may proceed to subprocess . At subprocess the master key may be distributed to the remote device. Subprocess may be performed in any suitable way. In some embodiments the controlling device may convey the master key to the remote device using the Wi Fi protected setup protocol WPS .

Regardless of the manner in which the key is distributed process may proceed to subprocess . Subprocess may entail authenticating a device seeking to join the peer to peer group. illustrates that the processing performed within subprocess is the same regardless of whether process reaches subprocess from subprocess in which the remote device receives a unique master key or from decision block where it may be determined that the remote device already has a master key. Accordingly subprocess is shown beginning at block where the controlling device checks whether the remote device has a valid master key. In embodiments in which the remote device has just been assigned a master key through subprocess this processing may be bypassed.

In embodiments in which processing is performed at block the controlling device may check whether the remote device seeking to join the peer to peer group has a valid master key through an exchange of messages. The exchange of messages for example may entail exchanging information between the controlling device and the remote device that allows the controlling device to determine whether the remote device has performed a cryptographic function using a valid master key. Such an exchange of communications may be performed according to any suitable protocol. In some embodiments subprocess may be performed according to a known protocol such as the WPA2 protocol. In such an embodiment processing performed at block may be in accordance with that protocol though the specific protocol used is not critical to the invention.

However a difference between the processing at block and a conventional process for checking the validity of a master key of a remote device is that at block the controlling device may select an appropriate master key that corresponds with the remote device. The master key used by the controlling device at block may be selected in any suitable way. In some embodiments the controlling device may access a key store such as key store based on an identifier associated with the remote device. Though in other embodiments the controlling device may sequentially attempt to validate the master key used by the remote device against each valid master key stored in a key store until the master key applied by the remote device validates against a key in the key store in which case the key is validated or the controlling device unsuccessfully attempts to validate the master key used by the remote device against all of the master keys in the key store in which case the remote device is determined not to have a valid master key.

Regardless of the technique used to validate the master key at block process may continue to decision block where there process may branch depending on the result of that validation. If as a result of processing at block the controlling device determines that remote device does not have a valid master key the process may branch from decision block to the end of process without the remote device being able to connect to the peer to peer group.

Conversely if the remote device is determined to have a valid master key the process may continue from decision block to block . At block the controlling device may generate one or more transient keys that may be distributed to the remote device. A transient key generated at block may enable communication between the remote device and the controlling device. If multiple transient keys are generated for example one transient key may be used with the controlling device and the additional keys may be used for communication with other devices in the peer to peer group.

The transient keys may be generated in any suitable way. In an embodiment in which subprocess is performed in accordance with the WPA2 protocol processing at block may be performed in accordance with that protocol. Though any suitable mechanism may be used to generate transient keys and distribute those transient keys to the remote device.

Regardless of the number of transient keys generated at block they may be stored at block for future use in encrypting or decrypting communications with the remote device.

Process may then continue to subprocess . During subprocess the controlling device and the remote device may communicate using the transient keys generated at block . Subprocess may include any suitable steps. In the example illustrated processing within subprocess begins with block . At block the controlling device may encrypt data for transmission to the remote device using a transient key generated at block . The specific data to be transmitted to the remote device is not critical to the invention and may depend on the nature of both the remote device and the controlling device. Moreover the manner in which the transient key is used to encrypt data at block also is not critical to the invention. Encryption may provide confidentiality authentication or integrity or some combination of those functions.

Regardless of how and why data is encrypted with the transient key at block the encrypted data may be transmitted to the remote device at block . Transmission of encrypted data at block may be performed in any suitable way. Though embodiments in which the peer to peer group is formed in accordance with a standard protocol transmission at block may be in accordance with the standard protocol. In the embodiment illustrated the communication subprocess may also include receiving data from the remote device. In this scenario the received data may also be encrypted using the transient keys generated and transmitted to the remote device at block . Accordingly data received at block may be encrypted with the transient key for the remote device.

At block the controlling device may decrypt the received data also using the transient key. The received data may then be used within the controlling device. The specific use of the data is not critical to the invention and the data may be put to any suitable use.

Process may then continue to decision block . At decision block the process may branch depending on whether a trigger event has been detected that indicates that the remote device should be removed from the peer to peer group. An example of a trigger advice may be user input. As a specific example a user may select command from a user interface on the controlling device. Though any other suitable event may serve as a trigger. For example illustrates that records in a data set containing information about remote devices may include a time value such as the time value illustrated in field . In some embodiments a suitable trigger for removing a remote device from a peer to peer group may be passage of a predetermined amount of time. That time may be determined for example from a value in field .

Regardless of the specific trigger event if the trigger event is detected process branches from decision block to block . At block the controlling device may invalidate the master key associated with the remote device. Processing at block may be performed in any suitable way. In some embodiments a master key may be invalidated by deleting it from a key store such as key store . Though in other embodiments the key may be invalidated by setting a flag in a record associated with the key or in any other suitable way.

Following invalidation of the master key at block process may continue to block where transient keys associated with the remote device may also be invalidated such as by deletion. Following deletion of the transient keys process may end. When processing arrives at the end after having passed through blocks and the remote device will be unable to further communicate as in subprocess because it will not have transient keys to encrypt and decrypt data. Further the remote device will be unable to re establish communication by repeating subprocess to establish transient keys that can be used for communication. If the remote device seeks to re establish communication it will be forced to pass through decision block where it must be reauthorized to obtain a new master key.

Though illustrate other sequences of steps through which processing may arrive at the end of process . For example if at decision block no indication to remove the remote device is received processing may proceed to decision block . At decision block process may branch depending on whether communications have been completed. If not processing may loop back where some or all of subprocess may be repeated.

Conversely if communications are completed the process may branch from decision block to block . At block transient keys assigned to the remote device may be deleted and then process may end. In scenarios in which processing reaches the end without execution of block the remote device may retain a valid master key. Though the remote device may lack transient keys because they were deleted at block the remote device may nonetheless resume communication as part of the peer to peer group without further express user authorization. For example if at a later time the remote device attempts to re establish communication processing may branch through decision block directly to subprocess where because the remote device retains a valid master key the remote device may receive new transient keys. In this way process illustrates an approach by which a master key for a remote device that is part of a peer to peer group may be selectively removed.

Though depict interactions between a controlling device and a single remote device it should be appreciated that process may be repeated for each of multiple remote devices forming a peer to peer group. Processing for each of the remote devices may be independent. Accordingly selective invalidation of a master key for one remote device does not impact the validity of the master keys held by other remote devices. Accordingly a remote device may be selectively removed in accordance with the process of . Though it should be appreciated that illustrate an exemplary process and any suitable processing may be used to selectively remove one or more remote devices from a peer to peer group.

The invention is operational with numerous other general purpose or special purpose computing system environments or configurations. Examples of well known computing systems environments and or configurations that may be suitable for use with the invention include but are not limited to personal computers server computers hand held or laptop devices multiprocessor systems microprocessor based systems set top boxes programmable consumer electronics network PCs minicomputers mainframe computers distributed computing environments that include any of the above systems or devices and the like.

The computing environment may execute computer executable instructions such as program modules. Generally program modules include routines programs objects components data structures etc. that perform particular tasks or implement particular abstract data types. The invention may also be practiced in distributed computing environments where tasks are performed by remote processing devices that are linked through a communications network. In a distributed computing environment program modules may be located in both local and remote computer storage media including memory storage devices.

With reference to an exemplary system for implementing the invention includes a general purpose computing device in the form of a computer . Components of computer may include but are not limited to a processing unit a system memory and a system bus that couples various system components including the system memory to the processing unit . The system bus may be any of several types of bus structures including a memory bus or memory controller a peripheral bus and a local bus using any of a variety of bus architectures. By way of example and not limitation such architectures include Industry Standard Architecture ISA bus Micro Channel Architecture MCA bus Enhanced ISA EISA bus Video Electronics Standards Association VESA local bus and Peripheral Component Interconnect PCI bus also known as Mezzanine bus.

Computer typically includes a variety of computer readable media. Computer readable media can be any available media that can be accessed by computer and includes both volatile and nonvolatile media removable and non removable media. By way of example and not limitation computer readable media may comprise computer storage media and communication media. Computer storage media includes both volatile and nonvolatile removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions data structures program modules or other data. Computer storage media includes but is not limited to RAM ROM EEPROM flash memory or other memory technology CD ROM digital versatile disks DVD or other optical disk storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and which can accessed by computer . Communication media typically embodies computer readable instructions data structures program modules or other data in a modulated data signal such as a carrier wave or other transport mechanism and includes any information delivery media.

The term modulated data signal means a signal that has one or more of its characteristics set or changed in such a manner as to encode information in the signal. By way of example and not limitation communication media includes wired media such as a wired network or direct wired connection and wireless media such as acoustic RF infrared and other wireless media. Combinations of the any of the above should also be included within the scope of computer readable media.

The system memory includes computer storage media in the form of volatile and or nonvolatile memory such as read only memory ROM and random access memory RAM . A basic input output system BIOS containing the basic routines that help to transfer information between elements within computer such as during start up is typically stored in ROM . RAM typically contains data and or program modules that are immediately accessible to and or presently being operated on by processing unit . By way of example and not limitation illustrates operating system application programs other program modules and program data .

The computer may also include other removable non removable volatile nonvolatile computer storage media. By way of example only illustrates a hard disk drive that reads from or writes to non removable nonvolatile magnetic media a magnetic disk drive that reads from or writes to a removable nonvolatile magnetic disk and an optical disk drive that reads from or writes to a removable nonvolatile optical disk such as a CD ROM or other optical media. Other removable non removable volatile nonvolatile computer storage media that can be used in the exemplary operating environment include but are not limited to magnetic tape cassettes flash memory cards digital versatile disks digital video tape solid state RAM solid state ROM and the like. The hard disk drive is typically connected to the system bus through an non removable memory interface such as interface and magnetic disk drive and optical disk drive are typically connected to the system bus by a removable memory interface such as interface .

The drives and their associated computer storage media discussed above and illustrated in provide storage of computer readable instructions data structures program modules and other data for the computer . In for example hard disk drive is illustrated as storing operating system application programs other program modules and program data . Note that these components can either be the same as or different from operating system application programs other program modules and program data . Operating system application programs other program modules and program data are given different numbers here to illustrate that at a minimum they are different copies. A user may enter commands and information into the computer through input devices such as a keyboard and pointing device commonly referred to as a mouse trackball or touch pad. Other input devices not shown may include a microphone joystick game pad satellite dish scanner or the like. These and other input devices are often connected to the processing unit through a user input interface that is coupled to the system bus but may be connected by other interface and bus structures such as a parallel port game port or a universal serial bus USB . A monitor or other type of display device is also connected to the system bus via an interface such as a video interface . In addition to the monitor computers may also include other peripheral output devices such as speakers and printer which may be connected through a output peripheral interface .

The computer may operate in a networked environment using logical connections to one or more remote computers such as a remote computer . The remote computer may be a personal computer a server a router a network PC a peer device or other common network node and typically includes many or all of the elements described above relative to the computer although only a memory storage device has been illustrated in . The logical connections depicted in include a local area network LAN and a wide area network WAN but may also include other networks. Such networking environments are commonplace in offices enterprise wide computer networks intranets and the Internet.

When used in a LAN networking environment the computer is connected to the LAN through a network interface or adapter . When used in a WAN networking environment the computer typically includes a modem or other means for establishing communications over the WAN such as the Internet. The modem which may be internal or external may be connected to the system bus via the user input interface or other appropriate mechanism. In a networked environment program modules depicted relative to the computer or portions thereof may be stored in the remote memory storage device. By way of example and not limitation illustrates remote application programs as residing on memory device . It will be appreciated that the network connections shown are exemplary and other means of establishing a communications link between the computers may be used.

Having thus described several aspects of at least one embodiment of this invention it is to be appreciated that various alterations modifications and improvements will readily occur to those skilled in the art.

Such alterations modifications and improvements are intended to be part of this disclosure and are intended to be within the spirit and scope of the invention. Accordingly the foregoing description and drawings are by way of example only.

The above described embodiments of the present invention can be implemented in any of numerous ways. For example the embodiments may be implemented using hardware software or a combination thereof. When implemented in software the software code can be executed on any suitable processor or collection of processors whether provided in a single computer or distributed among multiple computers. Such processors may be implemented as integrated circuits with one or more processors in an integrated circuit component. Though a processor may be implemented using circuitry in any suitable format.

Further it should be appreciated that a computer may be embodied in any of a number of forms such as a rack mounted computer a desktop computer a laptop computer or a tablet computer. Additionally a computer may be embedded in a device not generally regarded as a computer but with suitable processing capabilities including a Personal Digital Assistant PDA a smart phone or any other suitable portable or fixed electronic device.

Also a computer may have one or more input and output devices. These devices can be used among other things to present a user interface. Examples of output devices that can be used to provide a user interface include printers or display screens for visual presentation of output and speakers or other sound generating devices for audible presentation of output. Examples of input devices that can be used for a user interface include keyboards and pointing devices such as mice touch pads and digitizing tablets. As another example a computer may receive input information through speech recognition or in other audible format.

Such computers may be interconnected by one or more networks in any suitable form including as a local area network or a wide area network such as an enterprise network or the Internet. Such networks may be based on any suitable technology and may operate according to any suitable protocol and may include wireless networks wired networks or fiber optic networks.

Also the various methods or processes outlined herein may be coded as software that is executable on one or more processors that employ any one of a variety of operating systems or platforms. Additionally such software may be written using any of a number of suitable programming languages and or programming or scripting tools and also may be compiled as executable machine language code or intermediate code that is executed on a framework or virtual machine.

In this respect the invention may be embodied as a computer readable storage medium or multiple computer readable media e.g. a computer memory one or more floppy discs compact discs CD optical discs digital video disks DVD magnetic tapes flash memories circuit configurations in Field Programmable Gate Arrays or other semiconductor devices or other non transitory tangible computer storage medium encoded with one or more programs that when executed on one or more computers or other processors perform methods that implement the various embodiments of the invention discussed above. The computer readable storage medium or media can be transportable such that the program or programs stored thereon can be loaded onto one or more different computers or other processors to implement various aspects of the present invention as discussed above. As used herein the term non transitory computer readable storage medium encompasses only a computer readable medium that can be considered to be a manufacture i.e. article of manufacture or a machine. Alternatively or additionally the invention may be embodied as a computer readable medium other than a computer readable storage medium such as a propagating signal.

The terms program or software are used herein in a generic sense to refer to any type of computer code or set of computer executable instructions that can be employed to program a computer or other processor to implement various aspects of the present invention as discussed above. Additionally it should be appreciated that according to one aspect of this embodiment one or more computer programs that when executed perform methods of the present invention need not reside on a single computer or processor but may be distributed in a modular fashion amongst a number of different computers or processors to implement various aspects of the present invention.

Computer executable instructions may be in many forms such as program modules executed by one or more computers or other devices. Generally program modules include routines programs objects components data structures etc. that perform particular tasks or implement particular abstract data types. Typically the functionality of the program modules may be combined or distributed as desired in various embodiments.

Also data structures may be stored in computer readable media in any suitable form. For simplicity of illustration data structures may be shown to have fields that are related through location in the data structure. Such relationships may likewise be achieved by assigning storage for the fields with locations in a computer readable medium that conveys relationship between the fields. However any suitable mechanism may be used to establish a relationship between information in fields of a data structure including through the use of pointers tags or other mechanisms that establish relationship between data elements.

Various aspects of the present invention may be used alone in combination or in a variety of arrangements not specifically discussed in the embodiments described in the foregoing and is therefore not limited in its application to the details and arrangement of components set forth in the foregoing description or illustrated in the drawings. For example aspects described in one embodiment may be combined in any manner with aspects described in other embodiments.

Also the invention may be embodied as a method of which an example has been provided. The acts performed as part of the method may be ordered in any suitable way. Accordingly embodiments may be constructed in which acts are performed in an order different than illustrated which may include performing some acts simultaneously even though shown as sequential acts in illustrative embodiments.

Use of ordinal terms such as first second third etc. in the claims to modify a claim element does not by itself connote any priority precedence or order of one claim element over another or the temporal order in which acts of a method are performed but are used merely as labels to distinguish one claim element having a certain name from another element having a same name but for use of the ordinal term to distinguish the claim elements.

Also the phraseology and terminology used herein is for the purpose of description and should not be regarded as limiting. The use of including comprising or having containing involving and variations thereof herein is meant to encompass the items listed thereafter and equivalents thereof as well as additional items.

