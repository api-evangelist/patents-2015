---

title: Just-in time remote data storage allocation
abstract: A just-in-time storage allocation is initiated for storage at a remote storage device having storage disks. Each of multiple containers comprises a grouping of one or more of the storage disks. The just-in-time storage allocation includes an application profile that includes a priority criteria for the storage of either a priority of performance over efficiency or a priority of efficiency over performance A determination is made of whether at least one container of the multiple containers satisfies the priority criteria based on at least one attribute of the at least one container. The storage is allocated in the at least one container, in response to the at least one container satisfying the priority criteria.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09507526&OS=09507526&RS=09507526
owner: NetApp, Inc.
number: 09507526
owner_city: Sunnyvale
owner_country: US
publication_date: 20150112
---
This application claims the priority benefit of U.S. Provisional Application Ser. No. 62 079 989 filed Nov. 14 2014.

This disclosure generally relate to the field of remote data storage and more particularly to just in time remote data storage allocation.

Various large enterprises e.g. businesses may need to store large amounts of data e.g. financial records human resource information research and development data etc. . The amount of storage needed typically grows over time. In conventional data storage approaches these large enterprises can purchase physical disks at some local or remote site. For example the enterprises e.g. a business can purchase a shelf of physical storage disks at some customer data center. Volumes can be defined on these physical storage disks. The enterprises applications can then access these volumes over a network for writing reading etc. data thereon. For this approach the number of physical storage disks is limited. Therefore to ensure that storage is available the physical storage disks are typically under provisioned just in case additional storage is needed. However this under provisioning of the physical storage disks can result in the purchase of physical storage disks that is not needed or unused for a long period of time.

A remote data storage manager can be configured to provide just in time storage allocation. With just in time storage allocation the remote data storage manager can interface with a service provider which provides the remote storage to set aside or mark storage space as requested. But all of the physical storage to support the request is not actually allocated thus delaying the cost of that physical storage. The storage is allocated in accordance with actual use. Thus different amounts of storage can be allocated to users on an as needed basis. In contrast to allocating storage in advance or fulfilling a request at the time of the request just in time storage allocation facilitates a much higher utilization of storage at a lower cost because storage is provisioned on an as needed basis.

The description that follows includes example systems methods techniques instruction sequences and computer program products that includes techniques of the features described herein. For instance this disclosure often refers to storage disks for ease of understanding. Embodiments can be applied to any type of storage and is not limited to storage disks. Examples of other storage that can be allocated in accordance with this disclosure include flash storage disk arrays flash arrays tape drives tape arrays etc. In addition examples refer to a storage server that stores data. But embodiments are not so limited. Embodiments can be applied to environments that employ a network storage architecture e.g. network attached storage storage area network etc. . Further examples herein refer to volumes. Embodiments are not limited to volumes and can be applied to various logical storage containers regardless of the moniker. However it is understood that the described features may be practiced without these specific details. In instances well known instruction instances protocols structures and techniques have not been shown in detail in order not to obfuscate the description.

Remote data storage can include cloud storage in which storage space is allocated from storage devices maintained and provided by a service provider e.g. cloud service provider . In addition to the storage devices the service provider can maintain storage controllers and storage network elements e.g. switches bridges etc. . The service provider provides access to its resources e.g. the storage space via interfaces e.g. application programming interfaces that communicate with the appropriate elements of the service provider e.g. gateways servers etc. to request allocations and access allocated storage space.

Storage space in a remote data storage of a service provider can be organized and allocated by containers. Examples of a container include an aggregate i.e. a grouping of storage arrays a volume a partition etc. A container can include multiple storage devices or can include portions of space of multiple storage devices i.e. multiple storage devices can support multiple containers . In response to determining more storage is needed for a user new storage space can be allocated within a current container or a new container. In particular a determination is made of whether 1 a current container has sufficient capacity to accommodate this new allocation without allocating additional storage disks to the current container 2 a current container has sufficient capacity to accommodate this new allocation based on allocating additional storage disks to the current container or 3 a new container having one or more storage disks needs to be created to accommodate this new allocation. This allocation to a specific container can be made independent of user involvement. Accordingly in response to a user needing more storage capacity the remote data storage can be configured to provide more storage allocation in a specific container without the user s involvement or knowledge. As further described below the container can be selected based on the application profile and the current available containers.

The remote storage server includes storage disks an operating system a remote storage manager a storage disk service and machine readable media . The storage disks includes allocated storage disks and unallocated storage disks . The allocated storage disks include storage disks storage disks and storage disks . As further described below the allocated storage disks include those storage disks that have already been allocated or provisioned to at least one of the users . For example volumes can be created on the allocated storage disks such that a user can read and write data on those volumes assigned to the user. The storage disks can be allocated to a user based on just in time storage allocation in which a user can be allocated more storage as more is needed on an as need basis .

The remote storage manager is communicatively coupled to the operating system and the storage disk service . The storage disk service and the storage operating system are communicatively coupled to the storage disks . The storage operating system is communicatively coupled to the machine readable media . The storage operating system the remote storage manager and the storage disk service can be software firmware hardware or a combination thereof. For example the storage operating system the remote storage manager and the storage disk service can be software executing on a processor not shown in . An example of this architecture is depicted in which is described in more detail below. The machine readable media can be different types of volatile or nonvolatile memory e.g. one or more of cache SRAM DRAM zero capacitor RAM Twin Transistor RAM eDRAM EDO RAM DDR RAM EEPROM NRAM RRAM SONOS PRAM etc. . The machine readable media is configured to store a number of containers shown as a container a container and a container . A container can represent a logical grouping of one or more storage disks. The operating system can manage the containers. The operating system can create delete expand or reduce the containers. For example the operating system can expand a container to add more storage disks to its logical grouping. also depicts the relationships between the containers stored in the machine readable media and the allocated storage disks stored in the storage disks . The container includes a logical grouping of storage disks six storage disks . The container includes a logical grouping of storage disks two storage disks . The container includes a logical grouping of storage disks three storage disks . The storage disk service can provide information about the storage disks to the remote storage manager. For example the storage disk service can provide different information about the storage disks in the remote storage server e.g. performance characteristics size type number etc. of the storage disks .

As further described below in response to determining more storage is needed for a user storage operating system can allocate storage within a current or new container. In particular a determination is made of whether 1 a current container has sufficient capacity to accommodate this new allocation without adding additional storage disks to the current container 2 a current container has sufficient capacity to accommodate this new allocation based on adding additional storage disks to the current container or 3 a new container having one or more storage disks needs to be created to accommodate this new allocation.

Although depicts the remote storage server as including storage disks the scope of the claims are not so limited. Just in time allocation of storage space from a service provider can be applied if the remote storage server is communicatively coupled with storage disks . The remote storage server can be coupled with the storage disks with any of various networking implementations e.g. switched fabric Ethernet iSCSI etc. . The remote storage server may cache data for the storage disks and or maintain metadata about the data stored on the storage disks . As stated previously the storage disks can be flash storage tape drives etc.

Various operations that can be performed for just in time storage allocation at a remote storage server in response to additional storage being needed are now described. In particular depict flowcharts of operations for just in time storage allocation at a remote storage server. The operations depicted in are described in reference to a user making a request for additional storage. However these operations can also occur based on monitoring storage usage for instance by different user applications. For example a remote storage manager can initiate a request for additional storage for an application if the application is almost out of space based on its current storage capacity without any user request . As an example the request for additional storage can be initiated if the free space remaining for an application is less than some threshold e.g. 5 .

A flowchart of a flowchart of and a flowchart of are described in reference to . The operations of the flowcharts are performed together and continue among each other as defined by transition points A B C D and E. The operations of the flowcharts can be performed by software firmware hardware or a combination thereof. With reference to the example of the operations can be performed by the remote storage manager and the storage operating system . The operations of the flowchart start at block .

At block a determination is made to increase available storage based on a just in time storage allocation. For example the remote storage manager can determine that the user is in need of additional storage space. The remote storage manager can make this determination based on a request from the user for additional storage. For example the request from the user can include the name of the volume the size of the volume e.g. 200 Gigabytes 1 Terabyte etc. and the underlying storage disk type. The underlying storage disk type can be based on one or more performance characteristics e.g. the number of Provisioned Input Output per Second PIOPS . For example a performance characteristic of the underlying storage disk type can be 300 PIOPS 1000 PIOPS 2000 PIOPS 3000 PIOPS 4000 PIOPS etc. The remote storage manager can also make this determination based on monitoring usage by the user . For example the remote storage manager can make a determination that the current available storage for the user has dropped below an available storage threshold e.g. 10 thereby triggering the need for additional storage for the user . Operations of the flowchart continue at block .

At block the working environment capacity information is retrieved. With reference to the remote storage manager can request the working environment capacity information from the storage operating system. The working environment capacity information can include an identification associated with this group of containers the containers . The working environment capacity information can also include the following information about each container in this working environment 1 name 2 total size 3 used size 4 number of storage disks 5 number of volumes 6 storage disk type and 7 the over provisioning amount. The over provisioning amount for a container includes the total of all the container s thin provisioned volume size used size 

Thin provisioning can include a virtualization of the storage space in the containers such that more space is presented as allocated than is actually allocated. In other words if a storage configuration has enough physical resources to simultaneously support all of the virtualized resources the storage configuration cannot be defined as thin provisioned. Operations of the flowchart continue at block .

At block a determination is made of whether there are any containers having the correct storage disk type and having less than the maximum number of storage disks. With reference to the remote storage manager can make this determination. According to some aspects each storage disk in a container is of a same storage disk type. Therefore if the user has configured their storage to have a certain storage disk type the remote storage manager locates those available containers having this requested storage disk type. Also the working environment capacity information includes the number of storage disks in each container. In the example depicted in the container includes six storage disks the storage disks the container includes two storage disks the storage disks and the container includes three storage disks the storage disks . For those containers having the correct storage disk type the remote storage manager also determines whether these containers have less than the maximum number of storage disks e.g. five . The maximum number of storage devices can depend on various factors e.g. platform configuration etc. . A container can have different storage disk types. In these situations there is no criterion for having a correct storage disk type. Therefore the remote storage manager can locate those containers having less than the maximum number of storage disks independent of the storage disk type . If there are no containers having the correct storage disk type and having less than the maximum number of storage disks referred to herein as determined available containers operations of the flowchart continue at block . Otherwise operations of the flowchart continue at block .

At block a determination is made of whether any of the determined available containers can accommodate the increased available storage. With reference to the remote storage manager can make this determination. In particular when more storage is needed for a user the remote storage manager can search the determined available containers to determine whether an existing container can accommodate the additional storage e.g. added volume or whether a new container needs to be created. If none of the determined available containers can accommodate the increased storage operations of the flowchart continue at transition point B which continues at transition point B in the flowchart of . Otherwise operations of the flowchart continue at block .

At block a determination is made of whether free space in the available container s decline below a free space ratio based on accommodating the increased storage. With reference to the remote storage manager can make this determination. For example the remote storage manager can determine that the available container is considered to have enough free space if the following is true 

The container used size is the amount of storage in the container that is currently being used to store data. The container size is the amount of storage both used and unused that is available to store data or the configured size of the container. The free space ratio is the amount of free space that is to remain available in the container. In a first example assume the free space ratio is 0.1 10 the container size is 100 gigabytes and the container used size is 95 gigabytes. In this first example this available container would fail the free space test because the ratio 0.95 1 0.1. In a second example assume the free space ratio is 0.1 10 the container size is 100 gigabytes and the container used size is 88 gigabytes. In this second example this available container would pass the free space test because the ratio 0.88

The operations of the flowchart are now described. The flowchart begins at the transition point A that is a continuation from transition point A of the flowchart . From the transition point A operations of the flowchart continue at block .

At block a determination is made of whether the over provisioning rate of the available container s that have passed the free capacity test described in block above has declined below an over provisioning ratio. With reference to the remote storage manager can make this determination. For example the remote storage manager can determine that the available container s over provisioning rate has not declined below the over provisioning ratio if the following is true 

The container free size is the amount of free storage space in the container. The volume size is the size of a volume in the container. The volume used size is the amount of space in a volume that has been used. The volume size the volume used size can be summed across all of the thin provisioned volumes in the container. The OPRatio is the over provisioning ratio that the container s provisioning rate is not to fall below. For example assume that the over provisioning ratio is five and that the container free size is 10 Gigabytes. Also assume that the container includes 10 volumes wherein each volume has a volume size of 11 Gigabytes and a volume used size of one Gigabyte. For this example the result would be as follows 

In this example the container is over provisioned because the over provisioning rate of the available container is greater than an over provisioning ratio.

If the requested additional storage is not provisioned the volume size of the additional storage can be included in the summarization across all of the thin provisioned volumes in the container wherein the volume used size of 0 volumeSize of additional storage 0 . If the requested additional storage is not thin provisioned the volume size of the requested additional storage is not included in the summarization across all of the thin provisioned volumes in the container. If the over provisioning rate of the available container s has not declined below an over provisioning ratio operations of the flowchart continue at block . Otherwise operations of the flowchart continue at transition point E which continues at transition point E in the flowchart of . Also from the transition point C operations of the flowchart continue at block .

At block a determination is made of whether at least one of the available container s can add another storage disk to accommodate additional storage. With reference to the remote storage manager can make this determination. In particular the remote storage manager can determine whether any of the containers that have enough free space see block and whose capacity is not over provisioned see block can add another storage disk to accommodate the requested additional storage. The remote storage manager can make this determination. If at least one of these available container s can add another storage disk to accommodate additional storage these available container s can be considered eligible containers and operations of the flowchart continue at block . Otherwise operations of the flowchart continue at block .

At block the total number of storage disks required to store the current capacity and the additional requested storage for each available container that is eligible is determined. With reference to the remote storage manager can make this determination. As described above a container may have a maximum number of storage disks that can be used to store user data. The maximum number of storage disks can vary or be constant across the different containers. The remote storage manager can determine this data for each available container that is eligible. Operations of the flowchart continue at block .

At block a determination is made of whether the total number of storage disks to store the current capacity and the additional requested storage for any eligible available container is less than the maximum number of storage disks whether the total number of storage disks criteria is satisfied also used in block described below . With reference to the remote storage manager can make this determination. The remote storage manager can determine the maximum number of storage disks for each eligible available container. The remote storage manager can determine that none one or more than one eligible available container satisfy this storage criteria. If none of the eligible available containers satisfy this storage criteria total number of storage disks can store the current capacity and the additional requested storage operations of the flowchart continue at block . Otherwise operations of the flowchart continue at transition point D which continues at transition point D of the flowchart further described below . Also from the transition point B operations of the flowchart continue at block .

At block m a new container is created to accommodate additional storage based on the application profile . With reference to the remote storage manager can request that the storage operating system create the new container The number of storage disks that are needed to provide the requested capacity for the requested storage can be based on the following 

Also the application profile can be part of the request for storage. The application profile can be provided by the user that is requesting the storage. The application profile can define the performance and efficiency of the storage being requested. For example as part of the request for storage the user can request a certain size for the storage volume e.g. 100 Gigabytes having one of a number of application profiles. A first type of application profile can be performance based wherein performance has priority over cost. For example the storage that is to be allocated is not based on thin provisioning compression or other types of efficiencies that may adversely affect I O performance. Therefore if the request is for 100 Gigabytes of storage the container needs to actually have 100 Gigabtyes. A second type of application profile is efficiency based. For example thin provisioning can be used on the allocation of storage for this request. A third type of application profile is a compromise between performance and efficiency with a bias toward one or the other. For example the third type of application profile can have a performance bias having some efficiency. The type of application profile can also determine the type of underlying storage disk type to be used. For example for a performance based application profile a performance characteristic of the storage disk type is a highest available PIOPS e.g. 4000 PIOPS . In contrast for an efficiency based application profile a performance characteristic of the storage disk type is a lowest available PIOPS e.g. 300 PIOPS . For a performance bias with efficiency based based application profile the storage disk type is a mid range available PIOPS e.g. 1000 2000 PIOPS .

Also according to some aspects the storage can be a Redundant Array of Independent Disks RAID that includes data striping. The data striping provides for storage of data by segmenting logically sequential data such that consecutive segments are stored on different storage disks. Thus the more storage disks that are used the better the performance faster I O operations . Accordingly the more storage disks that a container includes the better the performance of the container. Therefore the remote storage manager can create a container with more storage disks if the application profile is performance based. Alternatively the remote storage manager can create a container with less storage disks if the application profile is efficiency based. Additionally the capacity of the storage disk used for the container can be based on the application profile. In particular the greater the capacity of the storage disk the better the performance but greater cost. Therefore the remote storage manager can create a container with greater capacity storage disks e.g. 6 Terabytes if the application profile is performance based. Alternatively the remote storage manager can create a container with less capacity storage disks e.g. 1 Terabyte if the application is efficiency based. Therefore the remote storage manager can request that the storage operating system create the new container with one or more storage disks with different criteria based on the application profile. Operations of the flowchart continue at transition point F which continue at transition point F in the flowchart of which completes the operations.

The operations of the flowchart are now described. The flowchart begins at either the transition point D that is a continuation from transition point D of the flowchart or the transition point E that is a continuation from transition point E of the flowchart . From the transition point D operations of the flowchart continue at block . From the transition point E operations of the flowchart continue at block .

At block a determination is made of whether more than one container satisfies the total number of storage disks criteria. In other words a determination is made of whether more than one eligible available container satisfies the following the total number of storage disks in the container to store the current capacity and the additional requested storage is less than the maximum number of storage disks see block described above . With reference to the remote storage manager can make this determination. If more than one container satisfies the total number of storage disks criteria operations of the flowchart continue at block . If only one container satisfies the total number of storage disks criteria operations continue at block .

At block a determination is made of whether more than one container has enough free capacity. In other words a determination is made of whether free space in more than one available container has not declined below a free space ratio based on accommodating increased storage see block described above and whether over provisioning rate of the more than one available container has not declined below an over provisioning ratio see block described above . With reference to the remote storage manager can make this determination. If more than one container has enough free capacity operations of the flowchart continue at block . If only one container has enough free capacity operations continue at block .

At block a determination is made of whether any of the multiple containers satisfy the application profile. With reference to the remote storage manager can make this determination. For example if the operations are coming from block the remote storage manager can determine whether any of the multiple containers that satisfy the total number of storage disks criteria also satisfy the application profile. If the operations are coming from block the remote storage manager can determine whether any of the multiple containers that have enough free capacity satisfy the application profile. As described above there can be different types of application profiles having different criteria. For example the criteria for the application profiles can include the storage disk type the number of storage disks in the container capacity of the storage disks thin provisioning compression etc. If any container satisfies the application profile operations of the flowchart continue at block . Otherwise operations of the flowchart continue at transition point B which continues at transition point B in the flowchart in which a new container is created as described above at block .

At block the container with the least number of storage disks is selected. With reference to the remote storage manager can make this selection. In particular because there are multiple containers that can be selected the remote storage manager can select the container with the least number of storage disks. For this path in the flowchart the operations are complete.

At block a determination is made of whether the one container satisfies the application profile. With reference to the remote storage manager can make this determination. For example if the operations are coming from block the remote storage manager can determine whether the one container that satisfies the total number of storage disks criteria also satisfies the application profile. If the operations are coming from block the remote storage manager can determine whether the one container that has enough free capacity satisfies the application profile. As described above there can be different types of application profiles having different criteria. If the container satisfies the application profile operations of the flowchart continue at block . therwise operations of the flowchart continue at transition point B which continues at transition point B in the flowchart in which a new container is created as described above at block .

At block he one container is selected. With reference to the remote storage manager can make this selection. For this path in the flowchart the operations are complete.

Further realizations may include fewer or additional components not illustrated in e.g. video cards audio cards additional network interfaces peripheral devices etc. . The processor the storage disks the network interface the memory the storage operating system the remote storage manager and the storage disk service are coupled to the bus . Although illustrated as being coupled to the bus the memory may be coupled to the processor .

As will be appreciated by one skilled in the art embodiments may be embodied as a system method or program code instructions stored in one or more machine readable media. Accordingly embodiments may take the form of an entirely hardware embodiment an entirely software embodiment including firmware resident software micro code etc. or an embodiment combining software and hardware aspects that may all generally be referred to herein as a circuit module or system. The functionality presented as individual modules units in the example illustrations can be organized differently in accordance with any one of platform operating system and or hardware application ecosystem interfaces programmer preferences programming language administrator preferences etc.

Any combination of one or more machine readable medium s may be utilized. The machine readable medium may be a machine readable signal medium or a machine readable storage medium. A machine readable storage medium may be for example but not limited to a system apparatus or device that employs any one of or combination of electronic magnetic optical electromagnetic infrared or semiconductor technology to store program code. More specific examples a non exhaustive list of the machine readable storage medium would include the following a portable computer diskette a hard disk a random access memory RAM a read only memory ROM an erasable programmable read only memory EPROM or Flash memory a portable compact disc read only memory CD ROM an optical storage device a magnetic storage device or any suitable combination of the foregoing. In the context of this document a machine readable storage medium may be any tangible medium that can contain or store a program for use by or in connection with an instruction execution system apparatus or device.

A machine readable signal medium may include a propagated data signal with machine readable program code embodied therein for example in baseband or as part of a carrier wave. Such a propagated signal may take any of a variety of forms including but not limited to electro magnetic optical or any suitable combination thereof. A machine readable signal medium may be any machine readable medium that is not a machine readable storage medium and that can communicate propagate or transport a program for use by or in connection with an instruction execution system apparatus or device.

Program code embodied on a machine readable medium may be transmitted using any appropriate medium including but not limited to wireless wireline optical fiber cable RF etc. or any suitable combination of the foregoing.

Computer program code for carrying out operations for aspects of the disclosure may be written in any combination of one or more programming languages including an object oriented programming language such as the Java programming language C or the like a dynamic programming language such as Python a scripting language such as Perl programming language or PowerShell script language and conventional procedural programming languages such as the C programming language or similar programming languages. The program code may execute entirely on a stand alone computer may execute in a distributed manner across multiple computers and may execute on one computer while providing results and or accepting input on another computer.

Embodiments are described with reference to flowchart illustrations and or block diagrams of methods apparatus systems and program code according to aspects of the disclosure. It will be understood that each block of the flowchart illustrations and or block diagrams and combinations of blocks in the flowchart illustrations and or block diagrams can be implemented by program instructions. These program instructions may be provided to a processor of a general purpose computer special purpose computer or other programmable data processing apparatus to produce a machine such that the instructions which execute via the processor of the computer or other programmable data processing apparatus create means for implementing the functions acts specified in the flowchart and or block diagram block or blocks.

These program instructions may also be stored in a machine readable medium that can direct a computer other programmable data processing apparatus or other devices to function in a particular manner such that the instructions stored in the machine readable medium produce an article of manufacture including instructions which implement the function act specified in the flowchart and or block diagram block or blocks.

The program instructions may also be loaded onto a computer other programmable data processing apparatus or other devices to cause a series of operational steps to be performed on the computer other programmable apparatus or other devices to produce a computer implemented process such that the instructions which execute on the computer or other programmable apparatus provide processes for implementing the functions acts specified in the flowchart and or block diagram block or blocks.

While the embodiments are described with reference to various implementations and exploitations it will be understood that these embodiments are illustrative and that the scope of the inventive subject matter is not limited to them. In general techniques for just in time storage allocation as described herein may be implemented with facilities consistent with any hardware system or hardware systems. Many variations modifications additions and improvements are possible.

Plural instances may be provided for components operations or structures described herein as a single instance. Finally boundaries between various components operations and data stores are somewhat arbitrary and particular operations are illustrated in the context of specific illustrative configurations. Other allocations of functionality are envisioned and may fall within the scope of the inventive subject matter. In general structures and functionality presented as separate components in the example configurations may be implemented as a combined structure or component. Similarly structures and functionality presented as a single component may be implemented as separate components. These and other variations modifications additions and improvements may fall within the scope of the inventive subject matter.

