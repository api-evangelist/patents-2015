---

title: Method and apparatus for allocating client resources to multiple applications
abstract: A quota management system for Personal Video Recorders (PVRs) in which the storage space available on connected storage devices is shared between multiple content providers or multiple software programs.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09363201&OS=09363201&RS=09363201
owner: TVWorks, LLC
number: 09363201
owner_city: Philadelphia
owner_country: US
publication_date: 20150106
---
This application is a continuation of and claims priority to co pending U.S. application Ser. No. 10 788 099 filed Feb. 26 2004 having the same title which content is incorporated herein by reference in its entirety.

The present invention relates to data processing systems and more particularly resource management within a client device such as in personal video recorder.

In current generation personal video recorders PVRs the storage space available is dedicated to the main effectively only application running on the PVR platform namely the storage of received content for subsequent viewing. Unfortunately the dedication of substantially all resources to a single application impedes service and feature expansion thereby decreasing the value of a PVR to a user.

These and other deficiencies of the prior art are addressed by the present invention of a quota management system for Personal Video Recorders PVRs in which the storage space available on connected storage devices is shared between multiple content providers or multiple software programs. The quota system controls the use of storage space for recording television programs by multiple software applications from one or more vendors. A method for adapting a resource allocation according to one embodiment of the invention comprises receiving from a server a provisioning request including resource allocation parameters associated with at least one application said resource allocation parameters indicative of a resource allocation for said at least one application identifying available resources and reserving available resources for said at least one set of applications according to said resource allocation parameters.

To facilitate understanding identical reference numerals have been used where possible to designate identical elements that are common to the figures.

The invention will be described within the context of a quota management system for Personal Video Recorders PVRs in which the storage space available on connected storage devices is shared between multiple content providers or multiple software programs. The quota system controls the use of storage space for recording television programs by multiple software applications from one or more vendors.

In one embodiment a central entity such as a cable operator or PVR service provider e.g. a server controls the use of the storage space by multiple applications based on the quota system. Different vendors providing content to the user through the PVR gain permission from this service provider to reserve memory space or to use a general area or other PVR resources . In one embodiment the invention provides a method and apparatus to share and or reserve the storage space in multiple AV hard drives connected to a PVR.

Client is also connected to a communication system . In one embodiment communication system includes a telephone network and the Internet. In other embodiments communication system could include a network the Internet without a telephone network a dedicated communication system a cable or satellite network a single connection to another computer or any other means for communicating with another electronic entity. The communication system is also connected to a server such as a Unix or Windows server computer or a broadcast head end.

The inventors contemplate that the system may be logically segmented into a server function and a client function. The various functions may be implemented as a method by one or more processors. The functions may be embodied as software instructions within a signal bearing medium or a computer product. Within the context of a peer to peer network the server functions and client functions may both be implemented on client and or server devices.

The receiver module receives television programs applications and other content from a content transmission system such as the network discussed above with respect to . The receiver module includes all of the circuitry necessary to implement at least one of analog television reception digital television reception and data reception. The receiver module is controlled by the control module via a receiver module control signal RMC. The receiver module and control module communicate with each other to effect desired content selections channel selections and the like. The receiver module provides selected received content to RC the storage module . The received content provided to the storage module may comprise compressed content decompressed content data and the like.

The storage module comprises one or more mass storage devices for storing received content RC provided by the receiver module . The storage module may comprise a single mass storage device a plurality of mass storage devices an array of mass storage devices and the like. The storage module is controlled by the control module via a storage module control signal SMC. The storage module and control module communicate with each other to effect desired logical and physical partitioning of the one or more mass storage devices selection of compression decompression formats and other operating details associated with the storage and retrieval of content from the mass storage device s .

The presentation module processes a stored content stream SC provided by the storage module to produce a display signal DS suitable for use by a presentation device such as a television monitor computer display device and the like. For example in the case of the storage module providing a compressed digital video stream and associated audio streams the presentation module includes appropriate decompression decoder circuitry along with presentation circuitry such that a correctly formatted display stream DS is provided to the display device. The display stream DS may comprise a National Television Standards Committee NTSC analog display signal a digital display signal or any other signal format as desired depending upon the type of display device utilized. The presentation module is controlled by the control module via a presentation module control signal PMC. The presentation module and control module communicate with each other to effect desired decompression deencryption processing format processing image processing and other functions associated with processing the stored content stream SC to produce the display signal DS.

The control module comprises a processor as well as memory for storing programs P and data D. The memory may also store an operating system OS supporting the programs P. The processor cooperates with conventional support circuitry such as power supplies clock circuits cache memory and the like as well as circuits that assist in executing the software routines stored in the memory . As such it is contemplated that some of the steps discussed herein as software processes may be implemented within hardware for example as circuitry that cooperates with the processor to perform various steps. The control module also contains input output I O circuitry that forms an interface between the various functional elements communicating with the control module .

Although the control module is depicted as a general purpose computer that is programmed to perform various control functions in accordance with the present invention the invention can be implemented in hardware as for example an application specific integrated circuit ASIC or field programmable gate array FPGA . As such the process steps described herein are intended to be broadly interpreted as being equivalently performed by software hardware or a combination thereof.

The control module may be operably coupled to a number of devices or systems. For example the I O circuitry in is depicted as interfacing to an input device e.g. a keyboard mouse remote control and the like a network e.g. communication system a display device e.g. presentation device a receiver module a storage module and a presentation module .

Various embodiments of the invention may be implemented as a computer program product wherein computer instructions when processed by a computer adapt the operation of the computer such that the methods and or techniques of the present invention are invoked or otherwise provided. Instructions for invoking the inventive methods may be stored in fixed or removable media transmitted via a data stream in a broadcast media and or stored within a working memory within a computing device operating according to the instructions.

Generally speaking the Personal Video Recorder PVR of comprises functional modules adapted to receive television signals in either analog form or digital form and process encode and store the signals as digital data on one or more storage devices and modules. The PVR is adapted to play back the stored television program by accessing the stored data from the storage devices decoding and presenting the stored data in audio visual form. In addition to these modules the PVR includes an operating system or an environment to execute software programs such as a Java Virtual Machine. The PVR uses the input device to collect response from the user and may contain or may be connected to a display device where software programs can present screens visible to users.

The Recording Manager RM is a module that accepts requests from software programs to record television programs. The recording requests may be for television programs being broadcast at the time of the request or for television programs to be recorded in the future. The recording manager stores these requests and initiates the recording at the specified start time and stops the recording after the requested duration of the program has been recorded.

The Volume Manager VM is a module that maintains information about various quotas and reservations for space management. In one embodiment the Volume Manager enforces quotas by using Logical Volumes. A Logical Volume is a container to store for example recorded television programs. A Quota is a limiting value that specifies the maximum amount of storage space that can be used for storing recorded programs in the Logical Volume. For example a Quota value of 5 GB for a Logical Volume means the total amount of space used for all the recorded programs in that Logical Volume should not exceed 5 GB at any time. A Reservation is a value that specifies the minimum amount of space that is guaranteed to be available in a Logical Volume to store recorded programs. For example a Reservation value of 2 GB for a Logical Volume means that there would be at least 2 GB of storage space that will be available on the Logical Volume to store recorded programs.

The Monitor Application MA is a software program with special access rights that is authorized by the PVR service provider to control various functions of the PVR. The Monitor Application MA optionally communicates with a server e.g. server to collect parameters supporting its functionality. The Monitor Application has permission to create Logical volumes Modify or Delete Logical Volumes created by other software programs.

The Monitor application also has permissions to change or remove Reservation values for Logical Volumes. The Monitor application also has permissions to change set or remove Quota values for Logical Volumes. When an application requests the Volume Manager to reserve space on a Logical Volume the Volume Manager checks with the Monitor Application before allowing the request by invoking a module within the Monitor Application. The Monitor Application may grant or deny the request to reserve space.

The Monitor Application MA uses Allocation Provisioning Information to decide whether a request from an application to reserve space in a storage device should be granted or not. If the request is granted the VM then decides the amount of space granted based on the value specified by the Monitor Application. Monitor Application also uses Allocation Provisioning Information to set Quotas on Logical Volumes.

Allocation Provisioning Information may be provided in various forms. In one form the Allocation Provisioning Information specifies that any software programs could reserve any amount of space on any storage device and if space is available in that device to grant the reservation.

In another form the Allocation Provisioning Information identifies multiple groups of software programs that are allowed to make reservations and the maximum value allowable for each group. In this form combined value for all reservations from programs belonging to a group should not exceed the specified maximum value. In this case the group of software programs may be specified as software programs with a specified value of an associated attribute tag. The tag comprises in various embodiments a data structure such as one or more bits a database entry a group or program identifier and the like.

In another form the Allocation Provisioning Information identifies multiple groups of software programs that are allowed to create Logical Volumes and the quota values to be set for these Logical Volumes.

In another form the Allocation Provisioning Information is a function of the storage space available on the PVR e.g. percentage of total or available storage space characteristics of the subscriber e.g. premium or standard of the PVR Service or characteristics of the software program e.g. preferred or standard that requests the reservation. In another form the Allocation Provisioning Information is retrieved from a server connected to the PVR through a communication network e.g. server management of subscriber PVR .

The interactions between software programs the recording manager the volume manager and the monitor application will now be discussed in more detail.

The Default Volume is a designated one of the Logical Volumes in a storage device. The space available on the Default Volume is the space remaining on the storage device after reservations on all other Logical Volumes on that storage device are enforced. In one embodiment of the invention the Volume Manager creates the default volume on each of the connected storage devices. In this model the Logical Volumes may be distributed across multiple physical partitions on multiple storage devices.

The physical device and physical partitions portion comprises one or more hard disk drives which either individually or in any combination support a plurality of data partitions illustratively two denoted as and as well as a plurality of media partitions illustratively two denoted as and . It is noted that the data partitions and media partitions may be stored on individual hard disks in their entireties and or have portions stored on or across multiple hard disks or mass storage devices.

In the models A and B of data partitions and media partitions visible to applications are accessed through general purpose file system APIs such as java.io.File. In one embodiment the PVR Service provider requires all PVRs to have a specified percentage of the total storage capacity available to store non media files. The PVR service provider may also enforce a requirement that specifies that a given percentage of storage space in each storage device connected to the PVR is available to store non media files. In both of these cases the remainder of the storage space is available to store media content. The space available for storing media files on the PVR may be spread across multiple hard disks or other mass storage devices.

At step the RM verifies that quota and reservations for the one or more volumes to be used have not been violated. Information necessary to verify is provided by the volume manager at step where quota and reservation information for the volume is provided. In one embodiment the RM adds up the space used up by all recorded programs stored on a logical volume to make sure that any quota restrictions on that Logical volume are not exceeded. Similarly if space is reserved on a Logical volume the Recording Manager verifies that at least the reserved amount of space is always available on the volume to store television programs. When television programs are stored in a logical volume the Recording Manager updates the available space on that volume based on the space already used up by the television programs.

At step the RM takes corrective action if either the quota or reservations for the volume are violated. If corrective action is taken then a notification of corrective action is communicated to the software program SP at step .

Where the application has rights step and both quota and reservations are not violated step the RM starts recording the television program or other content at the specified time step . After starting a recording a notification of recording start is communicated to the software program at step .

At step the quotas and reservations are periodically verified by the RM to determine that they have not been violated. In the case of a violation steps and are repeated. In the case of no violation the recording of television programming or other content is stopped at a specified time step and notification about the recording stop is communicated to the SP at step .

In one embodiment the Recording Manager enforces the volume restrictions by periodically checking the space usage on all volumes to make sure none of the restrictions are violated. The checks for enforcing volume restriction may also be implemented on modules that write data on to storage devices. If the Recording Manager detects that any of the volume restrictions are about to be violated or are already violated the Recording Manager takes corrective actions to rectify the situation. Some examples of corrective actions include terminating the recording deleting the recording that caused the violation deleting one or more programs in the volume or volumes that exceeded the limit or invoking a software function specified by one of the software programs to handle the situation.

The volume manager also propagates a notification of the creation of a new volume to the monitor application at step . The Monitor Application uses the Allocation Provisioning information to decide whether to set a quota value for the newly created volume. If a quota value has to be set the Monitor Application gets the value for the quota from the Allocation Provisioning Information. Software programs may also request the Volume Manager to set a Quota for a Logical Volume.

At step if the allocation provisioning information specifies setting quotas the monitor application requests that a quota be set. The request is propagated to the volume manager. At step the volume manager sets a quota for the created volume. At step if the quota is being violated programs are deleted to eliminate the violation.

At step a software program requests reservations on a volume which request is received by the volume manager at step . At step the volume manager sends a request to the monitor application to check if the requested reservation should be granted. That is software programs may request the Volume Manager to reserve a specified amount of storage space for the logical volume. When the Volume Manager receives such a request the Volume Manager checks with the Monitor Application to see if the request should be allowed or denied. This check is performed via various methods. One such method is by invoking a software routine within the Monitor Application. Another method is to send a request to the Monitor Application to verify if the reservation request should be granted or not.

At step if the allocation provisioning information allows such a reservation the monitor application returns a value for the allowed space reservation e.g. an amount of space for storage capacity . Upon receiving the request the Monitor Application uses the Allocation Provisioning Information to decide whether the request should be granted or denied. For example if the request to reserve space originated from an application A and if the Allocation Provisioning Information states that application A should be granted a reservation of up to 5 GB of space the Monitor application should grant up to 5 GB of space reservation for the application. In one embodiment of the invention the monitor application uses input from the user to decide how much space on a mass storage device should be granted for the application.

At step the volume manager creates the appropriate reservation on a logical volume. While creating a Logical volume or any time after that an application with sufficient access rights may optionally specify criteria to the Volume Manager for identifying software programs that should be allowed to store television programs on the Logical volume. The Recording Manager interfaces with the Volume Manager to gather information about these criteria. The Recording Manager prevents any software program that does not match the criteria to request television programs from being stored in the specified volume.

Allocation provisioning information may be provided in various forms. In one form the reservation information allows any software programs to reserve any amount of space on any storage device and if space is available in that device to grant the reservation. In another form the information identifies a set of software programs that are allowed to make reservations and the maximum value allowable for each software program. In this case the set of software programs may be specified as software programs with an associated attribute tag. The attribute tag associated with the software program may be transmitted or distributed along with the software program. The attribute tag for software programs may be transmitted separately to the PVR through an index table that includes entries for software programs and all attribute tags associated with the software program. In another form the reservation information is a function of the storage space available on the PVR e.g. percentage of total or available storage space characteristics of the subscriber e.g. premium or standard of the PVR Service or characteristics of the software program e.g. preferred or standard that requests the reservation. In another form the information is retrieved from a server connected to the PVR through a communication network e.g. server management of subscriber PVR .

When a volume is created or when a reservation is made the monitor application may request the volume manager to add additional restrictions on the volume. The Monitor application could request the Volume manager to restrict the space usage on the volume to a given limit or the Monitor application can impose limits on the set of applications that can access the Logical volume.

If a Monitor application is not active in a PVR implementing this system the Volume Manager and the Recording Manager may assume the role and functionality of the Monitor Application. Even when the Volume Manager assumes the functionality of a monitor application previously created volumes and reservations are not changed by the Volume Manager.

The Volume Manager gives a Monitor application the right to change the values of any previously allowed reservation on any Logical Volume. These include adding more space to a reservation removing space from a reservation or deleting a reservation. A Monitor application can create a new Logical volume and reserve space on the Logical Volume and allow other applications to store television programs in the Logical Volume. The Monitor application may use reservation information to create such Logical Volumes and make reservation on Logical Volumes.

If a request to reserve space is made when the monitor application is not active the Volume manager may grant the request provided space is taken away only from the default Logical volumes. When the monitor application gets control again the monitor app may delete the newly created logical volume or the reservation associated with it.

When a Logical volume is reduced in size by the monitor application the Volume manager deletes stored content if needed to make sure that the Logical volume is not using more space than allowed.

If the PVR Service provider changes or if a new set of monitor applications are activated a new monitor application could delete Logical volumes authorized by the earlier monitor application. A New Monitor application or a software program could set up one or more logical volume for reserved space. These requests will be approved by a module registered by the new monitor application.

When a new hard disk is inserted the Volume Manager formats and hard partitions the disk to data and media partitions. The Volume Manager will make the newly added media space available to software programs to record television program. If a monitor application is active the Volume manager notifies the monitor application about the availability of the new space. The monitor application could modify quota restrictions at this point.

The method of is entered at step when a provisioning command is received by the client device. At step application set resource allocations are extracted from the provisioning command. That is referring to box resource allocations defined in terms of memory space processing time quality of service QoS and other criteria are extracted from the provisioning command. A provisioning command may be associated with an application or broadcast request.

At step the available resources within the client device are identified and at step a determination is made as to whether sufficient resources exist to satisfy the extracted application set resource allocations. If insufficient resources exist then at step the resource allocations are adapted per the provisional guidelines. If the resources are sufficient or the adaptation of the resources allocations has occurred per step then at step the available resources are allocated using the application set resource allocations as extracted from the provisioning command or as adapted per step .

At step the method manages monitors the resource utilization of the various application sets invoked within the client environment. At step a determination is made as to whether a new provisioning command has been received. If a new command has not been received then the method continually manages monitors resource utilization of the existing application set. If the new provisioning command has been received then the method processes the new provisioning command by repeating steps through and then continues to manage monitor resource utilization of the application sets at .

Per step the method is performed for every logical volume. Thus for a first iteration of the method a first logical volume is selected. The method is exited when each logical volume has been processed.

At step a determination is made as to whether the selected logical volume should be deleted. If the query at step is answered affirmatively then at step the selected logical volume is deleted and the method returns to step to select the next logical volume. If the query at step is answered negatively then at step a query is made as to whether a reservation or quota value associated with the selected logical volume should be changed. If no such change is indicated then the method proceeds to step to select the next logical volume. Otherwise at step the reservation and or quota value associated with the selected logical volume is changed by propagating a change request to the volume manager. The method then proceeds to step where the next logical volume is selected.

If the request is not a volume creation request then at step a query is made as to whether the request is a reservation request. If the software program has made a reservation request then at step the monitor application is queried to determine if the reservation request may be honored. If the monitor application denies the request then the method returns to step to await the next request. If the monitor application allows the request then at step the allowed value of space is reserved on a volume and the method returns to step .

If at step a reservation request has not been received then at step a determination is made as to whether a set quota request has been received. If a set quota request has been received then at step a determination is made as to whether the software program has permission to effect such a request. If the software program does not have permission then the method returns to step . If the software program does have permission then the method proceeds to step where the quota on the volume is correspondingly set. At step a query is made as to whether the space usage exceeds the quota. If the space usage does not exceed the quota then the method returns to step . If the space usage does exceed the quota then at step some programs are deleted to insure that the space usage does not exceed the quota. The method then proceeds to step .

If at step a set quota request was not received then at step a query is made as to whether a delete volume request has been received. If a delete volume request has not been received then the method proceeds to step . If a delete volume request has been received then at step a determination is made as to whether the software program has permission to effect such a request. If the SP does have permission then at step the volume is delete and the method returns to step . If the SP does not have permission at step then the method returns directly to step .

If the received message is not a volume creation notification then at step a determination is made as to whether the received message comprises a reservation validation request. If not a reservation validation request then the method proceeds to step to await the next message. Otherwise the method proceeds to step where the API is checked to determine if the reservation validation request is allowed. If not allowed then at step a denial message is transmitted and the method proceeds to step . If allowed then at step a message to the volume manager is set indicating that the allowed space is provided and the method proceeds to step .

It will be appreciated by those skilled in the art and informed by the teachings of the present invention that the functionality of the Volume Manager Recording Manager and or Monitor Application may be distributed across various modules of a PVR. That is any one or more of the receiver module storage module presentation module and control module may be used to perform some or all of these functions.

While the foregoing is directed to the preferred embodiment of the present invention other and further embodiments of the invention may be devised without departing from the basic scope thereof and the scope thereof is determined by the claims that follow.

