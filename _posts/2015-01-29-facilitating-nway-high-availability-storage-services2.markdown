---

title: Facilitating N-way high availability storage services
abstract: A method, non-transitory computer readable medium, and apparatus that monitors with a passive storage controller a plurality of active storage controllers. A determination is made with the passive storage controller when a failure of one of the active storage controllers has occurred based on the monitoring. Storage device(s) previously assigned to the one of the active storage controllers are remapped to the passive storage controller. A transaction log associated with the one of the active storage controllers is retrieved with the passive storage controller from a transaction log database. Transaction(s) in the transaction log are replayed with the passive storage controller, when the failure of the one of the active storage controllers is determined to have occurred.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09632890&OS=09632890&RS=09632890
owner: NetApp, Inc.
number: 09632890
owner_city: Sunnyvale
owner_country: US
publication_date: 20150129
---
This application is a continuation in part of U.S. patent application Ser. No. 14 325 897 filed Jul. 8 2014 which is hereby incorporated by reference in its entirety.

This technology relates to failover in data storage networks and more particularly to methods and devices for providing high availability storage services.

A storage fabric may include multiple storage controllers including physical and or virtual storage controllers which store and manage data on behalf of clients. Applications utilizing such storage systems rely on continuous data availability. Accordingly with respect to physical storage controllers one common technique to provide high availability is to cross wire storage drives or fabric between two physical storage controllers to provide a seamless transfer if one of the physical storage controllers fails.

While both physical storage controllers can operate simultaneously neither physical storage controller should operate at greater than half capacity since each of the physical storage controller may need to service the traffic previously serviced by a failed one of the physical storage controllers. Accordingly providing high availability in the context of physical storage controllers requires maintaining significantly underutilized storage controllers with excess headroom which is undesirable particularly considering the relatively high cost of the hardware required to implement the physical storage controllers. Additionally the pairing of storage controllers is not an optimal solution in platforms requiring significant scalability.

While virtual storage controllers generally require relatively lower cost to implement than physical storage controllers and therefore underutilization is not a significant concern platforms on which virtual storage controllers are implemented may not allow sharing of the same storage drives or fabric between virtual storage controllers or more specifically the virtual machines on which the virtual storage controllers are executed. Accordingly cloud platform providers do not offer virtual storage controllers a shared storage fabric.

Instead high availability for cloud platforms is often implemented using mirroring of the stored data requiring replication and associated storage costs which can be significant. Another technique is simply to reboot a failed virtual storage controller. However rebooting generally takes on the order of several minutes within which applications relying on the services provided by a failed virtual storage controller will generally fail themselves. Therefore providing high availability of virtual storage controllers on a cloud platform generally results in significant additional storage cost or application disruption and or failure.

A method for facilitating n way high availability storage services includes monitoring with one or more passive storage controllers a plurality of active storage controllers. A determination is made with one of the passive storage controllers when a failure of one of the active storage controllers has occurred based on the monitoring. Storage device s previously assigned to the one of the active storage controllers are remapped with the passive storage controller to the passive storage controller. The transaction log associated with the failed storage controller is retrieved by the passive storage controller from a transaction log database. Transaction s in the transaction log are replayed by the passive storage controller and upon completion the passive storage controller transitions its role to an active storage controller. When the previously failed controller is healed it returns to the storage fabric with the role of a passive controller.

An apparatus includes a processor and a memory coupled to the processor which is configured to be capable of executing programmed instructions comprising and stored in the memory to monitor with a passive storage controller a plurality of active storage controllers. A determination is made with the passive storage controller when a failure of one of the active storage controllers has occurred based on the monitoring. Storage device s previously assigned to the one of the active storage controllers are remapped to the passive storage controller. The transaction log associated with the failed storage controller is retrieved by a passive storage controller from a transaction log database. Transaction s in the transaction log are replayed by the passive storage controller and upon completion the passive storage controller transitions its role to an active storage controller. When the previously failed controller is healed it returns to the storage fabric with the role of a passive controller.

A non transitory computer readable medium having stored thereon instructions for facilitating n way high availability storage services includes executable code which when executed by a processor causes the processor to perform steps including monitoring with a passive storage controller a plurality of active storage controllers. A determination is made with the passive storage controller when a failure of one of the active storage controllers has occurred based on the monitoring. Storage device s previously assigned to the one of the active storage controllers are remapped with the passive storage controller to the passive storage controller. The transaction log associated with the failed storage controller is retrieved by a passive storage controller from a transaction log database. Transaction s in the transaction log are replayed by the passive storage controller and upon completion the passive storage controller transitions its role to an active storage controller. When the previously failed controller is healed it returns to the storage fabric with the role of a passive controller.

This technology provides a number of advantages including more efficient and effective methods non transitory computer readable media and host devices for facilitating high availability storage services. With this technology a storage controller can assume the role and responsibility of a storage controller that has failed without having to return traffic to a recovered storage controller reserve headroom in the active controller or replicate data. This technology is highly scalable and high availability can be provided for many or n active storage controllers by only one passive storage controller although more passive storage controllers can be utilized depending on the desired level of protection.

A network environment including a storage fabric with client devices storage controllers and a transaction log database coupled together by communication network s is illustrated in although this environment can include other numbers and types of systems devices components and or elements in other configurations such as multiple numbers of each of these apparatuses and devices. By way of example only the storage controllers can be virtual storage controllers running as virtual machines or physical storage controllers included in purpose built storage arrays. This technology provides a number of advantages including methods non transitory computer readable medium and devices that relatively efficiently facilitate n way high availability of storage services provided by storage controllers.

Each of the client devices in this example can include a processor a memory a network interface an input device and a display device which are coupled together by a bus or other link although each of the client devices can have other types and numbers of components or other elements and other numbers and types of network devices could be used. The client devices may run interface applications that provide an interface to make requests for and send content and or data to the storage controllers via the communication network s for example. Each of the client devices may be for example a conventional personal computer a workstation a smart phone a virtual machine running in a cloud or other processing and or computing device.

The transaction log database can optionally be hosted by a shared memory server which includes a processor a memory and a network interface coupled together by a bus or other communication link and can be an in memory database or cache e.g. the ElastiCache web service product available from Amazon.com Inc. of Seattle Wash. or flash based storage for example although other types of storage can also be used for the transaction log database . The transaction log database is configured to store a plurality of transaction logs each associated with an active storage controller which are used by the active storage controllers to store information associated with transactions received from the client devices for example although the transaction logs can also be used to store other information received from other sources as described and illustrated in more detail later.

The communication network s in this example may employ any suitable interface mechanisms and network communication technologies including for example teletraffic in any suitable form e.g. voice modem and the like Public Switched Telephone Network PSTNs Ethernet based Packet Data Networks PDNs combinations thereof and the like. The communication network s may also comprise any local area network and or wide area network e.g. Internet although any other type of traffic network topologies may be used.

Referring more specifically to a block diagram of an exemplary one of the storage controllers is illustrated. The storage controller in this example includes a processor a memory at least one network interface storage devices and an operating system coupled together by a bus or other communication link.

The storage controller can be operating in an active or passive state as described and illustrated in more detail later. In an active state the storage controller services traffic associated with the storage and retrieval of data stored by one or more of the storage devices for example. In a passive state the storage controller monitors one or more active storage controllers to determine when one of the active storage controllers fails at which time the storage controller operating in a passive state assumes the role of the failed one of the active storage controllers as described and illustrated in more detail later.

The processor of the storage controller may execute programmed instructions stored in the memory for various functions and or operations illustrated and described herein. The memory of the storage controller may include any of various forms of read only memory ROM random access memory RAM Flash memory non volatile or volatile memory or the like or a combination of such devices for example.

The network interface operatively couples and communicates between the storage controller the client devices and the transaction log database which are all coupled together by the communication network s although other types and numbers of connections and configurations to other devices and elements can also be used. By way of example only the communication network s can use TCP IP over Ethernet and industry standard protocols including NFS CIFS SOAP XML LDAP and SNMP although other types and numbers of communication networks can also be used.

The storage devices in this example can include conventional magnetic disks solid state drives SSDs or any other type of stable non volatile storage device suitable for storing large quantities of data. The storage devices may be organized into one or more volumes of Redundant Array of Inexpensive Disks RAID .

Although examples of the client devices storage controllers and transaction log database are described herein it is to be understood that the devices and systems of the examples described herein are for exemplary purposes as many variations of the specific hardware and software used to implement the examples are possible as will be appreciated by those skilled in the relevant art s . In addition two or more computing systems or devices can be substituted for any one of the systems in any embodiment of the examples.

The examples also may be embodied as a non transitory computer readable medium having instructions stored thereon for one or more aspects of the present technology as described and illustrated by way of the examples herein as described herein which when executed by the processor cause the processor to carry out the steps necessary to implement the methods of this technology as described and illustrated with the examples herein.

An exemplary method for facilitating n way high availability storage services will now be described with reference to . Referring more specifically to an exemplary method for facilitating high availability storage services with an active one of the storage controllers is illustrated. In step in this example the active one of the storage controllers receives one or more transactions such as from one or more of the client devices for example although the transactions can be received from other sources including internal processes executing on the active one of the storage controllers . Exemplary transactions can include requests from one of the client devices to read or write data although other numbers and types of transactions can be received in step .

In step the active one of the storage controllers stages the transactions such as by storing the one or more transactions in the transaction log database in a transaction log associated with the active one of the storage controllers for example. The transactions are staged because they may be received more quickly than they can be processed by the one of the active one of the storage controllers . Generally processing the transactions requires a relatively long period of time considering the mechanical nature of the operation of storing and retrieving data on disks of the storage devices .

In this example the active one of the storage controllers can send the one or more transactions to the transaction log database with a unique identifier of the active one of the storage controllers . Upon receipt the transaction log database stores the one or more transactions in a transaction log associated with the active one of the storage controllers as identified based on the unique identifier. Optionally only a subset of the one or more transactions received in step are sent to the transaction log database such as those write transactions that affect data stored by the storage devices for example.

In step the active one of the storage controllers executing on the host device receives an acknowledgement that each transaction was successfully stored by the transaction log database . After receiving each acknowledgement the active one of the storage controllers acknowledges the transaction to the source of the transactions such as one or more of the client devices for example.

In step the active one of the storage controllers processes the transactions received in step from the corresponding transaction log in the transaction log database such as by retrieving requested data from one or more of the storage devices and or writing data to one or more of the storage devices for example.

Referring more specifically to an exemplary method for facilitating n way high availability storage services with a passive one of the storage controllers is illustrated. In step in this example the passive one of the storage controllers monitors one or more active ones of the storage controllers . Accordingly the passive one of the storage controllers may monitor any numbers of active ones of the storage controllers and or other numbers of passive ones of the storage controllers could be used to monitor the active ones of the storage controllers .

The monitoring can be based on a heartbeat signal periodically sent from the monitored one or more of the active ones of the storage controllers to the passive one of the storage controllers using an interconnect or other communication link for example. The monitored one or more active ones of the storage controllers can be configured to periodically initiate the heartbeat signal or the passive one of the storage controllers can periodically send a message using the interconnect or other communication link to prompt the monitored active ones of the storage controllers to send the heartbeat signal.

In some examples the heartbeat message received from each of the monitored active ones of the storage controllers includes a unique identifier of the respective one of the active ones of the storage controllers which is used as described and illustrated in more detail later. Other methods of monitoring the health of one or more of the active ones of the storage controllers also can be used.

In step the passive one of the storage controllers determines whether a monitored active one of the storage controllers has entered a failure state. In this example the passive one of the storage controllers can determine whether the active one of the storage controllers has failed based on whether it has received a heartbeat signal within a specified period of time since a prior heartbeat signal.

In another example the active one of the storage controllers can be configured to communicate to the passive one of the storage controllers using an interconnect or other communication link that it has entered a failure state. Other methods of determining that the active one of the storage controllers has failed also can be used. In this example the failure identified by the passive one of the storage controllers can be of the one of the operating systems of the monitored one of the active storage controllers a hypervisor failure or a hardware failure for example.

If the passive one of the storage controllers determines in step that none of the monitored active ones of the storage controllers has failed then the No branch is taken back to step and the passive one of the storage controllers continues to monitor active ones of the storage controllers and effectively wait for one of the active ones of the storage controllers to fail.

Referring back to step if the passive one of the storage controllers determines that one of the active ones of the storage controllers has failed then the Yes branch is taken to step . In step the passive one of the storage controllers remaps at least one or more of the storage devices previously assigned to the failed active one of the storage controllers to be assigned to the passive one of the storage controllers . The remapped one or more of the storage devices also can be virtual storage devices corresponding to one or more of the storage devices or portions thereof for example. In one example in order to remap the one or more of the storage devices the passive one of the storage controllers can make call s to an application programming interface API supported by the cloud platform provider for example although other methods of remapping the one or more of the storage devices can also be used.

In some examples the passive one of the storage controllers also remaps the network interface or more specifically a network interface controller NIC of the network interface previously assigned to the failed active one of the storage controllers to be associated with the passive one of the storage controllers . By remapping the NIC an application associated with one or more of the client devices previously communicating with the one of the operating systems associated with the failed active one of the storage controllers can communicate with the operating system of the passive one of the storage controllers . The NIC can be remapped using call s to the API provided by the cloud platform provider or through IP address translation of the traffic received from one or more of the client devices as managed by the operating system for example although other methods of remapping the NIC can also be used.

In step the passive one of the storage controllers retrieves the transaction log associated with the failed one of the active storage controllers from the transaction log database . The passive one of the storage controllers can use a unique identifier of the failed active one of the storage controllers such as communicated with the heartbeat signal for example to retrieve the transaction log corresponding to the failed active one of the storage controllers although other methods of identifying and or retrieving the transaction log associated with the failed active one of the storage controllers can also be used.

In step the passive one of the storage controllers replays the transactions stored in the transaction log retrieved in step and effectively assumes the role of the failed active one of the storage controllers . In parallel the failed active one of the storage controllers performs a failure processing routine including performing a core dump and rebooting the associated operating system for example. Upon rebooting the failed active one of the storage controllers can effectively assume the role of the passive one of the storage controllers .

Referring more specifically to in another example another exemplary network environment with three active storage controllers and and a passive storage controller is illustrated. Additionally the network environment in this example includes three client devices and a transaction log database.

Referring more specifically to the exemplary network environment is illustrated in which one of the active storage controllers also referred to in as storage controller B has failed and the formerly passive storage controller also referred to in as storage controller D has become an active storage controller . Accordingly in this example active storage controller B fails passive storage controller D retrieves storage controller B s transaction log from the transaction log database and replays the transactions as described and illustrated earlier with reference to . Thereafter storage controller D transitions its role to an active storage controller . The transaction log associated with the active storage controller B that is retrieved and replayed was previously maintained by the active storage controller B as described and illustrated earlier with reference to .

Referring more specifically to an exemplary network environment is illustrated in which the one of the active storage controllers that failed has become a passive storage controller . Accordingly in this example once storage controller B is healed it returns to the storage fabric as passive controller .

Accordingly with this technology a passive storage controller can retrieve and replay transactions in a transaction log corresponding to a failed active storage controller and retrieved from a transaction log database. By maintaining transaction logs on a shared memory service a passive storage controller can monitor any number of active storage controllers. Additionally this technology is optimized for scalability and network administrators can control the ratio of passive and active storage controllers in order to provide a desired level of protection and availability. Further high availability of storage controllers can advantageously be provided on a cloud platform without requiring replication of data and associated cost with reduced disruption to applications utilizing the storage controllers and with increased scalability.

Having thus described the basic concept of the invention it will be rather apparent to those skilled in the art that the foregoing detailed disclosure is intended to be presented by way of example only and is not limiting. Various alterations improvements and modifications will occur and are intended to those skilled in the art though not expressly stated herein. These alterations improvements and modifications are intended to be suggested hereby and are within the spirit and scope of the invention. Additionally the recited order of processing elements or sequences or the use of numbers letters or other designations therefore is not intended to limit the claimed processes to any order except as may be specified in the claims. Accordingly the invention is limited only by the following claims and equivalents thereto.

