---

title: Adaptive gain control using sample-and-hold circuit for analog CDS
abstract: An image processing circuit includes a first sample-and-hold circuit that samples a first data from a pixel, a second sample-and-hold circuit that samples a second data from the pixel, a voltage-to-current circuit that includes a resistor and a current source and receives the first and second data to output a difference data, an adaptive gain control determination circuit that determines whether a rate of change of a signal from the pixel exceeds a threshold based on an output of the second sample-and-hold circuit, and a current-mode ADC that converts the difference data from an analog form to a digital form.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09661251&OS=09661251&RS=09661251
owner: Sony Semiconductor Solutions Corporation
number: 09661251
owner_city: Kanagawa
owner_country: JP
publication_date: 20151030
---
This application relates generally to image sensor readout chains which includes sample and hold circuits. More specifically this application relates to an image sensor readout circuit that implements analog gain to improve noise performance and maintain dynamic range.

Image sensing devices typically consist of an image sensor generally an array of pixel circuits as well as signal processing circuitry and any associated control or timing circuitry. Within the image sensor itself charge is collected in a photoelectric conversion device of the pixel circuit as a result of the impingement of light.

One example of a pixel circuit is illustrated in . As shown in a pixel circuit includes a photoelectric conversion device for example a photodiode a floating diffusion FD a transfer transistor a reset transistor an amplification transistor and a selection transistor and a vertical signal line . As illustrated vertical signal line is common to a plurality of pixel circuits within the same column. Alternatively a vertical signal line may be shared among multiple columns. Gate electrodes of transfer transistor reset transistor and selection transistor receive signals TRG RST and SEL respectively. These signals may for example be provided by the control or timing circuitry.

While illustrates a pixel circuit having four transistors in a particular configuration the current disclosure is not so limited and may apply to a pixel circuit having fewer or more transistors as well as other elements such as capacitors resistors and the like. Additionally the current disclosure may be extended to configurations where one or more transistors are shared among multiple photoelectric conversion devices.

The voltage at signal line is measured at two different times under the control of timing circuits and switches which results in a reset signal P phase value and light exposed or data signal D phase value of the pixel. This process is referred to as a correlated double sampling CDS method. The reset signal is then subtracted from the data signal to produce a value which is representative of an accumulated charge in the pixel and thus the amount of light shining on the pixel. The accumulated charge is then converted to a digital value. Such a conversion typically requires several circuit components such as sample and hold S H circuits analog to digital converters ADC and timing and control circuits with each circuit component serving a purpose in the conversion. For example the purpose of the S H circuit may be to sample the analog signals from different time phases of the photo diode operation after which the analog signals may be converted to digital form by the ADC. A single slope ADC is illustrated in including a comparator a digital counter and a ramp reference voltage V. In an analog sample and hold circuit is not included and the sampling of the signal is done digitally by the ramp ADC.

As illustrated by VSL settles to a steady voltage after the pixel has been reset. Then in the above example where a single slope ADC is used the ADC measures the voltage VSL beginning with the start of the reset settling followed by the ADC of reset signal period. During this measurement Vbegins at a high level and then decreases linearly as a function of time from this initial high level. Simultaneously the digital counter starts counting from zero while monitoring the output of the comparator so as to stop counting when the comparator changes state. At this point the stopped count value is a digital value corresponding to the reset signal of the pixel. The data signal value of the pixel is then measured in a similar fashion after the signal line VSL has once again settled i.e. during the data noise integration period illustrated in . The difference between the data and reset values is then interpreted as the amount of illumination on the pixel.

In many practical pixel readout circuits there is a tradeoff between ADC noise floor and ADC maximum input level. In order to best sense the pixels with low illumination the readout chain is preferably set to provide high signal gain with lowest input referred noise. At strong illumination on the other hand the readout chain is preferably set to provide low signal gain in order not to have saturation. In other words the preferred settings for low illumination pixels and high illumination pixels are different.

In summary common attempts to improve noise performance may reduce the dynamic range of the image sensor. Thus there exists a need for a pixel readout chain that improves the signal to noise ratio SNR without degrading the dynamic range of the image sensor.

Various aspects of the present disclosure relate to a sample and hold circuit and or a black sun detection circuit for improving the operation of a sample and hold circuit.

In one aspect of the present disclosure an image processing circuit comprises a first sample and hold circuit configured to sample a first data from a pixel a second sample and hold circuit configured to sample a second data from the pixel a voltage to current circuit including a resistor and a current source and configured to receive the first data and the second data and output a difference data an adaptive gain control determination circuit configured to determine whether a rate of change of a signal from the pixel exceeds a first predetermined threshold based on an output of the second sample and hold circuit and a current mode analog to digital converter configured to convert the difference data from an analog form to a digital form.

In another aspect of the present disclosure a method of processing an image comprises sampling a first data from a pixel by a first sample and hold circuit sampling a second data from the pixel by a second sample and hold circuit receiving the first data and the second data by a voltage to current circuit including a resistor and a current source outputting a difference data by the voltage to current circuit determining whether a rate of change of a signal from the pixel exceeds a predetermined threshold by an adaptive gain control determination circuit based on an output of the second sample and hold circuit and converting the difference data from an analog form to a digital form by a current mode analog to digital converter.

In yet another aspect of the present disclosure an imaging device comprises a pixel including a photoelectric conversion device configured to convert an incident light into an analog signal and an image processing circuit including a first sample and hold circuit configured to sample a first data from the pixel a second sample and hold circuit configured to sample a second data from the pixel a voltage to current circuit including a resistor and a current source and configured to receive the first data and the second data and output a difference data an adaptive gain control determination circuit configured to determine whether a rate of change of the analog signal from the pixel exceeds a predetermined threshold based on an output of the second sample and hold circuit and a current mode analog to digital converter configured to convert the difference data from an analog form to a digital form.

This disclosure can be embodied in various forms including hardware or circuits controlled by computer implemented methods computer program products computer systems and networks user interfaces and application programming interfaces as well as hardware implemented methods signal processing circuits image sensor circuits application specific integrated circuits field programmable gate arrays and the like. The foregoing summary is intended solely to give a general idea of various aspects of the present disclosure and does not limit the scope of the disclosure in any way.

In the following description numerous details are set forth such as flowcharts data tables and system configurations. It will be readily apparent to one skilled in the art that these specific details are merely exemplary and not intended to limit the scope of this application.

In this manner the present disclosure provides for improvements in the technical field of signal processing as well as in the related technical fields of image sensing and image processing.

The dynamic range R of an image sensor circuit is determined by the maximum possible voltage swing of the signals in the circuit divided by the noise of a dark pixel. Because the voltage swing of a particular circuit design is fixed the dynamic range is also fixed. illustrates the effect of analog gain on the operation of a circuit in view of the fixed nature of the dynamic range. In a signal x from a pixel circuit being input to an analog gain circuit . Analog gain circuit applies a gain G where G is larger than 1. Thus the output signal y is G x. Where the analog gain G is applied to the entire image the maximum possible swing of y is the same as the maximum possible swing of the circuit R. Therefore the maximum swing of x is R G because any value larger than this will become clipped after analog gain is applied. In other words if analog gain is applied indiscriminately to the entire image the dynamic range of the circuit is reduced. Thus it is preferable to apply the analog gain selectively to only a portion of the pixels in the sensor so that the dynamic range of the circuit is maintained while still realizing the noise reduction benefits of analog gain.

To maintain this dynamic range it is preferable to utilize two different analog gains in the sensor circuit and to control the gain selection adaptively Adaptive Gain Control or AGC . Specifically it is preferable to use a first analog gain of 1 low and a second analog gain of G high where G 1. illustrates an exemplary process flow of the analog gain decision for each pixel in the image sensor. The process begins at step S and then at step S samples both the reset and data signals from the pixel. Next at step S CDS subtraction is performed. Because CDS subtraction is performed while the signal is still in the analog domain this step is performed by an analog circuit. At step S the value of the difference signal Diff is compared to a threshold which is set to the value R G. If the value of Diff is less than or equal to R G the analog gain is set to G in step S. If on the other hand the value of Diff is larger than R G the analog gain is set to 1 in step S. Once the analog gain has been set the process terminates at step S and is begins again for the next pixel in the sensor. This procedure is repeated for each pixel in the sensor.

Thus it is guaranteed that the maximum swing of the output that is after the analog gain stage will always stay within the usable dynamic range R of the circuit. Concurrently average noise performance of the image sensor is improved because the signals with a level lower than R G are amplified by the analog gain and thus exhibit an improved SNR. While illustrate only two analog gain values more than two analog gains may be utilized and selected among for further improvement in SNR while maintaining dynamic range.

Using the analog circuit logic illustrated in the two types of pixels i.e. those with analog gain 1 and those with analog gain G are marked so that the digital signal processing DSP circuit after ADC may distinguish between pixels that are high gain pixels and pixels that are low unit gain pixels. The DSP circuit preferably then normalizes the two types of pixels in digital form so that a proper and uniform image may be formed. For example such a DSP circuit can divide the digital value of the high gain pixels by the factor G. Because this is done in digital form it does not affect the SNR and thus the improved SNR of the sensor may be maintained.

To detect whether the difference signal DIFF exceeds the threshold a switched capacitor comparator may be used. illustrate a switched capacitor comparator circuit which includes a differential amplifier a sampling capacitor and a switch . At a time t illustrated in switch is closed and sampling capacitor is charged to a voltage of V t V. This is referred to as the sampling phase in the operation of switched capacitor comparator circuit . At a subsequent time t illustrated in switch is opened. Because sampling capacitor has been charged to the voltage V t V the differential voltage across differential amplifier is V t V t V V. Therefore if V t V t VV the output of switched capacitor comparator circuit is at a low state 0 . If however V t 

To achieve sufficiently high throughput while performing CDS the above S H circuits may be combined in a dual S H configuration. is a block diagram of one such configuration. illustrates an exemplary circuit that converts the reset and data signals from a pixel into a digital form representative of V V. Exemplary circuit may be for example the readout circuit of an image sensor pixel. Circuit includes a first data path including a switch and a S H circuit and a second data path including a switch and a S H circuit . As illustrated in the first data path corresponds to data signal Vand the second data path corresponds to reset signal V. The outputs of S H circuits and are operatively connected to ADC which in turn outputs the digital representation of V V.

To accomplish this switches and are controlled at an appropriate timing so that S H circuits and successively sample the input signal at the proper time so that Vand Vappear at the top and bottom S H circuits respectively. ADC converts the two voltages into digital values. Additionally a subtraction is performed so that the appropriate output signal is obtained. This subtraction may be performed in the analog domain before analog to digital conversion or may be performed in the digital domain after each signal has been individually converted to digital form.

To sample the reset signal switches and are closed and switches and are opened. This causes capacitor to be charged to the voltage V V. After capacitor has been charged up switches and open disconnect to complete the sampling. To sample the data signal a similar operation is performed. That is switches and are closed and switches and are opened. This causes capacitor to be charged to the voltage V V. After capacitor has been charged up the switches and are opened.

In order to convert the difference between the reset to the data signal into current switches and turn on. As a result the sampled reset voltage will appear on the right side of the resistor and the sampled data voltage will be on the left side of resistor .

Because the voltages appearing on the left and right sides of resistor are Vand V respectively the current that flows through resistor is I V V R. This current flows to the input of current mode ADC and is converted to a digital value. In this configuration any type of current mode ADC may be used for example a sigma delta ADC may be used to convert the difference signal into a digital value with a high accuracy.

As can be seen from the current from current source is split and flows into the two transistors and . The current flowing through transistor is I V V R whereas the current at transistor is I I I. To ensure proper operation of dual S H circuit current source is chosen so that the current value Iis larger than the maximum possible value of V V Rfor any Vand Vvalues.

In dual S H circuit ADC receives as an input the current I V V R. This indicates that the CDS subtraction step that is subtracting the reset value from the light exposed signal value is automatically done in the analog domain via the circuit arrangement. This occurs without any additional circuitry required. Another benefit to the configuration of dual S H circuit is that ADC receives a scaled version of the signal difference with a scaling factor of 1 R. This is equivalent to an analog gain in the circuit. Thus Rmay be controlled for example by using a variable resistor several resistors that may be selected among and the like to achieve various analog gains such as gain 1 and gain G as described above. Thus dual S H circuit has both CDS subtraction and analog gain capabilities built in. The output of ADC is a digital value corresponding to V V R and may include additional gain in the digital domain if desired.

To achieve AGC detection the trip point of amplifier may be shifted as described above. Thus a signal present at intermediate output node may be fed to a AGC circuit such as the AGC flip flop described above with regard to so that a determination can be made as to gain.

In the pixel in array outputs a pixel signal as a voltage VSL on a vertical signal line which is clamped as described above. This signal is output to a pair of transistor S H circuits one of which implements trip point shifting as also described above. The output of the trip point shifted S H circuit is latched by an AGC flip flop . When the output of flip flop is 1 this indicates that the signal is below the threshold and thus signifies a high signal where unit analog gain is used. When the output of flip flop is 0 the signal corresponds to a low input and analog gain G is used. The flip flop controls an adjustable resistor Rto achieve the desired analog gain.

The two S H transistor circuits are connected to V2I circuit which comprises a current source having current Iand the resistor having resistance Ras described above. The resistor is connected across the two S H outputs and as a result the current in the resistor I is given by the difference between the sampled reset signal and the sampled data signal divided by R. That is I V V R.

As illustrated in the current Iis split between the resistor and a source follower PMOS transistor that connects to ground just as in the implementation of . Thus where the current flowing through the resistor is I the current flowing through the grounding transistor is I I. Therefore to ensure proper circuit operation the value of current source Iis chosen so that the value Iis larger than the maximum possible value of V V Rfor any Vand Vvalues.

Current Iis fed via another source follower PMOS transistor to ADC which is preferably a current mode sigma delta ADC. Thus ADC sees an input current V V R. As described above with regard to both CDS subtraction and analog gain capabilities are therefore built in to this circuit. The output of ADC is a digital value corresponding to V V R.

ADC is not restricted to a current mode sigma delta ADC but may be any type of analog to digital converter. For example ADC may be a single slope ADC a flash ADC a sigma delta ADC a successive approximation ADC and the like. It is preferable to use a sigma delta ADC for ADC because a sigma delta ADC operates using oversampling where each conversion is the result of many high speed samples. The output from a sigma delta ADC may be passed through a decimation filter to generate the final digital output. As a result ADC will have an inherent low pass filtering characteristic which helps reduce the sampling amplifiers and resistor noise.

The implementation illustrated above may be used concurrently with other circuit features that rely on similar circuit components. For example it is possible to implement black sun spot detection and control using common circuit components with the AGC detection and control illustrated above.

A black sun spot is a problem in some image sensor implementations where very strong illumination for example if a camera is pointed at the sun causes the reset value to be very large and possibly reach the maximum value for the circuit. In this case both the reset value and the data value are at the lowest possible level of the circuit operating range and thus the difference between the data value and the reset value is zero. As a result the output becomes black when there is very strong incoming illumination. This is referred to as the black sun spot problem because the resultant output image shows a black spot when the camera is directly pointing at the sun.

Black sun spot detection may be implemented using a switched capacitor comparator and a flip flop in a manner similar to that illustrated above with respect to . In this case a resistor having resistance Ris used. If V t V t I R the associated transistor is on and the transistor output point is at a low state. If V t 

In the pixel in array outputs a pixel signal as a voltage VSL on a vertical signal line which is clamped by a clamping circuit that will be described in more detail below. This signal is output to a pair of transistor S H circuits one of which implements trip point shifting. In this case to implement trip point shifting for both black sun spot and AGC two switched resistor components are used in series. In this manner one of the resistors is used for AGC and the other is used for black sun spot detection. The output of the trip point shifted S H circuit is latched by an AGC black sun spot flip flop .

The two S H transistor circuits are connected to V2I circuit which comprises a current source having current Iand a resistor having resistance Ras described above. The resistor R is connected across the two S H outputs and as a result the current in the resistor I is given by the difference between the sampled reset signal and the sampled data signal divided by R. That is I V V R.

As illustrated in the current Iis split between the resistor and a source follower PMOS transistor that connects to ground just as in the implementation of . Thus where the current flowing through the resistor is I the current flowing through the grounding transistor is I I. Therefore to ensure proper circuit operation the value of current source Iis chosen so that the value Iis larger than the maximum possible value of V V Rfor any Vand Vvalues.

Current Iis fed via another source follower PMOS transistor to ADC which is preferably a current mode sigma delta ADC. Thus ADC sees an input current V V R. As described above with regard to both CDS subtraction and analog gain capabilities are therefore built in to this circuit. The output of ADC is a digital value corresponding to V V R.

ADC is not restricted to a current mode sigma delta ADC but may be any type of analog to digital converter. For example ADC may be a single slope ADC a flash ADC a sigma delta ADC a successive approximation ADC and the like. It is preferable to use a sigma A delta ADC for ADC because a sigma delta ADC operates using oversampling where each conversion is the result of many high speed samples. The output from a sigma delta ADC may be passed through a decimation filter to generate the final digital output. As a result ADC will have an inherent low pass filtering characteristic which helps reduce the sampling amplifiers and resistor noise.

Clamping circuit includes a select transistor that is operated via a voltage Vclamp at the gate thereof and a source follower transistor. The clamping circuit restricts a minimum voltage VSL of the signal line. Thus even if the signal line could potentially fall to a very low level as a result of very strong illumination on the photodiode the clamping circuit maintains the voltage to a particular minimum value.

AGC BS flip flop may be implemented as a single flip flop or as a pair of flip flops operating in tandem such that one flip flop operates for AGC and another operates for black sun spot detection and control. In the case of a single flip flop the AGC and BS determinations may be performed in a time divisional manner.

The comparison results during both the black sun comparison and AGC stages are latched by AGC BS flip flop illustrated in . The level of the latched signal is used to inform the DSP circuit to set the output to the maximum value in the case of a black sun spot being detected and the latched signal is used to control the resistor for gain setting in the case of AGC comparison output.

Vertical signal line conducts the analog signal for a particular column to a column circuit . While illustrates one vertical signal line for each column in pixel array the present disclosure is not so limited. For example more than one vertical signal line may be provided for each column or each vertical signal line may correspond to more than on column. In any case column circuit preferably includes a plurality of individual image processing circuits . As illustrated the ADC circuit includes a image processing circuit for each vertical signal line however each image processing circuit may correspond to more than one vertical signal line .

Column circuit is controlled by a horizontal driving circuit also known as a column scanning circuit. Each of vertical driving circuit column circuit and horizontal driving circuit receive one or more clock signals from a controller . Controller controls the timing and operation of various image sensor components such that analog signals from pixel array having been converted to digital signals in column circuit are output via output circuit for signal processing storage transmission and the like.

With regard to the processes systems methods heuristics etc. described herein it should be understood that although the steps of such processes etc. have been described as occurring according to a certain ordered sequence such processes could be practiced with the described steps performed in an order other than the order described herein. It further should be understood that certain steps could be performed simultaneously that other steps could be added or that certain steps described herein could be omitted. In other words the descriptions of processes herein are provided for the purpose of illustrating certain embodiments and should in no way be construed so as to limit the claims.

Accordingly it is to be understood that the above description is intended to be illustrative and not restrictive. Many embodiments and applications other than the examples provided would be apparent upon reading the above description. The scope should be determined not with reference to the above description but should instead be determined with reference to the appended claims along with the full scope of equivalents to which such claims are entitled. It is anticipated and intended that future developments will occur in the technologies discussed herein and that the disclosed systems and methods will be incorporated into such future embodiments. In sum it should be understood that the application is capable of modification and variation.

All terms used in the claims are intended to be given their broadest reasonable constructions and their ordinary meanings as understood by those knowledgeable in the technologies described herein unless an explicit indication to the contrary in made herein. In particular use of the singular articles such as a the said etc. should be read to recite one or more of the indicated elements unless a claim recites an explicit limitation to the contrary.

The Abstract of the Disclosure is provided to allow the reader to quickly ascertain the nature of the technical disclosure. It is submitted with the understanding that it will not be used to interpret or limit the scope or meaning of the claims. In addition in the foregoing Detailed Description it can be seen that various features are grouped together in various embodiments for the purpose of streamlining the disclosure. This method of disclosure is not to be interpreted as reflecting an intention that the claimed embodiments require more features than are expressly recited in each claim. Rather as the following claims reflect inventive subject matter lies in less than all features of a single disclosed embodiment. Thus the following claims are hereby incorporated into the Detailed Description with each claim standing on its own as a separately claimed subject matter.

