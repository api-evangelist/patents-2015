---

title: System and method for web-based real time communication with optimized transcoding
abstract: A system and method is provided to allow for real-time communication between a web browser application and a contact center resource, where media codecs supported by the two parties may differ. A processor is configured to bridge the media exchanged between the browser and contact center resource. In bridging the media, the processor transcodes the media based on a first media codec for media directed to and from the web browser application, and further transcodes the media based on the second media codec for media directed to and from a contact center resource.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09648169&OS=09648169&RS=09648169
owner: GENESYS TELECOMMUNICATIONS LABORATORIES, INC.
number: 09648169
owner_city: Daly City
owner_country: US
publication_date: 20151204
---
This application is a continuation of U.S. patent application Ser. No. 14 477 824 filed on Sep. 4 2014 now U.S. Pat. No. 9 210 266 which is a continuation of U.S. patent application Ser. No. 13 956 271 filed on Jul. 31 2013 now U.S. Pat. No. 8 867 731 which are related to of U.S. patent application Ser. No. 13 669 384 filed on Nov. 5 2012 and U.S. patent application Ser. No. 13 669 288 filed on Nov. 5 2012 the disclosures of which are incorporated herein by reference.

Embodiments of the present invention are directed to systems and methods for operating contact centers and more particularly to systems and methods for communicating with users using web browser based communication channels.

In the field of customer communications and services an organization such as a retail company a service company or a non profit organization may operate a website for providing information to customers and clients and or for providing an entry point of communication with a contact center. In addition to the website the organization may also operate a contact center e.g. customer service or sales contact center staffed by people who communicate with customers via a telephone or other audio visual communication channel interactive text chat systems short message service SMS social media co browsing emails letters fax etc.

Generally visitors to an organization s website are presented with information and opportunities for contacting representatives of the organization at the contact centers. These opportunities are typically presented as toll free numbers e.g. 1 800 numbers for voice communications and or chat boxes or windows integrated into a web page for real time text based communications. In some circumstances a user is given the opportunity to fill out a form to indicate what they would like to speak about and to provide their telephone number for a representative of the organization to call the user either immediately or at a designated time using the public switched telephone network PSTN .

However operating toll free numbers and maintaining a sufficiently large number of PSTN lines can often be expensive for organizations. In addition voice communication over a PSTN connection is generally limited to audio and is substantially separate from and independent of the particular browser session currently being used by the caller.

Many organizations often use Data Network Telephony DNT or computer simulated telephony to provide increased flexibility in handling higher numbers of calls through the use of shared connectionless data networks such as the Internet. In such DNT systems high loads can be handled by for example gracefully degrading call quality during peak usage through Quality of Service QoS mechanisms. For example a DNT system may be implemented in part using telephones and gateways based on a voice over IP VoIP protocol such as the Session Initiation Protocol SIP as described in part in Internet Engineering Task Force IETF Request for Comments RFC 2543 3261 and 3262.

Whether the contact centers use PSTN lines DNT connections other types of telephonic communication systems or combinations thereof the contact centers typically include some system for routing incoming calls to the appropriate resources. Such a system may include an interactive voice response IVR system. The call can be connected to an IVR either before reaching the contact center switch such as at the service control point SCP level or after reaching the contact center switch such as through contact center routing mechanisms. During an IVR interaction a voice application or a chain of voice applications is played for the caller and the caller interacts with menu options that are played by the voice application e.g. For new sales press 1. For product support press 2. . Other IVR systems may also or alternatively provide voice recognition systems e.g. Which flight would you like to know the status of You can say the flight number or enter it on your keypad . Interaction with such enunciated voice menus may often be difficult. This may be due in part to confusion because of the recitation of many options presented serially to the caller through the voice interface. Often a caller replays the menu and listens to the available options multiple times before selecting an option. This creates delay in the system that could lead to delays in call processing and to reductions in call processing efficiency and may sometimes result in callers abandoning calls due to frustration.

Accordingly what is desired are economical systems and methods for customers browsing a website to communicate with agents and other resources at the contact center even if the capabilities of the devices at the contact center differ from the capabilities of the devices used by the customers.

Embodiments of the present invention are directed to system and method for real time communication between a customer and a contact center resource. A processor receives a first offer for a browser based call from a web browser application. The first offer includes a first media codec supported by the web browser application. The processor modifies the first offer and generates a second offer having a second media codec supported by the processor. In generating the second offer the processor deletes the first media codec or adds the second media codec to a list containing the first media codec. The processor transmits the second offer for receipt by the contact center resource. In response to the second offer the contact center resource generates an answer including a selection of the second media codec in the second offer. The processor then bridges media exchanged between the web browser application and the contact center resource during the real time communication. In bridging the media the processor transcodes the media based on the first media codec for media directed to and from the web browser application and further transcodes the media based on the second media codec for media directed to and from the contact center resource.

According to one embodiment the contact center resource is a contact center agent device. The contact center agent device may support an agent web browser application for engaging in a browser based call with the web browser application requesting the browser based call.

According to one embodiment the contact center agent device includes a voice over IP client for engaging in a voice over IP call with the web browser application requesting the browser based call. According to one embodiment the processor establishes a web browser call leg with the web browser application according to a web signaling protocol and establishes a voice over IP call leg with the contact center agent device according to a voice over IP signaling protocol.

According to one embodiment in generating the second offer the processor is configured to list the media codecs in the second offer in an order of preference for selection by the contact center resource according to the listed order of preference.

According to one embodiment the processor deletes the first media codec in generating the second offer if the first media codec is not supported by the processor.

According to one embodiment the real time communication is transferred to a second contact center resource for exchanging real time media between the web browser application and the second contact center resource wherein the transfer is without changing a peer connection.

According to one embodiment the processor negotiates a media codec for use for the real time communication between the processor and the second contact center resource. The negotiating may include receiving by the processor an offer from the second contact center resource including a third media codec supported by the second contact center resource and transmitting by the processor an answer including a media codec selected based on knowledge of media codecs supported by the web browser application. According to one embodiment the knowledge is acquired without re negotiating a media session with the web browser.

According to one embodiment the second contact center resource is a media controller configured to deliver a music media service for the web browser application. If the web browser application supports the third media codec the media controller delivers the music media service according to the third media codec. If the web browser application does not support the third media codec the media controller transcodes the music to a media codec supported by the web browser application prior to delivering the music media service to the web browser application.

According to one embodiment the negotiating between the processor and the second contact center resource is without re negotiating a media session with the web browser application.

According to one embodiment the real time communication is upgraded from an audio only communication to an audio and video communication. The upgrading includes receiving by the processor a message from the contact center resource for adding video to the real time communication negotiating attributes for the video between the processor and the web browser application wherein in response to the negotiating the web browser application displays a video stream transmitted by the contact center resource and further displays a prompt for receiving the customer s consent for the web browser application to access a customer camera and in response to receipt of the customer s consent transmitting by the web browser application a video stream captured by the customer camera to the contact center resource.

Embodiments of the present invention are also directed to a method for real time communication between a customer and a contact center resource where the method includes receiving by a processor a first request for a browser based call from a web browser application the first request adhering to a web signaling protocol establishing by the processor a first call leg with the web browser application generating by the processor a second request for a voice over IP call the second request adhering to a voice over IP protocol receiving the second request by a call controller and identifying a contact center resource in response establishing by the processor a second call leg with the identified contact center resource and bridging by the processor media exchanged between the web browser application and the contact center resource during the real time communication.

As a person of skill in the art should recognize embodiments of the present invention allow both premise and cloud based contact center to use the browser as the last mile connect with the contact center. The entire contact center solution may be delivered to a business without the need for additional telephony equipment on the business premise. Agents will simply use the browser as the desktop application as well as the communication device.

The WebRTC service mechanism according to embodiments of the present invention also allows the business web site to collect customer data before placing a WebRTC call to the contact center. This allows business attached data about the customer context without the customer needing to go through an IVR. The contact center routing strategy can use this attached data to find agents with proper skills to answer the call. The agent also will be able to get the full context data about the customer when the call is answered.

Embodiments of the present invention also allow integration of existing contact center media services including IVR. Within a single WebRTC session the contact center is able to deliver multiple media services without the need to change the peer connection on the browser side. The WebRTC Service has a transcoding service built in to ensure endpoints e.g. browser to SIP with incompatible codecs can communicate. The WebRTC service and the contact center also provide intelligent codec negotiation to ensure that whenever media service IVR music on hold is provided the components will avoid the problem of multiple transcoding in the same session if for example the IVR or media controller also acts as a transcoder.

Embodiments of the present invention also allow a customer to start with an audio only call to the contact center. When the agent is reached the agent can request to upgrade the call to audio video. In this regard the agent shows the video stream first and then requests the customer to grant access to the agent to see the customer s video.

Contact center agents can use the WebRTC service to authorize and authenticate the communication device with the contact center. The mechanism uses the same authorization module for all other SIP communication devices.

These and other features aspects and advantages of the present invention will be more fully understood when considered with respect to the following detailed description appended claims and accompanying drawings. Of course the actual scope of the invention is defined by the appended claims.

In the following detailed description only certain exemplary embodiments of the present invention are shown and described by way of illustration. As those skilled in the art would recognize the invention may be embodied in many different forms and should not be construed as being limited to the embodiments set forth herein. Like reference numerals designate like elements throughout the specification.

Exemplary embodiments of the present invention are directed to a system and method for establishing one or more communications channels with visitors to a website and a customer service representative also referred to as an agent using a web browser based communication system. Such a system may be for example a Web real time communication WebRTC system. WebRTC which is also known as RTCWeb enables a web browser to provide real time communications RTC capabilities via JavaScript application programming interfaces APIs without requiring a user to actively download and install additional software and essentially makes bidirectional media processing and media coding technologies available in every browser. WebRTC technology puts a media engine into a browser or into other elements of client devices. The media engine is the technology that manages microphones cameras and speakers and gets audio and video onto and off the internet. Thus a visitor to the website desiring to speak to an agent simply actuates a call button displayed on the website and a voice and or video connection is formed between the visitor and an agent over e.g. the Internet without requiring that the visitor install any standalone applications or browser plug in. The visitor also need not leave his her current web browsing session and initiate a separate call session for engaging in a web browser based voice communication with the agent.

In one exemplary embodiment of the present invention the user s activity on the website is monitored and information derived from monitoring the activity is used to determine whether or not to offer a live agent e.g. a live communication with a customer service representative . If offered a live contact the user may choose to speak to an agent e.g. via text chat telephone WebRTC or another teleconferencing service . The organization may route the user to an agent based on the user s prior activity on the website. For example a first user looking primarily at a particular category of products e.g. laptops available for sale on the website may be directed to a sales agent with specialized knowledge of that category. As another example a second user browsing portions of the website associated with troubleshooting problems associated with a particular product may be routed to a customer support agent such as a technical support agent. As a third example a customer browsing a Spanish or Chinese version of the website may be routed to a Spanish or Chinese speaking customer service representative respectively.

According to one exemplary embodiment of the present invention a user may utilize an out of band OOB or supplemental channel for providing and receiving additional information to and from agents and end users before during and or after a call e.g. by telephone WebRTC or other voice over IP communication channel. In some embodiments the OOB channel is dynamically offered by the contact center through the web server such that the decision to offer the OOB channel is made by the contact center and the user is provided the option to accept or ignore this channel. According to one exemplary embodiment the OOB or supplemental channel may include any communication channel which is logically linked to the real time communication channel used for video and or audio conversation between agents and end users but may be separate from the real time communication channel with respect to the protocol and transmission. For example the display of the OOB channel data could be either separated from or grouped with the real time communication display. According to one embodiment of the present invention the OOB channel is used to display of pictures or movies or a graphical presentation of an IVR selection menu. In some embodiments the additional information may be received via the OOB channel after establishing a call but before connecting the call with an agent. In other embodiments when the additional information is received via the OOB channel before establishing a call it may be used to assist in routing the user to an appropriate agent.

In some embodiments when the customer initiates a call using WebRTC the contact center actively initiates or offers an OOB or supplemental channel to the user to for example show the graphical presentation of the IVR menu and for the agent to push content to the user. For example according to one exemplary embodiment of the invention the OOB channel may also be a text chat window where the additional information is exchanged between agents and end users via text chat. The OOB channel may also be for example a medium for sharing images e.g. screenshots recorded videos documents e.g. tutorials and order forms links to other web pages and or a medium for sharing screens e.g. using remote desktop technology such as remote framebuffer Microsoft Remote Desktop Services and other similar technologies . The OOB channel may also provide a backup communication channel if WebRTC is unreliable due to an unstable a poor Internet connection. Furthermore the OOB channel can provide data without being restricted by quality of service QoS requirements that may be in place for data that is transferred in an in band channel such as a WebRTC channel.

In some exemplary embodiments in addition or in lieu of any information provided via the OOB channel the agents may also be with supplied information regarding the user s browsing history on the organization s website and if available the users responses to web browser based forms in order to provide the agent with a better understanding of the issues the user may be facing.

According to one exemplary embodiment a contact center may be operated by the organization or by another entity. The contact center may according to one example include a WebRTC call server or gateway for receiving incoming requests to establish WebRTC calls also simply referred to as a browser call and a routing server for routing incoming requests from the WebRTC call server to appropriate agents at the contact center. According to one embodiment the WebRTC call server is configured to receive and establish WebRTC sessions and acts as a gateway between WebRTC and SIP. According to one embodiment the WebRTC call is converted into a SIP call and sent to a SIP server . The routing server receives a request from the SIP server to route the SIP call and in response the routing server returns instructions as to where to route the call. If the agent has access to a SIP enabled device the call is routed to the SIP enabled device using SIP. If the agent has access to a WebRTC enabled device the SIP server instructs the WebRTC call server to route the call to the agent device as a WebRTC call. The agents may be reached at one or more agent devices which may include for example desktop or portable computers tablets smartphones or any other device capable of running a web browser or at agent telephones . The agent telephones may be for example SIP phones for engaging in VoIP communication via for example the SIP server .

According to one exemplary embodiment the contact center also includes a web monitor for monitoring customer s activity on the web server . In other embodiments the web monitor may be hosted by the organization and may be a software module running on the web server or on a separate server. Systems and methods for monitoring a customer or web visitor are described in more detail in for example in U.S. application Ser. No. 13 293 575 filed in the United States Patent and Trademark Office on Nov. 10 2011 and titled SYSTEM FOR INTERACTING WITH A WEB VISITOR the entire disclosure of which is incorporated herein by reference.

The contact center may also include a database server for storing information relating to the customers and their interactions with the organization and the contact center. Such information may include for example historical data collected by prior agents regarding prior calls and prior issues or requirements contact information such as names addresses and telephone numbers lists of products owned by the customer and the like.

In some exemplary embodiments the contact center also includes an OOB application server separate from the web server configured to provide OOB or supplemental communications channels to the customer end user devices . For example in some embodiments the web server is configured to handle and supply functionality related to WebRTC calls between the web browser and the WebRTC call server while the OOB application server is configured to provide code and or media associated with the out of band communication channels. In other embodiments the out of band communication channel functionality may be provided by the web server . These out of band communications channels may include without limitation channels that provide web browser based forms text chats video and other types of media that may typically be presentable by a web server to a customer via a web browser. For example text based chat may be used for increased accuracy when communicating addresses email addresses and credit card payment information and to provide URLs to web pages to answer user questions. The OOB channels may also be used for video tutorials official documentation and screen sharing for demonstrating usage. OOB channels may also provide some redundancies in the case of poor connections in the real time communication channel. In this regard the WebRTC call server may assist in establishing socket connections between the customer end user device and the out of band application server and or the agent device .

According to one exemplary embodiment of the invention an end user viewing a website provided by the web application referred to as the website visitor may decide to speak to an agent for asking questions about products viewed on the website engage in a particular transaction or for receiving any other assistance from the agent. A conventional method for initiating this conversation is by dialing a telephone number e.g. a toll free or 1 800 number . The user may also request e.g. via email that the agent call the customer at a particular telephone number or may engage in a text based chat with the agent via the web browser . According to exemplary embodiments of the present invention the end user may in addition or in lieu of these conventional contact mechanisms establish a WebRTC call with an agent via the web browser. Using WebRTC allows a user to participate in a real time voice conversation with an agent thereby increasing their engagement while reducing the costs associated with operating a contact center reliant on standard PSTN public switched telephone network telephone systems. In addition WebRTC calls may be associated with particular browser sessions thereby simplifying the task of associating OOB channels with the in band audio video channel.

The various servers and web monitor of may each include one or more processors executing computer program instructions and interacting with other system components for performing the various functionalities described herein. The computer program instructions are stored in a memory implemented using a standard memory device such as for example a random access memory RAM . The computer program instructions may also be stored in other non transitory computer readable media such as for example a CD ROM flash drive or the like. Also although the functionality of each of the servers is described as being provided by the particular server a person of skill in the art should recognize that the functionality of various servers may be combined or integrated into a single server or the functionality of a particular server may be distributed across one or more other servers without departing from the scope of the embodiments of the present invention.

The process starts and in step the web monitor tracks a user s session on a web application such as for example the web application provided by the web server . In this regard a user invokes the browser in the end user device to access the web application . The user may interact with the website application by navigating though the pages of the website selecting different links submitting information initiating transactions or performing other actions as will be apparent to a person of skill in the art. The navigating of the various pages and the actions performed while visiting the website is tracked by the web monitor as discussed in further detail in the above referenced U.S. application Ser. No. 13 293 575. For example while using the web application a session identifier a session ID or session token or alternatively login information associated with a user account may be granted and associated with the customer end user device and or the web browser running thereon thereby allowing the web application and other servers operated by the organization and or the contact center to identify the user and to track the user s activity.

According to one exemplary embodiment the web monitor monitors tracks the user s activity on the web application to determine the intent or goals of the user while using the website e.g. determining which category of products or services the user is interested in purchasing or determining the problem that the user would like to resolve and associate this computed result with the user s session identifier. According to one exemplary embodiment the web monitor supplies to the routing server information regarding the monitored activity of the user as associated with a particular session identifier.

While perusing the information on the website the user may decide to speak to a customer service representative to obtain information or to ask for assistance in regards to a product or service being viewed. According to one example the visitor may transmit the command to initiate the call by selecting a call button. According to one exemplary embodiment the web application interprets the command as a command to initiate a browser based real time communication channel referred to as a WebRTC call .

In step the WebRTC call server receives the request to initiate the WebRTC call with a customer service representative. According to one exemplary embodiment the request to initiate the call includes for example a Session Description Protocol SDP offer as described in Internet Engineering Task Force IETF Request for Comments RFC 3264 which may include an Interactive Connectivity Establishment ICE candidate as described in IETF RFC5245 . The offer may include information such as a session identifier for identifying the requested session and an IP address of the requesting end user device.

In step the WebRTC call server translates the WebRTC call to a SIP call using a SIP protocol and sends a request e.g. via an INVITE message to the SIP server . Although a SIP call is used as an example a person of skill in the art should recognize that a different protocol for VoIP communication may be used instead of SIP such as for example H.323.

In other embodiments of the present invention the web server may provide the JavaScript that drives WebRTC functionality to the web browser. When the user activates a WebRTC session the other party is matched to the WebRTC call server . The WebRTC call server acts as a proxy or gateway for connection to the actual end party of the user s WebRTC session where the actual party may be for example a WebRTC enabled agent or a SIP enabled agent.

In step the routing server is invoked by the SIP server for identifying an appropriate agent to route the call.

In step a determination is made by for example the SIP server in combination with the router as to whether the identified agent is associated with a WebRTC capable browser. If the answer is NO the SIP server transmits in step a SIP call to the selected agent. For example the SIP server transmits a SIP INVITE message to the selected agent s SIP device e.g. telephone . The selected agent thus communicates with the website visitor via his or her SIP device while the website visitor communicates with the selected agent via the web browser . In some exemplary embodiments this WebRTC call referred to as an in band connection is used solely for voice e.g. audio only . In other exemplary embodiments the connection includes both audio and video. Referring again to step if a determination is made that the selected agent has a WebRTC capable browser the SIP server transmits a SIP call for the agent to the WebRTC call server . In this regard the SIP server transmits a SIP INVITE message including an address of the selected agent.

In step the WebRTC call server converts the SIP call to a WebRTC call. In this regard the WebRTC call server acts as a bidirectional gateway between WebRTC and SIP based calls.

In step the WebRTC call server sends the WebRTC call to the browser in the selected agent s device . Thus both the agent and the website visitor engage in communication via their respective web browsers.

Referring again to step if the routing server determines that the information received is insufficient for routing the call additional routing information may be collected in step from the website visitor. According to one exemplary embodiment the routing server invokes the OOB application server for obtaining the additional information. In one exemplary embodiment of the present invention the OOB application server displays one or more prompts e.g. web forms or a series of prompts in a wizard via an OOB channel to obtain the additional information. For example a webpage may be displayed to the website visitor inquiring additional details on the call such as for example the reason for the call a particular language that is preferred and the like.

According to one exemplary embodiment the OOB application server provides one or more OOB channels of communication within the browser in addition to e.g. concurrently with the real time communication channel e.g. the WebRTC connection .

According to one exemplary embodiment the OOB application server forwards the additional information to the routing server or to the call server to route the call to the appropriate customer service representative.

In embodiments of the present invention which include the web monitor the one or more prompts for additional information may be selected based on the sufficiency of the information determined by the web monitor . For example the web monitor may determine that a user is interested in obtaining product support because the user has been browsing troubleshooting pages. However in some circumstances the web monitor may not have sufficient information to determine the particular product that the user is having issues with. As such when the user makes a request to establish a real time communication channel with a customer service representative the out of band application server may first prompt the user to indicate that it believes that the user is looking for customer support and may ask the user to identify a product from a list of products that the user would like help with.

According to one exemplary embodiment of the invention the session identifier transmitted with the request for a WebRTC call is used to associate the website user with the particular session of the web application the user s call request and the user s responses to the web browser based prompts.

The additional routing information may be combined with the previously collected routing information and reassessed in step to determine if there is sufficient information to determine a user s intentions. The process may be repeated until sufficient information is received. The user may also choose to cancel the call request rather than to continue to answer questions via the web prompt in which case the call request is ended in step .

The out of band application server receives request to establish an out of band channel in step . Either the user or the customer service representative CSR may make this request via their web browsers on their end user devices and the out of band channel may be activated at the contact center. The request may identify one or more types of out of band channels e.g. text chat screen sharing etc. to be established. The out of band application server also uses session identifiers to identify the user and the CSR to be connected. The out of band application server then establishes a connection e.g. a WebSocket connection between the user and the CSR using their respective session identifiers. This connection can be used to provide a channel for communicating the out of band information between the user and the CSR.

As described above according to one exemplary embodiment of the present invention the out of band channels and out of band information are used to supplement the in band WebRTC based voice and or video communication channel by providing additional communication channels such as text chat screen sharing and the like.

In some embodiments of the present invention the party e.g. the user or the CSR not requesting the out of band channel may be prompted to confirm or reject the request to establish the out of band channel. In addition in some embodiments of the present invention separate connections e.g. separate WebSocket connections are established between the user and the CSR e.g. the web browsers used by the user and the CSR for each type of out of band channel or some or all of these connections can be shared by the types of out of band channels used.

In the illustrated example a request to establish a WebRTC call is transmitted by the browser in response to the user s selection of the button . The established WebRTC call between the website visitor and an agent may be audio only or audio and video. is an exemplary screen shot of a browser window with a pop up window displaying a real time video call with an agent.

In general terms when a browser wants to initiate a real time channel with another browser referred to as a peer connection the browser acquires the necessary resources using Javascript and packages the signaling information to the other browser peer. How the signaling information is transported over to the other browser or peer is a concern that is entirely up to the application. Typically a browser supports only HTTP and in some cases WebSocket the signaling information needs to be transported over to the other peer using whatever mechanism defined by the web application.

Within the signaling there is a negotiation process between the peer browsers to determine the transport and media attributes. As of this writing the media attributes are encapsulated in the form of the Session Description Protocol SDP . Using a similar model as the SDP offer answer model the negotiation process is called Javascript Session Establishment Protocol JSEP .

Once JSEP completes the media negotiation the media is transported over Secure Real time Transport Protocol SRTP between the peer connections. In order to allow interoperability among the existing VoIP equipment a media gateway is configured to bridge signaling and media to a SIP phone.

In some situations where a WebRTC endpoint communicates with a legacy endpoint e.g. a SIP endpoint there may be no common codec between the two endpoints to encode and decode audio video transported over the wire. For example a legacy SIP endpoint may only support a H.263 4 video codec while a WebRTC browser e.g. Google Chrome may only support a VP8 video codec. Even if the two endpoints did support the same codec certain situations may arise where the codec may not be used by one of the endpoints. For example even if the G.711 audio codec were supported by both endpoints certain deployments with bandwidth requirements may mandate the use of low bitrate codecs e.g. G.729 codec instead of the higher bitrate G.711 codec. Low bitrate codecs may not be supported by for example the WebRTC browser.

In order to address the above mentioned problems embodiments of the present invention provide a transcoding service to bridge two endpoints and allow media to be exchanged between them even if they do not share a common media codec. According to one embodiment transcoding is optimized so that unnecessary transcoding is avoided instead transcoding occurs if it is deemed to be a situation that requires the transcoding. According to one embodiment transcoding is made transparent to the user.

The customer device may be similar to the end user device of and may take the form of a standard desktop or portable computer tablet smartphone standard telephone or cellular phone television game console and or any other device with a processor memory and input output units providing capability for real time audio and or video communication. For example depending on the capabilities of the customer device the device may engage in a WebRTC call via a web browser application a VoIP call via a SIP client application or a traditional telephone call via PSTN wires and connections .

The agent device may be similar to the agent devices and of and may take the form of a standard desktop or portable computer tablet smartphone standard telephone or cellular phone television game console and or any other device with a processor memory and input output units providing capability for real time audio and or video communication. As with the customer device depending on the capabilities of the agent device the agent device may engage in a WebRTC call via a web browser application a VoIP call via a SIP client application or a traditional telephone call via PSTN wires and connections . One or more of the agent devices may be used concurrently by an agent to engage in a real time media communication with a customer. For example an agent desktop may be displayed on a desktop computer to provide data about the customer while the agent engages in a telephony call via a SIP phone.

The browser and SIP client applications may be implemented as software program instructions that are stored in memory or any other non transitory storage medium that when executed by a corresponding processor cause the processor to provide the WebRTC or VoIP telephony call functionality that will be understood by a person of skill in the art.

According to one embodiment the access gateway is configured to allow customer devices and agent devices to communicate using different types of real time communication protocols and codecs. In this regard the access gateway includes one or more of a WebRTC service gateway collectively VoIP gateway collectively and PSTN media gateway collectively . The PSTN media gateway allows customers and agents to engage in a PSTN call. The VoIP gateway allows customers and agents to engage in a VoIP call via SIP signaling over SIP legs call paths . The WebRTC service gateway allows customers and agents to engage in a WebRTC to WebRTC call also referred to as a browser to browser call via any application message built on top of a web signaling protocol such as for example the hypertext transfer protocol HTTP . Such an application message may adhere for example to a ROAP Rtcweb Offer Answer Protocol . Of course the invention is not limited to ROAP and any other protocol may be used in lieu or in addition to ROAP.

According to one embodiment a browser based call established via web signaling over legs ensues if both the customer and agent devices include the WebRTC enabled browsers . If either the customer or the agent does not support WebRTC the WebRTC service gateway allows one of the parties to conduct a WebRTC call session while the other party conducts a SIP call session. The access gateway acts as a common endpoint for both the WebRTC session and the SIP session. In this regard a WebRTC call session is established between a web browser and the access gateway while a SIP call session is established between the access gateway and a SIP client.

The WebRTC service gateway may be similar to the WebRTC call server of . In this regard the WebRTC service gateway is configured to establish WebRTC sessions and act as a gateway between WebRTC and SIP. In this regard the WebRTC service gateway is coupled to a SIP server which may be similar to the SIP server of . Although SIP is used as an example a person of skill in the art should recognize that any other VoIP protocol may be used in addition or in lieu of SIP.

According to one embodiment the WebRTC service gateway is configured to convert a WebRTC call into a SIP call and communicate with the SIP server over SIP legs using SIP signaling messages. In this manner a WebRTC call may be processed and routed similarly to a SIP call. The SIP server has access to various contact center system components such as for example a routing server which may be similar to the routing server of in order to provide the routing and other functionalities typical for a contact center.

According to one embodiment the SIP server is also coupled to a media controller configured to provide media services to the customer and or agent devices . Such media services may include for example music media servicers where music is played for the customer or agent while the call is being routed to a contact center resource.

According to one embodiment the WebRTC service gateway bridges the media exchanged during a browser to browser and browser to SIP calls. In doing so the gateway is configured to automatically transcode between different media codecs if the gateway detects that there is no common codec that is shared by both parties. In this regard the WebRTC service gateway includes a media stack configured for transcoding of different media on the wire. As a person of skill in the art should recognize the media stack is a protocol stack that handles the actual transport of media between two endpoints. Real time Transport Protocol RTP may be used as the base transport for delivering the real time media.

According to one embodiment the WebRTC service gateway stores in memory a list of supported codecs for WebRTC and a list of supported codecs for SIP. Exemplary audio codecs include but are not limited to G.711 Opus G.729 and the like. Exemplary video codecs include but are not limited to VP8 H.264 H.263 and the like. According to one embodiment transcoding between the codecs is optimized minimized when possible since the transcoding step may introduce delays in the real time media exchange. In one example the WebRTC service gateway gives preference to codecs provided by a session offerer initiator so that to the extent that an answering device supports the codec this codec is used for the media exchange avoiding unnecessary transcoding.

In another example a codec may be selected based on predictions on different parties that may be invoked during the call. For example analysis of prior interactions with a calling customer may reflect that a specific type of agent is often patched into the call. For example a non English speaking customer may often require a translator to join the call or a troublesome customer may always require a supervisor to join the call. According to one embodiment consideration or prediction of different parties that may be invoked during a call and the codecs supported by the predicted parties may influence the selection of a current codec. According to one embodiment a codec that is common to a majority of the predicted parties is selected and prioritized by the WebRTC service gateway .

The WebRTC service processes the request and proceeds to establish a WebRTC session call with the web browser application . In doing this the WebRTC service determines whether codecs should be added or removed replaced from the SDP offer. In this regard the service retrieves the list of codecs it supports and modifies the SDP offer as needed to match the list of supported codecs. In one example the WebRTC service removes the ISAC audio codec and adds a G.729 audio codec and H.264 and H.263 video codecs. The modified SDP offer thus may indicate Audio G.711 Opus G.729 Video VP8 H.264 H.263.

According to one embodiment the codecs in the modified SDP offer are listed in an order of priority preference with the most preferred codecs being listed first for selection in an SDP answer. According to one embodiment preference is given to the codecs provided by the requesting web browser which are also supported by the WebRTC service. In this regard in order to ensure selection of the codecs supported by the requesting web browser the codecs from the requesting web browser are listed first and any new codecs that are added by the WebRTC service are added to the end of the list.

In act the WebRTC server transmits to the SIP server a SIP invite message along with a new SDP offer containing the modified SDP offer data.

In response to the SIP invite message the SIP server engages in traditional processing and routing processing for identifying a resource to which to route the call. In this regard the SIP server may invoke a routing server which executes the appropriate routing logic for identifying the appropriate resource. According to one embodiment the routing logic may take into account the capabilities of an agent in selecting the agent to which to route the call. For example if the SDP offer was for both audio and video an agent having access to a device capable for both audio and video may be selected. The capability information may be specified even to the codec level. In this regard the SIP and or routing server may have access to the various codecs supported by the various agent devices . Assuming that there are two agents with the same skill set and capacity that may handle the call the agent having a device that shares the same codec as that of the SDP offer may be selected for handling the call. In this manner unnecessary transcoding between different codecs may be avoided.

In the embodiment illustrated in a first agent that is configured only for SIP calls is selected for handling the call. Accordingly in act the SIP server transmits a SIP message to the selected first agent for establishing a SIP session with the first agent and the message is then processed by the agent s SIP client application . The SIP message includes the SDP offer received from the WebRTC service .

In act the first agent s SIP client application returns an SDP answer with one or more codecs supported by the first agent s device. In the illustrated example the first agent does not support any of the codecs from the browser and answers with a codec added by the WebRTC service .

The WebRTC service processes the SDP answer from the SIP server and recognizes that there is no common codec between the calling browser application and the selected first agent device. Nonetheless given the transcoding capabilities of the WebRTC service the service allows the media session between the web browser and the SIP client . Accordingly the WebRTC service responds in act with an SDP answer that agrees to the SDP offer provided by the web browser .

In act the web browser and WebRTC service engage in ICE Interactive Connectivity Establishment connectivity checks for resolving the network path to the web browser as will be understood by a person of skill in the art. The ICE protocol which is defined in RFC 5245 addresses the problem of handling network address traversal NAT due to the web browser with a private IP address utilizing the UDP protocol to send a real time media stream during a WebRTC call. ICE uses Session Traversal Utilities for NAT STUN protocol as a mechanism for discovering the server reflexive address seen by a public server. Once a browser discovers all the addresses seen by public servers the browser uses ICE to negotiate the connection with the peer.

According to one embodiment the WebRTC service application remembers the negotiated media attributes resolved network path information and other information about a current media session with the web browser to avoid re negotiating the media session and avoid modifying the peer connection at the web browser side in the event that there is a transfer or addition of another agent or contact center resource to the call. This helps avoid the time and extra processing that is expended in doing the re negotiating which includes the ICE connectivity check. In this regard the WebRTC service behaves like a peer endpoint with which the browser conducts the session negotiation regardless of the agents or number of transfers to other agents that may occur during the session and with which a peer connection is established based on negotiated media parameters. According to one embodiment although re negotiation is avoided if possible it may not be avoidable for example if a new media stream is added to the call e.g. call is upgraded from audio to audio and video .

In acts and the web browser transmits and receives media encoded by a first type of codec negotiated with the web browser while the first agent receives and transmits media encoded by a second type of codec negotiated with the agent s SIP client application . When the codecs are incompatible the WebRTC service is configured to transcode between the first and second types of codecs in act . That is the WebRTC service receives media encoded in the first type of codec and re encodes the media according to conventional transcoding algorithms stored in memory according to a second type of codec and vice versa.

In the example of the call is transferred to a second agent configured with a WebRTC enabled browser as is depicted via act . While the call is transferred a media service such as for example music video on hold is requested by the SIP server to the media controller via act .

In response to the request the media controller transmits in act an SDP offer including the media codecs supported by the media controller. The media controller may or may not support the same codecs as the web browser .

Negotiation of the media codec ensues with the WebRTC service as an endpoint as depicted via acts . Specifically in step the WebRTC service generates an SDP answer for the media controller based on information already obtained about the web browser during the initial session negotiation with the web browser. That is according to embodiments of the present invention there is no need to re negotiate the session with the caller web browser unless for example new media channels are being added. The peer connection parameters negotiated for the call with the first agent therefore is maintained at the web browser side.

According to one embodiment if the SDP offer from the media controller includes a media codec supported by the web browser that media codec is selected by the WebRTC service and included in the SDP answer back to the media controller. In this manner unnecessary transcoding is avoided for the media provided by the media controller to the web browser.

If the web browser does not support the native media codec used by the media controller in streaming its media the media controller is configured to transcode the media to the codec supported by the web browser prior to transmitting the media to the web browser. Thus according to this embodiment transcoding by the WebRTC service is disabled when the media controller is invoked to transmit media during the call.

According to one embodiment a transcoded media is stored in a cache of the media controller for use for communicating with other incompatible browsers. Such caching is beneficial since the type of media that is provided by the media controller e.g. music on hold is not likely to vary much. When such caching functionality is enabled the media controller is configured to check the cache first for media already transcoded to a particular codec prior to engaging in the transcoding process.

In act music and or video provided by the media controller is bridged through the WebRTC service and transmitted to the web browser .

In act the SIP server transmits a SIP request to the second agent s web browser to effectuate the transfer of the call to the second agent.

In act the second agent s web browser transmits an SDP offer with information on the codecs supported by this web browser.

In act the WebRTC service engages in negotiation of the SDP by identifying and selecting a codec that minimizes transcoding. For example the WebRTC service selects the codec that may be common to the caller s web browser and the agent web browser . If multiple parties are involved the WebRTC service may select a codec that is common to a majority of the parties involved. Again no re negotiation of the media session is performed with the caller s web browser unless a new media stream is added since the WebRTC service is aware of the codecs and other session parameters relevant to the call from the initial session negotiation. The peer connection parameters at the caller s web browser therefore does not change.

Embodiments of the present invention allow media streams to be added or removed from a WebRTC session. The adding of a media stream may occur for example when an agent wishes to upgrade the call from an audio only session to an audio and video session where video is exchanged in addition to audio. According to existing browser privacy requirements explicit consent must be given by the customer for the web browser application to access the customer s webcam or microphone. Assuming a majority of calls handled by a contact center are conducted using audio only requesting that a user provide access to both the customer webcam in addition to his or her microphone may be unnecessary and may result in undue discomfort by the customer to engage in web browser based calls with a contact center agent. Thus according to an embodiment of the present invention the customer initially only grants microphone access to the web browser for an audio only call. If the agent wishes to upgrade to video he or she may do so by adding a video stream to the call. According to one embodiment a new SDP offer answer is conducted to provide the agent s video stream to the customer. As soon as the new SDP offer answer is completed the customer may see the agent s video stream. At this point the Javascript library may provide the web application an option to ask whether the customer would like to grant access to the webcam during the call. If the user grants access to the webcam a separate SDP offer answer is conducted include the customer s video.

In act the agent generates a new INVITE SIP message directed to the customer to add a video media stream. The WebRTC server receives the SIP message and generates a ROAP message with an SDP offer for video in act . Video codecs supported by the WebRTC server is transmitted in the SDP offer.

Via signaling messages depicted generally via reference number the video codec is negotiated between the WebRTC service and the customer s web browser application . According to one embodiment the video codec that is selected is aimed in minimizing transcoding as discussed above.

When the video attributes have been negotiated the agent s video stream is displayed by the customer s web browser in act . According to one embodiment although the agent s video stream is displayed access to the customer s video is not given until the customer grants consent for the web browser application to access the customer s camera webcam and start delivering the video captured by the customer s webcam. In this regard the web browser application displays a prompt for receiving the customer s consent to access the webcam during the call. In response to the customer indicating via user input grant of the access to the webcam access is provided to the customer s camera via for example a getUsermedia Javacript function.

The consent by the customer results in a separate negotiation of the video attributes between the customer s web browser application and the WebRTC service to include the customer s video. In this regard the web browser application generates a separate SDP offer in act . The SDP offer is transmitted to the WebRTC service which in turn generates and exchanges appropriate SIP messages with the agent s SIP client as indicated generally via reference number to transmit a video stream captured by the webcam to the agent device for display thereon.

Each of the various servers controllers switches and or gateways in the afore described figures may be a process or thread running on one or more processors in one or more computing devices e.g. executing computer program instructions and interacting with other system components for performing the various functionalities described herein. The computer program instructions are stored in a memory which may be implemented in a computing device using a standard memory device such as for example a random access memory RAM . The computer program instructions may also be stored in other non transitory computer readable media such as for example a CD ROM flash drive or the like. Also a person of skill in the art should recognize that a computing device may be implemented via firmware e.g. an application specific integrated circuit hardware or a combination of software firmware and hardware. A person of skill in the art should also recognize that the functionality of various computing devices may be combined or integrated into a single computing device or the functionality of a particular computing device may be distributed across one or more other computing devices without departing from the scope of the exemplary embodiments of the present invention. A server may be a software module which may also simply be referred to as a module. The set of modules in the contact center may include servers and other modules.

The central processing unit is any logic circuitry that responds to and processes instructions fetched from the main memory unit . It may be implemented for example in an integrated circuit in the form of a microprocessor microcontroller or graphics processing unit GPU or in a field programmable gate array FPGA or application specific integrated circuit ASIC . The main memory unit may be one or more memory chips capable of storing data and allowing any storage location to be directly accessed by the central processing unit . As shown in the central processing unit communicates with the main memory via a system bus . As shown in the central processing unit may also communicate directly with the main memory via a memory port .

A wide variety of I O devices may be present in the computing device . Input devices include one or more keyboards mice trackpads trackballs microphones and drawing tablets. Output devices include video display devices speakers and printers. An I O controller as shown in may control the I O devices. The I O controller may control one or more I O devices such as a keyboard and a pointing device e.g. a mouse or optical pen.

Referring again to the computing device may support one or more removable media interfaces such as a floppy disk drive a CD ROM drive a DVD ROM drive tape drives of various formats a USB port a Secure Digital or COMPACT FLASH memory card port or any other device suitable for reading data from read only media or for reading data from or writing data to read write media. An I O device may be a bridge between the system bus and a removable media interface .

The removable media interface may for example be used for installing software and programs. The computing device may further comprise a storage device such as one or more hard disk drives or hard disk drive arrays for storing an operating system and other related software and for storing application software programs. Optionally a removable media interface may also be used as the storage device. For example the operating system and the software may be run from a bootable medium for example a bootable CD.

In some embodiments the computing device may comprise or be connected to multiple display devices which each may be of the same or different type and or form. As such any of the I O devices and or the I O controller may comprise any type and or form of suitable hardware software or combination of hardware and software to support enable or provide for the connection to and use of multiple display devices by the computing device . For example the computing device may include any type and or form of video adapter video card driver and or library to interface communicate connect or otherwise use the display devices . In one embodiment a video adapter may comprise multiple connectors to interface to multiple display devices . In other embodiments the computing device may include multiple video adapters with each video adapter connected to one or more of the display devices . In some embodiments any portion of the operating system of the computing device may be configured for using multiple display devices . In other embodiments one or more of the display devices may be provided by one or more other computing devices connected for example to the computing device via a network. These embodiments may include any type of software designed and constructed to use the display device of another computing device as a second display device for the computing device . One of ordinary skill in the art will recognize and appreciate the various ways and embodiments that a computing device may be configured to have multiple display devices

A computing device of the sort depicted in and may operate under the control of an operating system which controls scheduling of tasks and access to system resources. The computing device may be running any operating system any embedded operating system any real time operating system any open source operating system any proprietary operating system any operating systems for mobile computing devices or any other operating system capable of running on the computing device and performing the operations described herein.

The computing device may be any workstation desktop computer laptop or notebook computer server machine handheld computer mobile telephone or other portable telecommunication device media playing device gaming system mobile computing device or any other type and or form of computing telecommunications or media device that is capable of communication and that has sufficient processor power and memory capacity to perform the operations described herein. In some embodiments the computing device may have different processors operating systems and input devices consistent with the device.

In other embodiments the computing device is a mobile device such as a Java enabled cellular telephone or personal digital assistant PDA a smart phone a digital audio player or a portable media player. In some embodiments the computing device comprises a combination of devices such as a mobile phone combined with a digital audio player or portable media player.

As shown in the central processing unit may comprise multiple processors P P P P and may provide functionality for simultaneous execution of instructions or for simultaneous execution of one instruction on more than one piece of data. In some embodiments the computing device may comprise a parallel processor with one or more cores. In one of these embodiments the computing device is a shared memory parallel device with multiple processors and or multiple processor cores accessing all available memory as a single global address space. In another of these embodiments the computing device is a distributed memory parallel device with multiple processors each accessing local memory only. In still another of these embodiments the computing device has both some memory which is shared and some memory which may only be accessed by particular processors or subsets of processors. In still even another of these embodiments the central processing unit comprises a multicore microprocessor which combines two or more independent processors into a single package e.g. into a single integrated circuit IC . In one exemplary embodiment depicted in the computing device includes at least one central processing unit and at least one graphics processing unit .

In some embodiments a central processing unit provides single instruction multiple data SIMD functionality e.g. execution of a single instruction simultaneously on multiple pieces of data. In other embodiments several processors in the central processing unit may provide functionality for execution of multiple instructions simultaneously on multiple pieces of data MIMD . In still other embodiments the central processing unit may use any combination of SIMD and MIMD cores in a single device.

A computing device may be one of a plurality of machines connected by a network or it may comprise a plurality of machines so connected. shows an exemplary network environment. The network environment comprises one or more local machines also generally referred to as local machine s client s client node s client machine s client computer s client device s endpoint s or endpoint node s in communication with one or more remote machines also generally referred to as server machine s or remote machine s via one or more networks . In some embodiments a local machine has the capacity to function as both a client node seeking access to resources provided by a server machine and as a server machine providing access to hosted resources for other clients . Although only two clients and three server machines are illustrated in there may in general be an arbitrary number of each. The network may be a local area network LAN e.g. a private network such as a company Intranet a metropolitan area network MAN or a wide area network WAN such as the Internet or another public network or a combination thereof.

The computing device may include a network interface to interface to the network through a variety of connections including but not limited to standard telephone lines local area network LAN or wide area network WAN links broadband connections wireless connections or a combination of any or all of the above. Connections may be established using a variety of communication protocols. In one embodiment the computing device communicates with other computing devices via any type and or form of gateway or tunneling protocol such as Secure Socket Layer SSL or Transport Layer Security TLS . The network interface may comprise a built in network adapter such as a network interface card suitable for interfacing the computing device to any type of network capable of communication and performing the operations described herein. An I O device may be a bridge between the system bus and an external communication bus.

While the present invention has been described in connection with certain exemplary embodiments it is to be understood that the invention is not limited to the disclosed embodiments but on the contrary is intended to cover various modifications and equivalent arrangements included within the spirit and scope of the appended claims and equivalents thereof. For example in some embodiments of the present invention may provide multi party calls involving for example multiple agents interacting with a customer over WebRTC and the OOB communication channels call transfer between agents supervisor silent monitoring or whisper coaching e.g. supervisor speaking to the agent without the customers being able to listen in are also available and end users or customers may be able to conference in other parties via WebRTC.

While embodiments of the present invention illustrate a call server and routing calls via the call server in some embodiments of the present invention customer service representatives communicate with users directly via WebRTC connections without an intervening call server. In other embodiments a SIP server is included in the loop for purposes of call control such as transfer conferencing or supervisors silent monitoring and whisper coaching.

In addition while embodiments of the present invention have been described above in the context of WebRTC other embodiments of the present invention may use other web browser based conferencing technologies such as CU RTC WEB that similarly do not depend on the installation of additional plugins such as Adobe Flash or the Google Talk plugin.

