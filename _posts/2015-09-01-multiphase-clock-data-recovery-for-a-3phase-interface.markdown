---

title: Multiphase clock data recovery for a 3-phase interface
abstract: Methods, apparatus, and systems for data communication over a multi-wire, multi-phase interface are disclosed. A method of data communication includes configuring a clock recovery circuit to provide a first clock signal that includes a pulse for each symbol transmitted on the interface, where symbols are transmitted on the interface at a first frequency, adjusting a loop delay of the clock recovery circuit to modify the first clock to have a second frequency that is no more than half the first frequency, where the clock recovery circuit generates a pulse in the first clock signal for a first of an integer number of symbols and suppresses pulse generation for other symbols in the integer number of symbols, configuring a clock generation circuit to provide a second clock signal, and capturing symbols from the interface using the first clock signal and the second clock signal.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09496879&OS=09496879&RS=09496879
owner: QUALCOMM Incorporated
number: 09496879
owner_city: San Diego
owner_country: US
publication_date: 20150901
---
The present disclosure relates generally to high speed data communications interfaces and more particularly to clock generation in a receiver coupled to a multi wire multi phase data communication link.

Manufacturers of mobile devices such as cellular phones may obtain components of the mobile devices from various sources including different manufacturers. For example an application processor in a cellular phone may be obtained from a first manufacturer while an imaging device or camera may be obtained from a second manufacturer and a display may be obtained from a third manufacturer. The application processor the imaging device the display controller or other types of device may be interconnected using a standards based or proprietary physical interface. In one example an imaging device may be connected using the Camera Serial Interface CSI defined by the Mobile Industry Processor Interface MIPI Alliance. In another example a display may include an interface that conforms to the Display Serial Interface DSI standard specified by the Mobile Industry Processor Interface MIPI Alliance

A multiphase three wire C PHY interface defined by the MIPI Alliance uses a trio of conductors to transmit information between devices. Each of the three wires may be in one of three signaling states during transmission of a symbol over the C PHY interface. Clock information is encoded in a sequence of symbols transmitted on the C PHY interface and a receiver generates a clock signal from transitions between consecutive symbols. The maximum speed of the C PHY interface and the ability of a clock and data recovery CDR circuit to recover clock information may be limited by the maximum time variation related to transitions of signals transmitted on the different wires of the communication link. A receiver may employ delay circuits to ensure that all of the conductors in the trio have assumed a stable signaling state before providing a sampling edge. The transmission rate of the link may be limited by the delay values used and there is an ongoing need for clock generation circuits that can function reliably as signaling frequencies of multi wire interfaces increase.

Embodiments disclosed herein provide systems methods and apparatus that enable improved communications on a multi wire and or multiphase communications link. The communications link may be deployed in apparatus such as a mobile terminal having multiple Integrated Circuit IC devices.

In an aspect of the disclosure a method of data communication includes configuring a clock recovery circuit to provide a first clock signal that includes a pulse for each symbol transmitted on a 3 wire 3 phase interface where symbols are transmitted on the 3 wire 3 phase interface at a first frequency adjusting a loop delay of the clock recovery circuit to modify the first clock to have a second frequency that is no more than half the first frequency where the clock recovery circuit generates a pulse in the first clock signal for a first of an integer number of symbols and suppresses pulse generation for other symbols in the integer number of symbols configuring a clock generation circuit to provide a second clock signal where the second clock signal includes pulses for each of the other symbols in the integer number of symbols and capturing symbols from the 3 wire 3 phase interface using the first clock signal and the second clock signal.

In an aspect of the disclosure an apparatus for decoding data transmitted on a 3 wire 3 phase interface includes means for configuring a clock recovery circuit to provide a first clock signal that includes a pulse for each symbol transmitted at a first frequency on a 3 wire 3 phase interface means for calibrating a loop delay of the clock recovery circuit. In one mode of operation the means for calibrating the loop delay modifies the first clock signal to have a second frequency that is no more than half the first frequency. In the first mode of operation the clock recovery circuit generates a pulse in the first clock signal for a first of an integer number of symbols and suppresses pulse generation for other symbols in the integer number of symbols means for configuring a clock generation circuit to provide a second clock signal where the second clock signal includes pulses for each of the other symbols in the integer number of symbols. The apparatus may also include means for capturing symbols from the 3 wire 3 phase interface using the first clock signal and the second clock signal.

In an aspect of the disclosure an apparatus for data communication includes a plurality of difference receivers coupled to a 3 wire bus a clock recovery circuit configured to provide a first clock signal that includes a pulse for each symbol transmitted in a stream of symbols at a first frequency on a 3 wire 3 phase interface one or more registers and a processing circuit. The processing circuit may be configured to adjust a loop delay of the clock recovery circuit until the first clock is modified to have a second frequency that is no more than half the first frequency where the clock recovery circuit generates a pulse in the first clock signal for a first of an integer number of the stream of symbols and suppresses pulse generation for other symbols in the integer number of the stream of symbols and configure a clock generation circuit to provide a second clock signal where the second clock signal includes pulses for each of the other symbols in the integer number of symbols. The one or more registers may capture symbols from the 3 wire 3 phase interface in response to pulses in the first clock signal and the second clock signal.

In an aspect of the disclosure a processor readable storage medium is disclosed. The storage medium may be a non transitory storage medium and may store code that when executed by one or more processors causes the one or more processors to configure a clock recovery circuit to provide a first clock signal that includes a pulse for each symbol transmitted on a 3 wire 3 phase interface where symbols are transmitted on the 3 wire 3 phase interface at a first frequency adjust a loop delay of the clock recovery circuit such that the first clock has a second frequency that is no more than half the first frequency where the clock recovery circuit generates a pulse in the first clock signal for a first of an integer number of symbols and suppresses pulse generation for other symbols in the integer number of symbols configure a clock generation circuit to provide a second clock signal where the second clock signal includes pulses for each of the other symbols in the integer number of symbols and capture symbols from the 3 wire 3 phase interface using the first clock signal and the second clock signal.

The detailed description set forth below in connection with the appended drawings is intended as a description of various configurations and is not intended to represent the only configurations in which the concepts described herein may be practiced. The detailed description includes specific details for the purpose of providing a thorough understanding of various concepts. However it will be apparent to those skilled in the art that these concepts may be practiced without these specific details. In some instances well known structures and components are shown in block diagram form in order to avoid obscuring such concepts.

As used in this application the terms component module system and the like are intended to include a computer related entity such as but not limited to hardware firmware a combination of hardware and software software or software in execution. For example a component may be but is not limited to being a process running on a processor a processor an object an executable a thread of execution a program and or a computer. By way of illustration both an application running on a computing device and the computing device can be a component. One or more components can reside within a process and or thread of execution and a component may be localized on one computer and or distributed between two or more computers. In addition these components can execute from various computer readable media having various data structures stored thereon. The components may communicate by way of local and or remote processes such as in accordance with a signal having one or more data packets such as data from one component interacting with another component in a local system distributed system and or across a network such as the Internet with other systems by way of the signal.

Moreover the term or is intended to mean an inclusive or rather than an exclusive or. That is unless specified otherwise or clear from the context the phrase X employs A or B is intended to mean any of the natural inclusive permutations. That is the phrase X employs A or B is satisfied by any of the following instances X employs A X employs B or X employs both A and B. In addition the articles a and an as used in this application and the appended claims should generally be construed to mean one or more unless specified otherwise or clear from the context to be directed to a singular form.

Certain aspects of the invention may be applicable to a C PHY interface specified by the MIPI Alliance which may be deployed to connect electronic devices that are subcomponents of a mobile apparatus such as a telephone a mobile computing device an appliance automobile electronics avionics systems etc. Examples of a mobile apparatus include a cellular phone a smart phone a session initiation protocol SIP phone a laptop a notebook a netbook a smartbook a personal digital assistant PDA a satellite radio a global positioning system GPS device a multimedia device a video device a digital audio player e.g. MP3 player a camera a game console a wearable computing device e.g. a smartwatch a health or fitness tracker etc. an appliance a sensor a vending machine or any other similarly functioning device.

The C PHY interface is a high speed serial interface that can provide high throughput over bandwidth limited channels. The C PHY interface may be deployed to connect application processors to peripherals including displays and cameras. The C PHY interface encodes data into symbols that are transmitted in a three phase signal over a set of three wires which may be referred to as a trio or trio of wires. The three phase signal is transmitted on each wire of the trio in different phases. Each three wire trio provides a lane on a communications link. A symbol interval may be defined as the interval of time in which a single symbol controls the signaling state of a trio. In each symbol interval one wire is undriven while the remaining two of the three wires are differentially driven such that one of the two differentially driven wires assumes a first voltage level and the other differentially driven wire assumes to a second voltage level different from the first voltage level. The undriven wire may float be driven and or be terminated such that it assumes a third voltage level that is at or near the mid level voltage between the first and second voltage levels. In one example the driven voltage levels may be V and V with the undriven voltage being 0 V. In another example the driven voltage levels may be V and 0 V with the undriven voltage being V 2. Different symbols are transmitted in each consecutively transmitted pair of symbols and different pairs of wires may be differentially driven in different symbol intervals.

The communication link may include multiple channels and . One or more channel may be bidirectional and may operate in half duplex and or full duplex modes. One or more channel and may be unidirectional. The communication link may be asymmetrical providing higher bandwidth in one direction. In one example described herein a first communications channel may be referred to as a forward channel while a second communications channel may be referred to as a reverse channel . The first IC device may be designated as a host system or transmitter while the second IC device may be designated as a client system or receiver even if both IC devices and are configured to transmit and receive on the communications channel . In one example the forward channel may operate at a higher data rate when communicating data from a first IC device to a second IC device while the reverse channel may operate at a lower data rate when communicating data from the second IC device to the first IC device .

The IC devices and may each include a processor or other processing and or computing circuit or device . In one example the first IC device may perform core functions of the apparatus including establishing and maintaining wireless communications through a wireless transceiver and an antenna while the second IC device may support a user interface that manages or operates a display controller and may control operations of a camera or video input device using a camera controller . Other features supported by one or more of the IC devices and may include a keyboard a voice recognition component and other input or output devices. The display controller may include circuits and software drivers that support displays such as a liquid crystal display LCD panel touch screen display indicators and so on. The storage media and may include transitory and or non transitory storage devices adapted to maintain instructions and data used by respective processors and and or other components of the IC devices and . Communication between each processor and its corresponding storage media and and other modules and circuits may be facilitated by one or more internal bus and and or a channel and or of the communication link .

The reverse channel may be operated in the same manner as the forward channel and the forward channel and the reverse channel may be capable of transmitting at comparable speeds or at different speeds where speed may be expressed as data transfer rate and or clocking rates. The forward and reverse data rates may be substantially the same or differ by orders of magnitude depending on the application. In some applications a single bidirectional channel may support communications between the first IC device and the second IC device . The forward channel and or the reverse channel may be configurable to operate in a bidirectional mode when for example the forward and reverse channels and share the same physical connections and operate in a half duplex manner. In one example the communication link may be operated to communicate control command and other information between the first IC device and the second IC device in accordance with an industry or other standard.

The communication link of may be implemented according to MIPI Alliance specifications for C PHY and may provide a wired bus that includes a plurality of signal wires denoted as M wires . The M wires may be configured to carry N phase encoded data in a high speed digital interface such as a mobile display digital interface MDDI . The M wires may facilitate N phase polarity encoding on one or more of the channels and . The physical layer drivers and may be configured or adapted to generate N phase polarity encoded data for transmission on the communication link . The use of N phase polarity encoding provides high speed data transfer and may consume half or less of the power of other interfaces because fewer drivers are active in N phase polarity encoded data links.

N phase polarity encoding devices and or can typically encode multiple bits per transition on the communication link . In one example a combination of 3 phase encoding and polarity encoding may be used to support a wide video graphics array WVGA 80 frames per second LCD driver IC without a frame buffer delivering pixel data at 810 Mbps for display refresh.

Signaling states defined for each of the 3 wires in a 3 wire 3 phase polarity encoding scheme may include an undriven state a positively driven state and a negatively driven state. The positively driven state and the negatively driven state may be obtained by providing a voltage differential between two of the signal wires and or and or by driving a current through two of the signal wires and or connected in series such that the current flows in different directions in the two signal wires and or . The undriven state may be realized by placing an output of a driver of a signal wire or in a high impedance mode. Alternatively or additionally an undriven state may be obtained on a signal wire or by passively or actively causing an undriven signal wire or to attain a voltage level that lies substantially halfway between positive and negative voltage levels provided on driven signal wires and or . Typically there is no significant current flow through an undriven signal wire or . Signaling states defined for a 3 wire 3 phase polarity encoding scheme may be denoted using the three voltage or current states 1 1 and 0 .

A 3 wire 3 phase polarity encoder may employ line drivers to control the signaling state of signal wires and . The drivers may be implemented as unit level current mode or voltage mode drivers. In one example each driver may receive sets of two or more of signals and that determine the output state of corresponding signal wires and . In one example the sets of two signals and may include a pull up signal PU signal and a pull down signal PD signal that when high activate pull up and pull down circuits that drive the signal wires and toward a higher level or lower level voltage respectively. In this example when both the PU signal and the PD signal are low the signal wires and may be terminated to a mid level voltage.

For each transmitted symbol interval in an M wire N phase polarity encoding scheme at least one signal wire or is in the midlevel undriven 0 voltage or current state while the number of positively driven 1 voltage or current state signal wires or is equal to the number of negatively driven 1 voltage or current state signal wires or such that the sum of current flowing to the receiver is always zero. For each symbol the state of at least one signal wire or is changed from the symbol transmitted in the preceding transmission interval.

In operation a mapper may receive and map 16 bit data to 7 symbols . In the 3 wire example each of the 7 symbols defines the states of the signal wires and for one symbol interval. The 7 symbols may be serialized using parallel to serial converters that provide a timed sequence of symbols for each signal wire and . The sequence of symbols is typically timed using a transmission clock. A 3 wire 3 phase encoder receives the sequence of 7 symbols produced by the mapper one symbol at a time and computes the state of each signal wire and for each symbol interval. The 3 wire encoder selects the states of the signal wires and based on the current input symbol and the previous states of signal wires and

The use of M wire N phase encoding permits a number of bits to be encoded in a plurality of symbols where the bits per symbol is not an integer. In the example of a 3 wire communications link there are 3 available combinations of 2 wires which may be driven simultaneously and 2 possible combinations of polarity on the pair of wires that is driven yielding 6 possible states. Since each transition occurs from a current state 5 of the 6 states are available at every transition. The state of at least one wire is required to change at each transition. With 5 states log 5 2.32 bits may be encoded per symbol. Accordingly a mapper may accept a 16 bit word and convert it to 7 symbols because 7 symbols carrying 2.32 bits per symbol can encode 16.24 bits. In other words a combination of seven symbols that encode five states has 5 78 125 permutations. Accordingly the 7 symbols may be used to encode the 2 65 536 permutations of 16 bits.

Information may be encoded in the direction of rotation at each phase transition and the 3 phase signal may change direction for each signaling state. Direction of rotation may be determined by considering which signal wires and or are in the 0 state before and after a phase transition because the undriven signal wire and or changes at every signaling state in a rotating three phase signal regardless of the direction of rotation.

The encoding scheme may also encode information in the polarity of the two conductors and or that are actively driven. At any time in a 3 wire implementation exactly two of the conductors are driven with currents in opposite directions and or with a voltage differential. In one implementation data may be encoded using two bit values where one bit is encoded in the direction of phase transitions and the second bit is encoded in the polarity for the current state.

The timing chart illustrates data encoding using both phase rotation direction and polarity. The curves and relate to signals carried on three signal wires and respectively for multiple phase states. Initially the phase transitions are in a clockwise direction and the most significant bit is set to binary 1 until the rotation of phase transitions switches at a time to a counterclockwise direction as represented by a binary 0 of the most significant bit. The least significant bit reflects the polarity of the signal in each state.

According to certain aspects disclosed herein one bit of data may be encoded in the rotation or phase change in a 3 wire 3 phase encoding system and an additional bit may be encoded in the polarity of the two driven wires. Additional information may be encoded in each transition of a 3 wire 3 phase encoding system by allowing transition to any of the possible states from a current state. Given 3 rotational phases and two polarities for each phase 6 states are available in a 3 wire 3 phase encoding system. Accordingly 5 states are available from any current state and there may be log 5 2.32 bits encoded per symbol transition which allows the mapper to accept a 16 bit word and encode it in 7 symbols.

N Phase data transfer may use more than three wires provided in a communication medium such as a bus. The use of additional signal wires that can be driven simultaneously provides more combinations of states and polarities and allows more bits of data to be encoded at each transition between states. This can significantly improve throughput of the system and reduce the power consumption over approaches that use multiple differential pairs to transmit data bits while providing increased bandwidth.

In one example an encoder may transmit symbols using 6 wires with 2 pairs of wires driven for each state. The 6 wires may be labeled A through F such that in one state wires A and F are driven positive wires B and E negative and C and D are undriven or carry no current . For six wires there may be 

Of the 4 wires driven the possible combinations of two wires driven positive and the other two must be negative . The combinations of polarity may include 

Accordingly the total number of different states may be calculated as 15 6 90. To guarantee a transition between symbols 89 states are available from any current state and the number of bits that may be encoded in each symbol may be calculated as log 89 6.47 bits per symbol. In this example a 32 bit word can be encoded by the mapper into 5 symbols given that 5 6.47 32.35 bits.

The general equation for the number of combinations of wires that can be driven for a bus of any size as a function of the number of wires in the bus and number of wires simultaneously driven 

The wire state decoder may extract a sequence of symbols from phase encoded signals received on the signal wires and . The symbols are encoded as a combination of phase rotation and polarity as disclosed herein. The wire state decoder may include a CDR circuit that extracts a clock that can be used to reliably capture symbols from the signal wires and . A transition occurs on least one of the signal wires and at each symbol boundary and the CDR circuit may be configured to generate the clock based on the occurrence of a transition or multiple transitions. An edge of the clock may be delayed to allow time for all signal wires and to have stabilized and to thereby ensure that the current symbol is captured for decoding purposes.

A 3 phase transmitter includes drivers that provide high low and middle level voltages onto the transmit channel. This results in some variable transitions between consecutive symbol intervals. Low to high and high to low voltage transitions may be referred to as full swing transitions while low to middle and high to middle voltage transitions may be referred to as half swing transitions. Different types of transitions may have different rise or fall times and may result in different zero crossings at the receiver. These differences can result in encoding jitter which may impact link signal integrity performance.

Certain transitions between transmitted symbols may be detectable by a single differential receiver or while other transitions may be detected by two or more of the differential receivers and . In one example the states or relative states of two wires may be unchanged after a transition and the output of a corresponding differential receiver or may also be unchanged after the phase transition. In another example both wires in a pair of signal wires and or may be in the same state in a first time interval and both wires may be in a same second state in a second time interval and the corresponding differential receiver or may be unchanged after the phase transition. Accordingly a clock generation circuit may include a transition detection circuit and or other logic to monitor the outputs of all differential receivers and in order to determine when a phase transition has occurred The clock generation circuit may generate a receive clock signal based on detected phase transitions.

Changes in signaling states of the 3 wires may be detected at different times for different combinations of the signal wires and or . The timing of detection of signaling state changes may vary according to the type of signaling state change that has occurred. The result of such variability is illustrated in the timing chart of . Markers and represent occurrences of transitions in the difference signals provided to the transition detection circuit . The markers and are assigned different heights in the timing chart for clarity of illustration only and the relative heights of the markers and are not intended to show a specific relationship to voltage or current levels polarity or weighting values used for clock generation or data decoding. The timing chart illustrates the effect of timing of transitions associated with symbols transmitted in phase and polarity on the three signal wires and . In the timing chart transitions between some symbols may result in variable capture windows and or collectively symbol capture windows during which symbols may be reliably captured. The number of state changes detected and their relative timing can result in jitter on the clock signal .

The throughput of a C PHY communications link may be affected by duration and variability in signal transition times. For example variability in detection circuits may be caused by manufacturing process tolerances variations and stability of voltage and current sources and operating temperature as well as by the electrical characteristics of the signal wires and . The variability in detection circuits may limit channel bandwidth.

In each of the examples shown in the timing charts and the initial symbol z see transitions to a different symbol. As shown in the timing charts and signal A is initially in a 1 state signal B is in a 0 state and signal C is in the 1 state. Accordingly the differential receivers initially measure a 1 difference and the differential receiver measures a 2 difference as shown in the timing charts for the differential receiver outputs.

In a first example corresponding to the timing charts a transition occurs from symbol z to symbol x see in which signal A transitions to a 1 state signal B transitions to a 1 state and signal C transitions to a 0 state with the differential receiver transitioning from 1 difference to a 2 difference differential receiver remaining at a 1 difference and differential receiver transitioning from 2 difference to a 1 difference .

In a second example corresponding to the timing charts a transition occurs from symbol z to symbol z in which signal A transitions to a 1 state signal B remains at the 0 state and signal C transitions to a 1 state with two differential receivers and transitioning from 1 difference to a 1 difference and differential receiver transitioning from 2 difference to a 2 difference .

In a third example corresponding to the timing charts a transition occurs from symbol z to symbol x in which signal A remains at the 1 state signal B transitions to the 1 state and signal C transitions to a 0 state with the differential receiver transitioning from a 1 difference to a 2 difference the differential receiver transitioning from a 1 difference to a 1 difference and the differential receiver transitioning from 2 difference to a 1 difference .

These examples illustrate transitions in difference values spanning 0 1 2 3 4 and 5 levels. Pre emphasis techniques used for typical differential or single ended serial transmitters were developed for two level transitions and may introduce certain adverse effects if used on a MIPI Alliance C PHY 3 phase signal. In particular a pre emphasis circuit that overdrives a signal during transitions may cause overshoot during transitions spanning 1 or 2 levels and may cause false triggers to occur in edge sensitive circuits.

The concept of periodic sampling and display of the signal is useful during design adaptation and configuration of systems which use a clock data recovery circuit that re creates the received data timing signal using frequent transitions appearing in the received data. A communication system based on Serializer Deserializer SERDES technology is an example of a system where an eye pattern can be utilized as a basis for judging the ability to reliably recover data based on the eye opening of the eye pattern .

An M wire N Phase encoding system such as a 3 wire 3 phase encoder may encode a signal that has at least one transition at every symbol boundary and the receiver may recover a clock using those guaranteed transitions. The receiver may require reliable data immediately prior to the first signal transition at a symbol boundary and must also be able to reliably mask any occurrences of multiple transitions that are correlated to the same symbol boundary. Multiple receiver transitions may occur due to slight differences in rise and fall time between the signals carried on the M wires e.g. a trio of wires and due to slight differences in signal propagation times between the combinations of signal pairs received e.g. A B B C and C A outputs of differential receivers and of .

Drivers receivers and other devices used in a C PHY 3 Phase decoder may exhibit different switching characteristics that can introduce relative delays between signals received from the three wires. Multiple receiver output transitions may be observed at each symbol interval boundary and or due to slight differences in the rise and fall time between the three signals of the trio of signal wires and due to slight differences in signal propagation times between the combinations of pairs of signals received from the signal wires . The eye pattern may capture variances in rise and fall times as a relative delay in transitions near each symbol interval boundary and . The variances in rise and fall times may be due to the different characteristics of the 3 Phase drivers. Differences in rise and fall times may also result in an effective shortening or lengthening of the duration of the symbol interval for any given symbol.

A signal transition region represents a time or period of uncertainty where variable signal rise times prevent reliable decoding. State information may be reliably determined in an eye opening representing the time period in which the symbol is stable and can be reliably received and decoded. In one example the eye opening may be determined to begin at the end of the signal transition region and end at the symbol interval boundary of the symbol interval . In the example depicted in the eye opening may be determined to begin at the end of the signal transition region and end at a time when the signaling state of the signal wires and or the outputs of the three differential receivers and have begun to change to reflect the next symbol.

The maximum speed of a communication link configured for N Phase encoding may be limited by the duration of the signal transition region compared to the eye opening corresponding to the received signal. The minimum period for the symbol interval may be constrained by tightened design margins associated with the CDR circuit in the decoder illustrated in for example. Different signaling state transitions may be associated with different variations in signal transition times corresponding to two or more signal wires and or thereby causing the outputs of the differential receivers and in the receiving device to change at different times and or rates with respect to the symbol interval boundary where the inputs of the differential receivers and begin to change. The differences between signal transition times may result in timing skews between signaling transitions in two or more difference signals . CDR circuits may include delay elements and other circuits to accommodate timing skews between the difference signals .

For example the AB difference signal is provided to a first D flip flop of a first pair of D flip flops and the inverter provides an inverted version of the AB difference signal to a second D flip flop of the first pair of D flip flops . The D flip flops are initially in a reset state. A rising edge on the AB difference signal clocks a logic one through the first D flip flop causing the output of the first flip flop r AB to transition to a logic one state. A falling edge on the AB difference signal clocks a logic one through the second D flip flop causing the output of the second flip flop f AB to transition to a logic one state.

The output signals are provided to logic such as the OR gate which produces an output signal that may serve as the receiver clock RxCLK signal . The RxCLK signal transitions to a logic one state when a transition occurs in signaling state of any of the difference signals . The RxCLK signal is provided to a programmable delay element which drives a reset signal rb that resets the D flip flops in the pairs of D flip flops . In the illustrated example an inverter may be included when the D flip flops are reset by a low signal. When the D flip flops are reset the output of the OR gate returns to the logic zero state and the pulse on the RxCLK signal is terminated. When this logic zero state propagates through the programmable delay element and the inverter the reset condition on the D flip flops is released. While the D flip flops are in the reset condition transitions on the difference signals are ignored.

The programmable delay element is typically configured to produce a delay that has a duration that exceeds the difference in the timing skew between the occurrence of first and last transitions on the difference signals . The programmable delay element configures the duration of pulses i.e. the pulse width on the RxCLK signal . The programmable delay element may be configured when a Set signal is asserted by a processor or other control and or configuration logic.

The RxCLK signal may also be provided to a set of three flip flops that capture the signaling state of the difference signals providing a stable output symbol for each pulse that occurs on the RxCLK signal . Delay or alignment logic may adjust the timing of the set of difference signals . For example the delay or alignment logic may be used to adjust the timing of the difference signals with respect to the pulses on the RxCLK signal to ensure that the flip flops capture the signaling state of the difference signals when the difference signals are stable. The delay or alignment logic may delay edges in the difference signals based on the delay configured for the programmable delay element .

The programmable delay element may be configured in the CDR circuit to accommodate possible large variations in transition times in the difference signals . In one example the programmable delay element may introduce a minimum delay period that exceeds the duration of the timing skew between the occurrence of the first and last transitions on the difference signals . For reliable operation of the CDR circuit the maximum delay time provided by the programmable delay element may not be greater than the symbol interval. At faster data rates timing skew increases as a proportion of the symbol interval and the eye opening can become small in comparison to the symbol interval . The maximum symbol transmission rate may be limited when the timing skew reduces the percentage of the symbol interval occupied by the eye opening below a threshold size that can support reliable capture of symbols.

The relationship between t and the UI may determine the reliability of operation of the CDR circuit . This relationship is affected by clock frequency used for transmission which has a direct effect on the UI and variability in the operation of the programmable delay element .

In some devices the operation of the programmable delay element can be afflicted by variations in manufacturing process circuit supply voltage and die temperature PVT . The delay time provided by the programmable delay element for a configured value may vary significantly from device to device and or from circuit to circuit within a device. In conventional systems the nominal operating condition of the CDR circuit is generally set by design to generate a clock edge somewhere in the middle of the eye opening under all PVT conditions in order to ensure that a clock edge occurs after the end of the signal transition region and prior to the commencement of the transition region to the next symbol even under worst case PVT effects. Difficulty can arise in designing a CDR circuit that guarantees a clock edge within the eye opening when the transmission frequency increases and timing skew of the difference signals is large compared to the UI . For example a typical delay element may produce a delay value that changes by a factor of 2 over all PVT conditions.

Empirical evidence suggests that t is very sensitive to PVT. In some instances the delay provided by the programmable delay element may be increased to accommodate the range of potential variations of PVT. As data rates increase decreases and tincreases proportionately with respect to the UI reducing the potential range of delays available to configure the programmable delay element .

According to certain aspects disclosed herein a clock recovery circuit used in a C PHY multi phase receiver can avoid issues associated with variations in PVT. A clock recovery circuit may be adapted to detect transitions in some UIs and to suppress detection of transitions in other UIs. The clock recovery circuit may generate interpolated pulses for UIs in which transition detection is suppressed. In a first mode of operation a programmed delay may be configured to cause a CDR circuit to suppress detection of transitions in a second occurring UI after detecting a transition in first occurring UI. In this first mode of operation the CDR circuit generates a clock signal with a frequency that is half the frequency of the symbol transmission frequency. In a second mode of operation the programmed delay may be configured to cause the CDR circuit to suppress detection of transitions in two succeeding UIs after detecting a transition in first occurring UI. In the second mode of operation the CDR circuit generates a clock signal with a frequency that is one third of the frequency of the symbol transmission frequency. Other modes of operation may produce frequencies that are a quarter or less of the symbol frequency etc. A delay locked loop DLL may be used to generate clock pulses corresponding to UIs in which transition detection is suppressed. The clock pulses generated by the DLL may be inserted between pulses of the clock signal produced by the CDR circuit.

The RxCLK signal and the RXCLK MID signal may be used to sample delayed versions of the difference signals including for example the AB delay signal which is a delayed version of the AB signal and the CA delay signal which is a delayed version of the CA signal . The RxCLK signal captures even occurring symbols to provide symbols and in the Capture even signal while the RXCLK MID signal captures odd occurring symbols to provide symbols in the Capture odd signal .

In some instances the Capture even signal and the Capture odd signal can be re aligned to the RxCLK signal for example such that two or more of the symbols can be read in parallel.

CDR calibration logic may be provided to detect differences in the frequency of the rclk signal relative to the frequency of the ref clk signal . One or more programmable delay elements in the second CDR circuit may be calibrated based on the difference in frequencies of the rclk signal and the ref clk signal . In one example the CDR calibration logic may provide a multi bit control signal. The multi bit control signal may define that defines a delay parameter that controls the duration of delays produced by the programmable delay element in the second CDR circuit . The programmable delay element may be configured using a parameter that is selected to cause the second CDR circuit to suppress pulse generation in some proportion of the UIs . The rclk signal is provided to the DLL circuit which produces additional pulses in the form of a phase shifted signal that when combined with pulses in the rclk signal can be used by the second CDR circuit to generate the parallel output data ab o 1 0 bc o 1 0 ca o 1 0 .

The programmed delay in the second CDR circuit may be configured by adjusting the programmed delay while monitoring the frequency of the rclk signal . Initially the programmed delay may set to produce a delay that persists for a time that is less than the UI time the time required to transmit one symbol . In one example the clock recovery circuit may be configured to produce the rclk signal with a frequency equal to the symbol transmission frequency when a 3 phase signal is initially received. The value of the programmed delay may then be incrementally increased until the frequency of the rclk signal is divided by 2 by 3 or by any desired factor.

Clock frequencies may be measured using the counters . The counters may be incremented by the ref elk signal and the cal clk signal for a predetermined time period which may be determined by the calibration cycle clock signal for example. A first counter may capture the number of clock cycles ref val corresponding to the ref clk signal . In some instances the first counter may be operated immediately after initialization to capture a ref val that is a measure of the full rate symbol transmission clock and in some instances this initially obtained ref val may be registered or otherwise captured to be used for subsequent calibration cycles. A second counter counts the number of clock cycles cal val that occur during a calibration cycle. The calibration cycle may be configured as a predetermined time period or may be an adjustable time period. For each calibration cycle a delay parameter is provided to the CDR under calibration and the frequency of the resultant cal clk signal may be measured as the cal val accumulated by the second counter during the calibration cycle. When the cal val reflects a value that is a division of the clock frequency by the desired factor the configuration is complete and the final value of the delay parameter may be used to operate the clock recovery circuit.

The second CDR circuit may be calibrated by incrementing or decrementing the delay parameter until a desired frequency for the cal clk signal . Changes in frequency may result in changes in cal val and the comparator logic may continue calibration until a predefined difference between cal val and ref val is obtained. Calibration may commence with a low value for the delay parameter and the delay parameter may then be incremented for each calibration cycle. Calibration may commence with a high value for the delay parameter and the delay parameter may then be decremented for each calibration cycle.

According to certain aspects a receiver may determine the nominal symbol transmission frequency of the C PHY interface by adjusting delay elements of a CDR circuit until a training sequence is accurately received. A transmitter may send the training sequence during link initialization prior to transmitting individual packets of data after detection of an error at the receiver and or under application or system control. The receiver may monitor the C PHY interface for activity and may perform calibration upon detection of transitions. In some instances the receiver may determine that the CDR circuit has already been calibrated and may perform calibration if the training sequence is not properly received.

In the example illustrated in calibration commences when the programmable delay is initialized to a predetermined value that enables the CDR circuit to detect the training sequence. The CDR circuit may be adapted according to certain aspects disclosed herein such that the programmable delay may be adjusted to increase the tduration until errors are detected in the training sequence. The CDR circuit may be configured for normal operation with a programmable delay with a value that is one or more increments lower than the value that caused errors to be detected in the training sequence.

In the illustrated example the processing circuit may be implemented with a bus architecture represented generally by the bus . The bus may include any number of interconnecting buses and bridges depending on the specific application of the processing circuit and the overall design constraints. The bus links together various circuits including the one or more processors and storage . Storage may include memory devices and mass storage devices and may be referred to herein as computer readable media and or processor readable media. The bus may also link various other circuits such as timing sources timers peripherals voltage regulators and power management circuits. A bus interface may provide an interface between the bus and one or more transceivers . A transceiver may be provided for each networking technology supported by the processing circuit. In some instances multiple networking technologies may share some or all of the circuitry or processing modules found in a transceiver . Each transceiver provides a means for communicating with various other apparatus over a transmission medium. Depending upon the nature of the apparatus a user interface e.g. keypad display speaker microphone joystick may also be provided and may be communicatively coupled to the bus directly or through the bus interface .

A processor may be responsible for managing the bus and for general processing that may include the execution of software stored in a computer readable medium that may include the storage . In this respect the processing circuit including the processor may be used to implement any of the methods functions and techniques disclosed herein. The storage may be used for storing data that is manipulated by the processor when executing software and the software may be configured to implement any one of the methods disclosed herein.

One or more processors in the processing circuit may execute software. Software shall be construed broadly to mean instructions instruction sets code code segments program code programs subprograms software modules applications software applications software packages routines subroutines objects executables threads of execution procedures functions algorithms etc. whether referred to as software firmware middleware microcode hardware description language or otherwise. The software may reside in computer readable form in the storage or in an external computer readable medium. The external computer readable medium and or storage may include a non transitory computer readable medium. A non transitory computer readable medium includes by way of example a magnetic storage device e.g. hard disk floppy disk magnetic strip an optical disk e.g. a compact disc CD or a digital versatile disc DVD a smart card a flash memory device e.g. a flash drive a card a stick or a key drive a random access memory RAM a ROM a PROM an erasable PROM EPROM an EEPROM a register a removable disk and any other suitable medium for storing software and or instructions that may be accessed and read by a computer. The computer readable medium and or storage may also include by way of example a carrier wave a transmission line and any other suitable medium for transmitting software and or instructions that may be accessed and read by a computer. Computer readable medium and or the storage may reside in the processing circuit in the processor external to the processing circuit or be distributed across multiple entities including the processing circuit . The computer readable medium and or storage may be embodied in a computer program product. By way of example a computer program product may include a computer readable medium in packaging materials. Those skilled in the art will recognize how best to implement the described functionality presented throughout this disclosure depending on the particular application and the overall design constraints imposed on the overall system.

The storage may maintain software maintained and or organized in loadable code segments modules applications programs etc. which may be referred to herein as software modules . Each of the software modules may include instructions and data that when installed or loaded on the processing circuit and executed by the one or more processors contribute to a run time image that controls the operation of the one or more processors . When executed certain instructions may cause the processing circuit to perform functions in accordance with certain methods algorithms and processes described herein.

Some of the software modules may be loaded during initialization of the processing circuit and these software modules may configure the processing circuit to enable performance of the various functions disclosed herein. For example some software modules may configure internal devices and or logic circuits of the processor and may manage access to external devices such as the transceiver the bus interface the user interface timers mathematical coprocessors and so on. The software modules may include a control program and or an operating system that interacts with interrupt handlers and device drivers and that controls access to various resources provided by the processing circuit . The resources may include memory processing time access to the transceiver the user interface and so on.

One or more processors of the processing circuit may be multifunctional whereby some of the software modules are loaded and configured to perform different functions or different instances of the same function. The one or more processors may additionally be adapted to manage background tasks initiated in response to inputs from the user interface the transceiver and device drivers for example. To support the performance of multiple functions the one or more processors may be configured to provide a multitasking environment whereby each of a plurality of functions is implemented as a set of tasks serviced by the one or more processors as needed or desired. In one example the multitasking environment may be implemented using a timesharing program that passes control of a processor between different tasks whereby each task returns control of the one or more processors to the timesharing program upon completion of any outstanding operations and or in response to an input such as an interrupt. When a task has control of the one or more processors the processing circuit is effectively specialized for the purposes addressed by the function associated with the controlling task. The timesharing program may include an operating system a main loop that transfers control on a round robin basis a function that allocates control of the one or more processors in accordance with a prioritization of the functions and or an interrupt driven main loop that responds to external events by providing control of the one or more processors to a handling function.

At block the receiver circuit may configure a clock recovery circuit to provide a first clock signal that includes a pulse for each symbol transmitted on a 3 wire 3 phase interface. Symbols may be transmitted on the 3 wire 3 phase interface at a first frequency.

At block the receiver circuit may adjust a loop delay of the clock recovery circuit to modify the first clock to have a second frequency that is no more than half the first frequency. The clock recovery circuit may generate a pulse in the first clock signal for a first of an integer number of symbols and may suppress pulse generation for other symbols in the integer number of symbols. The loop delay may correspond to a pulse generation cycle used to generate a pulse in response to a first detected transition in signaling state of the 3 wire 3 phase interface. Detection of other transitions in signaling state of the 3 wire 3 phase interface may be suppressed during the pulse generation cycle. The receiver circuit may adjust the loop delay by configuring one or more programmable delay circuits in the clock recovery circuit.

At block the receiver circuit may configure a clock generation circuit to provide a second clock signal. The second clock signal may include pulses corresponding to each of the other symbols in the integer number of symbols.

At block the receiver circuit may capture symbols from the 3 wire 3 phase interface using the first clock signal and the second clock signal. In the example the first clock signal may be combined with the second clock signal to produce a receive clock signal. The receive clock symbol may be used to clock registers that capture the signals.

In one example the first frequency may be twice the second frequency and the second clock signal may include one pulse for every pulse in the first clock signal. In this example the second frequency is 180 degrees phase shifted with respect to the first clock signal. In another example the second frequency is one third of the first frequency and the second clock signal may include two pulses for every pulse in the first clock signal. In another example the second frequency is one fourth of the first frequency and the second clock signal may include three pulses for every pulse in the first clock signal. Other divisor values may be employed to derive the second frequency.

In some instances adjusting the loop delay of the clock recovery circuit includes configuring a first circuit to recover a reference clock signal from a stream of symbols received from the 3 wire 3 phase interface determining a current frequency of the first clock signal by comparing frequencies of the reference clock signal and the first clock signal during each of a plurality of calibration cycles increasing the loop delay when the current frequency is determined to be greater than the second frequency decreasing the loop delay when the current frequency is determined to be less than the second frequency and terminating the plurality of calibration cycles when the current frequency is determined to be equal to the second frequency. The reference clock signal may have a frequency corresponding to the first frequency.

The processor is responsible for general processing including the execution of software stored on the computer readable storage medium . The software when executed by the processor causes the processing circuit to perform the various functions described supra for any particular apparatus. The computer readable storage medium may also be used for storing data that is manipulated by the processor when executing software including data decoded from symbols transmitted over the connectors or wires which may be configured as data lanes and clock lanes. The processing circuit further includes at least one of the modules and . The modules and may be software modules running in the processor resident stored in the computer readable storage medium one or more hardware modules coupled to the processor or some combination thereof. The modules and or may include microcontroller instructions state machine configuration parameters or some combination thereof.

In one configuration the apparatus may be configured for data communication over a C PHY 3 phase interface. The apparatus may include a module and or circuit that is configured to recover a first clock signal from timing information embedded in sequences of symbols transmitted on the connectors or wires a module and or circuit for generating a second clock signal that include pluses interpolated from the first clock signal a module and or circuit that uses the first and second signals to capture symbols from the connectors or wires and a module and or circuit that can calibrate the clock recovery module and or circuit and the clock generation module and or circuit .

The apparatus may be configured for various modes of operation. In one example the clock recovery module and or circuit may be adapted to provide a first clock signal that includes a pulse for each symbol transmitted at a first frequency on a 3 wire 3 phase interface the calibration module and or circuit may be adapted to calibrate a loop delay of the clock recovery circuit the clock generation module and or circuit may be adapted to provide a second clock signal and the symbol capture module and or circuit may be adapted to capture symbols from the 3 wire 3 phase interface using the first clock signal and the second clock signal. In one mode of operation the calibration module and or circuit modifies the first clock signal to have a second frequency that is no more than half the first frequency. In the first mode of operation the clock recovery module and or circuit generates a pulse in the first clock signal for a first of an integer number of symbols and suppresses pulse generation for other symbols in the integer number of symbols. The second clock signal may include pulses corresponding to each of the other symbols in the integer number of symbols.

In some instances the loop delay corresponds to a pulse generation cycle used to generate a pulse in response to a first detected transition in signaling state of the 3 wire 3 phase interface. Detection of other transitions in signaling state of the 3 wire 3 phase interface may be suppressed during the pulse generation cycle. The calibration module and or circuit may be configured to program a programmable delay circuit.

In one example the first frequency is twice the second frequency and the second clock signal includes one pulse for every pulse in the first clock signal. The second clock signal may be 180 degrees phase shifted with respect to the first clock signal. In another example the second frequency is one third of the first frequency and the second clock signal includes two pulses for every pulse in the first clock signal. In another example the second frequency is one fourth of the first frequency and the second clock signal includes three pulses for every pulse in the first clock signal.

In some instances the calibration module and or circuit is adapted to cause a first circuit to recover a reference clock signal from a stream of symbols received from the 3 wire 3 phase interface determine a current frequency of the first clock signal by comparing frequencies of the reference clock signal and the first clock signal during each of a plurality of calibration cycles increase the loop delay when the current frequency is determined to be greater than the second frequency decrease the loop delay when the current frequency is determined to be less than the second frequency and terminate the plurality of calibration cycles when the current frequency is determined to be equal to the second frequency. The reference clock signal may have a frequency corresponding to a rate of transmission of the stream of symbols.

It is understood that the specific order or hierarchy of steps in the processes disclosed is an illustration of exemplary approaches. Based upon design preferences it is understood that the specific order or hierarchy of steps in the processes may be rearranged. Further some steps may be combined or omitted. The accompanying method claims present elements of the various steps in a sample order and are not meant to be limited to the specific order or hierarchy presented.

The previous description is provided to enable any person skilled in the art to practice the various aspects described herein. Various modifications to these aspects will be readily apparent to those skilled in the art and the generic principles defined herein may be applied to other aspects. Thus the claims are not intended to be limited to the aspects shown herein but is to be accorded the full scope consistent with the language claims wherein reference to an element in the singular is not intended to mean one and only one unless specifically so stated but rather one or more. Unless specifically stated otherwise the term some refers to one or more. All structural and functional equivalents to the elements of the various aspects described throughout this disclosure that are known or later come to be known to those of ordinary skill in the art are expressly incorporated herein by reference and are intended to be encompassed by the claims. Moreover nothing disclosed herein is intended to be dedicated to the public regardless of whether such disclosure is explicitly recited in the claims. No claim element is to be construed as a means plus function unless the element is expressly recited using the phrase means for. 

