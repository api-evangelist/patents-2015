---

title: Location service management
abstract: An application manager of a mobile device can provide a user with the ability to control whether an application can use location information provided by a location subsystem of the mobile device. The application can request to be notified by the location subsystem when the mobile device crosses a geofence. When the mobile device crosses the geofence, the location subsystem provides a notice to the application. The application manager can intercept the notice to the application, and present an alert on a user interface. The application manager can then provide the notice to the application only upon receiving an input through the user interface confirming that the application still has permission to use location information.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09591443&OS=09591443&RS=09591443
owner: Apple Inc.
number: 09591443
owner_city: Cupertino
owner_country: US
publication_date: 20150916
---
This application claims priority to U.S. Provisional Patent Application No. 62 169 511 entitled Location Service Management filed Jun. 1 2015 the entire contents of which are incorporated herein by reference.

This disclosure relates generally to managing access to location service information by applications.

Modern mobile devices e.g. smart phones tablet computers wearable devices often include location services. A location service provides location data to applications running on the mobile device. The location data can be provided by satellite based or network based positioning systems. For example a Global Positioning System GPS receiver can be embedded or coupled to the mobile device that provides GPS data e.g. latitude longitude to the location service. Additionally radio frequency RF signals from access points beacons or cell towers can be used to determine the location of the mobile device. The location service aggregates location data from the various positioning systems and provides the location data to applications upon request.

Since the advent of location aware devices users have become increasingly concerned about the use of their private location data by third parties. To address this concern mobile device manufacturers desire to provide mechanisms for allowing users to opt out of sharing their location data with applications running on the mobile device.

An application manager of a mobile device can provide a user with the ability to control whether an application can use location information provided by a location subsystem of the mobile device. The application can request to be notified by the location subsystem when the mobile device crosses a geofence. When the mobile device crosses the geofence the location subsystem provides a notice to the application. The application manager can intercept the notice to the application and present an alert on a user interface. The application manager can then provide the notice to the application only upon receiving an input through the user interface confirming that the user authorizes the application to be notified.

An application can specify a location service authorization type to be enforced by a mobile device. After the user authorizes the location service through an authorization dialog the application can receive location service according to the authorization type. For example the application can specify one of several authorization types through an application programming interface API . A first authorization type allows the application to receive continuous location updates from a location service on the mobile device only when the application is in use. In some implementations an application is considered to be in use based on a variety of factors including but not limited to when the application is visible on a display of the mobile device or when the application is invoked through a voice command e.g. invoked using an intelligent personal assistant . A second authorization type allows the application to always receive continuous location updates and location events when the application is running in a foreground or background or caused to be running in the background.

In some implementations an authorization dialog is presented to the user requesting authorization from the user to allow the application to receive location data. The text of the authorization dialog can be customized by the application to provide more detail on how the location data will be used by the application. In some implementations the application can be configured to display the authorization dialog only once to the user. In some implementations the authorization type can be specified by setting one or more keys in a file of the application which are used in conjunction with an API to specify the authorization type and customized dialog text. In some implementations a settings pane allows a user to set an authorization type for an application on the mobile device. In some implementations a status indicator is displayed by the application that changes its visual appearance based on the type of location service being provided to the application. In some implementations a status indicator provides a quick return to an application that is using the location service while the user is working in another application on the display.

Other implementations are directed to systems devices and non transitory computer readable storage mediums. Particular implementations disclosed herein provide one or more of the following advantages. Application developers have more control over how location services on a mobile device are authorized for their application. Users benefit by receiving more detail about how the location data will be used by the application so that they can make a more informed decision regarding authorization of location service. A layer between an application and location functions of a mobile device provides additional privacy protection to the user.

The details of the disclosed implementations are set forth in the accompanying drawings and the description below. Other features objects and advantages are apparent from the description drawings and claims.

The Always authorization type shown in allows the location service to provide continuous location updates and location events e.g. a geofence crossing significant location detection to the application when the application is running in the foreground or background or caused to be running in the background on mobile device . When the application is launched authorization dialog can be presented in GUI . Authorization dialog includes generic text provided by an operating system of mobile device and custom text provided by the application.

In the operating system provided the generic text Allow Camera to Access Your Location While You Use the App and the camera application provided the custom text Photos and videos will be tagged with the location where they are taken. Custom text provided by the camera application addresses the user s privacy concerns about their location data being shared with third parties. The user is provided with user interface elements e.g. Don t Allow and Allow buttons to allow or not allow the camera application to use the location data. In some implementations authorization dialog is displayed only once after the camera application is launched for the first time after installation or reinstallation of the camera application.

In the example shown the operating system provided the generic text Weather Has Been Using Your Location in the Background. Do you want to Continue Allowing this and the weather application provided the custom text Your current location is used to show local weather in the Weather app and in Notification Center. The user is provided with user interface elements e.g. Don t Allow and Continue buttons to allow or not allow the weather application to use the location data.

In the example shown an application Stephen s Coffee Shop pre registered with the location subsystem to receive notification of geofence crossing. The location subsystem detects a crossing of the geofence. Mobile device can display user alert including text identifying the application. The application can provide the customizable text You ve arrived at Stephen s Coffee Shop. The user is provided with user interface elements e.g. Close and Open buttons to close the alert or open the application.

If an Always authorization type is enforced by authorization module location data is provided by location service to application when application is running in the foreground or background on mobile device . Application may send location data to online service e.g. Facebook through network e.g. the Internet .

If a WhenInUse authorization type is enforced by authorization module when application is in use e.g. its GUI is displayed then location service can send location data directly to application where it can be displayed to user . If application is not in use system service can involve the user so that the user can bring application into use and provide location data to application . For example a notification can be displayed that can be selected by the user to bring application back into use. In this case application can choose to send location data to online service because the user knows application is in use as opposed to the case when Always authorization is enforced and the user may not be aware that application is running and has received location data .

Mobile device can include user interface UI subsystem . UI subsystem is a component of mobile device configured to provide various user interface items e.g. dialog windows sound alerts vibration outputs configured to provide information to the user and receive input from the user through voice input touch screen or physical buttons.

Mobile device can store application . Application can include a computer program that interacts with various subsystems of mobile device . Application can have a feature that is related to a geofence and is configured to activate or to perform certain functions upon entry into or exit from a geofence by mobile device .

Mobile device can include application management subsystem . Application management subsystem is a component of mobile device configured to manage interactions between application and location services provided by mobile device including to intercept a location notification to application .

Mobile device can include location subsystem . Location subsystem is a component of mobile device configured to provide various location services including to determine a location of mobile device using various technologies e.g. Wi Fi signals or GPS signals and to determine whether mobile device crossed a geofence.

Mobile device can include notification subsystem . Notification subsystem can be a component of an operating system of mobile device or a component that is controlled by an operating system of mobile device . Notification subsystem can be configured to provide notifications to a user through UI subsystem .

Referring to . During execution of application application can submit request to location subsystem . Request can indicate a message seeking permission to use one or more services of location subsystem . In response to request location subsystem can determine whether to permit application to use location service provided by location subsystem . Determining whether to permit application to use location service can include sending a message to UI subsystem to display an alert e.g. user alert of receiving a user input through UI subsystem and permit or deny request according to the user input. If the user approves location subsystem can provide permission to application .

Upon receiving permission application can submit location parameters to application management subsystem . Location parameters can include one or more of a location a size an identifier or shape in the form of a polygon of a geofence. The geofence can enclose a two dimensional or three dimensional geographic area. Application management subsystem can act as an intermediary between application and location subsystem . Upon receiving location parameter application management subsystem can send request for geofence monitoring to location subsystem . Request can specify the geofence for location subsystem to monitor. Request can include information on the geofence as well as information associating the geofence with application to location subsystem . In response to request location subsystem can monitor the geofence specified in request . During monitoring application can pause execution for example by termination or by entering a background execution mode.

Upon detecting a crossing of the geofence specified in request location subsystem can submit fence crossing notification to application management subsystem . In response to fence crossing notification application management subsystem can submit query to location subsystem inquiring whether application still has permission to use location information. Application management subsystem can submit query synchronously where application management subsystem waits for a reply. Application management subsystem can submit query asynchronously handling other processes until a reply comes back from location subsystem . Location subsystem can respond by sending reply to application management subsystem . Reply can indicate that application still has permission. In response application management subsystem can submit request for user notification to notification subsystem . In response to request notification subsystem can submit message to UI subsystem for presenting a user alert. UI subsystem can present a notification to a user in response to message in various ways including for example by displaying user alert as described above in reference to .

Application management subsystem can receive input from UI subsystem indicating whether a user chose to open the application. Upon receiving a user input closing application through UI subsystem application management subsystem can prevent application from being activated. If the user chooses to open application UI subsystem can provide user approval to application management subsystem . In response to user approval application management subsystem can activate application if application is not already activated. Activating application can include for example launching application or bringing application from a background execution mode to a foreground execution mode. Application management subsystem can then provide location information to application . Location information can include the notification of geofence crossing as requested by application .

Referring to which corresponds to an alternative implementation of the features described in reference to . In response to fence crossing notification application management subsystem can submit request for user notification to notification subsystem . In response to request notification subsystem can submit message to UI subsystem for presenting a user alert. UI subsystem can present a notification to a user in response to message in various ways including for example by displaying user alert as described above in reference to .

Application management subsystem can receive input from UI subsystem indicating whether a user chose to open the application. If the user chooses to open application application manager subsystem can submit query to location subsystem inquiring whether application still has permission to use location information. Application management subsystem can submit query synchronously where application management subsystem waits for a reply. Application management subsystem can submit query asynchronously handling other processes until a reply comes back from location subsystem . Location subsystem can respond by sending reply to application manager . Reply can indicate that application still has permission or not. In response application manager activates application if application is not already activated. Application management subsystem can then provide location information to application if reply indicates that application still has permission or do not provide location information if reply indicates otherwise.

In some implementations the operations of and the operations of can be combined. Application management subsystem can submit query before requesting notification and then submit query after requesting notification.

In some implementations process can begin by receiving a request or intent for a location service authorization type . The location service authorization type can be specified by an application through an API. In some implementations the location service authorization type can be determined statically using metadata of the application. For example the location service authorization type can be specified by one or more keys in a file of the application. For example for mobile devices running iOS operating system developed by Apple Inc. Cupertino Calif. an info.plist of an application installed on the mobile device can set one of the keys NSLocationWhenInUseUsageDescription or NSLocationAlwaysUsageDescription. The keys indicate what the application may do in the future which causes for example the settings pane shown in to include a user interface element for the application.

In addition to the keys in the info.plist an authorization request API is called with one of the API parameters requestWhenInUseAuthorization or requestAlwaysAuthorization set. The API parameters inform the system what the application wants to request from the user. Other location service authorization types are also possible. In some implementations a default location service authorization type can be enforced if not specified by an application or the user.

Process can continue by receiving user input authorizing the location service through an authorization dialog or settings pane according to the location service authorization type . The authorization dialog can include generic or default text provided by an operating system of the mobile device and custom text provided by the application. Generic text can be specific to the location authorization type to be enforced for the application. Custom text can describe how the location data will be used by the application. The authorization dialog can include one or more user interface elements that can be selected by the user to allow or not allow the application to receive location data.

Process can continue by enforcing the location service authorization type for the application . For example an authorization module can determine when an application is requesting location data and based on the location service authorization type enforced for the application determine whether to provide the location data to the application Always . If the application does not meet the WhenlnUse constraints an operating system service can still provide the location service to the user without providing the location service to the application so that the user need not trust the application to be the direct recipient of the location service.

Process can continue while the application is running and receiving location data by displaying a status indicator on the display of the mobile device. The status indicator e.g. an icon can have a first visual appearance e.g. a solid icon based on a first location service type e.g. foreground or background location data use ranging significant location changes and a second visual appearance e.g. a hollow icon based on a second location service type e.g. region geofence monitoring .

In some implementations if a WhenlnUse application which is actively tracking the user s location ceases to be visible to the user e.g. the user is using a different application in the foreground a status indicator e.g. a banner display can be presented in the GUI that when selected by the user e.g. touched by the user provides a quick return back to the WhenlnUse application if the application is still using the location service. The status indicator allows the user to return to the application more quickly and also prevents applications from doing this surreptitiously. For example certain applications e.g. an exercise tracker application is considered in use even when not running in the foreground.

An application management subsystem of a mobile device e.g. application management subsystem of can receive location parameters from an application executing on the mobile device e.g. application of . The application can be requesting to be notified upon crossing a geofence by the mobile device. The location parameters can include information on the geofence. The information on the geofence can include at least one of a location of the geofence or an identifier of the geofence.

In some implementations before the application management subsystem receives the location parameters the location subsystem can receive from the application a request for permission to use location information. The location subsystem can provide a response indicating that the application is permitted to use the location information. The response can trigger the application to submit the location parameters to the application management subsystem. The application can enter an inactive state after submitting the location parameters to the application management subsystem. Entering the inactive state can include setting the application to a background execution mode or terminating the application.

Providing the response indicating that the application is permitted to use the location information can be triggered by a user input. In response to the request for permission to use location information received by the location subsystem from the application the location subsystem can cause a user interface subsystem of the mobile device e.g. the user interface subsystem of to present an application dialog. The location subsystem can receive a user input through the user interface subsystem approving the request to use location information. Then the location subsystem can provide the response indicating that the application is permitted to use the location information to the application.

The application management subsystem can provide to a location subsystem of the mobile device e.g. location subsystem of a request to monitor a crossing of the geofence. The request can trigger the location subsystem to monitor a location of the mobile device to determine whether the mobile device crossed the geofence.

Upon detecting the crossing the location subsystem can notify the application subsystem by sending a response. The application management subsystem can receive the response from the location subsystem indicating that the mobile device crossed the geofence.

The application management subsystem can provide a request for notification to a notification subsystem of the mobile device e.g. notification subsystem of requesting the notification subsystem to notify a user of the mobile device that communication between the location subsystem and the application is about to occur.

In response to the request for notification the notification subsystem can present an alert through a user interface subsystem of the mobile device e.g. user interface subsystem of . The alert e.g. user alert of can include information for the user to open the application.

Upon receiving by the application management subsystem and from the user interface subsystem an input opening the application the application management subsystem can activate the application and notify the application of the crossing of the geofence. Activating the application can include launching the application or changing an execution mode of the application from a background execution mode to a foreground execution mode. Notifying the application of the crossing of the geofence can be conditioned on a second permission check. In the second permission check the application subsystem can send a query to the location subsystem inquiring whether the application still has permission to use location information. The application management subsystem notifies the application of the crossing only if the location subsystem replies to the query and indicates that the application still has permission to use location information.

Sensors devices and subsystems may be coupled to peripherals interface to facilitate multiple functionalities. For example motion sensor light sensor and proximity sensor may be coupled to peripherals interface to facilitate orientation lighting and proximity functions of the device. For example in some implementations light sensor may be utilized to facilitate adjusting the brightness of touch surface . In some implementations motion sensor e.g. an accelerometer gyros may be utilized to detect movement and orientation of the device. Accordingly display objects or media may be presented according to a detected orientation e.g. portrait or landscape .

Other sensors may also be connected to peripherals interface such as a temperature sensor a biometric sensor or other sensing device to facilitate related functionalities.

Location processor e.g. GPS receiver chip may be connected to peripherals interface to provide geo referencing. Electronic magnetometer e.g. an integrated circuit chip may also be connected to peripherals interface to provide data that may be used to determine the direction of magnetic North. Thus electronic magnetometer may be used with an electronic compass application.

Camera subsystem and an optical sensor e.g. a charged coupled device CCD or a complementary metal oxide semiconductor CMOS optical sensor may be utilized to facilitate camera functions such as recording photographs and video clips.

Communication functions may be facilitated through one or more communication subsystems . Communication subsystem s may include one or more wireless communication subsystems. Wireless communication subsystems may include radio frequency receivers and transmitters and or optical e.g. infrared receivers and transmitters. Wired communication system may include a port device e.g. a Universal Serial Bus USB port or some other wired port connection that may be used to establish a wired connection to other computing devices such as other communication devices network access devices a personal computer a printer a display screen or other processing devices capable of receiving or transmitting data.

The specific design and implementation of the communication subsystem may depend on the communication network s or medium s over which the device is intended to operate. For example a device may include wireless communication subsystems designed to operate over a global system for mobile communications GSM network a GPRS network an enhanced data GSM environment EDGE network 802.x communication networks e.g. Wi Fi Wi Max code division multiple access CDMA networks NFC and a Bluetooth network. Wireless communication subsystems may include hosting protocols such that the device may be configured as a base station for other wireless devices. As another example the communication subsystems may allow the device to synchronize with a host device using one or more protocols such as for example the TCP IP protocol HTTP protocol UDP protocol and any other known protocol.

Audio subsystem may be coupled to a speaker and one or more microphones to facilitate voice enabled functions such as voice recognition voice replication digital recording and telephony functions.

I O subsystem may include touch controller and or other input controller s . Touch controller may be coupled to a touch surface . Touch surface and touch controller may for example detect contact and movement or break thereof using any of a number of touch sensitivity technologies including but not limited to capacitive resistive infrared and surface acoustic wave technologies as well as other proximity sensor arrays or other elements for determining one or more points of contact with touch surface . In one implementation touch surface may display virtual or soft buttons and a virtual keyboard which may be used as an input output device by the user.

Other input controller s may be coupled to other input control devices such as one or more buttons rocker switches thumb wheel infrared port USB port and or a pointer device such as a stylus. The one or more buttons not shown may include an up down button for volume control of speaker and or microphone .

In some implementations device implementing architecture may present recorded audio and or video files such as MP3 AAC and MPEG video files. In some implementations device implementing architecture may include the functionality of an MP3 player and may include a pin connector for tethering to other devices. Other input output and control devices may be used.

Memory interface may be coupled to memory . Memory may include high speed random access memory or non volatile memory such as one or more magnetic disk storage devices one or more optical storage devices or flash memory e.g. NAND NOR . Memory may store operating system such as Darwin RTXC LINUX UNIX OS X WINDOWS or an embedded operating system such as VxWorks. Operating system may include instructions for handling basic system services and for performing hardware dependent tasks. In some implementations operating system may include a kernel e.g. UNIX kernel .

Memory may also store communication instructions to facilitate communicating with one or more additional devices one or more computers or servers including peer to peer communications as described in reference to . Communication instructions may also be used to select an operational mode or communication medium for use by the device based on a geographic location obtained by the GPS Navigation instructions of the device. Memory may include graphical user interface instructions to facilitate graphic user interface processing including a touch model for interpreting touch inputs and gestures sensor processing instructions to facilitate sensor related processing and functions phone instructions to facilitate phone related processes and functions electronic messaging instructions to facilitate electronic messaging related processes and functions web browsing instructions to facilitate web browsing related processes and functions media processing instructions to facilitate media processing related processes and functions GPS Navigation instructions to facilitate GPS and navigation related processes camera instructions to facilitate camera related processes and functions and location management instructions for performing some or all of the operations as described in reference to .

Each of the above identified instructions and applications may correspond to a set of instructions for performing one or more functions described above. These instructions need not be implemented as separate software programs procedures or modules. Memory may include additional instructions or fewer instructions. Furthermore various functions of the device may be implemented in hardware and or in software including in one or more signal processing and or application specific integrated circuits ASICs .

The features described may be implemented in digital electronic circuitry or in computer hardware firmware software or in combinations of them. The features may be implemented in a computer program product tangibly embodied in an information carrier e.g. in a machine readable storage device for execution by a programmable processor and method steps may be performed by a programmable processor executing a program of instructions to perform functions of the described implementations by operating on input data and generating output.

The described features may be implemented advantageously in one or more computer programs that are executable on a programmable system including at least one programmable processor coupled to receive data and instructions from and to transmit data and instructions to a data storage system at least one input device and at least one output device. A computer program is a set of instructions that may be used directly or indirectly in a computer to perform a certain activity or bring about a certain result. A computer program may be written in any form of programming language e.g. Objective C Java including compiled or interpreted languages and it may be deployed in any form including as a stand alone program or as a module component subroutine or other unit suitable for use in a computing environment.

Suitable processors for the execution of a program of instructions include by way of example both general and special purpose microprocessors and the sole processor or one of multiple processors or cores of any kind of computer. Generally a processor will receive instructions and data from a read only memory or a random access memory or both. The essential elements of a computer are a processor for executing instructions and one or more memories for storing instructions and data. Generally a computer may communicate with mass storage devices for storing data files. These mass storage devices may include magnetic disks such as internal hard disks and removable disks magneto optical disks and optical disks. Storage devices suitable for tangibly embodying computer program instructions and data include all forms of non volatile memory including by way of example semiconductor memory devices such as EPROM EEPROM and flash memory devices magnetic disks such as internal hard disks and removable disks magneto optical disks and CD ROM and DVD ROM disks. The processor and the memory may be supplemented by or incorporated in ASICs application specific integrated circuits .

To provide for interaction with an author the features may be implemented on a computer having a display device such as a CRT cathode ray tube or LCD liquid crystal display monitor for displaying information to the author and a keyboard and a pointing device such as a mouse or a trackball by which the author may provide input to the computer.

The features may be implemented in a computer system that includes a back end component such as a data server or that includes a middleware component such as an application server or an Internet server or that includes a front end component such as a client computer having a graphical user interface or an Internet browser or any combination of them. The components of the system may be connected by any form or medium of digital data communication such as a communication network. Examples of communication networks include a LAN a WAN and the computers and networks forming the Internet.

The computer system may include clients and servers. A client and server are generally remote from each other and typically interact through a network. The relationship of client and server arises by virtue of computer programs running on the respective computers and having a client server relationship to each other.

One or more features or steps of the disclosed embodiments may be implemented using an Application Programming Interface API . An API may define on or more parameters that are passed between a calling application and other software code e.g. an operating system library routine function that provides a service that provides data or that performs an operation or a computation.

The API may be implemented as one or more calls in program code that send or receive one or more parameters through a parameter list or other structure based on a call convention defined in an API specification document. A parameter may be a constant a key a data structure an object an object class a variable a data type a pointer an array a list or another call. API calls and parameters may be implemented in any programming language. The programming language may define the vocabulary and calling convention that a programmer will employ to access functions supporting the API.

In some implementations an API call may report to an application the capabilities of a device running the application such as input capability output capability processing capability power capability communications capability etc.

As described above some aspects of the subject matter of this specification include gathering and use of data available from various sources to improve services a mobile device can provide to a user. The present disclosure contemplates that in some instances this gathered data may identify a particular location or an address based on device usage. Such personal information data can include location based data addresses subscriber account identifiers or other identifying information.

The present disclosure further contemplates that the entities responsible for the collection analysis disclosure transfer storage or other use of such personal information data will comply with well established privacy policies and or privacy practices. In particular such entities should implement and consistently use privacy policies and practices that are generally recognized as meeting or exceeding industry or governmental requirements for maintaining personal information data private and secure. For example personal information from users should be collected for legitimate and reasonable uses of the entity and not shared or sold outside of those legitimate uses. Further such collection should occur only after receiving the informed consent of the users. Additionally such entities would take any needed steps for safeguarding and securing access to such personal information data and ensuring that others with access to the personal information data adhere to their privacy policies and procedures. Further such entities can subject themselves to evaluation by third parties to certify their adherence to widely accepted privacy policies and practices.

In the case of advertisement delivery services the present disclosure also contemplates embodiments in which users selectively block the use of or access to personal information data. That is the present disclosure contemplates that hardware and or software elements can be provided to prevent or block access to such personal information data. For example in the case of advertisement delivery services the present technology can be configured to allow users to select to opt in or opt out of participation in the collection of personal information data during registration for services.

Therefore although the present disclosure broadly covers use of personal information data to implement one or more various disclosed embodiments the present disclosure also contemplates that the various embodiments can also be implemented without the need for accessing such personal information data. That is the various embodiments of the present technology are not rendered inoperable due to the lack of all or a portion of such personal information data. For example content can be selected and delivered to users by inferring preferences based on non personal information data or a bare minimum amount of personal information such as the content being requested by the device associated with a user other non personal information available to the content delivery services or publically available information.

A number of implementations have been described. Nevertheless it will be understood that various modifications may be made. Elements of one or more implementations may be combined deleted modified or supplemented to form further implementations. As yet another example the logic flows depicted in the figures do not require the particular order shown or sequential order to achieve desirable results. In addition other steps may be provided or steps may be eliminated from the described flows and other components may be added to or removed from the described systems. Accordingly other implementations are within the scope of the following claims.

