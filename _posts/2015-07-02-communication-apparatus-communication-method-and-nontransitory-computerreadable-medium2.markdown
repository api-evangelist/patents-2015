---

title: Communication apparatus, communication method, and non-transitory computer-readable medium
abstract: A first header compression table for compressing a message header is generated based on a first communication connection established between communication apparatuses. A message is transmitted from a communication apparatus to another communication apparatus based on the first communication connection, and a header of the message has been compressed based on the first header compression table. It is determined whether the first header compression table is used as a second header compression table for compressing a message header to be communicated based on a second communication connection which is different from the first communication connection and has been established between the communication apparatuses. The header of the message to be communicated based on the second communication connection is compressed using the first header compression table as the second header compression table in accordance with the determination.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09596326&OS=09596326&RS=09596326
owner: CANON KABUSHIKI KAISHA
number: 09596326
owner_city: Tokyo
owner_country: JP
publication_date: 20150702
---
The present invention relates to a communication apparatus and a communication method which compress a message header when performing message communication.

There is provided HTTP Hyper Text Transfer Protocol as one of protocols generally widely used as Internet standard techniques. In IETF Internet Engineering Task Force the new version HTTP 2 of the HTTP standard is now stipulated see M. Balshe and three others Hypertext Transfer Protocol version 2 online Apr. 23 2014 Internet .

As a new function of HTTP 2 there is provided an HTTP header compression function. The HTTP header compression function performs data compression for HTTP header information using a kind of dictionary called an HTTP header table and transmits receives only a difference in HTTP header information between a server and a client see R. Peon and H. Ruellan HTTP Header Compression for HTTP 2 online Apr. 3 2014 Internet . This can reduce the data size of an HTTP communication message transmitted received between a server and a client.

However the above described HTTP header compression function newly creates an HTTP header table every time HTTP communication starts. This unwantedly increases the processing load of HTTP header table creation processing and a communication delay caused by the creation time in both the server and client.

In one aspect a communication apparatus comprising a generation unit configured to generate a first header compression table for compressing a header portion of a message to be communicated based on a first communication connection established with another communication apparatus a transmission unit configured to transmit to the other communication apparatus based on the first communication connection established with the other communication apparatus the message whose header portion has been compressed based on the first header compression table generated by the generation unit a determination unit configured to determine whether the first header compression table is used as a second header compression table for compressing a header portion of a message to be communicated based on a second communication connection which is different from the first communication connection and has been established with the other communication apparatus and a compression unit configured to compress the header portion of the message to be communicated based on the second communication connection using the first header compression table corresponding to the first communication connection as the second header compression table corresponding to the second communication connection in accordance with determination by the determination unit.

Further features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings .

Embodiments of the present invention will be described below with reference to the accompanying drawings. Note that the following embodiments are not intended to limit the claims of the present invention and that not all the combinations of features described in the embodiments are necessarily essential to the solution of the present invention.

A first communication apparatus is a communication apparatus serving as a client according to the present invention and has a wireless LAN Local Area Network communication function complying with IEEE802.11. Examples of the first communication apparatus are a digital camera digital video camera mobile phone smartphone personal computer PC notebook PC server and tablet. Note that an example of using the wireless LAN communication function will be described in this embodiment. The present invention however is not limited to this and other wireless communication functions such as Bluetooth ZigBee and RFID Radio Frequency Identifier may be used. Also a wired LAN communication function such as Ethernet or a combination of a wireless LAN communication function and wired LAN communication function may be used.

A second communication apparatus is a communication apparatus serving as a server according to the present invention and performs direct wireless LAN connection to the first communication apparatus . Note that in this embodiment an example of performing direct wireless LAN connection between the first communication apparatus and the second communication apparatus will be described. The present invention however is not limited to this and the first communication apparatus and the second communication apparatus may be connected through a wireless access point. The first communication apparatus and the second communication apparatus perform HTTP communication complying with the HTTP 2 standard.

The components of a communication apparatus according to this embodiment will be described in detail. is a block diagram showing the hardware arrangement of the first communication apparatus according to this embodiment. Note that the second communication apparatus also has the same arrangement as that of the first communication apparatus and only the first communication apparatus will be explained. The first communication apparatus includes a CPU Central Processing Unit a ROM Read Only Memory a RAM Random Access Memory and an auxiliary storage device . The first communication apparatus also includes a display unit an operation unit a communication unit and an antenna . The CPU controls the overall first communication apparatus . The ROM stores programs and parameters which need not be changed. The RAM temporarily stores programs and data supplied from the auxiliary storage device or the like. The auxiliary storage device stores data such as an image content and video content. The display unit displays a GUI Graphical User Interface to be used by the user to operate the first communication apparatus . The operation unit serves as an input interface used by the user to operate the first communication apparatus . The communication unit controls the antenna and performs wireless LAN communication with a wireless access point or the second communication apparatus .

A controller controls all the function modules of the first communication apparatus . A wireless LAN communication controller controls the communication unit to perform communication control of a wireless LAN communication method with the wireless access point not shown or the second communication apparatus . The display controller controls the display unit to perform display control of the GUI in the first communication apparatus . An operation controller controls the operation unit to perform operation input control from the user to the first communication apparatus . A storage controller controls the RAM or auxiliary storage device to store or delete processing data or data such as an image content or video content.

A TCP IP communication controller performs communication control of the TCP IP Transmission Control Protocol Internet Protocol method with the second communication apparatus using the wireless LAN communication controller . Note that an example of using TCP IP communication will be explained in this embodiment. The present invention however is not limited to this and UDP User Datagram Protocol may be used.

An HTTP communication controller performs communication control of the HTTP 2 method with the second communication apparatus using the TCP IP communication controller . Furthermore the HTTP communication controller performs communication control of the HTTPS HTTP Security method using TLS Transport Layer Security with the second communication apparatus .

A discovery controller performs discovery control of a communication apparatus on the wireless LAN using the TCP IP communication controller or HTTP communication controller . More specifically the discovery controller has a function of discovering the second communication apparatus on the wireless LAN. The discovery controller also has a function of notifying the second communication apparatus on the wireless LAN that the first communication apparatus has joined or left. In this embodiment the discovery controller uses the SSDP Simple Service Discovery Protocol method used in the UPnP Universal Plug and Play standard. Note that the discovery controller may use another discovery method instead of SSDP. Examples of the other discovery method are mDNS multicast Domain Name Service Bonjour and SDP Service Discovery Protocol .

By using the HTTP communication controller an authentication controller controls authentication processing of the user or the first communication apparatus with the second communication apparatus . In this embodiment the authentication controller uses the HTTP authentication Basic authentication Digest authentication method. Note that the authentication controller may use other authentication methods such as OAuth 2.0 OpenID OpenID Connect and SAML Security Assertion Markup Language .

By using the HTTP communication controller a service controller controls provision of a service to the second communication apparatus or the use of a service provided by the second communication apparatus . In this embodiment the service controller uses each of DLNA Digital Living Network Alliance UPnP and a Web service method. Note that the present invention is not limited to them and the service controller may use other service control methods. For example the service controller may use SOAP Simple Object Access Protocol REST Representational State Transfer AtomPub Atom Publishing Protocol and the like.

A module of determining the presence absence of a communication relationship with the second communication apparatus will be described. By using one or more of a communication state determination unit communication history determination unit and communication method determination unit all of which will be described later a communication relationship determination unit determines the presence absence of a communication relationship as the status of a connection to the second communication apparatus through the network.

The communication state determination unit determines the presence absence of a communication relationship with the second communication apparatus based on the communication state with the second communication apparatus . This determination processing is performed based on the following communication state.

The wireless LAN communication controller is used to determine the presence absence of a communication relationship based on a wireless LAN communication state with the second communication apparatus . For example the determination processing is performed based on the start end of wireless LAN connection completion of authentication at the time of wireless LAN communication detection non detection of a beacon a wireless LAN connection mode infrastructure more or ad hoc mode and the like. Alternatively the determination processing may be performed based on the start end of Wi Fi Direct connection a wireless LAN communication error and the like.

The TCP IP communication controller is used to determine the presence absence of a communication relationship based on a TCP IP communication state with the second communication apparatus . For example the determination processing is performed based on TCP connection disconnection an error occurrence state a delay state a packet retransmission state a data transfer amount a sequence control state line quality a TCP IP communication error and the like.

The HTTP communication controller is used to determine the presence absence of a communication relationship based on an HTTP communication state with the second communication apparatus . For example the determination processing is performed based on the start HEADERS PRIORITY frame end GOAWAY frame of HTTP communication a simultaneous HTTP communication count multi session count an HTTP communication error and the like.

The discovery controller is used to determine the presence absence of a communication relationship based on a discovery state with the second communication apparatus on the wireless LAN. For example the determination processing is performed based on the joining leaving operation of the first communication apparatus with respect to the wireless LAN the discovery joining leaving operation of the second communication apparatus on the wireless LAN and the like.

The authentication controller is used to determine the presence absence of a communication relationship based on an authentication state with the second communication apparatus . For example the determination processing is performed based on the start end of authentication login logout of the user an authenticated unauthenticated state a permitted unpermitted state whether the valid period of authentication expires or not validation invalidation of an access token whether the valid period of an access token expires or not and the like.

The service controller is used to determine the presence absence of a communication relationship based on the service provision use state with the second communication apparatus . For example the determination processing is performed based on the start end of provision of a service the start end of the use of a service and the like.

The communication state determination unit may determine the presence absence of a communication relationship based on a combination of the plurality of communication states described above.

The communication history determination unit determines the presence absence of a communication relationship with the second communication apparatus based on a communication history with the second communication apparatus . This determination processing is performed based on the following communication history.

First the wireless LAN communication controller is used to determine the presence absence of a communication relationship based on a wireless LAN communication history with the second communication apparatus . For example the determination processing is performed based on the presence absence of wireless LAN connection disconnection to from the second communication apparatus so far a connection mode infrastructure mode ad hoc mode Wi Fi Direct or a persistent temporary group of Wi Fi Direct and the like.

The TCP IP communication controller is used to determine the presence absence of a communication relationship based on a TCP IP communication history with the second communication apparatus . For example the determination processing is performed based on the domain name host name IP address and port number of the second communication apparatus the presence absence of TCP IP connection disconnection to from the second communication apparatus so far and the like.

The HTTP communication controller is used to determine the presence absence of a communication relationship based on an HTTP communication history with the second communication apparatus . For example the determination processing is performed based on the URI of the second communication apparatus contents of a transmitted HTTP request contents of a received HTTP response an HTTP communication session ID an HTTP stream ID a cookie and the like.

The discovery controller is used to determine the presence absence of a communication relationship based on a discovery history with the second communication apparatus on the wireless LAN. For example the determination processing is performed based on the presence absence count and date time of the joining leaving operation of the first communication apparatus with respect to the wireless LAN the presence absence count and date time of the discovery joining leaving operation of the second communication apparatus on the wireless LAN and the like.

The authentication controller is used to determine the presence absence of a communication relationship based on an authentication history with the second communication apparatus . For example the determination processing is performed based on the presence absence count and date time of an authentication login logout operation authentication information such as an ID and password a permission count and the like. Alternatively the determination processing may be performed based on the ID authority range count valid period of an issued access token an invalidated access token and the like.

The service controller is used to determine the presence absence of a communication relationship based on a service provision use history with the second communication apparatus . For example the type contents of a service provided used the presence absence of provision use of a service and the like are determined.

Furthermore the presence absence of communication connection disconnection to from the second communication apparatus so far a communication count a communication date time communication success failure an error type and the like are determined regardless of the communication type.

The communication history determination unit may determine the presence absence of a communication relationship based on a combination of the plurality of communication histories described above.

The communication method determination unit determines the presence absence of the communication relationship with the second communication apparatus based on a communication method with the second communication apparatus . This determination processing is performed based on the following communication method.

First the wireless LAN communication controller is used to determine the presence absence of a communication relationship based on a wireless LAN communication method with the second communication apparatus . For example the determination processing is performed based on the presence absence of wireless direct communication with the second communication apparatus the presence absence of WPS Wi Fi Protected Setup communication and the like. Alternatively the determination processing may be performed based on the presence absence of Wi Fi Direct communication the presence absence of Wi Fi Direct Service communication the presence absence of Wi Fi Miracast communication and the like.

The TCP IP communication controller is used to determine the presence absence of a communication relationship based on a TCP IP communication method with the second communication apparatus . For example the determination processing is performed based on the presence absence of VPN Virtual Private Network communication the presence absence of IPsec Security Architecture for Internet Protocol communication and the like.

The HTTP communication controller is used to determine the presence absence of a communication relationship based on an HTTP communication method with the second communication apparatus . For example the determination processing is performed based on the presence absence of HTTPS TLS communication the presence absence of PROXY communication and the like.

The discovery controller is used to determine the presence absence of a communication relationship based on a discovery method with the second communication apparatus on the wireless LAN. For example the determination processing is performed based on the presence absence of SSDP the presence absence of mDNS the presence absence of Bonjour the presence absence of SDP and the like.

The authentication controller is used to determine the presence absence of a communication relationship based on an authentication method with the second communication apparatus . For example the determination processing is performed based on the presence absence of HTTP authentication Basic authentication and Digest authentication the presence absence of OAuth 2.0 the presence absence of OpenID the presence absence of OpenID Connect the presence absence of SAML and the like.

The service controller is used to determine the presence absence of a communication relationship based on a service provision use method with the second communication apparatus . For example the determination processing is performed based on the presence absence of DLNA the presence absence of UPnP the presence absence of SOAP the presence absence of REST the presence absence of AtomPub and the like.

The communication history determination unit may determine the presence absence of a communication relationship based on a combination of the plurality of communication methods described above.

A module for HTTP header compression will be described. An HTTP header compression unit performs HTTP header compression processing by the HTTP 2 method based on an HTTP header table selected by an HTTP header table selection unit to be described later . In the first communication apparatus serving as a client the HTTP header compression unit compresses an HTTP header serving as the message header of an HTTP request message generated by the HTTP communication controller . Similarly the HTTP header compression unit of the first communication apparatus decompresses the compressed HTTP header of an HTTP response message received by the HTTP communication controller from the second communication apparatus . On the other hand in the second communication apparatus serving as a server the HTTP header compression unit compresses the HTTP header of the HTTP response message generated by the HTTP communication controller . Similarly the HTTP header compression unit of the second communication apparatus decompresses the HTTP header of the HTTP request message received by the HTTP communication controller from the first communication apparatus .

An HTTP header table generation unit creates an initial HTTP header table defined by the HTTP 2 method. A practical example of the initial HTTP header table according to this embodiment will be described later with reference to .

An HTTP header table update unit updates an HTTP header table request header table based on the HTTP request header transmitted and compressed by the HTTP communication controller and HTTP header compression unit . Similarly the HTTP header table update unit updates an HTTP header table response header table based on the HTTP response header received and decompressed by the HTTP communication controller and HTTP header compression unit .

An HTTP header table storage unit stores an HTTP header table using the storage controller . In this embodiment the HTTP header table storage unit stores an HTTP header table generated by the HTTP header table generation unit and used for HTTP communication with the second communication apparatus and an HTTP header table received by an HTTP header table reception unit . Note that the HTTP header table selection unit can also hold for example a header table associated with communication with another communication apparatus different from the second communication apparatus .

An HTTP header table deletion unit deletes an HTTP header table using the storage controller . In this embodiment the HTTP header table deletion unit deletes an HTTP header table used for HTTP communication with the second communication apparatus or an HTTP header table stored in the HTTP header table storage unit .

By using the communication relationship determination unit the HTTP header table selection unit selects an HTTP header table to be used by the HTTP header compression unit . For example if the presence of a communication relationship with the second communication apparatus is determined the HTTP header table selection unit selects an HTTP header table corresponding to the communication relationship with the second communication apparatus . On the other hand if the absence of the communication relationship is determined the HTTP header table selection unit selects the initial HTTP header table generated by the HTTP header table generation unit . Note that the HTTP header table selection unit selects an HTTP header table from the HTTP header table storage unit .

As described above the HTTP header compression unit can perform HTTP header compression processing by the HTTP 2 method using the HTTP header table selected by the HTTP header table selection unit . That is based on the first header compression table corresponding to the first communication connection the HTTP header compression unit can compress the header portion of a message to be communicated based on the first communication connection. Furthermore based on the second header compression table corresponding to the second communication connection the HTTP header compression unit can compress the header portion of a message to be communicated based on the second communication connection. The HTTP header compression unit can also use the first header compression table corresponding to the first communication connection as the second header compression table corresponding to the second communication connection in accordance with the selection result of the HTTP header table selection unit .

By using the HTTP communication controller an HTTP header table confirmation unit confirms whether the second communication apparatus holds the same HTTP header table as that held by the first communication apparatus . This confirmation processing is determined based on whether CRC Cyclic Redundancy Check data calculated based on data of the HTTP header tables coincide with each other. Note that an HTTP header table confirmation method is not limited to this. The HTTP header table reception unit may be used to receive the data of the HTTP header table from the second communication apparatus and it may be determined whether the data is the same. Note that any methods may be used as long as it is possible to determine whether the second communication apparatus holds the same HTTP header table and a unique HTTP header table management unit to be described later may be used to perform the determination processing.

An HTTP header table transmission unit transmits the HTTP header table to the second communication apparatus using the TCP IP communication controller or HTTP communication controller . The HTTP header table reception unit receives the HTTP header table from the second communication apparatus using the TCP IP communication controller or HTTP communication controller .

By using the storage controller the unique HTTP header table management unit manages a unique HTTP header table corresponding to a communication method supported by the first communication apparatus . The unique HTTP header table is an HTTP header table optimized for a predetermined communication method. A predetermined HTTP header name to be used by the predetermined communication method and an HTTP header value are preset in the HTTP header table. Note that the unique HTTP header table management unit may manage a plurality of unique HTTP header tables corresponding to a plurality of communication methods supported by the first communication apparatus .

Note that this embodiment has exemplified a case in which the HTTP header table is formed from the HTTP request header table and HTTP response header table . However it is possible to collectively manage these tables as one table.

A communication sequence between the first communication apparatus and the second communication apparatus according to this embodiment will be described in detail below.

In step M the first communication apparatus performs wireless LAN communication connection to the second communication apparatus . The detailed sequence of this communication connection processing will be described later with reference to .

In step M the first communication apparatus selects an HTTP header table to be used with the second communication apparatus . The detailed sequence of this table selection processing will be described later with reference to . In step M the first communication apparatus determines the presence of a communication relationship with the second communication apparatus . Since however HTTP communication with the second communication apparatus has not been performed yet an HTTP header table is newly created.

In step M the first communication apparatus performs HTTP communication with the second communication apparatus using the HTTP header table selected in step M. That is in step M the first communication apparatus performs HTTP communication based on an established communication connection to the second communication apparatus . The detailed sequence of this HTTP communication processing will be described later with reference to . In step M a series of processes that is HTTP communication connection processing HTTP request transmission response reception processing and HTTP communication disconnection processing are performed.

In response to the HTTP communication disconnection processing in step M the first communication apparatus determines whether to delete the HTTP header table used with the second communication apparatus . In other words when the first communication apparatus disconnects the communication connection established to the second communication apparatus it determines whether to reuse the HTTP header table used in the communication connection. The detailed sequence of the table deletion processing will be described later with reference to . In step M the first communication apparatus determines the presence of the communication relationship with the second communication apparatus and stores the HTTP header table used with the second communication apparatus . Furthermore the second communication apparatus also determines the presence of the communication relationship with the first communication apparatus and stores the HTTP header table used with the first communication apparatus .

In step M the first communication apparatus selects an HTTP header table to be used with the second communication apparatus . The detailed sequence of this table selection processing will be described later with reference to . Since the first communication apparatus determines the presence of the communication relationship with the second communication apparatus in step M and the HTTP header table used with the second communication apparatus in step M exists the first communication apparatus selects this HTTP header table. That is the first communication apparatus can use for communication in the second communication connection established between the first communication apparatus and the second communication apparatus the first HTTP header table used in the first communication connection established to the second communication apparatus . Note that the first and second communication connections are different communication connections. The communication connection according to this embodiment indicates a connection in the transport layer.

In step M the first communication apparatus performs HTTP communication with the second communication apparatus using the HTTP header table selected in step M. shows the detailed sequence of this HTTP communication processing similarly to step M.

In response to the HTTP communication disconnection processing in step M the first communication apparatus determines in step M to delete the HTTP header table used with the second communication apparatus . shows the sequence of this table deletion processing similarly to step M. In step M the first communication apparatus determines the presence of the communication relationship with the second communication apparatus and stores the HTTP header table used with the second communication apparatus . The second communication apparatus also determines the presence of the communication relationship with the first communication apparatus and stores the HTTP header table used with the first communication apparatus .

In step M the first communication apparatus performs wireless LAN communication disconnection from the second communication apparatus . The detailed sequence of this communication disconnection processing will be described later with reference to .

In response to the wireless LAN communication disconnection processing in step M the first communication apparatus determines in step M to delete the HTTP header table used with the second communication apparatus . shows the sequence of this table deletion processing similarly to step M. In step M the first communication apparatus determines the absence of the communication relationship with the second communication apparatus and deletes the HTTP header table used with the second communication apparatus . The second communication apparatus also determines the absence of the communication relationship with the first communication apparatus and deletes the HTTP header table used with the first communication apparatus .

In step M the first communication apparatus performs HTTP communication connection to the second communication apparatus . The detailed sequence of this communication connection processing will be described later with reference to .

In step M the first communication apparatus transmits an HTTP request to the second communication apparatus and receives an HTTP response from the second communication apparatus . The detailed sequence of the HTTP request response will be described later with reference to .

In step M the first communication apparatus performs HTTP communication disconnection from the second communication apparatus . The detailed sequence of this communication disconnection processing will be described alter with reference to .

First in step M M to M the first communication apparatus performs TCP communication connection to the second communication apparatus . More specifically in step M the first communication apparatus transmits a TCP connection request SYN frame to the second communication apparatus . In step M the second communication apparatus transmits a TCP connection request response SYN ACK frame to the first communication apparatus . In step M the first communication apparatus transmits a response ACK frame to the second communication apparatus .

In step M M to M the first communication apparatus performs TLS communication connection to the second communication apparatus . More specifically in step M the first communication apparatus transmits a list of usable encryption compression algorithms to the second communication apparatus Client Hello . In step M the second communication apparatus transmits a determined encryption compression algorithm to the first communication apparatus Server Hello . In step M the second communication apparatus transmits a route certificate and server certificate to the first communication apparatus Server Certificate . In step M the second communication apparatus transmits server key information to the first communication apparatus Server Key Exchange .

In step M the second communication apparatus transmits completion of the series of processes to the first communication apparatus Server Hello Done . In step M the first communication apparatus transmits key information premaster secret to the second communication apparatus Client Key Exchange . In step M the first communication apparatus transmits completion of preparation of the encryption algorithm to the second communication apparatus Change Cipher Spec . In step M the first communication apparatus transmits completion of key exchange and authentication processing to the second communication apparatus Finished . In step M the second communication apparatus transmits completion of preparation of the encryption algorithm to the first communication apparatus Change Cipher Spec . In step M the second communication apparatus transmits the success of key exchange and authentication processing to the first communication apparatus Finished .

In step M the first communication apparatus creates an HTTP request to be transmitted to the second communication apparatus . At this time the first communication apparatus compresses an HTTP request header using an HTTP request header table. Of the HTTP request header a portion which is described in the HTTP request header table is compressed but a new portion which is not described in the table is added to the header without compression.

In step M the first communication apparatus updates the HTTP request header table based on the HTTP request header created in step M. That is when creating the HTTP request header in step M if there is a new portion which cannot be compressed the corresponding portion is added to the HTTP request header table.

In step M M to M the first communication apparatus transmits the HTTP request complying with the HTTP 2 method to the second communication apparatus . More specifically in step M the first communication apparatus transmits a HEADERS PRIORITY frame indicating an HTTP request line and HTTP request header to the second communication apparatus . In steps M and M the first communication apparatus transmits DATA frames indicating an HTTP request body to the second communication apparatus . At this time the first communication apparatus assigns a FINAL flag to the last DATA frame M in this example .

If there is no HTTP header table for the first communication apparatus in step M M the second communication apparatus newly creates an HTTP header table in step M.

In step M based on the HTTP request header of the HTTP request received from the first communication apparatus the second communication apparatus updates the HTTP request header table if there is a new portion.

In step M the second communication apparatus creates an HTTP response to be transmitted to the first communication apparatus . At this time the second communication apparatus compresses an HTTP response header using the HTTP response header table. In step M the second communication apparatus updates the HTTP response header table based on the HTTP response header created in step M. As for the HTTP response header as well a new portion is not compressed and the HTTP response header table is updated in accordance with the uncompressed contents similarly to the HTTP request header described in steps M and M.

In step M M to M the second communication apparatus transmits the HTTP response complying with the HTTP 2 method to the first communication apparatus . More specifically in step M the second communication apparatus transmits a HEADERS frame indicating an HTTP status line and HTTP response header to the first communication apparatus . In steps M and M the second communication apparatus transmits DATA frames indicating an HTTP response body to the first communication apparatus . Note that a FINAL flag is assigned to the last DATA frame M in this example .

In step M based on the HTTP response header of the HTTP response received from the second communication apparatus the first communication apparatus updates the HTTP response header table if there is a new portion.

In step M the first communication apparatus transmits a GOAWAY frame complying with HTTP 2 to the second communication apparatus . In step M M to M the first communication apparatus performs TCP communication disconnection from the second communication apparatus . More specifically in step M the first communication apparatus transmits a TCP disconnection request FIN frame to the second communication apparatus . In step M the second communication apparatus transmits a TCP disconnection request response FIN ACK frame to the first communication apparatus . In step M the first communication apparatus transmits a response ACK frame to the second communication apparatus .

In step M the first communication apparatus detects a wireless LAN communication connection instruction from the user. The wireless LAN communication connection instruction from the user is issued upon for example pressing of a WPS push button. The present invention is not limited to this and another wireless LAN communication connection instruction such as a Wi Fi Direct connection instruction may be issued.

In step M the second communication apparatus detects a wireless LAN communication connection instruction from the user for the first communication apparatus . This detection method is the same as that in step M.

In step M the first communication apparatus discovers wireless LAN communication of the second communication apparatus . In step M the first communication apparatus exchanges wireless parameters with the second communication apparatus . In step M the first communication apparatus establishes a wireless LAN communication connection to the second communication apparatus .

In step M the first communication apparatus detects a wireless LAN communication disconnection instruction from the user. In step M the first communication apparatus transmits a wireless LAN communication disconnection request to the second communication apparatus . In step M the second communication apparatus transmits a wireless LAN communication disconnection response to the first communication apparatus .

First in step M the first communication apparatus determines a communication relationship with the second communication apparatus .

If it is determined in step M that a communication relationship with the second communication apparatus is present and an HTTP header table for the second communication apparatus exists the processing in step M M and M is performed. That is in step M the first communication apparatus selects an HTTP header table corresponding to the communication relationship with the second communication apparatus . In step M the first communication apparatus performs confirmation and notification of the selected HTTP header table with the second communication apparatus . Details of this HTTP header table confirmation notification processing will be described later with reference to .

If it is determined in step M that there is no communication relationship between the first communication apparatus and the second communication apparatus or there is no HTTP header table for the second communication apparatus an initial table is created in step M M . That is in step M the first communication apparatus newly creates an initial HTTP header table defined by the HTTP 2 method.

In step M the first communication apparatus transmits an HTTP header table information acquisition request to the second communication apparatus . In step M the second communication apparatus transmits HTTP header table information to the first communication apparatus . In step M based on the HTTP header table information acquired in step M the first communication apparatus confirms whether the selected HTTP header table coincides with an HTTP header table based on the acquired information. That is it is confirmed whether the second communication apparatus holds the same HTTP header table as that selected by the first communication apparatus .

In step M the first communication apparatus notifies the second communication apparatus of the selected HTTP header table. Then in step M the second communication apparatus selects the HTTP header table notified from the first communication apparatus . In step M the second communication apparatus transmits the notification response of the selected HTTP header table to the first communication apparatus .

First in step M the first communication apparatus detects a communication event with the second communication apparatus . The communication event is for example an HTTP communication disconnection event a wireless LAN communication disconnection event or the like.

In step M the first communication apparatus determines the communication relationship with the second communication apparatus . If the presence of the communication relationship with the second communication apparatus is determined in step M processing in step M M is performed. That is in step M the first communication apparatus stores the HTTP header table used for HTTP communication with the second communication apparatus . On the other hand if the absence of the communication relationship with the second communication apparatus is determined in step M processing in step M M is performed. That is in step M the first communication apparatus deletes the HTTP header table used for HTTP communication with the second communication apparatus .

In step M the second communication apparatus detects a communication event with the first communication apparatus . The communication event is also for example an HTTP communication disconnection event a wireless LAN communication disconnection event or the like.

In step M the second communication apparatus determines the communication relationship with the first communication apparatus . If the presence of the communication relationship with the first communication apparatus is determined in step M processing in step M M is performed. That is in step M the second communication apparatus stores the HTTP header table used for HTTP communication with the first communication apparatus . On the other hand if the absence of the communication relationship with the first communication apparatus is determined in step M processing in step M M is performed. That is in step M the second communication apparatus deletes the HTTP header table used for HTTP communication with the first communication apparatus .

Communication processing between the first communication apparatus and the second communication apparatus according to this embodiment will be described in detail below with reference to the function module arrangement shown in .

In step S the HTTP header table selection unit specifies an apparatus to be referred to as a target apparatus hereinafter as a communication target by using the HTTP communication controller . In this example the target apparatus is the second communication apparatus . In step S the communication relationship determination unit determines the presence absence of a communication relationship as a connection status with the target apparatus. Details of this determination processing will be described later with reference to .

If the presence of the communication relationship with the target apparatus is determined S YES the process advances to step S otherwise S NO the process advances to step S. The absence of the communication relationship indicates that HTTP communication connection to the target apparatus has not been performed yet.

In step S the HTTP header table selection unit determines whether there is an HTTP header table for the communication relationship with the target apparatus in the HTTP header table storage unit . If there exists the HTTP header table S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the HTTP header table selection unit acquires the HTTP header table for the communication relationship with the target apparatus from the HTTP header table storage unit . In step S the HTTP header table confirmation unit performs with the target apparatus confirmation and notification of the HTTP header table acquired in step S. Details of the HTTP header table confirmation notification processing will be described later with reference to . If the confirmation and notification processing in step S has succeeded S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the HTTP header table selection unit selects the HTTP header table acquired in step S to be used by the HTTP header compression unit for HTTP header compression with the target apparatus thereby terminating the process.

In step S the HTTP header table generation unit newly generates an initial HTTP header table defined by the HTTP 2 method. Then the HTTP header table selection unit selects the newly generated HTTP header table to be used by the HTTP header compression unit for HTTP header compression with the target apparatus thereby terminating the process.

In step S the communication state determination unit determines whether the apparatus is in wireless LAN communication connection to the target apparatus. If the apparatus is in wireless LAN communication connection to the target apparatus S YES the process advances to step S otherwise S NO the process advances to step S.

In step S based on the determination result of the communication state determination unit the communication relationship determination unit determines the presence of the communication relationship with the target apparatus thereby terminating the process. On the other hand in step S based on the determination result of the communication state determination unit the communication relationship determination unit determines the absence of the communication relationship with the target apparatus thereby terminating the process.

In step S the HTTP header table confirmation unit transmits an HTTP header table information acquisition request to the target apparatus. The HTTP header table information is information by which it is possible to determine whether HTTP header tables coincide with each other such as a CRC calculated based on data of the HTTP header table.

If the HTTP header table confirmation unit receives the HTTP header table information from the target apparatus in step S S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the HTTP header table confirmation unit determines whether the HTTP header table acquired in step S coincides with the HTTP header table based on the HTTP header table information of the target apparatus received in step S. If it is determined that the tables coincide with each other S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the HTTP header table confirmation unit notifies the target apparatus of HTTP header table selection acquired in step S. The information transmitted in this notification processing may be any information by which it is possible to identify the HTTP header table.

In step S the HTTP header table confirmation unit determines whether an HTTP header table selection notification response has been received from the target apparatus. If the response has been received S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the HTTP header table confirmation unit determines whether the HTTP header selection notification response received from the target apparatus has succeeded. If the response has succeeded S YES the process ends otherwise S NO the process advances to step S.

In step S the HTTP header table confirmation unit determines that confirmation of the HTTP header table has failed thereby terminating the process.

In step S the HTTP header table confirmation unit receives the HTTP header table selection notification from the first communication apparatus .

In step S the HTTP header table confirmation unit determines whether the HTTP header table designated by the notification in step S exists in the HTTP header table storage unit . If the HTTP header table exists S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the HTTP header table selection unit selects the HTTP header table designated by the notification in step S to be used for HTTP header compression with the first communication apparatus . In step S the HTTP header table confirmation unit transmits success as an HTTP header table selection notification response thereby terminating the process. On the other hand in step S the HTTP header table confirmation unit transmits failure as an HTTP header table selection notification response thereby terminating the process.

In step S the HTTP header compression unit compresses an HTTP request header using the HTTP header table with the target apparatus acquired in step S. In step S the HTTP communication controller creates an HTTP request to include the compressed HTTP request header. In step S the HTTP communication controller transmits a HEADERS PRIORITY frame to the target apparatus. This frame contains information of the HTTP request header compressed in step S.

In step S the HTTP communication controller determines whether an HTTP request body exists in the HTTP request created in step S. If the HTTP request body exists S YES the process advances to step S otherwise S NO the process advances to step S. In step S the HTTP communication controller transmits a DATA frame to the target apparatus. This frame contains information of the HTTP request body created in step S. The HTTP communication controller repeatedly transmits a DATA frame by the size of the HTTP request body data and sets a FINAL flag in the last DATA frame.

In step S the HTTP communication controller determines whether transmission of the HTTP request to the target apparatus has succeeded. If transmission has succeeded S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the HTTP communication controller determines whether a HEADERS frame of an HTTP response has been received from the target apparatus. If the HEADERS frame has been received S YES the process advances to step S otherwise S NO the process advances to step S. In step S the HTTP header compression unit decompresses a compressed HTTP response header contained in the received HEADERS frame using the HTTP header table with the target apparatus.

In step S the HTTP communication controller determines whether an HTTP response body exists in the HTTP response received from the target apparatus. If the HTTP response body exists S YES the process advances to step S otherwise S NO the process advances to step S. In step S the HTTP communication controller receives a DATA frame from the target apparatus. This frame contains information of the HTTP response body. The HTTP communication controller repeatedly receives a DATA frame by the size of the HTTP response body data.

In step S the HTTP communication controller determines whether reception of the HTTP response from the target apparatus has succeeded. If reception has succeeded S YES the process advances to step S otherwise S NO the process advances to step S. In step S the HTTP header table update unit updates the HTTP request header table with the target apparatus based on the HTTP request header created in steps S and S. In step S the HTTP header table update unit updates the HTTP response header table with the target apparatus based on the HTTP response header received in step S thereby terminating the process.

In step S the HTTP communication controller determines that HTTP communication with the target apparatus has failed thereby terminating the process.

In step S the HTTP communication controller determines whether the HEADERS PRIORITY frame of the HTTP request has been received from the target apparatus. If the HEADERS PRIORITY frame has been received S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the HTTP header table selection unit determines whether an HTTP header table with the target apparatus has been selected. If an HTTP header table has been selected S YES the process advances to step S otherwise S NO the process advances to step S. In step S the HTTP header table generation unit newly generates an initial HTTP header table defined by the HTTP 2 method. At this time the HTTP header table selection unit selects the newly generated HTTP header table to be used by the HTTP header compression unit for HTTP header compression with the target apparatus.

In step S the HTTP header compression unit decompresses a compressed HTTP request header included in the received HEADERS PRIORITY frame by using the HTTP header table with the target apparatus.

In step S the HTTP communication controller determines whether an HTTP request body exists in the HTTP request received from the target apparatus. If the HTTP request body exists S YES the process advances to step S otherwise S NO the process advances to step S. In step S the HTTP communication controller receives the DATA frame from the target apparatus. This frame contains information of the HTTP request body. The HTTP communication controller repeatedly receives the DATA frame by the size of the HTTP request body data.

In step S the HTTP communication controller determines whether reception of the HTTP request from the target apparatus has succeeded. If reception has succeeded S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the HTTP header compression unit compresses an HTTP response header using the HTTP header table with the target apparatus selected in step S or S. In step S the HTTP communication controller creates an HTTP response to include the HTTP response header compressed in step S. In step S the HTTP communication controller transmits a HEADERS frame to the target apparatus. This frame contains information of the HTTP response header compressed in step S.

In step S the HTTP communication controller determines whether an HTTP response body exists in the HTTP response created in step S. If the HTTP response body exists S YES the process advances to step S otherwise S NO the process advances to step S. In step S the HTTP communication controller transmits a DATA frame to the target apparatus. This frame includes information of the HTTP response body created in step S. The HTTP communication controller repeatedly transmits a DATA frame by the size of the HTTP response body data and sets a FINAL flag in the last DATA frame.

In step S the HTTP communication controller determines whether transmission of the HTTP response to the target apparatus has succeeded. If transmission has succeeded S YES the process advances to step S otherwise S NO the process advances to step S. In step S the HTTP header table update unit updates the HTTP request header table with the target apparatus based on the HTTP request header received in step S. In step S the HTTP header table update unit updates the HTTP response header table with the target apparatus based on the HTTP response header created in steps S and S thereby terminating the process.

In step S the HTTP communication controller determines that HTTP communication with the target apparatus has failed thereby terminating the process.

In step S by using the communication relationship determination unit the HTTP header table selection unit detects a communication event for determining to store or delete the HTTP header table. Details of this detection processing will be described later with reference to .

In step S the HTTP header table selection unit determines whether the communication event detected in step S is a storage deletion determination target event. If the communication event is a target event S YES the process advances to step S otherwise S NO the process ends. In step S the HTTP header table selection unit specifies a target apparatus as an HTTP header table storage or deletion target. Note that the target apparatus is the second communication apparatus in this example. In step S the communication relationship determination unit determines the presence absence of the communication relationship with the target apparatus. Details of this determination processing are as described above with reference to similarly to step S.

In step S the HTTP header table selection unit determines whether the HTTP header table for the communication relationship with the target apparatus exists in the HTTP header table storage unit . If the HTTP header table exists S YES the process advances to step S otherwise S NO the process ends.

In step S the communication relationship determination unit determines the presence absence of the communication relationship with the target apparatus. If the presence of the communication relationship is determined S YES the process advances to step S otherwise S NO the process advances to step S. In step S the HTTP header table storage unit keeps in itself the HTTP header table for the communication relationship with the target apparatus thereby terminating the process. On the other hand in step S the HTTP header table deletion unit deletes the HTTP header table for the communication relationship with the target apparatus thereby terminating the process.

In step S the communication relationship determination unit detects a communication event. At this time the communication relationship determination unit uses one of the wireless LAN communication controller TCP IP communication controller HTTP communication controller discovery controller authentication controller and service controller .

In step S the communication relationship determination unit determines whether the detected communication event is an event of HTTP communication disconnection from the target apparatus. If the detected communication event is an HTTP communication disconnection event S YES the process advances to step S otherwise S NO the process advances to step S. In step S the HTTP header table selection unit sets the detected communication event as a storage deletion determination target communication event thereby terminating the process.

In step S the communication relationship determination unit determines whether the detected communication event is an event of wireless LAN communication disconnection from the target apparatus. If the detected communication event is a wireless LAN communication disconnection event S YES the process advances to step S otherwise S NO the process advances to step S. In step S the HTTP header table selection unit sets the detected communication event as a storage deletion determination non target communication event thereby terminating the process.

HTTP header table update processing according to this embodiment will be described below with reference to a practical example. is a table showing a practical example of the initial HTTP header table according to this embodiment. Referring to in the HTTP request header table the HTTP request header names and HTTP request header values of the indices 0 to 37 are set as initial records. Similarly in the HTTP response header table the HTTP response header names and HTTP response header values of the indices 0 to 34 are set as initial records.

As described above according to this embodiment the first communication apparatus appropriately selects an HTTP header table to be used for HTTP communication with the second communication apparatus in accordance with a communication relationship with the second communication apparatus . Thus the first communication apparatus need not newly create an HTTP header table every time HTTP communication with the second communication apparatus starts thereby reducing the processing load of HTTP header table creation processing and a communication delay caused by the creation time.

As shown in when the first communication apparatus determines the presence of the communication relationship with the second communication apparatus it stores the HTTP header table used with the second communication apparatus . Consequently when communication with the second communication apparatus continues and HTTP communication is performed again at a high probability the first communication apparatus allows reuse of the HTTP header table by storing it. This further reduces the processing load of HTTP header table creation processing and the communication delay caused by the creation time.

On the other hand as shown in when the first communication apparatus determines the absence of the communication relationship with the second communication apparatus it deletes the HTTP header table used with the second communication apparatus . Consequently if communication with the second communication apparatus does not continue and HTTP communication is performed again at a low probability the first communication apparatus can delete the stored HTTP header table. This eliminates the need to unnecessarily store the HTTP header table which is not to be reused thereby reducing the consumption of a memory area. Furthermore it is possible to further reduce the processing load of appropriate HTTP header table selection processing and a communication delay caused by the selection processing in the HTTP header table selection unit .

Also a case in which the communication relationship determination unit detects an HTTP communication disconnection event using the HTTP communication controller in step S of has been exemplified. HTTP communication disconnection detection according to the present invention is not limited to this. For example if power off wireless LAN communication disconnection or the like occurs during HTTP communication in the first communication apparatus and the second communication apparatus it may be impossible to detect a communication event of HTTP communication disconnection. In this case an HTTP header table which should originally be deleted is not deleted to unnecessarily consume the memory area. To cope with this situation the communication relationship determination unit may detect HTTP communication connection using the HTTP communication controller . In this case that is at the start of communication the processing shown in is executed to determine whether to delete the HTTP header table which is not to be reused thereby further reducing the consumption of the memory area. Also it is possible to further reduce the processing load of the HTTP header table selection unit and a communication delay caused by selection processing.

In step S of the HTTP header table selection unit may select one of a plurality of HTTP header tables which are stored in the HTTP header table storage unit and correspond to the target apparatus. In this case in step S of the HTTP header table storage unit stores information of a communication relationship in an HTTP header table use status in association with the HTTP header table used with the target apparatus. The information of the communication relationship need only be information by which it is possible to identify each communication relationship such as a communication history date time IP address packet data communication contents communication state connection relationship and the like . This enables the HTTP header table selection unit to select an optimum one of the HTTP header tables used with the second communication apparatus thereby improving the header compression efficiency.

A case in which the communication state determination unit determines the presence absence of the communication relationship based on HTTP communication and wireless LAN communication states has been exemplified as shown in . The present invention however is not limited to this. The determination processing can be performed as follows.

For example the communication state determination unit may use the TCP IP communication controller to determine the presence absence of the communication relationship based on the TCP IP communication state with the second communication apparatus . At this time the presence of the communication relationship is determined during TCP connection and the absence of the communication relationship is determined during TCP disconnection. As will be described later in the third embodiment the discovery controller may be used to determine the presence absence of the communication relationship based on a discovery state with the second communication apparatus on the wireless LAN.

Also the authentication controller may be used to determine the presence absence of the communication relationship based on the authentication state with the second communication apparatus . For example the presence of the communication relationship is determined in the user login state the authenticated state the permitted state the state in which the authentication valid period has not expired the access token valid state the state in which the access token valid period has not expired or the like. On the other hand the absence of the communication relationship is determined in the user logout state the unauthenticated state the unpermitted state the state in which the authentication valid period has expired the access token invalid state the state in which the access token valid period has expired or the like.

The service controller may be used to determine the presence absence of the communication relationship based on the service provision used state with the second communication apparatus . At this time the presence of the communication relationship is determined at the start of provision or use of a service and the absence of the communication relationship is determined at the end of provision or use of the service.

The communication state determination unit may determine the presence absence of the communication relationship based on a combination of the plurality of communication states.

The second embodiment of the present invention will be described below. According to a feature of the second embodiment a communication relationship is determined based on the communication states of a plurality of HTTP communication operations HTTP multi session communication . A communication system configuration and function module arrangement according to the second embodiment are the same as those in the above described first embodiment and a description thereof will be omitted.

A communication sequence between a first communication apparatus and a second communication apparatus according to the second embodiment will be described in detail below.

In step M the first communication apparatus performs the first HTTP communication connection to the second communication apparatus . The detailed sequence of this communication connection processing is the same as that in steps M and M the first HTTP communication connection and HTTP request transmission response reception of shown in the first embodiment.

In step M the first communication apparatus selects an HTTP header table to be used for the second HTTP communication with the second communication apparatus . The detailed sequence of this table selection processing is the same as that shown in of the first embodiment. However the communication relationship determination processing in step M is performed based on the presence absence of the first HTTP communication connection to the second communication apparatus . In step M the first communication apparatus determines the presence of a communication relationship with the second communication apparatus . Furthermore the HTTP header table used for the first HTTP communication with the second communication apparatus exists in the first communication apparatus .

In step M the first communication apparatus performs the second HTTP communication with the second communication apparatus using the HTTP header table which has been selected in step M and is used for the first HTTP communication. The detailed sequence of the HTTP communication processing is the same as that shown in and a series of processes that is the second HTTP communication connection processing HTTP request transmission response reception processing and second HTTP communication disconnection processing are performed.

In step M in response to the second HTTP communication disconnection processing in step M the first communication apparatus determines whether to delete the HTTP header table used for the second HTTP communication with the second communication apparatus . The detailed sequence of this table deletion processing is the same as that shown in of the first embodiment. In step M it is determined that the first HTTP communication is in progress no HTTP communication disconnection has been performed and the communication relationship with the second communication apparatus is present thereby storing the HTTP header table used with the second communication apparatus . Also the second communication apparatus determines the presence of the communication relationship with the first communication apparatus and stores the HTTP header table used with the first communication apparatus .

In step M the first communication apparatus performs the first HTTP communication disconnection from the second communication apparatus . The detailed sequence of this communication disconnection processing is the same as that in step M first HTTP communication disconnection of .

In step M in response to the first HTTP communication disconnection in step M the first communication apparatus determines to delete the HTTP header table used for the second HTTP communication with the second communication apparatus . The sequence of this table deletion processing is the same as that shown in . In step M the first communication apparatus determines the absence of the communication relationship with the second communication apparatus and deletes the HTTP header table used for the first HTTP communication and second HTTP communication with the second communication apparatus . Also the second communication apparatus determines the absence of the communication relationship with the first communication apparatus and deletes the HTTP header table used for the first HTTP communication and second HTTP communication with the first communication apparatus .

In step S a communication state determination unit determines whether the apparatus is in the first HTTP communication connection to a target apparatus. If the apparatus is in the first HTTP communication connection to the target apparatus S YES the process advances to step S otherwise S NO the process advances to step S.

After that a communication relationship determination unit determines the presence of the communication relationship with the target apparatus in step S and determines the absence of the communication relationship in step S similarly to .

In step S the communication relationship determination unit determines whether the detected communication event is an event of the second HTTP communication disconnection from the target apparatus. If the detected communication event is a second HTTP communication disconnection event S YES the process advances to step S otherwise S NO the process advances to step S. In step S the detected communication event is set as a storage deletion determination target communication event similarly to step S of .

In step S the communication relationship determination unit determines whether the detected communication event is an event of the first HTTP communication disconnection from the target apparatus. If the detected communication event is a first HTTP communication disconnection event S YES the process advances to step S otherwise S NO the process advances to step S. In step S the detected communication event is set as a storage deletion determination non target communication event similarly to step S of .

As described above according to the second embodiment the first communication apparatus selects the HTTP header table used for the first HTTP communication as an HTTP header table to be used for the second HTTP communication with the second communication apparatus . Thus the first communication apparatus need not newly create an HTTP header table every time a plurality of HTTP communication operations with the second communication apparatus start thereby reducing the processing load of HTTP header table creation processing and a communication delay caused by the creation time.

The third embodiment of the present invention will be described below. According to a feature of the third embodiment a communication relationship is determined based on a communication state associated with a network joining leaving operation on a wireless LAN. As for a communication system configuration and function module arrangement according to the third embodiment a description of the same elements as those in the above described first or second embodiment will be omitted.

A wireless access point relays wireless LAN communication between the first communication apparatus and the second communication apparatus . Note that the third embodiment will exemplify a case in which the wireless access point is used by the first communication apparatus and second communication apparatus to perform wireless LAN communication. However a wireless LAN router or the like may be used. If the first communication apparatus and second communication apparatus perform wired LAN communication a wired LAN hub wired LAN switch wired LAN router or the like may be used instead of the wireless access point .

A sequence showing message examples when the first communication apparatus according to the third embodiment performs processing from communication connection to the second communication apparatus to communication disconnection is the same as that shown in . In the third embodiment the first communication apparatus determines a communication relationship based on a communication state associated with a network joining leaving operation on the wireless LAN.

In step M the second communication apparatus performs wireless LAN communication connection to the wireless access point . In step M the second communication apparatus notifies the wireless LAN that it joins a network. In the third embodiment an SSDP alive message is transmitted as a network joining notification.

In step M the first communication apparatus performs wireless LAN communication connection to the wireless access point . In step M the first communication apparatus notifies the wireless LAN that it joins a network. Then in step M the second communication apparatus receives the network joining notification from the first communication apparatus and discovers the first communication apparatus .

In step M the first communication apparatus transmits an apparatus discovery request to the wireless LAN. In the third embodiment an SSDP M SEARCH message is transmitted as the apparatus discovery request. Then in step M in response to the apparatus discovery request received in step M the second communication apparatus transmits an apparatus discovery response. In the third embodiment a response message to the SSDP M SEARCH message is transmitted as the apparatus discovery response. In step M the first communication apparatus receives the apparatus discovery response from the second communication apparatus and discovers the second communication apparatus .

In step M the first communication apparatus requests the second communication apparatus to acquire apparatus information and service information. The apparatus information and service information indicate a device description and service description in UPnP respectively. In step M in response to the request from the first communication apparatus to acquire the apparatus information and service information the second communication apparatus transmits the apparatus information and service information about itself.

In step M the first communication apparatus notifies the wireless LAN that it leaves the network. In the third embodiment an SSDP byebye message is transmitted as a network leaving notification. Then in step M the second communication apparatus receives the network leaving notification from the first communication apparatus and detects that the first communication apparatus has left the network. In step M the first communication apparatus performs wireless LAN communication disconnection from the wireless access point .

In step S by using a discovery controller a communication state determination unit determines whether the first communication apparatus has left the network. If the first communication apparatus has left the network S YES the process advances to step S otherwise S NO the process advances to step S.

In step S by using the discovery controller the communication state determination unit determines whether the target apparatus has left the network. If the target apparatus has left the network S YES the process advances to step S otherwise S NO the process advances to step S.

After that a communication relationship determination unit determines the presence of the communication relationship with the target apparatus in step S and determines the absence of the communication relationship in step S similarly to .

In step S the communication relationship determination unit determines whether the detected communication event is an event of HTTP communication disconnection from the target apparatus. If the detected communication event is an HTTP communication disconnection event S YES the process advances to step S otherwise S NO the process advances to step S. In step S an HTTP header table selection unit sets the detected communication event as a storage deletion determination target communication event.

In step S the communication relationship determination unit determines whether the detected communication event is a network leaving event. If the detected communication event is a network leaving event S YES the process advances to step S otherwise S NO the process advances to step S. In step S the HTTP header table selection unit sets the detected communication event as a storage deletion determination non target communication event.

As described above according to the third embodiment the first communication apparatus appropriately selects an HTTP header table to be used for HTTP communication with the second communication apparatus in accordance with the communication relationship associated with a network joining leaving operation on the wireless LAN. Therefore the first communication apparatus need not newly create an HTTP header table every time HTTP communication with the second communication apparatus starts and can reuse the HTTP header table while it exists on the same network. This reduces the processing load of HTTP header table creation processing and a communication delay caused by the creation time.

Note that the third embodiment has exemplified a case in which the communication relationship determination unit detects a network leaving event using the discovery controller as shown in step S of . The present invention however is not limited to this. For example if power off wireless LAN communication disconnection or the like occurs while the first communication apparatus or second communication apparatus joins the network on the wireless LAN it may be impossible to detect a network leaving communication event. To the contrary the communication relationship determination unit may detect a network joining event using the discovery controller . This can reduce unnecessary consumption of the memory area by surely deleting an HTTP header table which should be deleted thereby further reducing the processing load of the HTTP header table selection unit and a communication delay caused by selection processing.

Furthermore the first communication apparatus according to the third embodiment may perform confirmation and notification of the HTTP header table selected with the second communication apparatus during a network joining or leaving sequence or apparatus discovery sequence. This can reduce the sequence shown in between the first communication apparatus and the second communication apparatus thereby increasing the communication speed between the first communication apparatus and the second communication apparatus and reducing the power consumption.

The fourth embodiment of the present invention will be described below. According to a feature of the fourth embodiment a communication relationship is determined based on a communication history. As for a communication system configuration and function module arrangement according to the fourth embodiment a description of the same elements as those in the above described first to third embodiments will be omitted.

A sequence showing message examples when a first communication apparatus performs processing from communication connection to a second communication apparatus to communication disconnection according to the fourth embodiment is the same as that shown in . In the fourth embodiment the first communication apparatus determines a communication relationship based on a communication history with the second communication apparatus .

In step S a communication history determination unit performs determination processing based on an HTTP communication history with a target apparatus. If there is a communication history with the target apparatus S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the communication history determination unit performs determination processing based on a TCP IP communication history with the target apparatus. That is the communication history determination unit determines whether the domain name and host name of the target apparatus are the same as before. If the domain name and host name are the same as before S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the communication history determination unit performs determination processing based on the HTTP communication history with the target apparatus. In this example if the communication history determination unit determines that the previous HTTP communication operation with the target apparatus has been performed within a valid period and an HTTP communication count is equal to or smaller than a valid count S YES the process advances to step S otherwise S NO the process advances to step S.

After that a communication relationship determination unit determines the presence of the communication relationship with the target apparatus in step S and determines the absence of the communication relationship in step S similarly to .

As described above according to the fourth embodiment the first communication apparatus appropriately selects an HTTP header table to be used for HTTP communication with the second communication apparatus in accordance with the communication history with the second communication apparatus . Therefore the first communication apparatus need not newly create an HTTP header table every time HTTP communication with the second communication apparatus starts and can reuse the HTTP header table while it exists on the same network. This reduces the processing load of HTTP header table creation processing and a communication delay caused by the creation time.

Furthermore the fourth embodiment has exemplified a case in which the communication history determination unit determines the presence absence of the communication relationship based on the HTTP communication history and TCP IP communication history. The present invention however is not limited to this. For example the communication history determination unit may determine the presence absence of the communication relationship based a wireless LAN communication history with the second communication apparatus . For example when there is a wireless LAN connection history or a history of a specific wireless LAN connection mode for example persistent group connection of Wi Fi Direct the presence of the communication relationship is determined. Alternatively the determination processing may be performed based on a discovery history with the second communication apparatus . For example when there is a joining discovery history in a network on a wireless LAN and the joining discovery date time and count fall within valid ranges the presence of the communication relationship is determined. Also the determination processing may be performed based on an authentication history with the second communication apparatus . For example when there is a history of user login success authentication success or the like the presence of the communication relationship is determined. The determination processing may be performed based on a service provision use history with the second communication apparatus . For example if services of the same types contents are provided used the presence of the communication relationship is determined.

The fifth embodiment of the present invention will be described below. According to a feature of the fifth embodiment a communication relationship is determined based on a communication method. As for a communication system configuration and function module arrangement according to the fifth embodiment a description of the same elements as those in the above described first to fourth embodiments will be omitted.

A sequence showing message examples when a first communication apparatus performs processing from communication connection to a second communication apparatus to communication disconnection according to the fifth embodiment is the same as that shown in . In the fifth embodiment the first communication apparatus determines the communication relationship based on a communication method with the second communication apparatus .

In step S an HTTP header table selection unit specifies a target apparatus the second communication apparatus in this example using an HTTP communication controller . In step S a communication relationship determination unit determines the presence absence of a communication relationship with the target apparatus. Details of this determination processing will be described later with reference to .

If the presence of the communication relationship with the target apparatus is determined S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the HTTP header table selection unit determines whether there is an HTTP header table for the communication relationship with the target apparatus in an HTTP header table storage unit . If there exists the HTTP header table S YES the process advances to step S otherwise S NO the process advances to step S.

In step S by using a unique HTTP header table management unit the HTTP header table selection unit determines whether there is a unique HTTP header table corresponding to a predetermined communication method for the communication relationship with the target apparatus. If there exists the unique HTTP header table S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the HTTP header table selection unit acquires the unique HTTP header table corresponding to the predetermined communication method for the communication relationship with the target apparatus by using the unique HTTP header table management unit . In step S an HTTP header table confirmation unit performs with the target apparatus confirmation and notification of the unique HTTP header table acquired in step S. Details of this HTTP header table confirmation notification processing are the same as in the first embodiment described with reference to .

If the confirmation and notification processing in step S has succeeded S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the HTTP header table selection unit selects the unique HTTP header table acquired in step S to be used by an HTTP header compression unit for HTTP header compression with the target apparatus thereby terminating the process.

In step S an HTTP header table generation unit newly generates an initial HTTP header table defined by the HTTP 2 method. Then the HTTP header table selection unit selects the newly generated HTTP header table to be used by the HTTP header compression unit for HTTP header compression with the target apparatus thereby terminating the process.

In step S a communication method determination unit determines the communication relationship based on the service provision method of the target apparatus using a service controller . That is if the service controller can support the service provision method of the target apparatus S YES the process advances to step S otherwise S NO the process advances to step S.

In step S the communication relationship determination unit receives the determination result of the communication method determination unit and determines the presence of the communication relationship with the target apparatus thereby terminating the process. On the other hand in step S the communication relationship determination unit receives the determination result of the communication method determination unit and determines the absence of the communication relationship with the target apparatus thereby terminating the process.

Similarly in addition to initial records of indices 0 to 34 records of indices 35 to 37 are added to an HTTP response header table . These added records are HTTP response headers commonly used or defined in DLNA .

As described above according to the fifth embodiment the first communication apparatus selects the unique HTTP header table complying with the predetermined communication method with the second communication apparatus as an HTTP header table to be used for HTTP communication with the second communication apparatus . Thus the first communication apparatus need not newly create an HTTP header table every time HTTP communication with the second communication apparatus starts and can use the unique HTTP header table optimized for the predetermined communication method. This can further reduce the processing load of HTTP header table creation processing and a communication delay caused by the creation time.

The fifth embodiment has exemplified a case in which the communication method determination unit determines the presence absence of the communication relationship based on the service provision method of the target apparatus by using the service controller . The present invention however is not limited to this. For example the presence absence of the communication relationship may be determined based on a wireless LAN communication method with the second communication apparatus . In this case when the wireless LAN communication method is the wireless direct method Wi Fi Direct method Wi Fi Direct Service method Wi Fi Miracast method or the like the communication method determination unit determines the presence of the communication relationship. Also the presence absence of the communication relationship may be determined based on a TCP IP communication method with the second communication apparatus . When the TCP IP communication method is the VPN method IPsec method or the like the presence of the communication relationship is determined. Furthermore the presence absence of the communication relationship may be determined based on a discovery method with the second communication apparatus . If the discovery method is the SSDP method mDNS method Bonjour method SDP method or the like the presence of the communication relationship is determined. The determination processing may be performed based on an authentication method. When the authentication method is the HTTP authentication Basic authentication and Digest authentication method OAuth 2.0 method OpenID method OpenID Connect method SAML method or the like the presence of the communication relationship is determined.

The fifth embodiment has exemplified a case in which the HTTP header table selection unit selects one unique HTTP header table corresponding to the predetermined communication method with the second communication apparatus . The present invention however is not limited to this. For example when the first communication apparatus performs HTTP communication with the second communication apparatus based on a plurality of predetermined communication methods a plurality of unique HTTP header tables corresponding to the communication methods may be selected and used in combination. This allows the use of HTTP header tables optimized for various communication methods thereby further reducing the processing load of HTTP header table creation processing and a communication delay caused by the creation time. With the arrangement according to this embodiment it is possible to reuse a table by selecting a table to be referred to by the message head compression function in accordance with the connection status between communication apparatuses thereby reducing processing of newly creating a table.

Embodiment s of the present invention can also be realized by a computer of a system or apparatus that reads out and executes computer executable instructions e.g. one or more programs recorded on a storage medium which may also be referred to more fully as a non transitory computer readable storage medium to perform the functions of one or more of the above described embodiment s and or that includes one or more circuits e.g. application specific integrated circuit ASIC for performing the functions of one or more of the above described embodiment s and by a method performed by the computer of the system or apparatus by for example reading out and executing the computer executable instructions from the storage medium to perform the functions of one or more of the above described embodiment s and or controlling the one or more circuits to perform the functions of one or more of the above described embodiment s . The computer may comprise one or more processors e.g. central processing unit CPU micro processing unit MPU and may include a network of separate computers or separate processors to read out and execute the computer executable instructions. The computer executable instructions may be provided to the computer for example from a network or the storage medium. The storage medium may include for example one or more of a hard disk a random access memory RAM a read only memory ROM a storage of distributed computing systems an optical disk such as a compact disc CD digital versatile disc DVD or Blu ray Disc BD a flash memory device a memory card and the like.

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.

This application claims the benefit of Japanese Patent Application No. 2014 142637 filed Jul. 10 2014 which is hereby incorporated by reference herein in its entirety.

