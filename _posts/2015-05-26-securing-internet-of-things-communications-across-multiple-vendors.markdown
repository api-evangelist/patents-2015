---

title: Securing internet of things communications across multiple vendors
abstract: A secure connection between a user mobile device and a “Internet-of-Things” network-connected device (e.g., a home appliance or a vehicle) may be provided using an internet gateway residing in the public internet and a local gateway residing in a private network behind a firewall. The user device may receive an input through a software application and may generate an electronic instruction based on the input. The user device may then encrypt the electronic instruction and send the encrypted electronic instruction to the internet gateway over a secure connection (e.g., SSH, TLS). The internet gateway then sends the encrypted electronic instruction to the local gateway, which decrypts the encrypted electronic instruction, interprets it, and generates and transmits a device instruction to communicate with the network-connected device, either directly or through an intermediary device such as a third-party bridge or hub. Only the user device and local gateway have encryption/decryption keys.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09485231&OS=09485231&RS=09485231
owner: DELL SOFTWARE INC.
number: 09485231
owner_city: Round Rock
owner_country: US
publication_date: 20150526
---
The present invention generally relates to network connected devices. More specifically the present invention relates to providing secure communications for multiple network connected devices from different vendors or manufacturers.

The phrase internet of things refers to network connected devices that may receive inputs from a computer network and or transmit outputs to the computer network. For example a network connected internet of things lightbulb might be controllable from a user s smartphone device so that a user could turn his her lights on or off without having to push a physical light switch. Similarly a network connected internet of things automobile might provide gas mileage data to a user s smartphone. Other internet of things devices may be thermostats smart watches or washing machines.

Due to decreased costs and sizes of computer components and wireless network connection modules more and more network connected internet of things devices are being produced. As production of network connected internet of things devices has increased several major problems have emerged trust identity and interoperability.

Some network connected internet of things devices can communicate with a user s mobile device through either a potentially untrustworthy non secure internet gateway system through a public internet connection or alternately through a non secure local gateway system with improper identity verification.

The user must blindly trust the internet gateway s managing entity e.g. typically the same Brand X that produced the device which could potentially view and or alter the user s communications between the user mobile device e.g. originating from Brand X mobile software app and the user s network connected internet of things devices .

This could allow the internet gateway s managing entity e.g. Brand X to track the user s actions and whereabouts e.g. by tracking when the user turns lights on or receiving a location from a user s vehicle of even health data about the user. The internet gateway s managing entity e.g. Brand X could intentionally sell or give a user s personal data to a third party or could unintentionally leak this data to a third party via a compromised connection e.g. man in the middle attack at connection connection or connection or a compromised machine e.g. malware at the non secure internet gateway . The non secure internet gateway s managing entity e.g. Brand X or a third party accessing the internet gateway or its various connections e.g. connection connection or connection could even potentially control the user s network connected internet of things devices themselves by transmitting commands appearing to come from the user mobile device through the internet gateway . Such third party control could be annoying e.g. turning off lights when the user is home wasteful e.g. turning on lights when the user is not home property damaging e.g. flooding a washing machine or overheating an oven or potentially life threatening e.g. causing the user s vehicle to swerve .

Typically a non secure internet gateway as depicted in e.g. managed by Brand X is not designed to function with network devices from brands or manufacturers other than the brand or manufacturer of the internet gateway e.g. Brand X . The Brand X internet gateway typically communicates with any connected network connected devices e.g. connection using proprietary protocols or even connection types e.g. proprietary cables . Thus the Brand X internet gateway cannot be used to control an ecosystem of network connected devices by multiple brands or manufacturers.

The approach of is problematic because it cannot scale and it cannot guarantee the identity of client requests. In particular implementing Secure Socket Layer SSL for communications between the user device and the local gateway can be problematic particularly when the user device is outside of the private network e.g. use case of connection .

A first method of implementing SSL in the context of connection of is to install and manage certificates using a certificate authority. A major problem with this approach is that this does not scale and is not manageable at a consumer level. The certificates might only be authorized temporarily costs associated with the certificate authority might have to be paid by the consumer and or management operations may have to be performed by the consumer.

A second method of implementing SSL in the context of connection of is to use self signed certificates from the local gateway and subsequently get those certificates to clients. Such self signed certificates are not as secure as certificates issued by certificate authorities however. Further use of self signed certificates in this manner locks the local gateway into connecting with certain devices excluding the ability to develop an ecosystem with multiple network connected devices made by multiple brands manufacturers.

A third method of implementing SSL in the context of connection of is to use self signed certificates while clients ignore signature validation. This is almost entirely non secure.

Because SSL is not feasible to reliably implement while maintaining interoperability the connections of cannot guarantee the identity of senders of communications to recipients. Thus if the user mobile device sends a communication to the local gateway e.g. to turn on a network connected light bulb a malicious party can compromise the connection and perform a man in the middle attack or a replay attack. Thus the malicious party could view or change the user s command or trigger a command at a different time.

Typically a local gateway as depicted in e.g. managed by Brand X is not designed to function with network devices from brands or manufacturers other than the brand or manufacturer of the local gateway e.g. Brand X . The Brand X local gateway typically communicates with any connected network connected devices e.g. connection using proprietary protocols or even connection types e.g. proprietary cables . Thus the Brand X local gateway cannot be used to control an ecosystem of network connected devices by multiple brands or manufacturers. Such interoperability issues can make communication with inconvenient multiple network connected internet of things devices inconvenient slow and cumbersome for a user. This may also force a user to be locked into a single brand or manufacturer or network connected internet of things devices or mobile devices potentially limiting the user s choices and functionalities and forcing the user to pay more to buy devices by a particular brand or manufacturer.

There is therefore a need in the art for an improved internet of things ecosystem for securely controlling a variety network connected internet of things devices from a control point of the user s choice.

One exemplary method for secure communications includes receiving an encrypted electronic instruction at a local gateway from an internet gateway. The encrypted electronic instruction is based on an electronic instruction generated by a user device the electronic instruction encrypted by the user device using a first security key stored in a user memory of the user device. The method may include decrypting the encrypted electronic instruction at the local gateway using a second security key stored in a local memory of the local gateway. The method also includes transmitting a device instruction from the local gateway. The device instruction is based on the electronic instruction decrypted by the local gateway using the second security key the device instruction to trigger a network connected device to perform a device action.

One exemplary system for secure communications includes an internet gateway device and a local gateway device. The internet gateway device is communicatively coupled to a user device and the local gateway device. Execution of internet gateway instructions stored in an internet memory of the internet gateway by an internet gateway processor of the internet gateway device performs a variety of internet gateway operations. The internet gateway operations include receiving an encrypted electronic instruction from the user device over a secure connection the encrypted electronic instruction being an electronic instruction that was generated by the user device and then encrypted by the user device using a first security key stored in a user memory of the user device. The internet gateway operations also include transmitting the encrypted electronic instruction to the local gateway device. The local gateway device is communicatively coupled to the internet gateway and a network connected device. Execution of local gateway instructions by a local gateway processor of the local gateway device performs a variety of local gateway operations. The local gateway operations include receiving the encrypted electronic instruction from the internet gateway based on the encrypted electronic instruction first passing through a firewall. The local gateway operations include decrypting the encrypted electronic instruction using a second security key stored in a local memory of the local gateway. The local gateway operations also include transmitting a device instruction from the local gateway the device instruction based on the electronic instruction decrypted by the local gateway using the second security key the device instruction to trigger a network connected device to perform a device action.

One exemplary non transitory computer readable storage medium may have embodied thereon a program executable by a processor to perform a method for secure connections. The exemplary program method may include receiving an encrypted electronic instruction at a local gateway from an internet gateway. The encrypted electronic instruction is based on an electronic instruction generated by a user device the electronic instruction encrypted by the user device using a first security key stored in a user memory of the user device. The program method may include decrypting the encrypted electronic instruction at the local gateway using a second security key stored in a local memory of the local gateway. The program method may include transmitting a device instruction from the local gateway. The device instruction is based on the electronic instruction decrypted by the local gateway using the second security key the device instruction to trigger a network connected device to perform a device action.

Embodiments of the present invention are directed generally to systems and methods of for secure communications between a user device and a set of network connected devices.

A secure connection between a user mobile device and a Internet of Things network connected device e.g. a home appliance or a vehicle may be provided using an internet gateway residing in the public internet and a local gateway residing in a private network behind a firewall. The user device may receive an input through a software application and may generate an electronic instruction based on the input. The user device may then encrypt the electronic instruction and send the encrypted electronic instruction to the internet gateway over a secure connection e.g. SSH TLS . The internet gateway then sends the encrypted electronic instruction to the local gateway which decrypts the encrypted electronic instruction interprets it and generates and transmits a device instruction to communicate with the network connected device either directly or through an intermediary device such as a third party bridge or hub. Only the user device and local gateway have encryption decryption keys.

The secure communications ecosystem of may include a user device which may be a user mobile device which may be produced by Brand Y or another brand manufacturer . The user mobile device may be a smartphone device a tablet device a portable media player device a wearable device or a portable game console device. The user device may also be another type of user device that does not fall under the traditional mobile device category such as a laptop computer a desktop computer a smart television a home entertainment system a home video game console or another type of computer device.

The ecosystem may include a secure internet gateway which may receive and transmit communications through a wired or wireless connection to the Internet . The secure internet gateway may be any type of physical or virtual computer system or computerized device with access to the internet such as a server a laptop computer a desktop computer or any other type of network connected device with a memory and a processor. The secure internet gateway may receive and transmit communications using protocols based on Secure Sockets Layer SSL or Transport Layer Security TLS and be able to communicate with a certificate authority CA . The secure internet gateway may in some cases include a hardware firewall not shown or a software firewall not shown for filtering communications being received by the secure internet gateway and or transmitted by the secure internet gateway .

The secure internet gateway may be a single computing device as illustrated in or may alternately be one or more of a collection of computing devices connected in a network or may be one or more of a collection of computing devices distributed throughout the Internet or may be some combination thereof. In embodiments where the secure internet gateway includes more than one computing device the secure internet gateway may include one or more computers systems run privately and or may include one or more computer systems and or virtual machines run by a third party entity as a subscription service to be used by one or more individuals or groups.

The ecosystem may include a private network which may be a local area network LAN a wireless local area network WLAN a municipal area network MAN or a wide area network WAN . The private network may include a secure local gateway . The secure local gateway may then be connected to various network connected devices. This connection may be direct e.g. device s indirect through a third party gateway e.g. third party gateway and third party gateway sub devices indirect through a third party bridge e.g. third party bridge and third party bridge sub devices or some combination thereof.

Any connections to the secure local gateway from outside of the private network e.g. the connection between the secure internet gateway and secure local gateway may be filtered through a firewall . The firewall may be a hardware firewall within the hardware of the secure local gateway or within the hardware of a router not shown . The firewall may alternately be a software firewall stored in a memory of the secure local gateway or stored in a memory of a router not shown . The firewall may alternately be some combination of a hardware and software firewall.

The user device may be used within the private network as illustrated in usage case of . The user device may alternately be used outside of the private network as illustrated in usage case of .

The user device may store a variety of software applications which may be mobile applications e.g. applications developed for mobile operating systems such as Apple iOS Google Android Microsoft Windows Mobile Blackberry OS or may be traditional desktop software applications e.g. applications developed for traditional computer operating systems such as Microsoft Windows Apple OSX Unix Linux .

These software applications may include a gateway software application designed specifically for interacting with the secure internet gateway and or secure local gateway. These software applications may also include a third party software application designed for interacting with one or more devices e.g. device s third party gateways e.g. third party gateway third party bridges e.g. third party bridge or some combination thereof. These software applications may also include a management software application designed to be used within the private network e.g. usage case of to communicate with and manage the secure local gateway .

The user device may store in a memory of the user device a security key . The secure local gateway may store in a memory of the secure local gateway a security key . The security key and the security key may be symmetric security keys e.g. security key may be entirely identical or at least partially identical to security key in terms of the data of which the keys are comprised . The security key and the security key may alternately be asymmetrical security keys such as private and public keys of a Public Key Infrastructure PKI . More security keys not shown may also be stored by the user device and or the secure local gateway .

The security key of the user device may be stored within or otherwise accessible to one or more of the third party software application the gateway software application and or the management software application . The security key may alternately be stored in a memory or storage component of the security key . The security key may be stored encrypted on the user device . Similarly the security key may be stored encrypted on the secure local gateway .

The management software application may in some cases be used to set up a link between a user device and the local gateway . Toward this end the management software application may execute or assist in executing at least some of the operations performed by the user device described in the flow diagram of . In some cases multiple user devices may be registered with a single local gateway . In such cases different user devices may each store different security keys and may each be associated with different security keys at the local gateway . Further different user devices may each be associated with different permissions which may be used to limit a particular user device s control e.g. user device A has administrative rights over other user devices associated permissions and has full control of all devices while user device B only has control over lights in a single room . Situations in which multiple user devices are registered with a single local gateway may be handled with the aid of a local gateway registration database stored within a memory of the local gateway or a memory accessible by the local gateway . An exemplary local gateway registration database is illustrated in .

The secure local gateway may in some cases include a discovery protocol which it may use to discover at least one of a user device a network connected device a third party gateway a sub device a third party bridge or a subdevice . The secure local gateway and secure internet gateway may in some cases locate each other using a discovery protocol through one or both systems. The secure local gateway may also in some cases include an application programming interface API conforming to Representational State Transfer REST constraints e.g. a RESTful API .

While the arrows illustrated in illustrate exemplary an exemplary communication from the user device to network connected device s or sub devices or sub devices it should be understood that the direction of these arrows may be reversed in order to illustrate an exemplary communication from the network connected device s or sub devices or sub devices to the user device e.g. a thermostat reporting the current temperature to the user device or reporting that a requested operation was completed .

The communication operations begin with the user device receiving an instruction input in step . The instruction input may be any type of input at a user device such as a touch based input at a touchscreen of the user device or a keyboard based input or a mouse based input or a voice and microphone based input. The user device may then generate an electronic instruction based on the instruction input in step . Generating the electronic instruction in step may alternately be based on an automatic trigger such as one preset by a user or one recommended by the manufacturer of the user device or network connected device . For example the generating the electronic instruction in step may be based on a location e.g. the user device is close to home triggering an automatic instruction input that a garage door should be opened or a thermostat should be powered on based on a sensor e.g. detecting using a sensor of the user device that the user device is cold triggering an automatic instruction input that a thermostat should be adjusted or powered on or based on a time and or preset instructions e.g. detecting that it is 6 30 AM triggering an automatic instruction input to turn on a set of lights and or an audio system in order to wake up a user according to preset instructions or a determined schedule .

Once the electronic instruction is generated in step the user device may encrypt the electronic instruction using security key stored at the user device to generate an encrypted electronic instruction in step . In step the user device may then transmit the encrypted electronic instruction to the secure internet gateway using SSL or TLS which may itself involve a second layer of encryption on top of the encryption performed in step .

In step the secure internet gateway may then receive the encrypted electronic instruction transmitted by the user device in step . The use of SSL and or TLS allows the secure internet gateway certainty that the encrypted electronic instruction was truly transmitted by the user device . Significantly the secure internet gateway does not store a security key capable of decrypting the encrypted electronic instruction from the encryption performed at step . This means that if the secure internet gateway or any connections going to or from it are compromised by a third party e.g. a malicious hacker or snooping government entity the third party will have no ability to view or change the contents of the electronic instruction generated by the user device in step . Similarly if the entity managing the secure internet gateway receives a subpoena order to turn over the contents of the electronic instruction generated by the user device in step to a third party the entity managing the secure internet gateway will be unable to turn over anything other than the still encrypted electronic instruction. This protects the privacy of a user of the user device .

In step the secure internet gateway may then locate the appropriate secure local gateway to which to transmit the encrypted electronic instruction. The secure internet gateway may do this a variety of ways. For example the user device could register with the internet gateway prior to transmitting any encrypted electronic instructions intended for network connected device . During such a registration process a user could identify a particular secure local gateway to be used for all communications originating from the user device that are bound for the network connected device . This information could then be stored at a database table list or other data structure e.g. data structures described with respect to at a memory accessible to the secure internet gateway . One example of this type of registration process at the secure internet gateway is illustrated in . Alternately the encrypted electronic instruction could be transmitted in step along with unencrypted information identifying a particular secure local gateway to which that encrypted electronic instruction should be sent. Even if a malicious third party was somehow able to change this unencrypted information identifying the particular secure local gateway to which that encrypted electronic instruction should be sent the contents of the electronic instruction would still be encrypted and thus unreadable to any device other than the secure local gateway originally identified by the user device .

Once the secure internet gateway identifies an appropriate secure local gateway to transmit the encrypted electronic instruction to in step the secure internet gateway may then transmit the encrypted electronic instruction to the identified appropriate secure local gateway in step . In some instances the encrypted electronic instruction may be transmitted from the secure internet gateway to the identified appropriate secure local gateway using SSL and or TLS for an additional layer of security as described regarding the transfer of step and step .

Once the secure internet gateway transmits the encrypted electronic instruction to the secure local gateway in step the transmitted encrypted electronic instruction may first pass through a firewall in step . The firewall may be a hardware firewall a software firewall or some combination thereof as described in relation to . Though the firewall operation of step is listed under the local gateway column of the flow diagram of the firewall may be located at the secure local gateway at another device such as a router or some combination thereof as described in relation to . If the encrypted electronic instruction has somehow been tampered with at the secure internet gateway or at a connection to or from the secure internet gateway the firewall may be used to detect any malicious tampering e.g. tampering that inserts a virus spyware or other malware into the encrypted electronic instruction or data transmitted with the encrypted electronic instruction and stop the tampered encrypted electronic instruction from reaching the secure local gateway . In some embodiments the firewall may be missing from the ecosystem and the communication operations in which case step may lead directly to step .

If the encrypted electronic instruction successfully passes through the firewall in step the encrypted electronic instruction may then be received by the secure local gateway in step . If the communication between the secure internet gateway and the secure local gateway was transmitted using SSL and or TLS this may involve an additional layer of encryption and decryption as described regarding the transfer of step and step . The secure local gateway may then decrypt the encrypted electronic instruction that it received in step using the security key stored at the secure local gateway in step . The decryption operation of step then produces a decrypted electronic instruction which reproduces the content of the electronic instruction generated by the user device in step before it was encrypted in step .

The secure local gateway can then interpret the content of the decrypted electronic instruction in the context of the devices that the secure local gateway is connected to which may include for example a network connected device a third party bridge and or a third party gateway and generate one or more third party instructions based on the decrypted electronic instruction in step . For example a particular network connected device third party bridge and or a third party gateway could be equipped to only handle instructions in a particular format which may be an open source format or a proprietary format. In some cases a single decrypted electronic instruction could translate to multiple third party instructions e.g. a single electronic instruction indicating that a thermostat should be set to a particular temperature may be split into a first third party instruction powering on the thermostat and a second third party instruction setting the thermostat to the particular temperature . Further if the third party instruction s are to be sent to a third party bridge and or a third party gateway the third party bridge and or a third party gateway must be able to interpret these and generate further device instructions for sub devices connected to the third party bridge and or a third party gateway e.g. sub devices and or sub devices in step . In some cases a network connected device third party bridge and or a third party gateway may be capable of interpreting the decrypted electronic instruction directly without needing to generate a third party instruction in which case the third party instruction generated in step may simply be the electronic instruction decrypted in step .

Once the third party instruction s are generated in step the third party instruction s may then be received by the appropriate third party device which may be a network connected device in step or a third party gateway or third party bridge in step .

If the secure local gateway is directly connected to a network connected device the network connected device may receive the third party instruction s in step which the network connected device may then interpret and perform a device action in step . The device action of step may be any action performable by a network connected device and may vary based on the type of device that the network connected device is. For example the device action of step may include adjusting a light bulb playing a song on a stereo system opening closing a garage door setting a thermostat temperature heating up a car interior opening a car sunroof locking unlocking a vehicle building door setting a kitchen appliance checking a battery charge level requesting a location of the network connected device or any number of other device actions.

If the secure local gateway is directly connected to a third party gateway or third party bridge the third party gateway or third party bridge may receive the third party instruction s in step . The third party gateway or third party bridge may then interpret the third party instruction s and generate one or more device instruction s based on each of the third party instruction s in step . For example the third party gateway or third party bridge may be a internet of things hub associated with a particular brand or manufacturer that may then interpret and generate instructions to devices associated with the same particular brand or manufacturer. The device instruction s may then be received by the network connected device in step the network connected device may then interpret and perform a device action in step . The device action may be any may be any action performable by a network connected device as described above.

In some cases a third party gateway or third party bridge may be connected to one or more secondary third party gateway s or secondary third party bridge s before finally reaching a network connected device. This may require interpreting the third party instruction received in step and generating a secondary third party instruction to send to the secondary third party gateway s or secondary third party bridge s where the secondary third party gateway s or secondary third party bridge s can then continue the communication operations from step onward.

While the network connected device third party bridge and third party gateway are sometimes referred to herein as third party devices it should be understood that these may be produced or manufactured by a third party or they may be produced or manufactured by the entity that produced or manufactured the secure local gateway or they may be produced or manufactured by the entity that produced or manufactured the secure internet gateway or they may be produced or manufactured by the entity that produced or manufactured the user device or some combination thereof. Some or all of these devices may share a producer and or manufacturer and or managing entity. Some or all of these devices may be produced and or manufactured and or managed by separate entities.

While the flow diagram of illustrates exemplary communication operations for a communication to be sent from the user device to a network connected device it should be understood that similar communication operations can also be used for a communication to be sent from a network connected device to the user device e.g. a thermostat reporting the current temperature to the user device or reporting that a requested operation was completed . In particular the network connected device could transmit such a communication to the local gateway either directly or through one or more third party bridge s and or third party gateway s where the local gateway may encrypt the communication using security key . The local gateway may send this encrypted communication to the internet gateway over SSL which may send it onward to the user device over SSL where the user device may decrypt the communication using security key .

While refers to the network connected device it should be understood that the network connected device of may be a sub device or a sub device as illustrated in .

The setup operations may begin with registering a user account and or a user device with the secure internet gateway in step . This may involve registering the user account information and or the user device information with the secure internet gateway and may optionally also involve identifying an secure local gateway and storing data about the associated secure local gateway with the secure internet gateway in step . Information about the user account and or user device may be stored in a database or other data structure e.g. data structures described with respect to accessible by the secure internet gateway .

The setup operations may include registering a user account and or a user device at the secure local gateway in step . This may involve registering the user account information and or the user device information with the secure local gateway and may optionally also involve identifying an secure local gateway and storing data about the associated secure local gateway with the secure internet gateway in step . Information about the user account and or user device may be stored in a local gateway registration database e.g. local gateway registration database of or other data structure e.g. data structures described with respect to accessible by the secure local gateway .

While the registration with the secure local gateway in step and step is illustrated in as taking place sequentially after the registration with the secure internet gateway these may take place in reverse order and or may take place at least partially in parallel. Further in some embodiments the secure internet gateway and the secure local gateway may share information about a user account and or a user device in step in order to make the registration process more simple e.g. so that potentially a user could register a user account and or user device with only one of the secure internet gateway or secure local gateway and have the registration transfer to the other automatically or have at least some information transfer automatically .

Registering a user account and or user device with the secure local gateway as discussed with respect to step and step be performed a variety of ways. For example the secure local gateway could receive a username and password from the user device that is then stored at the secure local gateway . Alternately the secure local gateway could generate a temporary passcode for use by a user device which may be a good solution for a quick registration such as when the user device is a user device belonging to a visitor who won t need to interact with the secure local gateway for very long. In some cases registration of one user device may be performed by a second user device e.g. where the second user device has special administrative privileges such as USER DEVICE A of and or where the second user device has the management software application . In some cases registering a user account and or user device with the secure internet gateway as discussed in step and step may be performed similarly.

Once the user account and or user device are registered with the secure internet gateway in step and with the secure local gateway in step the user device may install software applications e.g. third party software application gateway software application and or management software application that allow communication with a network connected device in step . The user device may then run one of these software applications in step . In some cases the user account information discussed above in steps may be tied to a particular software application and may be repeated for other software applications of the same user device .

The first time one of these software applications is run at the user device the user device may need to input user account information and or information about a particular secure internet gateway and or a particular secure local gateway in step . This may involve the secure internet gateway then receiving information about the user account and or about the secure local gateway in step . This may also involve the secure local gateway receiving information about the user account and or about the secure internet gateway in step . In some cases the secure internet gateway and secure local gateway may share information about the user account of the user device or software application or about each other in step .

The secure local gateway may then generate a unique identification ID key intended to uniquely identify the user of the user device the user device itself a software application run by the user device or some combination thereof in step . In some cases the unique ID key may be a high entropy key in cases where registration should be renewed or in cases where registration for a particular user or user device or software application is intended to expire after a period of time e.g. USER DEVICE D of . The secure local gateway can then transmit the unique ID key to the user device in step . The user device may then receive the unique ID key in step and store these in a memory accessible to the user device . In some cases unique ID key may be confined to use by a subset of the software applications stored at the user device .

The secure local gateway and user device may generate security key and security key at this stage in step and step . This may be performed a number of ways. In one embodiment the user device may generate and store security key and the secure local gateway may generate and store security key after which further security key data may be shared between the user device and the secure local gateway e.g. if security key and security key are private PKI keys and the shared further security key data includes public PKI keys . In a second embodiment the secure local gateway may generate both security key and security key and may store security key locally and transmit the security key to the user device . In a third embodiment the user device may generate both security key and security key and may store security key locally and transmit the security key to the secure local gateway . The second and third embodiments may be performed relatively securely if the user device and secure local gateway are on the same private network e.g. use case of . While the security key generation and sharing steps illustrated by step and step are illustrated here they may be performed at any other point in the setup operations. In some cases security key may be confined to use by a subset of the software applications stored at the user device .

The setup operations of may also include selection of a network connected device a third party bridge and or a third party gateway for registration in step . In particular this could include transmitting information identifying the network connected device third party bridge and or third party gateway to the secure local gateway so that the secure local gateway can readily communicate with these devices during the communication operations of . In some cases not shown step may be performed at the secure local gateway instead of at the user device . In some cases not shown step may be performed instead of at the user device at the network connected device third party bridge and or third party gateway to be registered. Regardless of how or where the selection of network connected device third party bridge and or third party gateway for registration is to be performed for step the secure local gateway may then register the network connected device third party bridge and or third party gateway in step .

In some embodiments the network connected device may also register the secure local gateway as an acceptable device to communicate with within a device database or other data structure e.g. data structures of accessible by the network connected device in step . In some embodiments the third party bridge or third party gateway may also register the secure local gateway as an acceptable device to communicate with within a third party bridge gateway database or other data structure e.g. data structures of accessible by the third party bridge or third party gateway in step .

While refers to the network connected device it should be understood that the network connected device of may be a sub device or a sub device as illustrated in .

The local gateway registration database may include information about one or more user devices e.g. USER DEVICE A USER DEVICE B USER DEVICE C USER DEVICE D . The user devices may they each be associated with a security key as indicated by the security key in the same row in the local gateway registration database e.g. SECURITY KEY A SECURITY KEY B SECURITY KEY D . The user devices may each be associated with a permission setting which can include for example administrative permissions e.g. USER DEVICE A device control permissions e.g. USER DEVICE A USER DEVICE B USER DEVICE C or view only permissions e.g. USER DEVICE D . The local gateway registration database may also store information about what software applications are stored at each user device and or what software applications stored at each user device are registered with the local gateway registration database . These software applications may include a third party software application e.g. used by USER DEVICE D a gateway software application e.g. used by USER DEVICE A USER DEVICE B and USER DEVICE C and or the management software application e.g. used by USER DEVICE A . The local gateway registration database may also store unique ID key information which may be used to uniquely identify the user of the user device the user device itself a software application run by the user device or some combination thereof e.g. step of . This may be a string of unique characters per user device for example as illustrated in the local gateway registration database of . Thus in the unique ID key is used to identify each user device . In some embodiments some user devices may be associated with multiple unique ID keys one associated with each software application .

In some embodiments two user devices may be associated with the same security key and or unique ID keys . For example USER DEVICE B and USER DEVICE C are both associated with SECURITY KEY B in exemplary database . This may indicate for example that USER DEVICE B and USER DEVICE C are commonly owned by a single user and that SECURITY KEY B is associated with the common user rather than with a single user device . While the unique ID keys of are unique to each user device rather than each user in another embodiment the unique ID keys may be unique to each user rather than to each user device in which case USER DEVICE B and USER DEVICE C could share a unique ID key in the same way that they share SECURITY KEY B in .

One benefit of being able to adjust permissions for multiple user devices is to prevent an evil sibling problem. In particular permissions could be adjusted so that an evil sibling could not use his her user device to for example turn on the lights in his her sibling s room in the middle of the night. For example the permissions associated with USER DEVICE B in the exemplary local gateway registration database only allow control of lights in a single room.

Such permissions could also prevent an evil visitor problem. In particular permissions could allow visitors some limited access to their host s network connected devices e.g. device that may expire after a particular time period. For example the permissions associated with USER DEVICE D in the exemplary local gateway registration database only allow for viewing not control of thermostat settings. Further these viewing permissions are set to expire after 24 hours. Other permission expiration settings could be set as well such as permission expiration settings set to expire after a shorter or longer duration of time permission expiration settings set to expire at a particular date or time instead of after a particular duration of time location based permission expiration settings e.g. expire once the visitor s user device disconnects from a particular private network or leaves a particular geographic region event triggered permission expiration settings e.g. expire if the visitor s user device tries to change a particular setting at a particular time or at all or manual input based permission expiration settings e.g. expire once the another user device triggers the permission expiration with an input .

While the local gateway registration database is referred to as a database it should be understood that it may alternately be any data structure that can hold one or more pieces of data such as a database a table a list a matrix an array an arraylist a tree a hash table a hash map a string a map a graph a flat data sequence file an image a queue a heap a memory a stack a set of registers a set of records a tree a tuple a union or a similar data structure.

The components shown in are depicted as being connected via a single bus . However the components may be connected through one or more data transport means. For example processor unit and main memory may be connected via a local microprocessor bus and the mass storage device peripheral device s portable storage device and display system may be connected via one or more input output I O buses.

Mass storage device which may be implemented with a magnetic disk drive or an optical disk drive is a non volatile storage device for storing data and instructions for use by processor unit . Mass storage device can store the system software for implementing embodiments of the present invention for purposes of loading that software into main memory .

Portable storage device operates in conjunction with a portable non volatile storage medium such as a floppy disk compact disk or Digital video disc to input and output data and code to and from the computer system of . The system software for implementing embodiments of the present invention may be stored on such a portable medium and input to the computer system via the portable storage device .

Input devices provide a portion of a user interface. Input devices may include an alpha numeric keypad such as a keyboard for inputting alpha numeric and other information or a pointing device such as a mouse a trackball stylus or cursor direction keys. Additionally the system as shown in includes output devices . Examples of suitable output devices include speakers printers network interfaces and monitors.

Display system may include a liquid crystal display LCD or other suitable display device. Display system receives textual and graphical information and processes the information for output to the display device.

Peripherals may include any type of computer support device to add additional functionality to the computer system. For example peripheral device s may include a modem or a router.

The components contained in the computer system of are those typically found in computer systems that may be suitable for use with embodiments of the present invention and are intended to represent a broad category of such computer components that are well known in the art. Thus the computer system of can be a personal computer hand held computing device telephone mobile computing device workstation server minicomputer mainframe computer or any other computing device. The computer can also include different bus configurations networked platforms multi processor platforms etc. Various operating systems can be used including Unix Linux Windows Macintosh OS Palm OS and other suitable operating systems.

The present invention may be implemented in an application that may be operable using a variety of devices. Non transitory computer readable storage media refer to any medium or media that participate in providing instructions to a central processing unit CPU for execution. Such media can take many forms including but not limited to non volatile and volatile media such as optical or magnetic disks and dynamic memory respectively. Common forms of non transitory computer readable media include for example a floppy disk a flexible disk a hard disk magnetic tape any other magnetic medium a CD ROM disk digital video disk DVD any other optical medium RAM PROM EPROM a FLASHEPROM and any other memory chip or cartridge.

Various forms of transmission media may be involved in carrying one or more sequences of one or more instructions to a CPU for execution. A bus carries the data to system RAM from which a CPU retrieves and executes the instructions. The instructions received by system RAM can optionally be stored on a fixed disk either before or after execution by a CPU. Various forms of storage may likewise be implemented as well as the necessary network interfaces and network topologies to implement the same.

While various flow diagrams provided and described above may show a particular order of operations performed by certain embodiments of the invention it should be understood that such order is exemplary e.g. alternative embodiments can perform the operations in a different order combine certain operations overlap certain operations etc. .

While various embodiments have been described above it should be understood that they have been presented by way of example only and not limitation. The descriptions are not intended to limit the scope of the invention to the particular forms set forth herein. Thus the breadth and scope of a preferred embodiment should not be limited by any of the above described exemplary embodiments. It should be understood that the above description is illustrative and not restrictive. To the contrary the present descriptions are intended to cover such alternatives modifications and equivalents as may be included within the spirit and scope of the invention as defined by the appended claims and otherwise appreciated by one of ordinary skill in the art. The scope of the invention should therefore be determined not with reference to the above description but instead should be determined with reference to the appended claims along with their full scope of equivalents.

