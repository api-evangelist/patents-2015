---

title: Print system for recovering a print job in a redundant print server, print server and print control method
abstract: By saving the print job status in a shared database and switching the print job recovery method depending on the status, it is possible to obtain a printed result desired by the user without storing print data in the common database at the time of the occurrence of a failure.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09354832&OS=09354832&RS=09354832
owner: CANON KABUSHIKI KAISHA
number: 09354832
owner_city: Tokyo
owner_country: JP
publication_date: 20150406
---
The present invention relates to a print system a print server and a print control method and more particularly to a recovery method for recovering a print job in a redundant print server and the like.

With a conventional print system including a plurality of servers it is necessary to control the order of printing and thus a single server is given responsibility for print data generation processing and print job management for each printer. This configuration however requires print data to be saved in a common database or the like in order to perform print job recovery in another server in the event of the occurrence of a failure in the server that is responsible for printer management. For example Japanese Patent Laid Open No. 2013 008155 discloses a method in which print data is retracted into another server upon shut down of the OS so that the other server that has retracted the print data can take over to continue the processing.

This related art technique works well if the OS is normally shut down but if the retraction of print data fails such as for example if the OS is abruptly shut down by an accident or a service in the print server is abruptly shut down it is not possible to continue print processing. In addition with a print system that supports high volume printing there is a possibility that if a shared database is heavily accessed in order to for example write print data when saving print data into the shared database data writing creates a bottleneck for the practical use of the print system. Also if a failure occurs after printing has started and another server continues the print processing a problem of making duplicated printouts occurs.

The present invention has been made in view of the problems encountered with the conventional techniques and the present invention provides a print system a print server and a print control method that solve the above described problems by performing recovery processing for recovering a failed server in the event of the occurrence of a failure in the print server without sharing of print data in a shared database or the like.

According to an aspect of the present invention there is provided a print system comprising a plurality of print servers a monitor unit configured to monitor an operating status of the print servers and a database configured to store document data wherein each of the print servers includes a storing unit configured to in response to a print request store association information in the database the association information being information in which a print server performing print processing a printer and a print job are associated with each other and a print unit configured to generate a print job based on the document data and transmit the print job to a designated printer so as to execute the print job the monitor unit is further configured to if a failure occurs in a first print server notify a second print server of the failed first print server and the second print server is configured to specify a target printer and a target print job that are associated with the first print server based on the association information generate the specified print job based on the document data and transmit the print job to the specified printer so as to execute the print job.

Alternatively according to another aspect of the present invention there is provided a print server connected to at least one other print server a monitor unit configured to monitor an operating status of the print servers and a database configured to store document data the print server comprising a storing unit configured to in response to a print request store association information in the database the association information being information in which a print server performing print processing a printer and a print job are associated with each other and a print unit configured to generate a print job based on the document data and transmit the print job to a designated printer so as to execute the print job wherein a notification indicating that a failure has occurred in the other print server is received from the monitor unit and a target printer and a target print job that are associated with the first print server are specified based on the association information the specified print job is generated based on the document data and the print job is transmitted to the specified printer so as to execute the print job.

According to the present invention in redundant print servers recovery processing for recovering a failed server can be performed by another print server without sharing of print data in a database or the like and thus the user can obtain desired printouts.

Further features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings.

Hereinafter preferred embodiments for carrying out the present invention will be described with reference to the drawings.

As shown in the printer the load balancer a monitor server and the client terminal are connected via a network . The network is a so called communication network which is implemented by for example a LAN such as the Internet a WAN a telephone line a dedicated digital line an ATM or frame relay line a cable television line a data communication wireless line or a combination thereof. The network may be any network as long as it is possible to perform transmission and reception of data. The way of communication from the client terminal to the print servers and and the printer and the way of communication from the printer to the print servers and may be different. The client terminal may be for example a desktop computer a notebook computer a mobile computer a PDA personal data assistant or the like. Alternatively the client terminal may be a mobile phone having a program operating environment. The client terminal has an environment for operating programs such as a web browser an internet browser a WWW browser a browser used to access the World Wide Web . The print servers and receive information for identifying document data to be printed and information for designating an output printer together with a print request from a web browser of the client terminal via the load balancer and causes the output printer to perform printing. The print servers and also perform monitoring and managing of the printer control and monitoring of print jobs and transfer of print jobs to the printer . As shown in the print servers and are configured to be able to be redundant by the load balancer so as to virtually function as one print server. To be specific a print application of the client terminal that performs printing transmits a print request to the load balancer that functions as if it is a single print server without identifying the print servers and . The monitor server monitors the operating status of the print servers and and upon detection of the occurrence of a failure in any one of the print servers the monitor server issues a notification indicating that a failure has occurred to another print server. In the present embodiment there is no particular limitation on the method for monitoring the print servers performed by the monitor server and for example the monitor server can regularly poll the status of the print servers or use SNMP trap messages. A database is a large capacity storage device and stores therein documents document information printer information and print job information used by the print servers.

A CPU is a control unit of an information processing apparatus and is configured to execute an application program a print driver program an operating system and a print system program of the present embodiment that are stored in a HD . The CPU also performs control so as to temporarily store information files and the like required to execute the programs in a RAM . The CPU also opens various types of registered windows based on a command pointed by a mouse cursor not shown or the like on a display and executes various types of data processing. In the present embodiment printer preparing processing is performed through a window displayed on the display of the client PC. A ROM is a storage unit in which programs such as a basic I O program and various types of data such as font data used in document processing and template data are stored. The RAM is a temporary storage unit and functions as a main memory a work area and the like for the CPU . An interface is an input output unit and the information processing apparatus performs data exchange with an external apparatus via the interface .

A keyboard is an instruction input unit for the user to issue instructions to the print servers and the like. The display is a display unit configured to display a command and the like input through the keyboard . A hard disk HD is an external storage unit that functions as a large capacity memory and stores therein an application program a print driver program an OS and the like. shows a Floppy disk FD and a drive FDD as removable storage media but it is also possible to use other recording media such as an optical recording medium a magneto optical recording medium and a magnetic recording medium. The CPU to the FD drive are connected with a system bus .

A basic I O program is an area storing therein a program having an IPL initial program loading function or the like that upon the information processing apparatus being turned on reads the OS from the HD into the RAM and starts the OS to perform operation. An operating system OS is a program that executes resource management of the computer or the like. A print control program according to the present embodiment is stored in an area allocated on the RAM . Related data is stored in an area allocated on the RAM . A work area is a work area for the CPU to execute the print control program of the present embodiment. A memory map is an example of a memory map of the FD shown in and indicates the content of data stored in the FD . Volume information indicates data information. Directory information indicates the structure of directory. A print system program of the present embodiment is under control of the OS loaded into the RAM expanded as the print control program and executed by the CPU of the print server or so as to implement the procedures shown in as a part of a print service which will be described later. Related data is the related data of the print system program . The print system program is a program constructed based on the flowcharts explained in the present embodiment. In the present embodiment the print servers and have the same configuration.

Print processing performed in the print system according to the present embodiment will be described next. The print processing of the print system is executed with the print control program described above. Each software module of the print control program is stored in the HD and loaded into the RAM and executed by the CPU .

The printer driver that has received the rendering commands from the print service generates data that can be processed by the printer such as for example print data written in a page description language PDL PDF or the like and transmits the print data to the job control port monitor rather than to a port monitor that is configured to transmit print data to the printer . The job control port monitor transmits the print data to a print system job control service rather than to the printer . The job control service transmits the received print data to the printer . The job control service also stores the received print data in a storage unit such as the hard disk HD . The print data is stored in the HD until the job control service determines that the job has been completed for example until the job control service determines that printing of the print job has been completed.

The job control service further performs communication with a device such as the printer by using a device information control module and manages information such as device status job status and the like that are notified from the device. The job control service also has a function of issuing predetermined commands to the device. For example the job control service acquires the status of each device print apparatus with which communication is possible the status being information indicating printing in progress power control state failure information paper jam information regarding paper supply units or the like. The job control service also obtains information regarding print jobs in each printer and the operation conditions and performs operations such as suspending a print job and cancelling a print job. The print service and the job control service exchange print job information and the status of the printer via a software interface API . The print service updates the printer information and the print job information stored in the database where necessary.

In the printer information printer name indicates a printer object name of the printer managed by the print service . The printer name is also set in the print job information which will be described later upon receiving a print request. Port name indicates information for the job control service to identify the printer which is an output printer. IP address indicates the network address of the printer . Responsible print service ID indicates information for identifying a print service that is responsible for the printer from among a plurality of print services. In the present embodiment because the print servers are configured to be able to be redundant if a plurality of print servers cause one printer to perform print processing the order of printing is disordered. For this reason the present embodiment uses a method in which the print service that first received a request sets its identifier in the responsible print service ID of the printer information and deletes the information set in the responsible print service ID upon completion of print processing. Accordingly only one print service uses one printer at a time. The identifier of the print service is information that is generated upon activation of the print service and held by the print service and is uniquely assigned in the print system. As long as one print service is operated in one print server the identifier of the print server may be used as the identifier of the print service. Printer driver name indicates information regarding the printer driver used by the printer specified by the printer information . Upon receiving a print request the print service issues a print command to the printer driver identified by the printer driver name .

Job ID is issued by the job control service upon receiving print data from the job control port monitor notified from the job control service to the print service and then set in the print job information . Status is information indicating job status. Examples of the job status include spooling in progress waiting for transfer transfer in progress transfer completed printing in progress printing completed and error . Each time there is a change the job status is notified from the job control service to the print service and the print job information is updated. Document ID is an ID for specifying a document based on which the print job was generated in the database and is set by the print service . The printer information and the job information associate the print service or print server the printer used by the print service to perform printing and the print job executed by the printer and thus may also be referred to as association information .

In S the print service receives a notification indicating that a failure has occurred in one of the print services that are under control of the load balancer from the monitor server . In the present embodiment the monitor server is configured to hold the identifiers uniquely assigned to the print services that the monitor server is monitoring or in other words monitor targets including the identifier of another print service to which a failure notification is sent and send a notification indicating the occurrence of a failure together with the identifier of the failed print service and identification information for example IP address of the print server executing the failed print service when notifying the print service of the failure. The present embodiment is described assuming that the monitor server sends identifier to the print service but the monitor server can send any information such as the IP address of the print server as long as it is possible to specify the print service. As a result of the identifier of the print service which may be for example a value saved in the database by the print service being notified to another print service the identifier can be known to the other print server. Alternatively the identifier of the print service may be notified to the load balancer such that the load balancer can specify the print service.

In S the print service searches the printer information so as to determine whether the identifier received in S is included in the responsible print service ID of the printer information . In other words a search is performed for a printer for which the failed print service is responsible.

In S if a responsible print service ID that matches the identifier of the failed print service is found as a result of the search performed in S the print service performs processing of S. If a responsible print service ID that matches the identifier of the failed print service is not found the processing ends. The matching or in other words corresponding printer information may also be referred to as the printer information of interest .

In S the print service searches the job information for job information that corresponds to the printer name of the printer information of interest. Prior to S the responsible print service ID of the printer information of interest may be replaced by the identifier of the print service that is executing this processing.

In S if corresponding print job information is found as a result of the search processing performed in S the print service performs processing of S. If there are a plurality of pieces of corresponding print job information the print service repeatedly performs the processing of S and the subsequent steps for each corresponding print job information. If there is no print job information the processing ends.

In S the print service focuses on one corresponding print job information and acquires the status of the print job information of interest. If the status indicates spooling in progress the print service performs processing of S. If the status of the print job information of interest does not indicate spooling in progress the print service performs processing of S.

In S the print service acquires document data corresponding to the document ID of the print job information of interest from the database . In S the print service issues a print instruction to the printer driver based on the document data acquired in S and the printer driver name . At this time upon receiving print job data from the printer driver via the job control port monitor the job control service performs transfer processing for transferring the job data print data to the printer . In addition at this time the print data is also saved.

In S if the status of the print job information of interest indicates waiting to be scheduled the print service performs processing of S. If the status does not indicate waiting to be scheduled the print service performs processing of S.

In S the print service issues to the job control service a cancel request to cancel the print job referred to as the target print job specified by the job information of interest in the printer referred to as the target printer or designated printer specified by the printer information of interest and then performs processing of steps S and S. At this time in response to the cancel request from the print service the job control service issues a cancel instruction to cancel the schedule request to the schedule application of the printer .

In S if the status of the print job information of interest indicates transfer in progress the print service performs processing of S. In S the print service issues to the job control service a cancel instruction to cancel the target print job that is currently being transferred to the printer and performs processing of S and processing of steps S to S. Here in S the job control service stops the transfer processing and in step S cancels the target print job a part of which has already been transmitted to the target printer . The processing performed in S is for example rewriting of the status of the print job information of interest to stop . In S if the status does not indicate transfer in progress or in other words for example if transfer of the print job to the printer has been completed and scheduled including the case where the print job is being executed the job is continuously executed.

In S the print service monitors the job transferred to the printer . At this time the job control service exchanges the job status and the printer status with the schedule application and issues a notification to the print service .

Through the processing described above in the redundant print servers even if a failure occurs in the print service of one of the print servers recovery processing for recovering the failed server can be performed by another print server without sharing of print data in the database or the like.

The present embodiment is different from Embodiment 1 in that processing performed by the print service when the printer has already started printing if the status of the print job indicates transfer in progress is added. Hereinafter the processing of the print service according to the present embodiment will be described with reference to . In the present embodiment the configuration of the system the configuration of each server and the configuration of the printer are the same as those of Embodiment 1.

In S the print service issues a request to acquire paper discharge information impression information to the job control service . The job control service acquires paper discharge information of the print job specified by the job ID from the schedule application .

In S the print service checks the paper discharge information acquired in S and if the number of sheets of paper discharged is 0 the print service then performs processing of S. Note that the default value for the start page from which printing starts is set to 1. If the number of sheets of paper discharged is greater than 0 the print service performs processing of S.

In S the print service designates a value obtained by adding 1 to the acquired number of sheets of paper discharged as the start page. As used herein the start page means the page from which printing starts in the processing performed by the printer .

In S the print service designates the start page and issues a request to generate print data to the printer driver . In the present embodiment a method is used in which the start page is designated at the time of generating print data but it is also possible to use a method in which after generation of print data a portion for designating the start page in the print data is directly edited. Step S can be implemented in the same procedure as for example steps S and S shown in .

It is also possible to skip step S shown in so as to ensure step S to be performed and in S set a value obtained by adding 1 to the number of sheets of paper discharged as the start page. Also if the print start page is not 1 in step S a value obtained by adding the print start page designated when the print request was issued to the number of sheets of paper discharged may be set as the print start page. Also if a print setting such as double sided printing is designated the print setting is reflected and the first page excluding the printed pages is designated as the print start page in S. With this configuration it is possible to respond to various types of print settings.

Through the processing described above even if a failure occurs in a print server and another server performs recovery processing print processing can be performed without making duplicated printouts.

Embodiment s of the present invention can also be realized by a computer of a system or apparatus that reads out and executes computer executable instructions e.g. one or more programs recorded on a storage medium which may also be referred to more fully as a non transitory computer readable storage medium to perform the functions of one or more of the above described embodiment s and or that includes one or more circuits e.g. application specific integrated circuit ASIC for performing the functions of one or more of the above described embodiment s and by a method performed by the computer of the system or apparatus by for example reading out and executing the computer executable instructions from the storage medium to perform the functions of one or more of the above described embodiment s and or controlling the one or more circuits to perform the functions of one or more of the above described embodiment s . The computer may comprise one or more processors e.g. central processing unit CPU micro processing unit MPU and may include a network of separate computers or separate processors to read out and execute the computer executable instructions. The computer executable instructions may be provided to the computer for example from a network or the storage medium. The storage medium may include for example one or more of a hard disk a random access memory RAM a read only memory ROM a storage of distributed computing systems an optical disk such as a compact disc CD digital versatile disc DVD or Blu ray Disc BD a flash memory device a memory card and the like.

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.

This application claims the benefit of Japanese Patent Application No. 2014 083106 filed Apr. 14 2014 which is hereby incorporated by reference herein in its entirety.

