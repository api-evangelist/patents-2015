---

title: Enabling virtual workloads using overlay technologies to interoperate with physical network services
abstract: A solution is provided to enable cloud service provider customers/users to offer physical network services to virtualized workloads that use overlay technologies, such as a Virtual Extensible Local Area Network (VXLAN). For a virtual workload that uses an overlay technology, an identifier is received of a logical network to which the virtual workload connects and a policy for the logical network. Based on the identifier of the logical network and the policy, a gateway is configured to connect traffic for the virtual workload on the logical network to a particular virtual local area network (VLAN) interface of the physical network service equipment on which the policy is configured.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09444644&OS=09444644&RS=09444644
owner: Cisco Technology, Inc.
number: 09444644
owner_city: San Jose
owner_country: US
publication_date: 20150421
---
This application is a continuation of U.S. patent application Ser. No. 13 789 721 filed Mar. 8 2013 which claims priority to U.S. Provisional Application No. 61 736 577 filed Dec. 13 2012. The entirety of these applications is incorporated herein by reference.

Virtualization of workloads has become pervasive and there is a need for customers to be able to use the existing installed base of physical network services such as firewalls load balancers etc. to offer network service capability to the virtualized workloads in the same way as in the physical environment in an on demand dynamic fashion particularly in cloud service provider environments.

In the physical baremetal environment application traffic is assigned to a specific virtual local area network VLAN to be sent to the firewall and the traffic from the firewall is sent on another VLAN for ultimate transmission to the network service. To satisfy the needs of large scale multi tenancy requirements overlay technologies such as Virtual Extensible LANs VXLANs are becoming popular. However there is no easy way to offer physical network services such as firewall services for virtualized workloads using an overlay technology.

A solution is provided to enable cloud service provider customers users to offer physical network services to virtualized workloads that use overlay technologies such as a Virtual Extensible Local Area Network VXLAN . For a virtual workload that uses an overlay technology an identifier is received of a logical network to which the virtual workload connects and a policy for the logical network. Based on the identifier of the logical network and the policy a gateway is configured to connect traffic for the virtual workload on the logical network to a particular virtual local area network VLAN interface of the physical network service equipment on which the policy is configured.

A solution is presented herein that configures a gateway entity and one or more physical networking services so as to extend the physical networking services to virtualized network endpoints.

Reference is first made to which shows a network environment that has virtual network components and physical network service equipment. In the physical network world is on the right side and the virtual network world is on the left side. The physical network service equipment is shown at reference numeral and may include firewall equipment load balancer equipment switches etc. each of which includes physical networking services capabilities. In other words the physical network service equipment is embodied by hardware and supporting software. An example of physical network service equipment is Cisco Systems Inc. s Adaptive Security Appliance ASA 5500 Firewall services. Other examples of physical network service equipment appliances include wide area network WAN acceleration devices WAAS intrusion prevention system IPS devices etc. In physical computing networking architectures segmentation is achieved using virtual local area networks VLANs . Currently physical network services can only be applied on VLAN segments.

On the left side of the diagram there is a virtual switch running in a hypervisor in a data center. The data center and its supporting equipment are not shown in for simplicity. In virtualized multi tenant environments it is becoming common to use Virtual Extensible LANs VXLANs . VXLANs are implemented in hypervisors and can only be used to connect to virtualized endpoints.

VXLAN is a technology to allow for floating virtual domains on top of a common networking and virtualization infrastructure. By leveraging industry standard Ethernet technology large numbers of virtual domains can be created which can be isolated from each other and the underlying network. VXLAN provides the capability to create isolated multi tenant broadcast domains across data center fabrics allowing for the creation of logical networks that span physical network boundaries.

VXLAN can be used to abstract a network into a generalized pool of network capacity. The use of these services can be separated from the underlying physical infrastructure. This pool can span physical boundaries optimizing compute resource utilization across clusters pods and even geographically separated datacenters. The pool of network capacity can be segmented into logical networks directly associated with specific applications.

VXLAN operates by creating Layer 2 logical networks that are encapsulated in standard Layer 3 IP packets. A Segment ID in every frame differentiates the individual logical networks VXLANs from each other. Numerous isolated Layer 2 VXLAN networks can therefore co exist on a common Layer 3 infrastructure.

An example of another overlay technology that may be used as an alternative to VXLAN is Network Virtualization using Generic Routing Encapsulation NVGRE .

A virtual service is in communication with the virtual switch . Examples of a virtual service include a Virtual Security Gateway VSG that serves as a virtual firewall appliance providing trusted access to virtual data center and cloud environments a Virtual Wide Area Application Services vWAAS for application acceleration in private and public cloud environments and a cloud router. There are virtual workloads e.g. virtual machines shown at reference numeral in that are running on the hypervisor .

The arrangement shown in enables cloud service provider customers to offer physical network services e.g. firewall services of the physical network service equipment to the virtualized workloads that connect to the network using overlays e.g. VXLAN via the VXLAN VLAN gateway in an on demand dynamic fashion through the CMP . This is depicted in a more isolated manner in the paradigm shown in .

Reference is now made to that illustrates a flow chart depicting operations to provision the physical network service equipment for multiple tenants. Reference is made to in connection with the description of the flow chart of . At step the physical services manager provisions the physical network service equipment with a service context for each tenant. At step the physical services manager of the CMP configures the physical network service equipment with multiple policies each with a policy id. Each policy is configured within the service context for the particular tenant. One VLAN is associated with each policy. Thus VLAN id1 is for policy id1 VLAN id2 is for policy id2 and so on. Each policy is applied to data received on or sent to a corresponding specific VLAN interface. A tenant may have multiple logical networks e.g. VLANs. As one example a physical network service equipment can scale to 1000 VLANs and 250 contexts.

A tie in is built between the VXLAN segment id that a virtual machine VM is using with the VLAN that is needed to transport the traffic to the appropriate context that is configured in the physical network service equipment e.g. a firewall context in the case where the physical network service equipment is a firewall.

Turning now to a flow chart is provided that sets forth in more detail the setup to enable the techniques presented herein. and are also referred to in connection with the description of . illustrates an example of a mapping between logical networks e.g. VXLAN segments in the virtual network world and VLANs in the physical network world.

Each VM is created within a tenant container. At step through the physical services manager a customer provisions the physical network service equipment with a context for each tenant. Tenant VM policies are configured within each context. One or more VLANs may be associated with each context. Thus each context contains multiple VLAN interfaces each with its own policy configuration.

At using the CMP a user customer acting on behalf of a tenant defines a policy for each logical network e.g. VXLAN to which VMs connect. This policy is to be enforced by the physical network service equipment .

At the CMP sends the logical network identifier tenant id and policy information VXLAN segment id tenant id policy to the physical services manager . At the physical services manager configures the VXLAN VLAN gateway to connect the VXLAN segment to the VLAN id on which the policy will be applied. At the physical services manager defines the policy on the physical network service equipment within the given tenant s service context and instructs it to apply it on the VLAN id to which the VXLAN segment is connected. The VXLAN VLAN gateway bridges traffic between a particular VXLAN segment id e.g. VXLAN 5500 and a VLAN id e.g. VLAN 55 . In this example VLAN 55 belongs to a particular context. The contexts and the associated security policies may be pre provisioned in the physical network service equipment .

The CMP will send this information VXLAN segment id VLAN id context name to the physical services manager which in turn configures the VXLAN VLAN gateway for the VXLAN to VLAN mapping and the physical services network equipment for the VLAN to the context name mapping.

Once this is setup the VMs that connect to the network will send their traffic on that specific VXLAN segment id through the virtual switch and to the VXLAN VLAN gateway . The VXLAN VLAN gateway will bridge that traffic to the correct VLAN as defined in the mapping. The physical network service equipment will apply the appropriate policy to the traffic as defined in the VLAN context mapping. This process does not require any changes to the existing physical network service equipment .

Reference is now made to with continued reference to for a description of a process similar to that depicted in but used when the physical network service equipment is preconfigured with its policies etc. At the physical network service equipment e.g. a firewall is preconfigured with the appropriate policies e.g. security load balancing etc. each with the corresponding tenant context and VLAN id. At this information is published to the CMP via the physical services manager using an integration mechanism between the physical services manager and the CMP . At a pool of logical networks e.g. VXLAN based networks for each tenant is configured in the CMP . At when a network is allocated from a particular tenant s network pool a corresponding policy is selected using the CMP . At using Application Programming Interfaces APIs between the CMP and physical services manager the tuple of policy identifier for the selected policy and VXLAN segment identifier is passed to the physical services manager . At based on the VXLAN segment identifier and policy identifier the physical services manager configures the VXLAN VLAN gateway to connect the VXLAN segment to the corresponding VLAN on which the policy is preconfigured on the physical network service equipment .

Turning now to a block diagram is shown for a computing apparatus in which may reside software instructions for performing the functions of the physical services manager . This same computing apparatus may also include software instructions for the CMP and the virtual services manager . The computing apparatus shown at reference numeral comprises a processor a bus memory a network interface unit and one or more user interface devices such as a keyboard and display . The processor is a microcontroller or microprocessor that executes instructions stored in memory . The network interface unit enables network communications to and from the computing apparatus .

The memory may comprise read only memory ROM random access memory RAM magnetic disk storage media devices optical storage media devices flash memory devices electrical optical or other physical tangible memory storage devices. Thus in general the memory may comprise one or more tangible non transitory computer readable storage media e.g. a memory device encoded with software comprising computer executable instructions and when the software is executed by the processor it is operable to perform the operations described herein. More specifically stored encoded in memory are instructions for physical services manager process logic that when executed by processor cause the processor to perform the operations described herein for the CMP virtual services manager and physical services manager in connection with .

In summary the foregoing solution provides for automated on demand provisioning to leverage the installed base of physical network services. From a method perspective a method is providing in which for a virtual workload that uses an overlay technology receiving an identifier of a logical network to which the virtual workload connects and a policy for the logical network and based on the identifier of the logical network and the policy configuring a gateway to connect traffic for the virtual workload on the logical network to a particular VLAN interface of the physical network service equipment on which the policy is configured.

This method may be embodied or implemented by computer executable instructions stored or encoded in a computer readable storage media wherein the instructions are operable to for a virtual workload that uses an overlay technology receive an identifier of a logical network to which the virtual workload connects and a policy for the logical network and based on the identifier of the logical network and the policy configure a gateway to connect traffic for the virtual workload on the logical network to a particular VLAN interface of the physical network service equipment on which the policy is configured.

Further still an apparatus such as a computing apparatus may be configured to perform these techniques. The apparatus comprises a network interface unit configured to enable network communications a memory and a processor coupled to the network interface unit and the memory wherein the processor is configured to for a virtual workload that uses an overlay technology receive an identifier of a logical network to which the virtual workload connects and a policy for the logical network and based on the identifier of the logical network and the policy configure a gateway to connect traffic for the virtual workload on the logical network to a particular VLAN interface of the physical network service equipment on which the policy is configured.

