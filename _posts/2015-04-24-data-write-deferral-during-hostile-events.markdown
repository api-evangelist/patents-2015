---

title: Data write deferral during hostile events
abstract: Technology is disclosed for deferring storage operations (e.g., writes or reads) during hostile events. When a data storage device experiences a hostile event, e.g., a vibration, shock, etc. contact by a head of the data storage device with a disk surface can cause errors or indeed damage. The technology can cause a data storage device to suspend storage operations until the hostile event is no longer detected.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09431061&OS=09431061&RS=09431061
owner: NetApp, Inc.
number: 09431061
owner_city: Sunnyvale
owner_country: US
publication_date: 20150424
---
Several of the disclosed embodiments relate to data storage and more particularly to data storage architecture for enhanced storage resiliency during hostile events.

Commercial enterprises e.g. companies and others gather store and analyze an increasing amount of data. The trend now is to store and archive almost all data before making a decision on whether or not to analyze the stored data. Although the per unit cost associated with storing data has declined over time the total costs for storage has increased for many companies because of the volumes of stored data. Hence it is important for companies to find cost effective ways to manage their data storage environments for storing and managing large quantities of data.

In response data storage drive e.g. magnetic hard disk drive manufacturers have increased data storage capacity by using various innovative techniques including increasing the number of platters and the density of tracks and sectors on one or both surfaces of the platters. A platter is commonly a circular disk having one or both sides of a rigid substrate coated with a magnetic medium on which data is stored. Data storage devices typically have several platters that are mounted on a common spindle. Each side on which data is stored commonly has an associated read head and a write head or sometimes a common read write head. The platters are rotated rapidly within the data storage device about the spindle and an actuator moves heads toward or away from the spindle so that data can be written to or read from tracks. A track is a circular path on the magnetic surface of the platters. One way of increasing data storage capacity is to have very narrow tracks and to place heads very close to the surface of the platter e.g. micrometers also microns away. However because it takes more energy to write data than to read data e.g. because the magnetic surface of platters must be magnetized to store data data storage drive manufacturers inserted a buffer track between tracks storing data so that a wider track can be written to than read from. The buffer tracks could be magnetized when tracks on either side of the buffer tracks data tracks were written to but read heads would only read from data tracks and ignore buffer tracks. However buffer tracks decrease available space on platters.

To avoid wasting space on buffer tracks a new technique employed by the industry is shingled magnetic recording SMR . SMR is a technique to increase capacity used in hard disk drive magnetic storage. Although conventional data storage devices as described above record data by writing non overlapping magnetic tracks parallel to each other SMR involves writing new tracks that overlap part of the previously written magnetic track leaving the previous track thinner thereby allowing for higher track density. The SMR tracks partially overlap in a manner similar to roof shingles on a house. Shingled magnetic recording is expected to increase hard disk capacity by about 25 as compared to non shingled storage.

However if there exist hostile environmental events e.g. vibrations mechanical shocks etc. use of SMR could lead to increased data corruption as compared to existing write techniques because not only could data in the track being written to become corrupt but possibly also data in previously written adjacent tracks.

Technology is described for deferring write operations to be performed by a data storage system when hostile environmental conditions are detected. In various embodiments the technology includes one or more sensors e.g. vibration sensors that detect a hostile environmental event e.g. a vibration. When the vibration is detected e.g. exceeding a specified threshold a processor associated with the data storage system suspends write operations e.g. until the event is no longer detected. In various embodiments the hostile environmental conditions can be detected using various sensors e.g. vibration sensors accelerometers or even moisture electo magnetic field or other environmental sensors. In typical use vibration sensors and or accelerometers can detect movement. When the detected movement exceeds a specified threshold a processor associated with the data storage system can command one or more data storage devices to suspend pending write operations. For example the processor can command all data storage devices that are proximate to one another e.g. co located in a cabinet shelf or rack of a data storage system to suspend the write operations. In another example the processor can command individual data storage devices that are proximate to the sensor that detected a hostile condition. The data storage system can temporarily store log write operations it receives e.g. in storage that is not susceptible to errors caused by vibration e.g. in a system random access memory e.g. non volatile memory solid state storage device etc. e.g. while the write operations are suspended. After the environmental condition returns to a state not exceeding the threshold e.g. an acceptable range the data storage system can return to a normal state the data storage devices that had been commanded to suspend write operations transfer the logged write operations to the data storage devices and then continue to forward additional write operations to the data storage devices.

During the time that a data storage device has been commanded to suspend write operations the data storage system may or may not be able to complete read operations. As an example if the processor detects that there is a risk that any operation could result in physical damage to a data storage device e.g. because a head may come in physical contact with a platter the processor can suspend all operations. On the other hand if the processor detects that there is little risk that a read physical operation could result in physical damage to a data storage device but a greater than normal risk that a write operation could result in error the processor can suspend write operations but continue with read operations. Thus the technology may have three states of operation and different threshold values for environmental conditions that determine in which state to operate 1 normal 2 read only or 3 neither read nor write.

In various embodiments the technology can receive at the data storage system a command to perform a write operation cause a data storage device to perform a write operation detect during the write operation performed by the data storage device a signal indicating that a vibration is detected suspend the write operation until the signal stops and continue after the signal stops the write operation. The technology can suspend the write operation if the detected signal exceeds a specified threshold. As an example if the vibration detector detects a vibration that exceeds a specified threshold a processor can suspend write operations directed to an affected data storage device. As another example if the vibration detector detects a vibration that exceeds a different specified threshold e.g. a higher threshold value the processor can suspend read and or write operations directed to the affected data storage device. The data storage device can be a high capacity magnetic data storage device e.g. a data storage device that employs very high density tracks and or a shingled magnetic recording technique. In various embodiments the technology may be employable with other types of data storage devices e.g. optical disc drives magnetic tape drives that write multiple tracks to tapes etc.

In various embodiments the sensor that detects environmental conditions e.g. a vibration detector may be associated with a device and or software that provides exposes an application program interface also known as an application programming interface or simply as API . As an example data storage devices commonly include an interface to enable attached devices e.g. the data storage system with which the data storage device is associated to receive commands return data indicate status etc. Data storage devices having or modified to have an environmental condition sensor e.g. vibration sensor accelerometer etc. can employ this interface to indicate the detected environmental condition. As examples the interface can raise a flag cause an interrupt or simply return a value indicating the present condition. In various embodiments the application program interface can indicate a value or range for the environmental condition or can receive threshold values and indicate that a specified threshold value has been exceeded. One having ordinary skill in the art would understand that the application program interface can have various combinations of properties and methods.

In various embodiments the environmental condition sensor also referred to herein as detector can be associated with a shelf of a data storage system. Cabinets of data storage systems typically have multiple shelves and each shelf typically has multiple data storage devices. When a first shelf associated with a data storage system experiences a risky environmental condition but a second shelf does not a processor associated with the data storage system can command all data storage devices of the first shelf to suspend read and or write operations but not transmit that command to data storage devices of the second shelf. In various embodiments the environmental condition sensor can be associated with an entire cabinet. In such embodiments the data storage system may suspend operations to all data storage devices of the cabinet.

The storage devices of the storage system can be organized as storage shelves and storage racks where each storage rack includes a number of storage shelves and each storage shelf includes a number of storage devices. The storage racks shelves devices can be distributed across various geographical locations.

The storage shelf further includes control circuitry that manages the power supply of the storage shelf the data access to and from the data storage devices and other storage operations to the data storage devices . The control circuitry may implement each of its functions as a single component or a combination of separate components.

As shown the storage shelf is adapted as a rectangular prism that sits on an elongated surface of the rectangular prism. Each of the data storage devices may be stacked within the storage shelf . For example the data storage devices can stack on top of one another into columns. The control circuitry can stack on top of one or more of the data storage devices and one or more of the data storage devices can also stack on top of the control circuitry .

In various embodiments the enclosure shell encloses the data storage devices without providing window openings to access individual data storage devices or individual columns of data storage devices. In these embodiments each of the storage shelves is disposable such that after a specified number of the data storage devices fail the entire storage shelf can be replaced as a whole instead of replacing individual failed data storage devices . Alternatively the storage shelf may be replaced after a specified time e.g. corresponding to an expected lifetime.

The illustrated stacking of the data storage devices in the storage shelf enables a higher density of standard disk drives e.g. 3.5 inch disk drives in a standard shelf e.g. a 19 inch width rack shelf . Each storage shelf can store ten of the standard disk drives. In the cases that the data storage devices are disk drives the storage shelf can hold the disk drives flat such that the spinning disks are parallel to the gravitational field.

The storage shelf may include a handle on one end of the enclosure shell and a data connection port not shown on the other end. The handle is attached on an outer surface of the enclosure shell to facilitate carrying of the storage shelf . The enclosure shell exposes the handle on its front surface. For example the handle may be a retractable handle that retracts to fit next to the front surface when not in use.

In some embodiments the storage shelf can include a sensor component that is configured to detect environmental conditions and transmit indications of the detected environmental conditions e.g. to a processor not illustrated . Examples of the sensor component can include e.g. a vibration sensor or detector accelerometer etc. The sensor component can include other electrical mechanical and or electromechanical structures or sub components e.g. to sense hostile environmental conditions and communicate the detected conditions.

In some embodiments the rack can include a sensor component that is configured to detect environmental conditions and transmit indications of the detected environmental conditions e.g. to a processor not illustrated . Examples of the sensor component can include e.g. a vibration sensor or detector accelerometer etc. The sensor component can include other electrical mechanical and or electromechanical structures or sub components e.g. to sense hostile environmental conditions and communicate the detected conditions.

The standard components of a hard disk data storage device are also illustrated a front bezel is attached to a mounting chassis . Also attached to the mounting chassis can be a sealed chamber an antivibration mount a printed circuit board and various electrical connectors . Although an IDE type connector is illustrated one skilled in the art will recognize that other connector types are also currently employed e.g. SATA SAS SCSI and so forth. The sealed chamber can include one or more disk platters a head arm and a head actuator . Other embodiments may include multiple of these components. Attached to the head arm can be multiple read write heads e.g. one per readable writable surface of the disk platter .

In various embodiments the system may take different actions depending on which of multiple data storage devices is affected by the hostile condition. For example operations can be suspended for affected data storage devices but not unaffected data storage devices. Alternatively operations can be redirected from affected data storage devices to unaffected data storage devices e.g. write operations or read operations when data is redundantly available. One skilled in the art will recognize that other variations are possible.

The memory and storage devices are computer readable storage media that may store instructions that implement at least portions of the described technology. In addition the data structures and message structures may be stored or transmitted via a data transmission medium such as a signal on a communications link. Various communications links may be used such as the Internet a local area network a wide area network or a point to point dial up connection. Thus computer readable media can include computer readable storage media e.g. non transitory media and computer readable transmission media.

The instructions stored in memory can be implemented as software and or firmware to program the processor s to carry out actions described above. In some embodiments such software and or firmware may be initially provided to the computing system by downloading it from a remote system to the computing system e.g. via network adapter .

The technology introduced herein can be implemented by for example programmable circuitry e.g. one or more microprocessors programmed with software and or firmware or entirely in special purpose hardwired non programmable circuitry or in a combination of such forms. Special purpose hardwired circuitry may be in the form of for example one or more ASICs PLDs FPGAs etc.

The above description and drawings are illustrative and are not to be construed as limiting. Numerous specific details are described to provide a thorough understanding of the disclosure. However in some instances well known details are not described in order to avoid obscuring the description. Further various modifications may be made without deviating from the scope of the embodiments. Accordingly the embodiments are not limited except as by the appended claims.

Reference in this specification to one embodiment or an embodiment means that a particular feature structure or characteristic described in connection with the embodiment is included in at least one embodiment of the disclosure. The appearances of the phrase in one embodiment in various places in the specification are not necessarily all referring to the same embodiment nor are separate or alternative embodiments mutually exclusive of other embodiments. Moreover various features are described which may be exhibited by some embodiments and not by others. Similarly various requirements are described which may be requirements for some embodiments but not for other embodiments.

The terms used in this specification generally have their ordinary meanings in the art within the context of the disclosure and in the specific context where each term is used. Some terms that are used to describe the disclosure are discussed below or elsewhere in the specification to provide additional guidance to the practitioner regarding the description of the disclosure. For convenience some terms may be highlighted for example using italics and or quotation marks. The use of highlighting has no influence on the scope and meaning of a term the scope and meaning of a term is the same in the same context whether or not it is highlighted. It will be appreciated that the same thing can be said in more than one way. One will recognize that memory is one form of a storage and that the terms may on occasion be used interchangeably.

Consequently alternative language and synonyms may be used for any one or more of the terms discussed herein nor is any special significance to be placed upon whether or not a term is elaborated or discussed herein. Synonyms for some terms are provided. A recital of one or more synonyms does not exclude the use of other synonyms. The use of examples anywhere in this specification including examples of any term discussed herein is illustrative only and is not intended to further limit the scope and meaning of the disclosure or of any exemplified term. Likewise the disclosure is not limited to various embodiments given in this specification.

Those skilled in the art will appreciate that the logic illustrated in each of the flow diagrams discussed above may be altered in various ways. For example the order of the logic may be rearranged substeps may be performed in parallel illustrated logic may be omitted other logic may be included etc.

Without intent to further limit the scope of the disclosure examples of instruments apparatus methods and their related results according to the embodiments of the present disclosure are given below. Note that titles or subtitles may be used in the examples for convenience of a reader which in no way should limit the scope of the disclosure. Unless otherwise defined all technical and scientific terms used herein have the same meaning as commonly understood by one of ordinary skill in the art to which this disclosure pertains. In the case of conflict the present document including definitions will control.

