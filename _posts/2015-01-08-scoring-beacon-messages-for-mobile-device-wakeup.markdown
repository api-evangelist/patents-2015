---

title: Scoring beacon messages for mobile device wake-up
abstract: Techniques and systems for scoring beacon messages and selectively performing mobile device wake-up on a score are disclosed. Such a technique can include receiving, at a mobile device in a first operational state, a beacon message from a beacon device over a short-range communication link; determining a score based on the beacon message and one or more criteria for causing a transition from the first operational state to a second operational state, the second operational state consumes more energy from a battery of the mobile device than the first operational state; determining whether the score exceeds a threshold for causing the transition; if the score does not exceed the threshold, maintaining the mobile device in the first operational state; and if the score exceeds the threshold, transitioning the mobile device to the second operational state and presenting the beacon message through the mobile device in the second operational state.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09456416&OS=09456416&RS=09456416
owner: Apple Inc.
number: 09456416
owner_city: Cupertino
owner_country: US
publication_date: 20150108
---
This patent document claims the benefit of the priority of U.S. Provisional Patent Application No. 62 057 581 filed on Sep. 30 2014. The above identified application is incorporated herein by reference in its entirety.

Many modern mobile devices e.g. a smart phone tablet computer wearable computer include one or more radio frequency receivers transmitters or transceivers that allow one way or two way communications with other devices. For example a mobile device can use a transceiver to communicate with a server on the Internet via a base station of a wireless network. In another example a mobile device can include a receiver to receive low powered RF signals from devices such as RF beacons.

Techniques and systems for scoring beacon messages for mobile device wake up determination are disclosed. A mobile device operating in a beacon equipped operating environment can be configured to receive one or more beacon messages from one or more beacon devices and score them. In some cases the mobile device may be in an operational state such as a low activity state e.g. sleep state when a beacon message is received and scored. Based on a beacon message score and a wake up threshold the mobile device can determine whether to transition to an operational state that is configured for a presentation of the beacon message. In some implementations the mobile device can transition to a nominal operational state in which content corresponding to the beacon message can be displayed on a screen. If the mobile device is already in the nominal operational state the mobile device can remain in the nominal operational state to present the beacon message provided that the score exceeds the wake up threshold.

A mobile device operating system can in some implementations run an application that monitors for beacon messages while the mobile device is in a low activity state or while the screen of the mobile device is powered off or both. In some implementations the application can monitor and score beacon messages as a background process. The application can determine whether to wake up the mobile device to display a received beacon message based on a scoring mechanism. However if too many beacon messages are received by the mobile device and the mobile device is continually waking up to process the beacon messages significant drain on the mobile device battery may occur. For example if the mobile device user works in a mall having one or more beacon equipped stores the user may frequently pass by a beacon equipped store throughout the day and the user s mobile device may wake up each time the user passes the store due to proximity of the mobile device to a beacon device in the store. This and other scenarios can be mitigated by using a smart wake up process where the application or operating system of the mobile device can be configured to manage the frequency of wake ups using a score that accounts for wake up frequency and context among other things. In some implementations the score can be based on how many times the mobile device has awakened within a time period e.g. minute s hour s or day s .

In some implementations a mobile device application for interacting with a beacon equipped operating environment can be configured to receive multiple different beacon messages and intelligently prioritize a presentation of the received beacon messages through the mobile device. Beacon messages can be prioritized based on their scores. For example higher scores can be assigned to higher priority levels. In some implementations beacon messages can be scored based on one or more rule sets priority preferences priority configurations proximity of the mobile device to beacon devices user or environment context timing message frequency inter beacon border rules and the like. For example in a beacon equipped retail store an initial welcome to the store beacon message may be repeatedly received by a customer s mobile device from a beacon device near a store entrance but is desired by the store operator to be displayed on the mobile device only once in a given time period e.g. once per day so as not to annoy the customer with redundant displays of the same welcome message.

When the customer walks through a beacon equipped environment with his mobile device beacon messages broadcast from beacon devices throughout the environment can be received and prioritized by an application or operating system running on the user s mobile device and based on the prioritization are selectively presented e.g. displayed through the user s mobile device. Message priority can be determined based on one or more factors. In some implementations message priority can be based on proximity to a beacon device where messages broadcast from nearby beacon devices have a higher priority than messages broadcast from beacon devices farther away. In some implementations message priority can be determined based on context such as a user s reason for visiting the environment. In some implementations a message priority can be determined based on context and proximity. Context information can include a user s activities before arriving to the environment e.g. ordered a product to pick up scheduled an in store consultation scheduled a repair drop off pick up or what a user is doing while in the environment e.g. the type of mobile device being used the type of device the user is interacting with can be used to determine message priority.

In some implementations message priority can be based on inter beacon border rules. For example if a user s mobile device is receiving messages from more than one beacon device then inter beacon border rules can be used to determine which beacon message to present first. Some implementations can use priority stickiness to determine how to prioritize the presentation of competing beacon messages. For example if a user s mobile device is receiving a signal from a first beacon device and someone walks between the mobile device and the first beacon device the signal from that first beacon device may become weaker than a signal from a second beacon device. Instead of immediately switching to displaying beacon messages from the second beacon device an application or operating system running on the mobile device determines whether to present messages from the second beacon device rather than messages from the first beacon device. The decision can be based on length of time the signal strength dropped the magnitude of the change in signal strength and or other factors and contexts.

In some implementations message priority can be based on a history of previously presented messages including tracking a number of times a message has been presented to a mobile device user. For example if a beacon message has already been presented then the beacon message should not be presented again unless there is an overriding factor present e.g. new day phone reset retail store application restart etc. Beacon devices can continuously broadcast the same message throughout the day or can alternate among a group of messages. An application on a mobile device can filter the beacon messages and only present one or more pertinent messages which are based on the determined message priority. The application or operating system of the mobile device can dynamically update message priorities based on continuously changing information such as changes in a received signal strength indicator RSSI due to the user moving about in the store.

A technique for scoring beacon messages for mobile device wake up can include receiving at a mobile device in a first operational state a beacon message from a beacon device over a short range communication link determining a score based on the beacon message and one or more criteria for causing a transition from the first operational state to a second operational state the second operational state consumes more energy from a battery of the mobile device than the first operational state determining whether the score exceeds a threshold for causing the transition if the score does not exceed the threshold maintaining the mobile device in the first operational state and if the score exceeds the threshold transitioning the mobile device to the second operational state and presenting the beacon message through the mobile device in the second operational state. Other implementations are directed to systems devices and computer readable storage mediums.

These and other implementations can include one or more of the following features. Transitioning the mobile device to the second operational state can include activating a screen of the mobile device. Presenting the beacon message can include displaying content corresponding to the beacon message on the screen. Implementations can include tracking in a period of time a number of transitions that the mobile device transitions to the second operation state to present one or more beacon messages wherein the score is based on the number of transitions. In some implementations the score is based on whether content from the beacon message has been previously received presented through the mobile device or both. In some implementations the score is based on a charge level of the battery. Implementations can include running an application as a background process on the mobile device the application being configured to determine the score. Transitioning the mobile device to the second operational state can include operating the application to transition to a foreground process on the mobile device and display content corresponding to the beacon message on a display of the mobile device. Implementations can include determining a range estimation between the mobile device and the beacon device based on a received signal strength value corresponding to the beacon message where the score is based on the range estimation. Determining the score can include determining whether there is a pre existing reason for visiting a business establishment associated with the beacon device.

A system for providing beacon based applications can include a network interface configured to communicate with mobile devices and processor electronics configured to store applications including an application for download to the mobile devices via the network interface. The application can include instructions to cause a mobile device to perform operations. The operations can include receiving in a first operational state a beacon message from a beacon device over a short range communication link determining a score based on the beacon message and one or more criteria for causing a transition from the first operational state to a second operational state wherein the second operational state consumes more energy from a battery of the mobile device than the first operational state determining whether the score exceeds a threshold for causing the transition if the score does not exceed the threshold maintaining the mobile device in the first operational state and if the score exceeds the threshold transitioning the mobile device to the second operational state and presenting the beacon message through the mobile device in the second operational state. In some implementations the application is configured to run as a background process while the mobile device is in the first operational state. Transitioning the mobile device to the second operational state can include operating the application to transition from the background process to a foreground process on the mobile device and display content corresponding to the beacon message on a display of the mobile device.

A mobile device can include circuitry configured to receive a beacon message from a beacon device over a short range communication link the beacon devices being within a vicinity of an establishment the beacon messages being configured to provide content associated with the establishment and a processor configured to perform operations. The operations can include receiving in a first operational state the beacon message via the circuitry determining a score based on the beacon message and one or more criteria for causing a transition from the first operational state to a second operational state wherein the second operational state consumes more energy from a battery of the mobile device than the first operational state determining whether the score exceeds a threshold for causing the transition if the score does not exceed the threshold maintaining the mobile device in the first operational state and if the score exceeds the threshold transitioning the mobile device to the second operational state and presenting the beacon message through the mobile device in the second operational state.

Particular implementations disclosed herein provide one or more of the following advantages. Scoring beacon messages can enhance a user s experience with an application that provides an interactive experience with a beacon equipped environment. Scoring beacon messages and filtering out low scoring messages can reduce energy consumption by a mobile device and thereby extend the time between battery charging operations.

The details of the disclosed implementations are set forth in the accompanying drawings and the description below. Other features objects and advantages are apparent from the description drawings and claims.

In some environments a mobile device can be barraged by beacon messages which can lead to increased battery drain due to having to wake up and present them. A mobile device for example can be barraged by beacon messages from multiple beacon devices at the same or over a short period of time or can be barraged by multiple beacon messages from the same beacon device over a longer period of time. Typically useful information can be obtained through a presentation of a beacon message. However the degree of usefulness can vary and moreover can be useful to some and not useful to others. For instance if a mobile device user works nearby he may frequently pass by the retail store throughout the day and his mobile device may be waking up each time he passes due to repeated reception of messages from the beacon device . In contrast a mobile device user may enter the retail store and be interested in having his mobile device present the beacon messages. To handle these different scenarios a mobile device can perform a wake up determination process. Such a process can include receiving a beacon message at a mobile device and determining whether to wake up in order to present the beacon message through the mobile device . Determining whether to wake up can include computing a beacon message score and comparing the score to a wake up threshold value. If too many beacon messages are being received by a mobile device and it is continually waking up to present them increased battery drain may result. Thus a wake up determination process can be used to prevent battery drain by managing the frequency of device wake ups. Managing the frequency of device wake ups can include limiting beacon based wake ups to high scoring messages. In some implementations a beacon message score can be based on proximity to a beacon device wake up frequency message context message content battery charge level or a combination thereof. In some implementations a beacon message score can be based on how many times the mobile device has been woken in a period of time such as a minute hour day or week. Note that different mobile devices can make separate determinations of a score for a beacon message received from the beacon device

The beacon devices can be configured locally or remotely over a network to transmit messages that provide information related to the retail store or events e.g. advertising campaigns occurring at the retail store . For example beacon device can transmit a store welcome message and beacon device can transmit a special offer message . In some implementations a beacon message includes a message number that the retail store application can map to content such as a text message for display on a screen of the mobile device . In some implementations the content e.g. a database table can be downloaded from a network based server computer to the mobile device when the user first enters the retail store .

In some implementations the retail store can include beacon equipped product demonstration tables . For example a table can include a product display area and product information placards having beacon devices configured to broadcast respective beacon messages corresponding to the respective products identified by the placards . In some implementations such beacon messages provide additional information about the respective products. In some implementations such beacon messages trigger a process for the user to order or customize the product using the retail store application. In some implementations the beacon devices can be fixed to or embedded inside of the information placards . If a user taps or swipes a mobile device on or near one of the beacon devices thereby selecting the product model associated with the corresponding placard the retail store application causes a display of a message associated with the user selected one of the placards i.e. beacon devices . The retail store can include additional tables each equipped with beacon devices that are configured to broadcast beacon messages associated with the respective products being displayed on the tables . Further the retail store can include a customer care center that is equipped with a beacon device that is configured to broadcast a beacon message associated with the center .

The beacon devices and the mobile devices can use a short range radio technology such as Bluetooth or a near field communication NFC technology for broadcasting and or receiving beacon messages. In some implementations the beacon devices can use a specific type of Bluetooth called Bluetooth low energy BLE . A wireless communication range of the beacon devices can be between 10 to 30 meters. Other ranges are possible. When a mobile device is within a wireless communication range of a beacon device it can receive a corresponding beacon message.

Various examples of mobile devices include smartphones tablet computers notebook computers or wearable computers. In some implementations the mobile devices can include a wireless receiver or transceiver that can scan the environment for beacon messages from other devices such as beacon devices in the environment . For example a mobile device can include a BLE receiver that scans for beacon messages. The mobile devices can communicate with servers using a base station of a wireless network such as one based on Long Term Evolution LTE or Code Division Multiple Access CDMA e.g. CDMA2000 and Wideband CDMA WCDMA . Other types of wireless networks are possible.

The process determines a score based on the beacon message and one or more criteria for causing a transition from the low activity operational state to a nominal operational state . Various examples of criteria include but are not limited to battery based criteria proximity based criteria context based criteria content based criteria and timing criteria. Other types of criteria are possible. A score can be a numerical value. In some implementations using context based criteria can include determining whether there is a pre existing reason for a visit to a store associated with the beacon message. In some implementations using content based criteria can include determining a content based priority level associated with the beacon message. In some implementations using battery based criteria can include determining a charge level associated with a battery of the mobile device. In some implementations a score can be lowered if the battery is in a low charge level range. For example it would take a message with a higher content based priority level to compensate for a battery being in a low charge level range.

In some implementations the process can determine a score based on one or more proximity based criteria such as a range estimation between the mobile device and a beacon device. Estimating the range between the mobile device and a beacon device can include using one or more received signal strength values corresponding respectively to one or more beacon messages. In some implementations process collects RF signal measurements for two or more beacon messages that have the same type or content computes RSSI values for each of these beacon messages and performs an average over the RSSI values to compute an average RSSI value. In some implementations an RSSI can be mathematically defined as being approximately a ratio of the power of a received signal and a reference received power e.g. 1 mW where the higher the RSSI number or less negative the stronger the signal. In some implementations a RSSI value can be expressed in dBm. Based on a predetermined transmission power for transmitting beacon messages range estimation can be computed based on the RSSI value. Determining range estimations can include using channel quality information such as a bit error rate BER or a packet error rate PER derived from a received beacon message. In some implementations a beacon message from a beacon device that is closer to the mobile device can produce a higher score than a message from a beacon device that is farther away from the mobile device.

The process determines whether the score exceeds a threshold . If the score does not exceed the threshold the process maintains the mobile device in the low activity operational state . Maintaining the mobile device in the low activity operational state can include keeping the mobile device in a low power state. Maintaining the mobile device in the low activity operational state can include not presenting the beacon message to a user of the mobile device. In some implementations maintaining the mobile device in the low activity operational state can include disregarding the beacon message such that it is not displayed on a screen of the mobile device. However the process can store information based on a received beacon message whether disregarded or not in a data structure for use in determining a score for a subsequently received message. For example a score can be based on a frequency of reception of beacon messages that have the same content.

If the score exceeds the threshold the process transitions the mobile device to the nominal operational state . The nominal operational state can consume more energy from a battery of the mobile device than the low activity operational state. For example the low activity operational state can be a sleep state in which a screen of the mobile device can be off or in a low power mode e.g. a backlight of the display is off. The nominal operational state can be a state in which a screen of the mobile device is powered on e.g. a backlight of the display is activated. In some implementations transitioning the mobile device to the nominal operational state can include activating a screen of the mobile device. In some implementations transitioning the mobile device to the nominal operational state can include activating an audio and or force feedback mechanism of the mobile device. In some implementations transitioning the mobile device to the nominal operational state can include increasing a clock frequency of a mobile device processor.

Based on the transition the process presents the beacon message through the mobile device in the nominal operational state . Presenting the beacon message can include displaying information corresponding to the beacon message on a screen of the mobile device. In some implementations presenting the beacon message can include providing one or more notifications. A presentation of a beacon message can include a force feedback e.g. vibration indication audio output e.g. beep music etc. visual output e.g. flashing light or a combination thereof. In some implementations beacon messages can include any content including but not limited to text graphics digital images audio video and animation. Beacon messages can be presented on the mobile device in the form of audio output to work with mobile devices without display capability or to assist visually impaired users. In some implementations presenting the beacon message can include retrieving content corresponding to one or more values included in the beacon message and displaying the content on the screen.

In the format includes a beacon identifier activity parameter application identifier and a user message . The application identifier can identify an application running on the mobile device for handling the beacon message upon reception at a mobile device. For example an operating system running on the mobile device can use the application identifier to forward the beacon message to an application corresponding to the application identifier . In some implementations if the application is not already installed on the mobile device a browser can be launched on the mobile device and direct the user e.g. using a URL to a website where the user can download and install the application corresponding to the application identifier . In some implementations the application can be downloaded automatically without user intervention in a manner that is transparent to the user e.g. as a background process . In some implementations if the application is installed but not running on the mobile device the application can be launched automatically by the operating system running on the mobile device to receive the beacon message.

In the format includes a beacon universally unique identifier UUID beacon identifier activity parameter major value and activity parameter minor value . A venue can include multiple beacon devices having the same beacon identifier . However such beacons can have different values for the beacon UUID . Thus the beacon UUID can serve to differentiate among beacon devices sharing the same beacon identifier . In some implementations the beacon identifier includes the beacon UUID . In some implementations the UUID is a 128 bit value.

An activity parameter can be split between a major value and a minor value . In some implementations the major value and a minor value are different 16 bit portions of a 32 bit value. In some implementations the minor value specifies a subtype from a group associated with the major value . For example the major value can specify a value associated with displaying user messages and the minor value can specify which user message to display.

In some implementations an application running on a mobile device can process the major value and the minor value based on an internal database that associates major and minor values with specific actions. In some implementations the internal database includes information from a JavaScript Object Notation JSON based file or data stream containing attribute value pairs e.g. one or more records containing a beacon identifier major value minor value and an action response such as a text string for displaying to a user. For example a JSON based file can include the following text 

Sensors devices and subsystems may be coupled to peripherals interface to facilitate multiple functionalities. For example motion sensor light sensor and proximity sensor may be coupled to peripherals interface to facilitate orientation lighting and proximity functions of the device. For example in some implementations light sensor may be utilized to facilitate adjusting the brightness of touch surface . In some implementations motion sensor e.g. an accelerometer gyros may be utilized to detect movement and orientation of the device. Accordingly display objects or media may be presented according to a detected orientation e.g. portrait or landscape . Other sensors may also be connected to peripherals interface such as a temperature sensor a biometric sensor or other sensing device to facilitate related functionalities. Location processor e.g. GPS receiver chip may be connected to peripherals interface to provide geo positioning. Electronic magnetometer e.g. an integrated circuit chip may also be connected to peripherals interface to provide data that may be used to determine the direction of magnetic North. Thus electronic magnetometer may be used as an electronic compass. Camera subsystem and an optical sensor e.g. a charged coupled device CCD or a complementary metal oxide semiconductor CMOS optical sensor may be utilized to facilitate camera functions such as recording photographs and video clips. Audio subsystem may be coupled to a speaker and one or more microphones to facilitate voice enabled functions such as voice recognition voice replication digital recording and telephony functions.

Communication functions may be facilitated through one or more communication subsystems . Communication subsystems may include one or more wireless communication subsystems. Wireless communication subsystems may include radio frequency receivers and transmitters and or optical e.g. infrared receivers and transmitters. Wired communication system may include a port device e.g. a Universal Serial Bus USB port or some other wired port connection that may be used to establish a wired connection to other computing devices such as other communication devices network access devices a personal computer a printer a display screen or other processing devices capable of receiving or transmitting data.

The specific design and implementation of the communication subsystems may depend on the communication network s or medium s over which the device is intended to operate. For example a device may include wireless communication subsystems designed to operate over LTE GSM a GPRS network an enhanced data GSM environment EDGE network 802.x communication networks e.g. Wi Fi Wi Max CDMA networks NFC and a Bluetooth network. Communication subsystems may include hosting protocols such that the device may be configured as a base station for other wireless devices. As another example the communication subsystems may allow the device to synchronize with a host device using one or more protocols such as for example the TCP IP protocol HTTP protocol UDP protocol and any other known protocol.

I O subsystem may include touch controller and or other input controller s . Touch controller may be coupled to a touch surface . Touch surface and touch controller may for example detect contact and movement or break thereof using any of a number of touch sensitivity technologies including but not limited to capacitive resistive infrared and surface acoustic wave technologies as well as other proximity sensor arrays or other elements for determining one or more points of contact with touch surface . In one implementation touch surface may display virtual or soft buttons and a virtual keyboard which may be used as an input output device by the user.

Other input controller s may be coupled to other input control devices such as one or more buttons rocker switches thumb wheel infrared port USB port and or a pointer device such as a stylus. The one or more buttons not shown may include an up down button for volume control of speaker and or microphone .

In some implementations device may present recorded audio and or video files such as MP3 AAC and MPEG video files. In some implementations device may include the functionality of an MP3 player and may include a pin connector for tethering to other devices. Other input output and control devices may be used.

Memory interface may be coupled to memory . Memory may include high speed random access memory or non volatile memory such as one or more magnetic disk storage devices one or more optical storage devices or flash memory e.g. NAND NOR . Memory may store operating system such as Darwin RTXC LINUX UNIX OS X WINDOWS or an embedded operating system such as VxWorks. Operating system may include instructions for handling basic system services and for performing hardware dependent tasks. In some implementations operating system may include a kernel e.g. UNIX kernel .

Memory may also store communication instructions to facilitate communicating with one or more additional devices. Communication instructions may also be used to select an operational mode or communication medium for use by the device based on a geographic location obtained by the GPS Navigation instructions of the device. Memory may include graphical user interface instructions to facilitate graphic user interface processing including a touch model for interpreting touch inputs and gestures sensor processing instructions to facilitate sensor related processing and functions phone instructions to facilitate phone related processes and functions electronic messaging instructions to facilitate electronic messaging related processes and functions web browsing instructions to facilitate web browsing related processes and functions media processing instructions to facilitate media processing related processes and functions GPS Navigation instructions to facilitate GPS and navigation related processes camera instructions to facilitate camera related processes and functions and application storage for storing applications such as a retail store application that is configured to receive score and prioritize beacon messages if required. In some implementations such applications can be pre installed on the device downloaded from an application store server or a combination thereof. The retail store application can include a rules based engine that processes beacon messages according to rule sets as described herein.

Each of the above identified instructions and applications may correspond to a set of instructions for performing one or more functions described above. These instructions need not be implemented as separate software programs procedures or modules. Memory may include additional instructions or fewer instructions. Furthermore various functions of the device may be implemented in hardware and or in software including in one or more signal processing and or application specific integrated circuits ASICs .

Mobile devices can also receive beacon messages over a short range communication link from a beacon device . In some implementations the short range communication link can be based on Bluetooth radio technology. In some implementations the short range communication link can be based on NFC radio technology. In some implementations the mobile devices can be configured to continuously scan for beacon messages. In some implementations the mobile devices can be configured to scan for beacon messages for a predetermined time period based on an application invoking a beacon scan API. Based on receiving one or more beacon messages over short range communication links from one or more beacon devices the mobile devices can determine beacon message scores. In some implementations the mobile devices can prioritize beacon messages for presentation based on their corresponding scores.

In some implementations based on receiving a beacon message over a short range communication link from a beacon device the mobile devices can establish communications with one or more servers via a long range communication link associated with a base station that provides cellular data services. For example a beacon message from a beacon device can cause the mobile devices to retrieve a retail store application from a first server . In some implementations the mobile devices have already retrieved and are running the retail store application before receiving the beacon message from the beacon device . The retail store application can be configured to download beacon message content from a second server . In some implementations the retail store application can download beacon message content from the second server in response to an initial reception of a beacon message such as a welcome message. Further the retail store application can be configured to download one or more message rule sets from the second server . The message rule sets can be used to determine beacon message scores priorities or both.

In some implementations the second server can store data such as beacon message content and message rule sets in a database . In some implementations the beacon message content includes mappings between beacon message values e.g. identifier major and or minor values and corresponding message data e.g. text picture video and or audio . After downloading the beacon message content from the second server the mobile devices can use the mappings and message texts to translate a received beacon message into a format that is suitable for display to users of the mobile devices . In some implementations beacon message content can be stored as a document within the database such as an Extensible Markup Language XML document or a JSON document. Other document types are possible. In some implementations the second server provides the entire beacon message content document to the mobile devices . In some implementations message rule sets can be stored as a document within the database such as an XML document or a JSON document. Other document types are possible. In some implementations the second server includes processor electronics configured to store applications including a retail store application for download to the mobile devices 

Beacon devices can include circuitry such as a processor memory transmitter for broadcasting beacon messages and an interface for programming the beacon devices which can be a USB interface or a two way wireless interface such as an LTE or IEEE 802.11 based network interface. In some implementations the beacon devices can be programmed to periodically update data within the beacon messages. The beacon device can transmit different action codes e.g. different message values at different times during the day. Such codes for example can include a first message value for announcing an in store event that starts in 15 minutes and for after the event a second message value for retrieving product information for a product featured during the in store event.

The process determines a message context associated with the beacon message . Determining a message context can include determining a reason code. In some implementations determining a message context can include accessing a calendar stored on the mobile device and determining whether there is a calendar event associated with a business establishment where the business establishment is associated with the beacon message. In some implementations determining a message context can include determining whether an application such as a retail store application has been launched.

The process determines a beacon message score based on the message frequency and the message context . In some implementations a beacon message score can be computed based on a summation of multiple weighted components such as a context component and a frequency component. In some implementations a message context component can be based on a reason code that is determined by a retail store application. For example if a reason code indicates that the mobile device user is likely to benefit from a display of the message e.g. the mobile device user has a scheduled appointment at the store then assign a high context component value otherwise if a reason code indicates an null reason i.e. no reason was found then assign a low or zero context component value. In some implementations message frequency information including previous device wake up information can be another component of the beacon message score. For example if the mobile device has already been woken to display a previously received version of the beacon message a frequency component of the beacon message score can take on a low or zero value if the mobile device has not previously received the beacon message then the frequency component can take on a high value.

The process determines whether the beacon message score exceeds a threshold value . In some implementations the threshold value is determined based on a user configurable parameter. In some implementations the threshold value is selected based on a remaining charge of the mobile device s battery. For example if the battery s charge is running low then the threshold value can be set higher to minimize device wake ups and thereby conserve charge. If not exceeded the process continues to monitor for and receive beacon messages . If exceeded the process performs a device wake up . Performing a device wake up can include powering on a screen of a mobile device. The process retrieves information corresponding to the beacon message . Retrieving information can include accessing a message text string corresponding to a message value included in the beacon message. The process displays the information on screen .

Within the process running the retail store application the process tracks the beacon messages to determine whether a visit to the store will occur . Tracking the beacon messages can include storing the beacon messages in a data structure such as a table an array queue or linked list. The process determines whether RSSI values for similar ones of the beacon messages are increasing over a period of time and have satisfied a proximity criterion . For example the process can compare received signal strength values associated with at least a portion of the beacon messages to determine whether the received signal strength values are increasing with time which may indicate that the user is walking towards an entrance of the retail store where a beacon device is located near the store s entrance. In some implementations similar ones of the beacon messages are messages having the same message type content or both. In some implementations determining when a proximity criterion is satisfied can include tracking range estimations of the beacon messages and identifying when a range estimation is less than a threshold value.

If the user of the mobile device is not about to visit the process continues to track the beacon messages . If the user of the mobile device is about to visit the process determines a reason code for the visit to the retail store based on a representative one of the beacon messages . In some implementations the process can access a database such as a user s calendar database or the retail store s appointment log to determine whether the user has an appointment at the retail store. Various examples of reason codes include codes for package pick up service consultation targeted browsing general browsing or non specified. Other types of codes are possible. In some implementations a general browsing code is used as a default code. In some implementations a null code is used as a default code.

The process determines a score based on the reason code . In some implementations determining a score can include selecting and applying a rule set to determine a score based on the reason code and the representative one of the beacon messages. Various examples of rule sets include a package pick up rule set service consultation rule set general browsing rule set or a non specified visit rule set. In some implementations the process applies the rule set to determine a score of a beacon message. In some implementations a rule set includes a list of message types and corresponding priority values score values or both. A package pick up rule set for example can cause beacon messages associated with general solicitations such as specials of the day to have a lower score or a lower context component score than beacon messages associated with a package pick up such as messages that provide instructions for the pick up. In contrast a general browsing rule set can assign beacon messages associated with general solicitations to have a higher score or a higher message context component score than beacon messages associated with a beacon device at a package pick up kiosk that is providing instructions about pick up. In another example a targeted browsing rule set if applied may cause a beacon message associated with a product that is on the user s wish list to have a higher score than a beacon message associated with a product that is not on the user s wish list. In some implementations a user s wish list is stored within a data structure managed by the retail store application.

The process operates the retail store application to transition to a foreground process to display the representative beacon message based on the score exceeding a threshold . In some implementations transitioning to a foreground process can be based on an application performing an action such as causing information to be displayed on a screen. In some implementations transitioning to a foreground process can be based on an application invoking a foreground transition via an API call.

A range estimation component can be based on an RSSI value associated with a beacon message. A received signal from a closer beacon device is typically stronger than a signal from a beacon device that is farther away assuming that both beacon devices transmit at the same power level. In some implementations a beacon device can be configured to broadcast messages at periodic time intervals e.g. every 25 milliseconds. In some implementations a range estimation component can be based on averaging two or more RSSI values associated with two or more beacon messages from the same beacon device e.g. using beacon messages that have the same beacon identifier.

In some implementations a range estimation component can be based on a range class that is determined for a received beacon message. A range class can provide an approximate distance range between a mobile device and an RF signal source such as a beacon device. Determining a range estimation component can include assigning a range class to a received beacon message. For example an RSSI value associated with a received beacon message can be assigned to a range class based on RSSI thresholds without converting the RSSI values to distances. In some implementations range classes include Immediate Near Far and Unknown. For scoring range classes can be assigned predetermined values. In some implementations an immediate range class is assigned to a higher value to produce a higher range estimation component value than other classes such as Near Far and Unknown. More or fewer range classes can be used as needed for an application.

In some implementations the Immediate range class can be defined as a range between a mobile device and an RF signal source that is e.g. 0 to 30 centimeters. The Near range class can be defined as a range between a mobile device and an RF signal source that is e.g. 30 centimeters to 4 meters. The Far range class can be defined as a range between a mobile device and an RF signal source that is e.g. 4 to 30 meters. The Unknown range class can be defined as the range between a mobile device and a signal source e.g. greater than 30 meters . Distance thresholds can separate the range classes. The distance thresholds e.g. in meters can be converted to RSSI thresholds in dBm to enable classification of RSSI values where the range classes are separated by RSSI thresholds. In some implementations a mobile device can be configured to assign priority classes to beacon messages based on their correspondingly assigned range classes. For example a high value for a range estimation component can be assigned to a message in an Immediate range class whereas a low value can be assigned to a message in a Far range class.

A message content component can be based on a content type of a received beacon message. Different content types can be assigned different values. In some implementations the assignment between content type and value can be based on a rule set. For example a rule set can assign a higher value for the message content component to a special offer message while assigning a lower value to a general welcome message. A message context component can be based on whether there is a pre existing reason for visiting a business establishment associated with the beacon device. In some implementations a message context component is based on a reason code.

A message history component can be based on whether content from the beacon message has been previously received presented through the mobile device or both. For example if content from the beacon message has been previously received and presented through the mobile device within the last N hours then the message history component can be set to indicate that the message should not be displayed again which in some implementations can be zero. In some implementations if the message was previously presented within the last N hours the score can be set to zero regardless of the other component contributions such that the mobile device would not make a transition in response to the message. In some implementations N is a user or system configurable value.

A mobile device can be configured to track in a period of time a number of transitions that the mobile device transitions to a nominal operation state to present a beacon message. A score can be based on the number of such transitions. For example a wake up tracking component can be based on the number of transitions K in a period of time that the mobile device has transitioned to a nominal state to present a beacon message. In some implementations the number of wake ups can be limited if the number of transitions K exceeds a predetermined value. In some implementations the wake up tracking component can take on a negative value to cause the limiting of transitions.

The features described may be implemented in digital electronic circuitry or in computer hardware firmware software or in combinations of them. The features may be implemented in a computer program product tangibly embodied in an information carrier e.g. in a machine readable storage device for execution by a programmable processor and method steps may be performed by a programmable processor executing a program of instructions to perform functions of the described implementations by operating on input data and generating output.

The described features may be implemented advantageously in one or more computer programs that are executable on a programmable system including at least one programmable processor coupled to receive data and instructions from and to transmit data and instructions to a data storage system at least one input device and at least one output device. A computer program is a set of instructions that may be used directly or indirectly in a computer to perform a certain activity or bring about a certain result. A computer program may be written in any form of programming language e.g. C C Objective C Java including compiled or interpreted languages and it may be deployed in any form including as a stand alone program or as a module component subroutine or other unit suitable for use in a computing environment.

Suitable processors for the execution of a program of instructions include by way of example both general and special purpose microprocessors and the sole processor or one of multiple processors or cores of any kind of computer. Generally a processor will receive instructions and data from a read only memory or a random access memory or both. The essential elements of a computer are a processor for executing instructions and one or more memories for storing instructions and data. Generally a computer may communicate with mass storage devices for storing data files. These mass storage devices may include magnetic disks such as internal hard disks and removable disks magneto optical disks and optical disks. Storage devices suitable for tangibly embodying computer program instructions and data include all forms of non volatile memory including by way of example semiconductor memory devices such as EPROM EEPROM and flash memory devices magnetic disks such as internal hard disks and removable disks magneto optical disks and CD ROM and DVD ROM disks. The processor and the memory may be supplemented by or incorporated in ASICs application specific integrated circuits .

To provide for interaction with an author the features may be implemented on a computer having a display device such as a CRT cathode ray tube or LCD liquid crystal display monitor for displaying information to the author and a keyboard and a pointing device such as a mouse or a trackball by which the author may provide input to the computer.

The features may be implemented in a computer system that includes a back end component such as a data server or that includes a middleware component such as an application server or an Internet server or that includes a front end component such as a client computer having a graphical user interface or an Internet browser or any combination of them. The components of the system may be connected by any form or medium of digital data communication such as a communication network. Examples of communication networks include a LAN a WAN and the computers and networks forming the Internet.

The computer system may include clients and servers. A client and server are generally remote from each other and typically interact through a network. The relationship of client and server arises by virtue of computer programs running on the respective computers and having a client server relationship to each other.

One or more features or steps of the disclosed embodiments may be implemented using an Application Programming Interface API . An API may define on or more parameters that are passed between a calling application and other software code e.g. an operating system library routine function that provides a service that provides data or that performs an operation or a computation. The API may be implemented as one or more calls in program code that send or receive one or more parameters through a parameter list or other structure based on a call convention defined in an API specification document. A parameter may be a constant a key a data structure an object an object class a variable a data type a pointer an array a list or another call. API calls and parameters may be implemented in any programming language. The programming language may define the vocabulary and calling convention that a programmer will employ to access functions supporting the API. In some implementations an API call may report to an application the capabilities of a device running the application such as input capability output capability processing capability power capability communications capability etc.

As described above some aspects of the subject matter of this specification include gathering and use of data available from various sources to improve services a mobile device can provide to a user. The present disclosure contemplates that in some instances this gathered data may identify a particular location or an address based on device usage. Such personal information data can include location based data addresses subscriber account identifiers or other identifying information.

The present disclosure further contemplates that the entities responsible for the collection analysis disclosure transfer storage or other use of such personal information data will comply with well established privacy policies and or privacy practices. In particular such entities should implement and consistently use privacy policies and practices that are generally recognized as meeting or exceeding industry or governmental requirements for maintaining personal information data private and secure. For example personal information from users should be collected for legitimate and reasonable uses of the entity and not shared or sold outside of those legitimate uses. Further such collection should occur only after receiving the informed consent of the users. Additionally such entities would take any needed steps for safeguarding and securing access to such personal information data and ensuring that others with access to the personal information data adhere to their privacy policies and procedures. Further such entities can subject themselves to evaluation by third parties to certify their adherence to widely accepted privacy policies and practices.

In the case of advertisement delivery services the present disclosure also contemplates embodiments in which users selectively block the use of or access to personal information data. That is the present disclosure contemplates that hardware and or software elements can be provided to prevent or block access to such personal information data. For example in the case of advertisement delivery services the present technology can be configured to allow users to select to opt in or opt out of participation in the collection of personal information data during registration for services.

Therefore although the present disclosure broadly covers use of personal information data to implement one or more various disclosed embodiments the present disclosure also contemplates that the various embodiments can also be implemented without the need for accessing such personal information data. That is the various embodiments of the present technology are not rendered inoperable due to the lack of all or a portion of such personal information data. For example content can be selected and delivered to users by inferring preferences based on non personal information data or a bare minimum amount of personal information such as the content being requested by the device associated with a user other non personal information available to the content delivery services or publically available information.

A number of implementations have been described. Nevertheless it will be understood that various modifications may be made. Elements of one or more implementations may be combined deleted modified or supplemented to form further implementations. As yet another example the logic flows depicted in the figures do not require the particular order shown or sequential order to achieve desirable results. In addition other steps may be provided or steps may be eliminated from the described flows and other components may be added to or removed from the described systems. Accordingly other implementations are within the scope of the following claims.

