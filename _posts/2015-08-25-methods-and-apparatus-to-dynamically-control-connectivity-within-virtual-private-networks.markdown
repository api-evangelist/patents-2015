---

title: Methods and apparatus to dynamically control connectivity within virtual private networks
abstract: Methods and apparatus to dynamically control connectivity within VPNs are disclosed. A disclosed example method includes a route server for storing an indication in an entry for a first pair of provider edge routers in a virtual private network (intra-VPN) connectivity database, the intra-VPN connectivity database including entries for a plurality of pairs of provider edge routers. The indication to define an additional connectivity for the first pair of provider edge routers beyond connectivity defined in a virtual private network routing and forwarding table associated with a first provider edge router of the first pair of provider edge routers. The first pair of provider edge routers including a second provider edge router to which the first provider edge router is to be communicatively coupled.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09401844&OS=09401844&RS=09401844
owner: AT&T Intellectual Property I, L.P.
number: 09401844
owner_city: Atlanta
owner_country: US
publication_date: 20150825
---
This patent arises from a continuation of U.S. patent application Ser. No. 14 550 389 entitled Methods and apparatus to dynamically control connectivity within virtual private networks filed Nov. 21 2014 now U.S. Pat. No. 9 137 109 which is a continuation of U.S. patent application Ser. No. 13 349 305 entitled Methods and apparatus to dynamically control connectivity within virtual private networks filed Jan. 12 2012 now U.S. Pat. No. 8 929 367 which is a continuation of U.S. patent application Ser. No. 12 262 675 entitled Methods and apparatus to dynamically control connectivity within virtual private networks filed on Oct. 31 2008 now U.S. Pat. No. 8 121 118. U.S. patent application Ser. No. 14 550 389 U.S. patent application Ser. No. 13 349 305 and U.S. patent application Ser. No. 12 262 675 are hereby incorporated herein by reference in their entireties.

This disclosure relates generally to virtual private networks VPNs and more particularly to methods and apparatus to dynamically control connectivity within VPNs.

Enterprise customers are increasingly adopting multiprotocol label switching MPLS based VPN services to implement a communication network among their respective customer sites via a service provider s network. Such MPLS based VPNs provide direct any to any reachability among an enterprise s customer sites.

Example methods and apparatus to dynamically control connectivity within virtual private networks VPNs are disclosed. A disclosed example route server to control connectivity within a VPN includes a memory to implement an intra VPN connectivity database a border gateway protocol BGP engine to process BGP advertisements a network interface to receive a first BGP advertisement from a first provider edge PE router associated with the VPN the first BGP advertisement including a first route target RT associated with the first PE router and an intra VPN connectivity controller to in response to the first BGP advertisement query the database to determine whether the first PE router is to be communicatively coupled to a second PE router of the VPN and when the first and second PE routers of the VPN are to be communicatively coupled direct the BGP engine to form a second BGP advertisement based on the first BGP advertisement the second BGP advertisement including a second RT associated with the second PE router.

A disclosed example method includes receiving a first BGP advertisement from a first PE router associated with a VPN the first BGP advertisement including a first RT associated with the first PE router automatically querying an intra VPN connectivity database to determine whether the first PE router is to be communicatively coupled to a second PE router of the VPN forming a second BGP advertisement based on the first BGP advertisement when the first and second PE routers of the VPN are to be communicatively coupled the second BGP advertisement including a second RT associated with the second PE router and broadcasting the second BGP advertisement.

In the interest of brevity and clarity throughout the following disclosure references will be made to an example multiprotocol label switching MPLS based communication system of . However the methods and apparatus described herein to dynamically control connectivity within VPNs are applicable to other types of networks constructed using other technologies topologies and or protocols.

To route and or transport data between and or among the example CE routers the example service provider network of includes a plurality of PE routers four of which are designated at reference numerals and . The example PE routers of are communicatively coupled to each other via any number and or type s of communication paths not shown that allow any particular PE router to communicate with at least some but not necessarily all of the other PE routers .

For each VPN implemented by the service provider network each of the example PE routers of has a corresponding VPN routing and forwarding VRF table. In the illustrated example of the PE router has a VRF table the PE router has a VRF table the PE router has a VRF table and the PE router has a VRF table . The example VRF tables of are associated with the VPN communicatively coupling the example CE routers . The example VRF tables are used by the PE routers to route and or forward a packet received at a particular PE router to and or toward its final destination. In general when a packet is received at a PE router from a CE router associated with a particular VPN the PE router uses the final destination specified and or identified in the packet to perform a query of the VRF table associated with that VPN. Based on a result of the query the PE router determines how the packet is to be routed or forwarded within the service provider network and or delivered to a particular CE router .

By sending for example BGP route advertisements each of the example PE routers of publishes and or exports information concerning the CE router s that are communicatively coupled to the PE router . Isolation between different VPNs and or between different devices of a VPN is achieved via RTs import policies and or export policies. Specifically BGP advertisements and or routes within a BGP advertisement are tagged with an RT value. The RT that is included in a BGP advertisement is defined by the export policy of the PE router that is sending the BGP advertisement. For instance when the example PE router of sends a BGP advertisement containing information regarding any of the CE routers the BGP advertisement includes an RT B as defined by an export policy associated with the VRF table .

Based on received BGP route advertisements the example PE routers of build compile update maintain and or construct their respective VRF tables . The example PE routers import routes in accordance with their associated import policy. In the illustrated example of when the example PE router receives a BGP advertisement tagged with an RT the PE router compares the RT contained in the BGP advertisement with its import policy . If the import policy specifies that routes associated with that RT are to be imported the PE router updates its VRF table . For example if the BGP advertisement includes an RT G the PE router would import the routes listed in the BGP advertisement. However BGP advertisements including other RTs would be ignored.

By configuring the import and export policies of the example VRF tables nominal and or default routes between the example PE routers for the example VPN of can be controlled as shown in . For example if the values A B C D E F and G of are configured to have the same value then the example VPN of is configured in the any to any topology traditionally utilized within VPNs. If the values A B C D E F and G are all different then no routes between any of PE routers for the example VPN of have been configured and or enabled. If the values A C E and H have a first value and the values B D F and G have a second value then the example VPN of is configured in a hub and spoke topology. In particular the example PE router would operate as a hub router for the VPN with the other PE routers operating as spoke routers.

Returning to to facilitate sharing of routing information among the example PE routers the example service provider network of includes any number of route servers route reflectors intelligent route reflectors and or intelligent route service control points one of which is designated at reference numeral . Because not all of the example PE routers are necessarily communicatively coupled in a full mesh topology for example when at least one PE router does not have a direct communication path to another PE router the example route server of forwards BGP advertisements among and or to the PE routers . By forwarding each received BGP advertisement the example route server enables each of the PE routers to build compile and or construct a VRF table that can be used by the PE router to route data from any of its communicatively coupled CE routers to none some or all of the CE routers communicatively coupled to other PE routers even if such routing of data requires use of one or more intervening PE routers .

To dynamically control communication within the example VPN of without having to reconfigure and or change import and or export policies of a VRF table the example route server of forms a copy of each BGP advertisement that it receives modifies the copy of the received BGP advertisement and sends and or broadcasts the modified BGP advertisement. For example when the example PE router is to be communicatively coupled to the example PE router for a particular VPN and the example route server of receives a BGP advertisement that includes the RT B associated with the export policy of the VRF table the example route server broadcasts a version of the BGP advertisement that includes an RT E associated with an import policy of the VRF table . Likewise when the example route server receives a BGP advertisement that includes an RT F associated with an export policy of the VRF table the example route server broadcasts a version of the BGP advertisement that includes an RT A associated an import policy of the VRF table . When a particular PE router is not to have additional connectivity within a VPN beyond that defined by the import and or export policy of the PE router the route server forwards the originally received BGP advertisements and without making modifying and or sending a copy of the received BGP advertisements and or .

Intra VPN connectivity enabled by the example route server is in addition to any intra VPN connectivity defined by the import and or export policies of the VRF tables . For example if the values A B C D E F and G are all different the route server is the sole enabler for connectivity within the example VPN of . However if the values A C E and H have a first value and the values B D F and G have a second value thereby enabling a hub and spoke topology with the PE router operating as a hub router the example route server can be used to dynamically enable additional connectivity between the spoke PE routers .

To determine whether PE routers are to have additional connectivity within a VPN beyond that defined by their respective import and export policies the example route server of queries an intra VPN connectivity database . As described below in connection with a user and or computer can dynamically and or selectively configure connectivity within a VPN by configuring the intra VPN connectivity database . An example manner of implementing the example route server of is described below in connection with .

While an example communication system has been illustrated in one or more of the interfaces data structures elements processes and or devices illustrated in may be combined divided re arranged omitted eliminated and or implemented in any other way. Further the example PE routers and or the example route server of may be implemented by hardware software firmware and or any combination of hardware software and or firmware. Thus for example any of the example PE routers and or the example route server may be implemented by one or more circuit s programmable processor s application specific integrated circuit s ASIC s programmable logic device s PLD s and or field programmable logic device s FPLD s etc. Further still a communication system may include interfaces data structures elements processes and or devices instead of or in addition to those illustrated in and or may include more than one of any or all of the illustrated interfaces data structures elements processes and or devices.

To send receive and process BGP route advertisements the example route server of includes a multi protocol BGP engine . When a BGP route advertisement is received from a PE router via the example network interface the example multi protocol BGP engine of forwards the received BGP route advertisement to the other PE routers . The example multi protocol BGP engine also queries an intra VPN connectivity controller to determine whether one or more modified copies of the received BGP router advertisement are to be broadcast.

To control connectivity within a VPN the example route server of includes the example intra VPN connectivity controller . When queried by the example multi protocol BGP engine the example intra VPN connectivity controller of queries the example intra VPN connectivity database to determine whether BGP advertisements associated with a first RT are to be re broadcast with one or more additional RT. When intra VPN connectivity beyond that defined by import and or export policies is to be enabled for a particular RT the example intra VPN connectivity controller returns to the multi protocol BGP engine the one or more additional RTs with which the received BGP route advertisement is to be re broadcast.

In response to the one more additional RTs the example multi protocol BGP engine of creates one or more corresponding copies of the received BGP advertisement modifies the original RT to correspond with a respective one of the one or more additional RTs and broadcasts the modified copy ies of the received BGP advertisement.

Intra VPN connectivity configuration information may be stored in the example intra VPN connectivity database using any number and or type s of data structures. An example data structure that may be used to implement the example shared resource control access database of is described below in connection with . The example intra VPN connectivity database may be stored using any number and or type s of memory ies memory device s and or storage device s .

To allow the user and or computer to configure intra VPN connectivity for a VPN the example route server of includes any number and or type s of user interface modules one of which is designated at reference numeral . The example user of may be associated with a particular VPN and or be associated with an operator of the service provider network . The example user interface module of enables the user to interact with the example intra VPN connectivity controller to update the database to configure connectivity within a VPN. In some examples intra VPN connectivity can be configured differently for different periods of time temporarily configured with an expiration time and or automatically re configured in response to a triggering event. For instance during business hours there may be full connectivity within a VPN with the VPN reverting to a nominal hub and spoke topology during non business hours. Additionally or alternatively if a virus and or security anomaly is detected connectivity within a VPN may be restricted and or blocked to reduce the likelihood of damage. Example user interface modules include but are not limited to a web based interface a voice activated response system and or an application programming interface accessible to another computer system .

While an example route server has been illustrated in one or more of the interfaces data structures elements processes and or devices illustrated in may be combined divided re arranged omitted eliminated and or implemented in any other way. Further the example intra VPN connectivity database the example network interface the example multi protocol BGP engine the example intra VPN connectivity controller the example user interface module and or more generally the example route server of may be implemented by hardware software firmware and or any combination of hardware software and or firmware. Thus for example any or the example intra VPN connectivity database the example network interface the example multi protocol BGP engine the example intra VPN connectivity controller the example user interface module and or more generally the example route server may be implemented by one or more circuit s programmable processor s ASIC s PLD s and or FPLD s etc. Further still a route server may include interfaces data structures elements processes and or devices instead of or in addition to those illustrated in and or may include more than one of any or all of the illustrated interfaces data structures elements processes and or devices.

To identify whether communication between the VRFs associated with a particular combination of RTs is currently enabled each of the example entries contains one or more values flags rules criteria and or strings that represent whether the example route server is to cross communicate BGP advertisements between the RTs associated with the entry . Example entries include but are not limited to a flag that indicates that connectivity between the RTs is unconditionally enabled a time of day range that specifies when connectivity is enabled a condition when connectivity is enabled and or a condition when connectivity is disabled. In some examples the example entries of each contain a simple flag to indicate whether the example route server is to cross communicate BGP advertisements between the RTs associated with the entry . In such examples the example user and or computer is responsible for configuring the example intra VPN connectivity database in response to one or more of conditions time of day day of week and or triggering events.

While an example data structure that may be used to implement the example intra VPN connectivity database of is illustrated in the example data structure of may be implemented using any number and or type s of other and or additional entries fields and or data. Further the entries fields and or data illustrated in FIG. may be combined divided re arranged eliminated and or implemented in any way. Further still the example data structures may include entries fields and or data in addition to or instead of those illustrated in and or may include more than one of any or all of the illustrated entries fields and or data. Moreover the example data structure of may be queried using any additional and or alternative methods.

The example process of begins with the example user interface module of determining whether updated intra VPN connectivity configuration information has been received block . If updated intra VPN connectivity configuration information has been received block the example intra VPN connectivity controller makes corresponding updates to the example intra VPN connectivity database block . Control then returns to block .

If updated intra VPN connectivity configuration information was not received block the example multi protocol BGP engine of determines whether a B GP advertisement was received via the example network interface block . If a BGP advertisement was not received block control returns to block .

If a BGP advertisement was received block the multi protocol BGP engine broadcasts the received BGP advertisement block . The multi protocol BGP engine queries the intra VPN connectivity controller to determine whether modified copies of the received BGP advertisement are to be broadcast block . If the intra VPN connectivity controller determines that no modified copies of the received BGP advertisement are to be broadcast block control returns to block .

If based on a query of the example intra VPN connectivity database the intra VPN connectivity controller returns one or more RTs block the multi protocol BGP engine creates one or more corresponding copies of the received BGP advertisement block modifies the RT of the copy ies with respective ones of the returned RT s block and broadcasts the modified BGP advertisement s block . Control then returns to block .

The processor platform P of the example of includes at least one general purpose programmable processor P. The processor P executes coded instructions P and or P present in main memory of the processor P e.g. within a RAM P and or a ROM P . The processor P may be any type of processing unit such as a processor core a processor and or a microcontroller. The processor P may execute among other things the example process of to implement the example methods and apparatus described herein.

The processor P is in communication with the main memory including a ROM P and or the RAM P via a bus P. The RAM P may be implemented by DRAM SDRAM and or any other type of RAM device and ROM may be implemented by flash memory and or any other desired type of memory device. Access to the memory P and the memory P may be controlled by a memory controller not shown . One or both of the example memories P and P may be used to implement the example intra VPN connectivity database of .

The processor platform P also includes an interface circuit P. The interface circuit P may be implemented by any type of interface standard such as an external memory interface serial port general purpose input output etc. One or more input devices P and one or more output devices P are connected to the interface circuit P. The input devices P and or output devices P may be used to for example implement the network interface of .

Although certain example methods apparatus and articles of manufacture have been described herein the scope of coverage of this patent is not limited thereto. On the contrary this patent covers all methods apparatus and articles of manufacture fairly falling within the scope of the appended claims either literally or under the doctrine of equivalents.

