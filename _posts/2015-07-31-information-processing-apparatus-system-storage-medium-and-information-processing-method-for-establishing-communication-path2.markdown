---

title: Information processing apparatus, system, storage medium, and information processing method for establishing communication path
abstract: An information processing apparatus includes a first receiving unit that receives authentication information from software that functions as a web client through a first communication path using a first communication protocol; a transmitting unit that, if authentication using the received authentication information is successful, permits communication through the first communication path, and transmits access permission information to the software through the first communication path; a second receiving unit that receives an establishment request for a second communication path using a second communication protocol different from the first communication protocol, from the software; and an establishing unit that, if the transmitted access permission information is included in the received establishment request, establishes the second communication path to the software.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09658805&OS=09658805&RS=09658805
owner: FUJI XEROX CO., LTD.
number: 09658805
owner_city: Tokyo
owner_country: JP
publication_date: 20150731
---
This application is based on and claims priority under 35 USC 119 from Japanese Patent Application No. 2014 193648 filed Sep. 24 2014.

The present invention relates to an information processing apparatus a system a storage medium and an information processing method.

According to an aspect of the invention there is provided an information processing apparatus including a first receiving unit that receives authentication information from software that functions as a web client through a first communication path using a first communication protocol a transmitting unit that if authentication using the received authentication information is successful permits communication through the first communication path and transmits access permission information to the software through the first communication path a second receiving unit that receives an establishment request for a second communication path using a second communication protocol different from the first communication protocol from the software and an establishing unit that if the transmitted access permission information is included in the received establishment request establishes the second communication path to the software.

A general configuration a hardware configuration and a functional configuration of an information processing system according to an exemplary embodiment are described first with reference to .

The communication line is a system for communication including at least one of the Internet a mobile communication network a telephone line and the like. The communication line provides communication among apparatuses and devices connected to the system. The communication line is connected to the information processing apparatus and the communication device . The communication device is a device having a communication function. In this exemplary embodiment the communication device executes wireless communication conforming to the standard of wireless LAN. The communication device executes wireless communication with the user device and communicates with the information processing apparatus through the communication line . That is the information processing apparatus communicates with the user device through the communication line and the communication device . Alternatively the information processing apparatus and the user device may directly communicate with each other without the communication device .

The information processing apparatus is an apparatus that executes image forming processing of forming an image on a medium and image reading processing of reading an image formed on a medium. These processing are executed when the above described function of for example copy scan FAX or print is provided. The information processing apparatus includes an operation device used for operating the information processing apparatus . The operation device is a device to operate the information processing apparatus and is so called control panel. The operation device is fixed to the housing of the information processing apparatus and is used by a user who comes to a location where the information processing apparatus is installed. The operation device includes for example a liquid crystal display. The operation device displays image data to operate the information processing apparatus hereinafter referred to as operation image data on the display. An operation image displayed on the basis of the operation image data is described with reference to .

The description returns to . The user device is a device for example a tablet terminal or a personal computer. The user device may be used when carried by a user or when placed on a desk. Also the user device may be used for other purpose for example business operations of a company without limiting to the operation of the information processing apparatus . The user device displays operation image data and when an operation is made on the displayed operation image data the user device requests the information processing apparatus for processing corresponding to the operation. This point is common to the operation device .

When the information processing apparatus executes processing based on a request from the operation device or the user device the information processing apparatus transmits information indicating the status of the processing being executed hereinafter referred to as status information to the device and thus notifies the device about the status of the processing. For example if the copy function is used the status information is information indicating the status of processing such as the number of media from which images are read the number of media on which images are formed etc.

Also when the copy processing progresses and copy is completed by the requested number of sheets as shown in the information processing apparatus transmits status information C including sheet number information C indicating completion of copy by the requested number of sheets and a character string describing copy is completed. The sheet number information C and the sheet number information C are each indicated by a mixed number having the number of sheets requested for copy as the denominator and the number of completed sheets of copy as the numerator. As described above the status information includes information indicating the progress of processing information indicating the result of the processing and information of parameters used for the processing. The operation device and the user device each serve as a display device that displays the notified status as shown in . Hereinafter the operation device and the user device are collectively called display device unless otherwise distinguished from one another.

The memory includes for example a hard disk drive. The memory stores data a program and image data used by the controller for the control. The communication unit is a communication unit including a communication circuit and an antenna for executing wireless communication conforming to the standard of wireless LAN Local Area Network . The communication unit executes wireless communication with for example the communication device shown in . The display includes for example a liquid crystal display. The display is controlled by the controller and displays an image on a display screen. The operation unit includes a touch sensor also called touch screen or touch panel overlaid on the display screen and a button etc. provided at the housing if the user device is a tablet terminal. The operation unit receives an operation by a user such as the tapping and supplies operation data indicating the content of the operation to the controller . Alternatively if the user device is a personal computer the operation unit may include a keyboard and a mouse. The controller executes control in accordance with supplied operation data.

As described above the operation device and the user device are called display device unless otherwise distinguished from one another. Accordingly when the controller and the controller do not have to be distinguished from one another the controllers and are collectively called controller . When the memory and the memory do not have to be distinguished from one another the memories and are collectively called memory . When the display and the display do not have to be distinguished from one another the displays and are collectively called display . When the operation unit and the operation unit do not have to be distinguished from one another the operation units and are collectively called operation unit . 

The image reading unit executes image reading processing of reading an image on a document by using for example a CCD Charge Coupled Devices system. The image reading unit optically reads an image of a content formed on a medium such as paper and supplies image data indicating the read image to the controller . The image forming unit executes image forming processing of forming an image on a medium by using for example an electrophotographic system. The image forming unit forms an image indicated by the image data supplied from the controller on a medium such as paper. The above described systems used for reading an image and forming an image are each merely an example and other system may be used.

The first communication unit is connected to the communication unit of the operation device through a communication cable and a data bus and communicates with the operation device without the above described external device. That is the communication unit also communicates with the information processing apparatus without the above described external device. The second communication unit includes a communication circuit that makes communication conforming to the standard of wired LAN or wireless LAN a port to which a connector of a communication cable a LAN cable is inserted and a wireless transmitting receiving device conforming to the standard of wireless LAN as a communication interface and executes communication processing of communicating with a device connected through the interface. The second communication unit is connected to the communication line shown in and communicates with for example the user device through an external device being an external device for the information processing apparatus and being for example the communication device .

The connection unit has a slot or the like to which a storage medium such as a SD memory card is connected and is connected to the storage medium. The controller reads data stored in the storage medium and writes data in the storage medium through the connection unit . The operation device has the configuration described with reference to and communicates with the first communication unit . By executing this communication the operation device functions as a user interface unit UI unit that displays an image indicated by data transmitted from the controller and that transmits data for operating the information processing apparatus to the controller .

If authentication using the authentication information received by the first receiving unit is successful the transmitting unit permits communication through the first communication path and transmits an access token an example of access permission information as information for permitting an access to the software through the first communication path. The second receiving unit receives an establishment request for a second communication path using a second communication protocol different from the first communication protocol from the software. If the access token transmitted from the transmitting unit is included in the establishment requirement received by the second receiving unit the establishing unit establishes the second communication path to the above described software.

If the second communication path established by the establishing unit is disconnected the disconnecting unit disconnects the first communication path to the software to which the disconnected second communication path has been established. In this example the controller of the information processing apparatus or the controller and the first communication unit are an example of the first receiving unit the transmitting unit the second receiving unit the establishing unit and the disconnecting unit .

Alternatively if the second communication path is disconnected the disconnecting unit may determine whether the first communication path is disconnected or not in accordance with the priority of the web client. For example the disconnecting unit does not disconnect the first communication path if the web client is a local UI unit the operation device and hence has high reliability but disconnects the first communication path if the web client is a remote UI unit the user device and hence has low reliability. Alternatively the disconnecting unit may record the connection history of the web client and in case of the web client with the connection history recorded the disconnecting unit may not disconnect the first communication path.

The display device includes an acquiring unit a first transmitting unit a receiving unit a second transmitting unit and a third transmitting unit . The acquiring unit acquires authentication information. The first transmitting unit transmits the authentication information acquired by the acquiring unit to software that functions as a server through the first communication path using the first communication protocol. The receiving unit receives an access token from the software through the first communication path. The second transmitting unit transmits an establishment request for the second communication path using the second communication protocol to the software the establishment request including the access token received by the receiving unit .

If the second communication path is disconnected the third transmitting unit transmits the establishment request for the second communication path including the access token received by the receiving unit to the software through the first communication path. In this example the controller of the user device the controller and the communication unit of the user device the controller of the operation device and the controller and the communication unit of the operation device are an example of the first receiving unit the transmitting unit the second receiving unit the establishing unit and the disconnecting unit .

In this exemplary embodiment the presentation layer that is the display device and the interface that is the information processing apparatus communicate with each other under the standard of WWW World Wide Web hereinafter referred to as web . In this example the presentation layer and the interface communicate with each other by using HTTP Hypertext Transfer Protocol and WebSocket.

If the display device is the user device the information processing apparatus and the user device that is the presentation layer and the interface transmit and receive data through the communication line and the communication device as described above with reference to . That is in this case communication is executed through a communication device which is not the information processing apparatus or the user device for example the communication device or a communication device connected to the communication line hereinafter referred to as other communication device . If the display device is the operation device the information processing apparatus and the operation device that is the presentation layer and the interface transmit and receive data through a cable connected to the first communication unit as described above with reference to . That is in this case communication without the above described other communication device is executed. The above described communication device may include for example a router a hub and a bridge connected to the communication line in addition to the communication device .

The presentation layer corresponding to the operation device or the user device realizes a function that receives an operation by a user that is a user interface . The presentation layer includes a UI controller a device controller and a communication unit . The UI controller is a unit that controls the user interface. The UI controller displays the above described operation image and status information transmitted from the interface that is the information processing apparatus on the display and receives an operation by the user in accordance with data supplied from the operation unit . To be specific for example the UI controller displays the status information C and the status information C described above with reference to . Other example of status information is described below with reference to .

Also the user executes an operation to make an access to URL Uniform Resource Locator of the information processing apparatus and hence the UI controller transmits a request for operation image data to the interface of the information processing apparatus . Also the UI controller displays the operation image data transmitted from an operation image managing unit of the information processing apparatus on the display as a response to the transmitted request for the operation image data. To be more specific the UI controller displays an operation image based on parameters such as the arrangement and size of the operation image presented by the operation image data. The operation image displayed in this way is for example the operation image data group A shown in . An example of information configuring the operation image data is a file described in HTML Hypertext Markup Language form. The UI controller interprets the acquired file in HTML form and controls the operation image to be displayed and operation information to be received.

The operation image data group A includes operation image data for selection of parameters such as a magnification of an image to be copied a sheet of paper on which a copied image is formed and a color mode of the image to be copied. The user operates the operation image data and hence the UI controller changes the image indicating the parameters into a display form indicating the selected parameters and displays the image. is an example showing an image including a character string indicating a magnification of copy in this example 110 B that is currently selected and operation image data indicating a sheet of paper and a color mode that are currently selected in this example character strings describing other magnification A4 normal paper monotone in a form different from a selection image that is not selected in this example a form with a thick line is employed or a form of highlight or radio buttons may be alternatively employed .

The operation image data group A includes the operation image data A to start copy. When the operation image data A is operated the function layer is requested for copy processing using the currently selected parameters through the interface . As described above the operation image data A is an image for determining the content to be requested to the information processing apparatus .

The description returns to . The UI controller supplies data relating to the displayed operation image data to the device controller . The data relating to the operation image data is data used for determining whether the operation image data is operated or not and is data indicating for example a region where the operation image data is displayed for example a region of a button image or an icon image . Also the UI controller supplies the data indicating the content of the parameters to the device controller based on the display form of the image indicating the parameters displayed as described above.

The device controller requests the function layer to execute processing through the interface based on an operation by the user. When the operation on the operation image data is executed by the user the device controller requests the information processing apparatus for processing corresponding to the operation by the user based on data supplied from the UI controller . For example when the user taps the touch sensor of the operation unit the device controller determines whether the tapped position is included in the region of the operation image data based on the data supplied from the UI controller . If it is determined that the tapped position is included in the region of the operation image data the device controller receives the operation on the operation image displayed in the region of the operation image data.

If the device controller receives the operation on the image for determining the above described request content in the example in the operation image data A the device controller requests the information processing apparatus for processing indicated by the image by using the parameters indicated by the data supplied from the UI controller . If the operation is made on the operation image data A in the state shown in the device controller requests the information processing apparatus for processing for copy with a magnification of 110 on a sheet of A4 normal paper in monotone.

In this example the device controller generates data describing an instruction indicating that processing corresponding to an operated image an image that determines a request content in this example the processing being copy processing is executed by using parameters set by the operation hereinafter the data being referred to as instruction data . In this exemplary embodiment the instruction data is described in XML Extensible Markup Language . The device controller generates a HTTP Hypertext Transfer Protocol request including the generated instruction data. The device controller requests the function layer for processing by transmitting the generated HTTP request to the interface . The HTTP request to be transmitted to the interface so that the device controller makes a request for processing is referred to as processing request hereinafter. A processing request including instruction data is generated if the copy processing is requested however a processing request may not include instruction data depending on processing to be requested. For example if processing of turning off the power of the information processing apparatus is requested the processing request does not include instruction data.

The communication unit controls communication of the UI controller and the device controller with the interface .

The interface is a layer that realizes a function of providing connection between the presentation layer and the function layer . The connection between the presentation layer and the interface includes connection through an external device having a communication function such as the communication device shown in connection with the user device and connection without such an external device connection with the operation device . The interface provides communication between the user device and the operation device by a common communication process a process of communication conforming to the standard such as HTTP or WebSocket . For example the interface receives a HTTP request transmitted from the presentation layer and supplies the HTTP request to the function layer and receives a HTTP response supplied from the function layer in response to the HTTP request and transmits the HTTP response to the presentation layer .

The function layer is a layer that realizes a function of processing data to meet the purpose of use such as the copy function and scan function. The function layer includes a receiving and responding unit an event notifying unit an operation image managing unit an operation image DB Data Base and a function unit that provides the copy function scan function etc.

The receiving and responding unit receives a processing request transmitted from the presentation layer through the interface and requests the function unit for processing. At this time the receiving and responding unit issues a transaction ID as information for identifying the requested processing. Also the receiving and responding unit issues a client ID as information for identifying a request source the display device which has requested the processing. The receiving and responding unit causes the memory to store the issued transaction ID and client ID and a communication target address of the display device of the request source in an associated manner. The receiving and responding unit supplies the issued transaction ID to the function unit when the receiving and responding unit requests the function unit for the processing. Also the receiving and responding unit transmits a response to the received request to the presentation layer through the interface . The response may indicate only reception of the request or may include status information.

The event notifying unit generates notification data including status information and transmits the generated notification data to the presentation layer through the interface by using the WebSocket protocol.

In this exemplary embodiment the function layer and the presentation layer transmit a request a response or a notification generally by four methods. The first and second methods use the HTTP protocol and are executed by the receiving and responding unit . The third method uses both the HTTP protocol and the WebSocket protocol and is cooperatively executed by the receiving and responding unit and the event notifying unit . The fourth method transmits a notification by using the WebSocket Protocol and is executed by the event notifying unit .

In the first method when a processing request HTTP request is transmitted from the presentation layer the receiving and responding unit waits until execution of the processing is completed by the middleware layer and the hardware layer . In this case when completion of the processing is notified from the middleware layer the receiving and responding unit transmits a HTTP response including status information indicating a state at completion of the processing to the presentation layer which has requested the processing. For example when a user operates operation image data such as A or A in the column of magnification select shown in the presentation layer requests processing of decreasing or increasing a parameter of copy magnification. In this case the receiving and responding unit transmits a response including the value of parameter changed as the result that the requested processing is executed to the presentation layer .

In the second method when a processing request HTTP request is received from the presentation layer the receiving and responding unit does not wait completion of the requested processing and transmits a response indicating reception of the processing request HTTP response . Then status information is acquired such that the presentation layer executes so called polling by using HTTP. That is when a request for a notification about the status of the processing hereinafter referred to as notification request is made from the presentation layer the receiving and responding unit responds to the notification request. When the response is made by the second method the sheet number information C shown in is notified every polling instead of each time when a copied image is formed on a medium. Owing to this for example the number of pages may not be incremented by one but may be incremented by several pages.

As described above if one of the first and second methods is used when a request processing request or notification request is made from the presentation layer the receiving and responding unit transmits a response to the request. If the first method is used the receiving and responding unit transmits the result of the processing to the presentation layer of the request source in response to the processing request. In case the second method is used the receiving and responding unit transmits the result of the processing and the status of other processing to the presentation layer of the request source in response to the notification request received after the response to the processing request.

In the third method when a processing request HTTP request is received from the presentation layer the receiving and responding unit does not wait for completion of the requested processing and transmits a response indicating reception of the processing request HTTP response similarly to the second method. Then if a status to be notified is generated in processing being executed by the middleware layer and the hardware layer the event notifying unit transmits notification data serving as a message including status information indicating the status to the presentation layer by using WebSocket even without a notification request. That is the status to be notified by the third method is the status of processing to be executed in response to the processing request. When the notification is transmitted by the third method the number of pages in the sheet number information C shown in is incremented every time when a copied image is formed on a medium.

In the fourth method if a status to be notified is generated the event notifying unit transmits notification data serving as a message including status information indicating the status even without a notification request to the presentation layer by using WebSocket regardless of presence of a processing request from the presentation layer . That is the status to be notified by the fourth method does not relate to processing to be executed in response to a processing request. In the fourth method for example any presentation layer may be possibly a notification target as long as the presentation layer has a session established to the information processing apparatus based on the standard of WebSocket. In the information processing system a status such as out of toner out of paper or housing portion open a state in which a housing portion that houses media such as paper is open is notified by the fourth method. The status to be notified by the fourth method may be different depending on the presentation layer the display device being the notification target.

As described above if one of the third and fourth methods is used the event notifying unit actively makes a so called push notification regardless of presence of a request processing request and notification request from the presentation layer . When the third method is used the event notifying unit makes a notification about the result of the processing and the status of other processing after the response to the processing request. If the fourth method is used the event notifying unit makes a notification about the state of predetermined processing.

If one of the second and third methods is used the receiving and responding unit or the event notifying unit transmits the result of the processing and the status of other processing after the response to the processing request. Also any of the first to third methods is a method for making a notification about the status of requested processing. In this exemplary embodiment the presentation layer designates a method that is one of the first to third methods of transmitting the status of the processing including the result of the processing when requesting the processing. For example the transmission method may be designated by a parameter included in a processing request generated by the device controller . The receiving and responding unit and the event notifying unit transmit a response and or a notification by using a method designated by the presentation layer .

In this exemplary embodiment status information is generated by the middleware layer and is supplied to the receiving and responding unit or the event notifying unit . Alternatively the status information may be generated by the function unit the receiving and responding unit or the event notifying unit . Still alternatively the status information to be supplied to the event notifying unit may be supplied to the event notifying unit through the receiving and responding unit instead of being directly supplied from the middleware layer or the function unit to the event notifying unit .

The operation image managing unit manages operation image data to be transmitted to the presentation layer . The operation image DB is a database that stores operation image data. The operation image managing unit provides the above described operation image data to the presentation layer through the interface . The operation image managing unit stores operation image data image data indicating an operation image and is a file described in for example the HTML form and when a request for operation image data is transmitted through the interface the operation image managing unit transmits a response including the operation image data to the request source through the interface .

When a request for operation image data is transmitted from the user device the operation image managing unit transmits the operation image data to the user device in response to the request. Also when a request for operation image data is transmitted from the operation device the operation image managing unit transmits the operation image data to the operation device in response to the request. By transmitting the operation image data to the request sources the user device and the operation device of the operation image data in this way the operation image managing unit provides operation image data to each of the request sources.

The function unit is a module group for realizing a function to be provided to the user by the information processing apparatus . When a processing request is transmitted from the presentation layer through the interface the function unit of the information processing apparatus controls the middleware layer to execute processing requested by the processing request.

For example the function unit analyses instruction data included in a processing request and controls the middleware layer so as to execute processing in accordance with the content of the analyzed instruction. To be specific the function unit executes instructed processing for example copy processing in accordance with an instructed parameter. Accordingly the middleware layer reads an image from a medium with an image quality and a reading method determined by operations of the user and forms the read image in an output format with a magnification on a sheet of paper in a color mode determined by operations of the user.

The function unit supplies the transaction ID supplied from the receiving and responding unit to the middleware layer when instructing the middleware layer to execute the processing. The middleware layer supplies the transaction ID together with the above described status information to the receiving and responding unit .

Also the function unit analyzes a description that designates a method described in a processing request one of the first to third methods and transmits the analyzed method that is the method designated by the display device to the receiving and responding unit . The receiving and responding unit or the event notifying unit transmits notification data describing the status information supplied with the transaction ID to the target address of communication associated with the transaction ID supplied from the function unit by the transmitted method. Accordingly the receiving and responding unit or the event notifying unit transmits the status of processing to the request source of the processing by the designated method. Alternatively the function unit may only supply a processing request to the receiving and responding unit and the receiving and responding unit may analyze the designated notification target.

The middleware layer is a layer that executes general purpose processing at an intermediate position between the function layer and the hardware layer . The hardware layer is a layer that physically realizes processing such as image reading or image formation. The middleware layer and the hardware layer execute various processing such as scan processing FAX processing and print processing processing for respectively providing the scan function FAX function and print function in addition to the above described copy processing. The copy processing includes image reading processing by the image reading unit and image forming processing by the image forming unit shown in . The scan processing includes the image reading processing. Also the print processing includes communication processing by the first communication unit and the image forming processing. The scan processing includes for example data communication processing using the second communication unit writing processing of writing data in the memory and reading processing of reading stored data from the memory . When the middleware layer and the hardware layer execute processing the middleware layer and the hardware layer supply the above described status information information indicating the state of processing being executed to the function layer .

At least one of the receiving and responding unit the event notifying unit the operation image managing unit and the function unit shown in is an example of the first receiving unit the transmitting unit the second receiving unit the establishing unit and the disconnecting unit shown in . At least one of the UI controller the device controller and the communication unit is an example of the acquiring unit the first transmitting unit the receiving unit the second transmitting unit and the third transmitting unit .

Examples of operations executed by the device and apparatus when status information is transmitted by the first to fourth methods are described first with reference to .

The middleware layer executes the instructed processing that is the parameter change in cooperation with the hardware layer step S and supplies information indicating the result as status information to the receiving and responding unit S . The receiving and responding unit generates notification data describing the supplied status information in this example parameter change result step S . The receiving and responding unit transmits a HTTP response including the generated notification data to the display device being the request source of the processing step S . The controller of the display device causes the display of the display device to display the status information included in the transmitted HTTP response step S .

When the receiving and responding unit instructs the middleware layer to execute the copy processing based on the interpreted content step S the middleware layer and the hardware layer cooperatively execute the processing based on the instructed content copy processing step S . The receiving and responding unit transmits a HTTP response indicating reception of the request for the copy processing after the instruction for the copy processing to the display device as a response to the HTTP request received in step S step S . The controller of the display device causes the display of the display device to display the content in accordance with the received HTTP response step S . Alternatively the operation in step S may be executed before the operation in step S or S.

In the second method a notification of processing status and a notification of processing completion in response to a processing request from the display device are acquired by the display device such that the display device executes polling processing in response to the HTTP request. The controller of the display device executes the polling processing by transmitting a notification request HTTP request for requesting a notification of the status of the copy processing after the controller receives the response to the request for the copy processing S . If status information of the copy processing is not supplied yet the receiving and responding unit of the information processing apparatus transmits a HTTP response indicating the situation to the display device step S . Operations in step S and S are repeated.

When a copy an image indicating a read document is output to a medium the middleware layer of the information processing apparatus detects the output step S and supplies status information indicating a status in which the copy is output to the medium to the receiving and responding unit step S . When the receiving and responding unit receives a notification request HTTP request after the status information is supplied step S the receiving and responding unit generates notification data including the status information step S and transmits the notification data in a manner included in the HTTP response to the display device step S . The controller of the display device causes the display of the display device to display the content corresponding to the notification data step S similarly to step S.

The operation shown in is started by a trigger that the user executes an operation to start copy similarly to . First when the controller of the display device receives the operation to start copy step S the controller executes processing for establishing a WebSocket session with respect to the information processing apparatus . That is the controller transmits a HTTP request being a handshake request of WebSocket to the information processing apparatus . The HTTP request includes a client ID for identifying the display device .

The interface of the information processing apparatus executes switching to WebSocket in response to the HTTP request received from the display device . The receiving and responding unit transmits a handshake response of WebSocket to the display device and accordingly the WebSocket session hereinafter merely referred to as session is established between the display device and the information processing apparatus step S . The timing at which the session is established is not limited to the above described timing. For example the session establishing processing may be executed at a timing when the user starts up a web browser by using the display device and executes an operation of making an access to the URL Uniform Resource Locator of the information processing apparatus .

Also the receiving and responding unit stores the client ID included in the received HTTP request in a predetermined region of the memory hereinafter referred to as cache region not illustrated . The client ID stored in the cache region remains for a predetermined term and then is deleted if it is detected that the session is disconnected by normal processing. That is the cache region stores a client ID of a display device in the middle of establishment of a session with respect to the information processing apparatus and a client ID of a display device whose session is disconnected in the middle of processing.

In processing of step S and later the display device and the information processing apparatus exchange a message by using the protocol of HTTP or WebSocket. In the following description a message transmitted and received by using HTTP and a message transmitted and received by using WebSocket are merely collectively referred to as message unless otherwise these messages have to be distinguished from one another. The receiving and responding unit of the information processing apparatus stores the message transmitted by the information processing apparatus in the cache region together with the client ID transaction ID and sequence ID applied to the message. The sequence ID is identification information for identifying the message. Also the controller of the display device stores a pair of the transaction ID and the sequence ID applied to the message received by the display device in a cache region hereinafter referred to as cache region not illustrated of the display device . The cache region may be included in the memory or may be provided in the RAM. The set of IDs stored in the cache region is referenced if the session is disconnected in the middle of processing.

The description returns to . When the WebSocket session is established the controller transmits a HTTP request including data describing that the above described third method is requested to the information processing apparatus step S . When the receiving and responding unit of the information processing apparatus receives the HTTP request the receiving and responding unit transmits the content of the request described in the data included in the received HTTP request to the middleware layer step S . The middleware layer receives the transmitted request and executes setting for transmission of state information by hereinafter using the third method with respect to the display device step S . For example the middleware layer changes a flag indicating whether or not a notification is made by the third method to ON.

The operation from step S to step S and the operation in step S and step S shown in are executed. Then when the middleware layer and the hardware layer of the information processing apparatus execute the operation in step S detection of copy output since the flag is ON the middleware layer and the hardware layer supply status information indicating that a copy is output to a medium to the event notifying unit instead of the receiving and responding unit step S . The event notifying unit generates notification data describing the supplied status information the number of copies etc. step S and transmits the generated data to the display device through the WebSocket session established in step S step S . The controller of the display device causes the display of the display device to display the content described in the received data for example status information C shown in step S .

When the middleware layer and the hardware layer complete the copy processing step S the middleware layer and the hardware layer supply status information indicating the completion to the event notifying unit step S . The event notifying unit generates notification data describing the status information for example notification data including a character string of copy is completed step S and transmits the generated notification data to the display device in a manner included in a message of WebSocket step S . The controller of the display device causes the display of the display device to display the content described in the notification data received in step S for example status information C shown in step S .

Alternatively as described above a status different depending on the display device may be notified. In this case before step S the controller transmits notification data describing a state to be notified to the display device to the information processing apparatus through the communication unit . The event notifying unit which has received the notification data through the interface stores the status to be notified in association with the target address of the display device . If status information supplied in step S represents the stored status to be notified the event notifying unit makes a notification about the status.

First the user U executes an operation on the display device to start up a web browser and make an access to the URL of the information processing apparatus . At this time the user U inputs user account information an example of authentication information used for log in to the information processing apparatus by using the operation unit of the display device . In this example a user ID and a password are used as the account information. The user ID is identification information allocated to each user.

In step S the controller of the display device starts up a web browser. In step S the controller establishes TCP Transmission Control Protocol connection an example of a first communication path to the information processing apparatus and transmits a HTTP request authentication request including the input account information to the information processing apparatus through the established TCP connection.

The receiving and responding unit receives the HTTP request transmitted from the display device . The receiving and responding unit supplies the account information included in the HTTP request to the function unit . In step S the function unit executes user authentication based on whether or not the supplied account information is stored in the authentication database not shown stored in the memory . If the account information supplied to the function unit is stored in the authentication database the user authentication is successful. In contrast if the account information is not stored in the authentication database the user authentication is failed. shows a case in which the account information of the user U is registered in the authentication database. Since the account information of the user U is registered in the authentication database the user authentication is successful.

If the user authentication is successful in step S the function unit registers the user ID of the user U succeeded in the user authentication in a user management table of the memory see step S . The user management table is a table for managing the log in state and connection state of the user.

The description returns to . In step S the function unit generates an access token used for establishing the session of WebSocket. In this access token a term of validity for example three minutes since an access token is generated is set. In step S the function unit registers the generated access token in the user management table in association with the user ID of the user U. Also the function unit supplies the generated access token to the receiving and responding unit . The function unit issues a timer corresponding to the term of validity set by the access token at a timing when the function unit supplies the access token. The access token registered in the user management table becomes invalid if an establishment request for a session including the access token is not received from the display device before the timeout of the timer and the access token is deleted from the user management table . In contrast if an establishment request for the session including the access token is received from the display device before the timeout of the timer the access token is kept valid without being deleted from the user management table . In this case the access token stored in the user management table is referenced if the session is disconnected and re connection processing is executed.

In step S the receiving and responding unit generates a HTTP response including information indicating the access token and the result of the user authentication supplied from the function unit and transmits the generated HTTP response to the display device through the interface .

If the controller of the display device receives the HTTP response indicating success of the user authentication the process goes to step S. In contrast if the controller receives the authentication result indicating failure of the user authentication subsequent processing is not executed and the processing is ended. In this example the display device receives the HTTP response indicating success of the user authentication and the process goes to step S. In step S the controller stores the access token included in the received HTTP response in a predetermined cache region hereinafter referred to as cache region of the memory or the RAM. In step S the controller establishes TCP connection to the information processing apparatus being the transmission source of the access token and transmits a HTTP request being a handshake request of WebSocket through the TCP connection. The HTTP request includes the access token received in step S.

The receiving and responding unit receives the handshake request from the display device . The receiving and responding unit specifies whether the received handshake request includes the access token. If the access token is included the receiving and responding unit supplies the access token to the function unit . In step S if the access token is supplied from the receiving and responding unit the function unit verifies whether the supplied access token is registered in the user management table . If the access token is stored in the user management table log in by the user U is successful. In contrast if the access token is not stored in the user management table log in by the user U is failed. In this example since the supplied access token is registered in the user management table log in is successful. In step S the function unit changes the value of log in state corresponding to the user ID of the user U to the value indicating logged in in the user management table . In step S the function unit notifies the interface about that the verification of the access token is successful.

If the interface is notified about that the verification of the access token is successful from the function unit the process goes to processing in step S and later. In contrast if a notification about that the verification of the access token is failed the interface does not execute subsequent processing and responds to the display device about the failure of log in. In this exemplary embodiment the interface is notified about that the verification of the access token is successful and the process goes to step S. In step S the interface executes switching to WebSocket in response to the HTTP request received from the display device in step S. The interface executes a handshake response of WebSocket and accordingly a session of WebSocket an example of a second communication path is established between the display device and the information processing apparatus .

When the session is established in step S the success in establishment of the session is notified from the interface to the function unit through the receiving and responding unit . In step S the function unit changes the value of connection state corresponding to the user ID of the user U to the value indicating connected in the user management table .

In step S the controller displays success in log in to the information processing apparatus on the display .

In this exemplary embodiment as described above as the communication path for exchange of data between the display device and the information processing apparatus the communication path using HTTP on the TCP connection an example of a first communication path and the WebSocket session on the TCP connection an example of a second communication path are both used. In the following description for the convenience of description the communication path using HTTP on the TCP connection is referred to as first channel and the WebSocket session is referred to as second channel. 

By the processing to step S log in processing using the display device is executed. When the log in processing is ended the user U executes an operation for using various functions provided by the information processing apparatus by using the display device . The information processing apparatus executes various processing in accordance with a processing request transmitted from the display device . For example if the copy processing is instructed by the user U the copy function is provided by executing the above described series of processing shown in or executing a series of processing excluding the processing in step S shown in the establishment processing of the WebSocket session . Also for example if parameter change relating to the copy processing is instructed a parameter change function is provided by executing the above described series of processing shown in . Also for example if the housing portion of media is opened while being logged in the user U is notified about that the housing portion of paper is not set by executing the above described series of processing shown in .

After the processing in step S if the series of processing shown in or the series of processing shown in is executed data is exchanged through the first channel. In contrast if the processing shown in is executed the first channel and the second channel that is the WebSocket session established in step S to step S both are used. Also the series of processing shown in executes transmission of a message through the second channel that is the WebSocket session established in step S to step S .

In step S the controller detects disconnection of the second channel. When the disconnection of the second channel is detected in step S the controller reads an access token stored in the cache region . In step S the controller establishes again TCP connection and transmits a handshake request of WebSocket through the established TCP connection. The handshake request includes the access token read in step S.

Also the interface of the information processing apparatus also detects disconnection of the second channel in step S. In step S the interface notifies the function unit about that the disconnection of the second channel is detected. In step S the function unit changes the value of connection state in the user management table corresponding to the disconnected second channel to the value indicating disconnected. Also in step S the function unit issues a timer corresponding to a term of validity of an access token corresponding to the disconnected second channel. The access token registered in the user management table becomes invalid if an establishment request for the second channel including the access token handshake request of WebSocket is not received from the display device before the timeout of the issued timer. If the access token becomes invalid information relating to the user corresponding to the timeout access token user ID access token etc. is deleted from the user management table . In contrast if an establishment request for the second channel including the access token is received from the display device before the timeout of the issued timer the access token is kept valid without being deleted from the user management table .

In step S the interface receives the handshake request transmitted in step S and supplies the access token included in the received request to the function unit . shows an operation if the handshake request transmitted in step S is supplied to the function unit before the timeout of the timer issued in step S. In step S the function unit verifies whether the supplied access token is registered in the user management table . If the supplied access token is stored in the user management table authentication is successful. In contrast if the supplied access token is not stored in the user management table authentication is failed. In this example since the supplied access token is registered in the user management table authentication is successful. In step S the function unit changes the value of connection state corresponding to the supplied access token to the value indicating connected in the user management table . In step S the function unit notifies the interface about that the verification of the access token is successful.

In step S the interface executes a handshake response to the handshake request received from the display device in step S. Accordingly the second channel is established again between the display device and the information processing apparatus . In step S the controller causes the display to display that the second channel is re connected.

Meanwhile in software using plural communication protocols if authentication information is required for each of the communication protocols input of authentication information corresponding to each of the communication protocols by the user may be troublesome work. In contrast according to this exemplary embodiment if user authentication of a first communication protocol HTTP by the information processing apparatus is successful an access token is transmitted through a communication path of the first communication protocol and the access token is used as authentication information for communication according to other communication protocol WebSocket . Accordingly an operation load relating to user authentication is reduced in a system using plural communication protocols.

The above described exemplary embodiment is merely an example of implementation of the present invention and may be modified as follows. Also the above described exemplary embodiment and respective modifications described below may be combined and implemented as required.

In the above described exemplary embodiment the controller stores the access token received from the information processing apparatus in a cache region not illustrated as shown in step S in . However the access token does not have to be cached. If the access token is not cached when the re connection processing of the second channel is executed the controller transmits the acquisition request for the access token to the information processing apparatus through the first channel instead of executing the processing shown in step S and step S in in the above described exemplary embodiment. That is the controller transmits the acquisition request for the access token to the information processing apparatus through the first channel permitted for communication after the second channel is disconnected.

In this case when the function unit receives the acquisition request through the interface the function unit generates again an access token and transmits the generated access token to the display device through the first channel permitted for communication. In this example since the access token is issued again reliability of security is higher than a case in which the cached access token is re used.

In the above described exemplary embodiment if it is determined that the term of validity of the access token included in the re connection request for the second channel transmitted by the controller in step S in is ended the function unit transmits a response indicating that situation to the display device . If the controller receives the response indicating that the access token is invalid from the information processing apparatus the controller may transmit an acquisition request for an access token for opening the second channel through the first channel permitted for communication.

In the above described exemplary embodiment as shown in when the function unit detects disconnection of the second channel the function unit issues a timer and waits for reception of a re connection request for the second channel from the display device until the timeout of the timer. The processing executed by the function unit if the second channel is disconnected is not limited to this processing. For example if the second channel is disconnected the function unit may disconnect the first channel to software to which the disconnected second channel has been established. In this case the establishment processing of the first channel and the second channel has to be executed again. Hence reliability of security is higher than a case in which the first channel is continuously used without disconnection.

In the above described exemplary embodiment the function unit sets the term of validity for the access token however the term of validity does not have to be set for the access token. Also the function unit may issue an access token in which a different term of validity is set depending on the type of display device that executes authentication and makes an access request or depending on the type of processing request transmitted together with the authentication and the access request. For example for a request from the operation device being a local UI unit since the request is less likely a request from a malicious user or client device the term of validity is set relatively long. Also in a case of a request from an external device such as the user device being a remote UI unit since the request is more likely a request from a malicious user or client device an access token may be issued while the term of validity is set relatively short.

In the above described exemplary embodiment if an asynchronous channel may not be opened the controller may execute active switching to polling processing processing using the above described second method . In this case the controller may check the net status by polling and if it is determined that the asynchronous channel is able to be opened the asynchronous channel may be opened and the processing execution method may be switched from the second method to the third method.

In the above described exemplary embodiment the user management table exemplarily shown in is used however the content of the user management table is not limited thereto. The user management table may store information other than the information shown in . Also in the example in the user ID and the access token are stored in an associated manner however identification information stored in association with an access token is not limited to the user ID. For example an access token and a client ID for identifying the display device or a browser or an application operable in the display device may be stored in an associated manner. The identification information stored in association with the access token may be any information as long as the correspondence between the first channel and the second channel may be recognized.

In the above described exemplary embodiment if user authentication of the first communication protocol HTTP is successful the information processing apparatus transmits the access token through the communication path of HTTP and uses the access token as authentication information for communication using the second communication protocol WebSocket . Instead of this authentication information used for communication of the first communication protocol may be transmitted through the communication path of the second communication protocol. In this case the information processing apparatus may establish a channel of WebSocket to the display device and execute authentication and then may transmit authentication information an access token etc. used for communication of HTTP through the channel of WebSocket. The display device may transmit the authentication information received from the information processing apparatus in a manner included in a HTTP request and may transmit the HTTP request to the information processing apparatus .

In this exemplary embodiment the user device includes the communication unit that executes wireless communication conforming to the standard of wireless LAN however it is not limited thereto. For example the user device may include a communication unit that executes communication conforming to the standard of wired LAN similarly to the communication unit of the operation device . In this case the user device is connected through a communication cable to a router or a hub of the wired LAN. The communication unit of the user device in this case also functions as a communication unit that communicates with the above described other communication device router or hub . Alternatively the user device may include a communication unit that executes wireless communication conforming to for example the standard of Bluetooth registered trademark or NFC Near field communication as a communication unit that executes wireless communication.

In the exemplary embodiment the first communication unit of the information processing apparatus has communication with the communication unit of the operation device under the standard of wired LAN however it is not limited thereto. For example communication conforming to USB Universal Serial Bus or HDMI registered trademark High Definition Multimedia Interface may be executed or wireless communication conforming to the standard of wireless LAN Bluetooth registered trademark or NFC Near field communication may be executed. In any of these cases the communication unit of the operation device communicates with the first communication unit of the information processing apparatus without the communication device such as a router or a hub. As described above the communication unit of the operation device functions as a communication unit that communicates with the information processing apparatus without the other communication device.

Also in the above described exemplary embodiment the information processing apparatus and the display device exchange data by using the two types of communication protocols of HTTP and WebSocket however the communication protocols to be used are not limited thereto. The communication protocols to be used by the information processing apparatus and the display device may be any communication protocols as long as these are a first communication protocol that synchronously exchange information such that the information processing apparatus web server transmits a response to a request transmitted from the display device web client and a second communication protocol for asynchronously transmission of a notification from the information processing apparatus to the display device .

Also in the above described exemplary embodiment the information processing apparatus and the display device may exchange data under the standard of SOAP Simple Object Access Protocol . Also the conforming protocol when data is exchanged between the information processing apparatus and the display device is not limited thereto. The information processing apparatus and the display device may communicate with each other under for example REST Representational State Transfer or SGML Standard Generalized Markup Language .

The operation device includes the controller the memory and the communication unit as shown in according to the exemplary embodiment however the operation device may not include these units.

The communication unit and the UI unit are connected to a bus in the information processing apparatus and are controlled by the controller . The communication unit is also connected to the first communication unit . The UI unit includes a display screen and a touch sensor overlaid on the display screen. The UI unit receives an operation from a user and displays an image. The UI unit supplies operation data corresponding to the received operation of the user to the controller . The controller executes processing corresponding to the operation data. In this modification the controller executes a program of a browser and hence realizes the functions of the display device shown in FIG. .

The operation device is fixed to the housing of the information processing apparatus according to the exemplary embodiment and the above described modification however the operation device may not be fixed to the housing. For example the operation device may be used as a remote controller without being fixed to the housing of the information processing apparatus.

The operation device is connected to the first communication unit through a communication cable and is used by a user in an installed state in the installation portion. The operation device is used as a local display device that communicates with the information processing apparatus without other communication device similarly to the operation device according to the exemplary embodiment. The user may remove the cable from the operation device and bring the operation device to other location and use the operation device for other purpose of use. In the example in instead of the operation device other device that functions as an operation unit for example the user device shown in etc. may be connected. Alternatively the operation device may be connected to the communication device and may communicate with the information processing apparatus through the communication device and the communication line .

In the above described exemplary embodiment the operation in case of copy processing is described. However the processing to be executed by the information processing apparatus is not limited to the copy processing. The processing to be executed by the information processing apparatus may be the above described image reading processing or image forming processing.

In the above described exemplary embodiment the controller receives an operation of the user by the touch sensor however a receiving method of an operation of the user is not limited thereto. For example if the display device is a tablet terminal an operation may be received with a button provided at the housing. Also if the display device is a personal computer an operation may be received with a keyboard or a mouse.

The event notifying unit transmits data which is notified as message information by using the communication protocol conforming to the standard of WebSocket in the exemplary embodiment however it is not limited thereto. For example by using a technique called Comet the event notifying unit may hold a HTTP request transmitted from the UI controller of the display device and the event notifying unit may transmit status information in response to the held HTTP request by a trigger that a message to be transmitted for example update of status information is generated. With the method using Comet similarly to the exemplary embodiment the status of processing is quickly transmitted to the user as compared with a case in which the transmission is executed in response to the request from the operation device.

In this exemplary embodiment the authentication executed when the user U uses the various functions provided by the information processing apparatus by operating the display device is described with reference to the sequence diagram shown in etc. however the timing at which the authentication is executed is not limited thereto. For example the authentication may be executed when the user U operates the display device for log in and the display device establishes connection to the information processing apparatus .

In addition to the information processing apparatus the display device the communication device and the information processing system including these apparatus and devices the present invention may be interpreted as an image processing method for realizing processing executed by these apparatus and devices. Also the present invention may be interpreted as a program for causing a computer serving as any of the information processing apparatus and the display device to function as the above described respective units. This program may be provided in the form of storage medium such as an optical disc storing the program or may be provided by downloading the program in a computer through a communication line such as the Internet installing the program in the computer and using the program.

The foregoing description of the exemplary embodiment of the present invention has been provided for the purposes of illustration and description. It is not intended to be exhaustive or to limit the invention to the precise forms disclosed. Obviously many modifications and variations will be apparent to practitioners skilled in the art. The embodiment was chosen and described in order to best explain the principles of the invention and its practical applications thereby enabling others skilled in the art to understand the invention for various embodiments and with the various modifications as are suited to the particular use contemplated. It is intended that the scope of the invention be defined by the following claims and their equivalents.

